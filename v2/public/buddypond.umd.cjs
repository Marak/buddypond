(function(r,o){typeof exports=="object"&&typeof module<"u"?module.exports=o():typeof define=="function"&&define.amd?define(o):(r=typeof globalThis<"u"?globalThis:r||self,r.BP=o())})(this,function(){"use strict";let r="http://192.168.200.59:5174";const o={};return window.bp=o,o.log=console.log,o.log=function(){},o.error=console.error,o.config={},o.apps={},o.data={},o._modules={},o.setConfig=function(e,t=!1){console.log("setConfig",e,t),t?o.config={...o.config,...e}:o.config=e},o.start=async function(e=[]){for(let t of e)await o.importModule(t)},o.open=async function(e,t={context:"default"}){console.log("bp.open",e,t);let n=e;typeof e=="string"&&(console.log("string loading async import app",n),await o.importModule(n,{},!0)),typeof e=="object"&&(n=e.name,t=e,console.log("object loading async import app",n,t),await o.importModule(n,t,!0)),console.log("aaa",n,o.apps),typeof o.apps[n].open=="function"&&(console.log("open",n,t),console.log("open",n,t),o.apps[n].open(t))},o.load=async function(e){if(typeof e=="string"){if(e.endsWith(".css"))return o.appendCSS(e);if(e.endsWith(".js"))return o.appendScript(e);if(!e.includes("."))return o.importModule(e)}console.log("Cannot load unknown resource type",e)},o.importModule=async function(e,t,n=!0){console.log("importModule",e,t,n);let i=r+`/v2/apps/based/${e}/${e}.js`,s=e;if(typeof e=="object"&&(i=r+`/v2/apps/based/${e.name}/${e.name}.js`,t=e,s=e.name),n||(i=e),o._modules[i]){console.log("module already loaded",e);return}try{o.log("modulePath",i);let a=await import(i);n&&(o.apps[s]=new a.default(o,t),await o.apps[s].init(),o.log("init complete",s)),o._modules[i]=a}catch(a){o.error("Failed to load module:",s,a),delete o.apps[s]}},o.fetchHTMLFragment=function(e){let t=`${r}${e}`;return fetch(t).then(n=>n.text())},o.appendCSS=function(e){let t=e;!e.includes("http")&&!e.includes("blob")&&(t=`${r}${e}`);let n=document.createElement("link");n.rel="stylesheet",n.href=t,document.head.appendChild(n)},o.appendScript=async function(e){let t=e;!e.includes("http")&&!e.includes("blob")&&(t=`${r}${e}`);let n=document.createElement("script");return n.src=t,document.head.appendChild(n),new Promise((i,s)=>{n.onload=i,n.onerror=s})},o.createWorker=async function(e,t={}){let n=`${r}/v2${e}`;o.log("createWorker",n);try{const s=await(await fetch(n)).blob(),a=URL.createObjectURL(s);let c=t||{};const f=new Worker(a,c);return o.log("Local Worker created from:",e),f}catch(i){return console.error("Failed to load worker script:",e,i),null}},o._emitters={},o.emit=function(e,...t){o.log("emit",e,...t),o._emitters[e]&&o._emitters[e].forEach(n=>{n.callback&&n.callback(...t)})},o.on=function(e,t,n){if(!e||!t||!n)throw new Error("Missing required parameters for on()");o._emitters[e]||(o._emitters[e]=[]),o._emitters[e].push({label:t,callback:n}),o.log("on",e,t)},o.off=function(e,t){o.log("off",e,t),o._emitters[e]&&(o._emitters[e]=o._emitters[e].filter(n=>n.label!==t))},o.me="Guest",o});
