(function(l,t){typeof exports=="object"&&typeof module<"u"?module.exports=t():typeof define=="function"&&define.amd?define(t):(l=typeof globalThis<"u"?globalThis:l||self,l.BP=t())})(this,function(){"use strict";let l="http://192.168.200.59:5174";l="https://137.184.116.145";const t={};return window.bp=t,t.log=console.log,t.log=function(){},t.error=console.error,t.apps={},t.data={},t._modules={},t.start=async function(e=[]){for(let n of e)await t.importModule(n)},t.open=async function(e,n={context:"default"}){console.log("bp.open",e,n);let o=e;typeof e=="string"&&(console.log("string loading async import app",o),await t.importModule(o,{},!0)),typeof e=="object"&&(o=e.name,n=e,console.log("object loading async import app",o,n),await t.importModule(o,n,!0)),console.log("aaa",o,t.apps),typeof t.apps[o].open=="function"&&(console.log("open",o,n),console.log("open",o,n),t.apps[o].open(n))},t.load=async function(e){if(typeof e=="string"){if(e.endsWith(".css"))return t.appendCSS(e);if(e.endsWith(".js"))return t.appendScript(e);if(!e.includes("."))return t.importModule(e)}console.log("Cannot load unknown resource type",e)},t.importModule=async function(e,n,o=!0){console.log("importModule",e,n,o);let i=l+`/v2/apps/based/${e}/${e}.js`,s=e;if(typeof e=="object"&&(i=l+`/v2/apps/based/${e.name}/${e.name}.js`,n=e,s=e.name),o||(i=e),t._modules[i]){console.log("module already loaded",e);return}try{t.log("modulePath",i);let a=await import(i);o&&(t.apps[s]=new a.default(t,n),await t.apps[s].init(),t.log("init complete",s)),t._modules[i]=a}catch(a){t.error("Failed to load module:",s,a),delete t.apps[s]}},t.fetchHTMLFragment=function(e){let n=`${l}${e}`;return fetch(n).then(o=>o.text())},t.appendCSS=function(e){let n=e;!e.includes("http")&&!e.includes("blob")&&(n=`${l}${e}`);let o=document.createElement("link");o.rel="stylesheet",o.href=n,document.head.appendChild(o)},t.appendScript=async function(e){let n=e;!e.includes("http")&&!e.includes("blob")&&(n=`${l}${e}`);let o=document.createElement("script");return o.src=n,document.head.appendChild(o),new Promise((i,s)=>{o.onload=i,o.onerror=s})},t.createWorker=async function(e,n={}){let o=`${l}/v2${e}`;t.log("createWorker",o);try{const s=await(await fetch(o)).blob(),a=URL.createObjectURL(s);let c=n||{};const d=new Worker(a,c);return t.log("Local Worker created from:",e),d}catch(i){return console.error("Failed to load worker script:",e,i),null}},t._emitters={},t.emit=function(e,...n){t.log("emit",e,...n),t._emitters[e]&&t._emitters[e].forEach(o=>{o.callback&&o.callback(...n)})},t.on=function(e,n,o){if(!e||!n||!o)throw new Error("Missing required parameters for on()");t._emitters[e]||(t._emitters[e]=[]),t._emitters[e].push({label:n,callback:o}),t.log("on",e,n)},t.off=function(e,n){t.log("off",e,n),t._emitters[e]&&(t._emitters[e]=t._emitters[e].filter(o=>o.label!==n))},t.me="Guest",t});
