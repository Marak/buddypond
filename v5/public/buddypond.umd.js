(function(t,r){typeof exports=="object"&&typeof module<"u"?module.exports=r():typeof define=="function"&&define.amd?define(r):(t=typeof globalThis<"u"?globalThis:t||self,t.BP=r())})(this,function(){"use strict";const t={};return typeof window<"u"&&(window.bp=t),t.version="6.0.0",t.log=console.log,t.log=function(){},t.error=console.error,t.reportError=function(){},t.config={host:""},t.apps={},t.data={},t.settings={},t._modules={},t.vendor={},t._cache={},t._cache.css={},t._cache.html={},t._cache.js={},t.setConfig=function(e,n=!1){console.log("setConfig",e,n),n?t.config={...t.config,...e}:t.config=e},t.start=async function(e=[]){for(let n of e)await t.importModule(n)},t.open=async function(e,n={context:"default"}){let o=e;if(typeof e=="string"&&await t.importModule(o,{},!0),typeof e=="object"&&(o=e.name,n=e,await t.importModule(o,n,!0)),typeof t.apps[o].open=="function"){let i=await t.apps[o].open(n);i&&typeof i.focus=="function"&&i.focus()}},t.load=async function(e,n={}){if(typeof e=="string"){if(e.endsWith(".css"))return t.appendCSS(e);if(e.endsWith(".html"))return t.fetchHTMLFragment(e);if(e.endsWith(".js"))return t.appendScript(e);if(e.endsWith(".json"))return t.fetchJSON(e);if(!e.includes("."))return t.importModule(e,n)}console.log("Cannot load unknown resource type",e)},t.importModule=async function(e,n,o=!0,i){let s=t.config.host+`/v5/apps/based/${e}/${e}.js`,c=e;if(o&&t.emit("bp::loading",c),typeof e=="object"&&(s=t.config.host+`/v5/apps/based/${e.name}/${e.name}.js`,n=e,c=e.name),o||(s=e),t._modules[s])return t._modules[s];try{let l=await import(s);return o&&(t.apps[c]=new l.default(t,n),typeof t.apps[c].init=="function"?(await t.apps[c].init(n),t.log("init complete",c)):t.log("no init function found",c),i&&(t.emit("bp::loaded",c,l),i(t.apps[c]))),t._modules[s]=l,l}catch(l){t.error("Failed to load module:",c,l),delete t.apps[c]}},t.fetchHTMLFragment=async function(e){let n=`${t.config.host}${e}`;return t._cache.html[n]||(t._cache.html[n]=await fetch(n).then(o=>o.text())),t._cache.html[n]},t.fetchJSON=async function(e){return fetch(e).then(n=>n.json())},t.appendCSS=async function(e,n=!1){let o=e;if(!e.includes("http")&&!e.includes("blob")&&(o=`${t.config.host}${e}`),o+="?v="+t.version,t._cache.css[o]&&!n)return"cached";t._cache.css[o]=new Date().getTime();let i=document.createElement("link");return i.rel="stylesheet",i.href=o,new Promise((s,c)=>{i.onload=()=>{s("loaded")},i.onerror=()=>{c(new Error(`Failed to load CSS from ${o}`))},document.head.appendChild(i)})},t.appendScript=async function(e){let n=e;!e.includes("http")&&!e.includes("blob")&&(n=`${t.config.host}${e}`);let o=document.createElement("script");return o.src=n,document.head.appendChild(o),new Promise((i,s)=>{o.onload=i,o.onerror=s})},t.createWorker=async function(e,n={}){let o=`${t.config.host}/v5${e}`;t.log("createWorker",o);try{const s=await(await fetch(o)).blob(),c=URL.createObjectURL(s);let l=n||{};const a=new Worker(c,l);return t.log("Local Worker created from:",e),a}catch(i){return console.error("Failed to load worker script:",e,i),null}},t._emitters={},t.emit=function(e,...n){t.log("emit",e,...n),t._emitters[e]&&t._emitters[e].forEach(o=>{o.callback&&o.callback(...n)})},t.on=function(e,n,o){if(!e||!n||!o)throw new Error("Missing required parameters for on(). Try: bp.on(event, label, callback). All Event Emitter require a label");t._emitters[e]||(t._emitters[e]=[]),t._emitters[e].push({label:n,callback:o}),t.log("on",e,n)},t.off=function(e,n){t.log("off",e,n),t._emitters[e]&&(t._emitters[e]=t._emitters[e].filter(o=>o.label!==n))},t.set=function(e,n){const o=e.split(".");let i=t.settings,s="";o.slice(0,-1).forEach((l,a)=>{s+=(a>0?".":"")+l,i[l]||(i[l]={}),i=i[l],t.emit(`settings::${s}`,i)});const c=o[o.length-1];s+=(s?".":"")+c,i[c]=n,t.emit("settings",e,n),t.emit(`settings::${s}`,n)},t.get=function(e){const n=e.split(".");let o=t.settings;for(const i of n){if(o[i]===void 0)return;o=o[i]}return o},t.play=async function(){await t.importModule("play"),t.play.call(this,...arguments)},t.focus=function(){},t.isMobile=function(){return window.innerWidth<=767&&("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)},t.me="Guest",t});
