{"version":3,"file":"vision-harp.js","sources":["../../../apps/based/vision-harp/vision-harp.js"],"sourcesContent":["export default class VisionInstrument {\n    constructor(bp, options = {}) {\n        this.bp = bp;\n        this.options = options;\n        this.numStrings = 8;\n        this.lastPlucked = {}; // Map finger ID to last string index\n        this.stringVibrations = Array(this.numStrings).fill(0);\n\n        this.lastPluckTime = Array(this.numStrings).fill(0); // Track last pluck time\n        this.cooldown = 100; // Cooldown in milliseconds\n\n        this.fingerPositions = {}; // Track previous finger positions\n        this.velocityThreshold = 0.05; // Minimum movement speed to trigger a note\n\n        this.fingerTrails = {}; // Maps fingerID â†’ array of {x, y, time}\n        this.trailDuration = 500; // ms\n\n\n        return this;\n    }\n\n    async init() {\n        await this.bp.appendScript('https://cdn.jsdelivr.net/npm/@mediapipe/hands');\n        await this.bp.appendScript('https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils');\n        await this.bp.appendScript('https://cdnjs.cloudflare.com/ajax/libs/tone/15.2.6/Tone.js');\n        await this.bp.appendCSS('/v5/apps/based/vision-harp/vision-harp.css');\n        this.html = await this.bp.load('/v5/apps/based/vision-harp/vision-harp.html');\n\n        return 'loaded VisionInstrument';\n    }\n\n    async open() {\n\n        if (this.win) {\n            console.log('VisionInstrument window is already open');\n            this.win.restore();\n            this.win.focus();\n            return this.win; // Return existing window if already open\n        }\n\n        this.win = this.bp.window(this.window());\n\n        // this should be in open, not init\n        // Create a polyphonic synth with harp-like settings\n        this.synth = new Tone.PolySynth(Tone.FMSynth, {\n            harmonicity: 3,\n            modulationIndex: 10,\n            oscillator: { type: 'sine' },\n            envelope: {\n                attack: 0.01,\n                decay: 0.2,\n                sustain: 0.5,\n                release: 1.5\n            }\n        });\n\n        // Add effects chain: gain -> reverb -> destination\n        const chorus = new Tone.Chorus(4, 2.5, 0.3).start();\n        const reverb = new Tone.Reverb({ decay: 3, wet: 0.4 }).toDestination();\n        const gain = new Tone.Gain(0.7).connect(chorus).connect(reverb);\n        this.synth.connect(gain);\n\n        gain.toDestination();\n\n\n\n        this.startLoadingSequence();\n        this.startVisionInstrument();\n        this.win.maximize();\n        return this.win;\n    }\n\n    window() {\n        const content = this.html;\n        return {\n            id: 'vision-harp',\n            title: 'Vision Harp',\n            icon: 'desktop/assets/images/icons/icon_vision-harp_64.png',\n            x: 300,\n            y: 100,\n            width: 700,\n            height: 520,\n            minWidth: 400,\n            content,\n            parent: $('#desktop')[0],\n            resizable: true,\n            maximizable: true,\n            closable: true,\n\n            onClose: () => {\n                this.win = null; // Clear reference on close\n                // close the camera\n                this.video.srcObject.getTracks().forEach(track => track.stop());\n                this.video = null;\n            }\n\n\n        };\n    }\n\n    async startVisionInstrument() {\n        this.video = document.getElementById('video');\n        const canvas = document.getElementById('video-harp-canvas');\n        const ctx = canvas.getContext('2d');\n        const noteIndicator = document.getElementById('note-indicator');\n\n        const stream = await navigator.mediaDevices.getUserMedia({ video: true });\n        this.video.srcObject = stream;\n\n        await new Promise(resolve => this.video.onloadeddata = resolve);\n        this.video.play();\n\n        const hands = new Hands({\n            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`\n        });\n\n        hands.setOptions({\n            maxNumHands: 2,\n            modelComplexity: 1,\n            minDetectionConfidence: 0.7,\n            minTrackingConfidence: 0.7,\n            selfieMode: true // Add this to flip landmarks for mirrored cameras\n        });\n\n        const camera = new Camera(this.video, {\n            onFrame: async () => await hands.send({ image: this.video }),\n            width: 640,\n            height: 480,\n        });\n        camera.start();\n\n        let firstResults = false\n\n\n        hands.onResults((results) => {\n\n            if (!firstResults) {\n                firstResults = true;\n                $('.vision-harp-loading', this.win.content).fadeOut(300);\n            }\n\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            // ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);\n\n            const width = canvas.width;\n            const height = canvas.height;\n\n            // Animate vibrating strings\n            for (let i = 0; i < this.numStrings; i++) {\n                const x = i * width / this.numStrings + width / (2 * this.numStrings);\n                const vibration = this.stringVibrations[i];\n                const offset = Math.sin(Date.now() / 30) * vibration * 5;\n\n                ctx.beginPath();\n                ctx.moveTo(x + offset, 0);\n                ctx.lineTo(x - offset, height);\n                // Color strings differently\n                const hue = (i * 360 / this.numStrings) % 360;\n                ctx.strokeStyle = `hsla(${hue}, 70%, 70%, 0.8)`;\n                ctx.lineWidth = 2 + vibration; // Thicker when vibrating\n                ctx.stroke();\n\n                this.stringVibrations[i] *= 0.9;\n            }\n            if (!results.multiHandLandmarks) {\n                this.fingerPositions = {}; // Reset positions if no hands detected\n                return;\n            }\n\n            for (let handIndex = 0; handIndex < results.multiHandLandmarks.length; handIndex++) {\n                const hand = results.multiHandLandmarks[handIndex];\n                const fingers = [4, 8, 12, 16, 20]; // Finger tip indices\n\n                for (let f = 0; f < fingers.length; f++) {\n\n                    const fingerLandmarkIndex = fingers[f];\n                    if (!this.isFingerExtended(hand, fingerLandmarkIndex)) continue;\n\n                    const tip = hand[fingers[f]];\n                    const x = tip.x * width;\n                    const y = tip.y * height;\n\n                    ctx.beginPath();\n                    ctx.arc(x, y, 6, 0, 2 * Math.PI);\n                    ctx.fillStyle = 'rgba(255,255,255,0.85)';\n                    ctx.fill();\n\n                    const fingerID = `${handIndex}-${f}`;\n\n\n                    // Store ghost trail\n                    if (!this.fingerTrails[fingerID]) this.fingerTrails[fingerID] = [];\n                    this.fingerTrails[fingerID].push({ x, y, time: Date.now() });\n\n                    // Prune old trail points\n                    this.fingerTrails[fingerID] = this.fingerTrails[fingerID].filter(p => Date.now() - p.time < this.trailDuration);\n\n\n                    const stringWidth = width / this.numStrings;\n                    const offset = stringWidth / 2;\n                    const stringIndex = Math.floor((x + offset) / stringWidth);\n\n                    // Calculate velocity\n                    let velocity = 0;\n                    if (this.fingerPositions[fingerID]) {\n                        const prev = this.fingerPositions[fingerID];\n                        const dx = x - prev.x;\n                        const dy = y - prev.y;\n                        velocity = Math.sqrt(dx * dx + dy * dy);\n                    }\n                    this.fingerPositions[fingerID] = { x, y };\n\n                    // Trigger note only if moving fast enough and not recently plucked\n                    if (velocity > this.velocityThreshold && this.lastPlucked[fingerID] !== stringIndex) {\n                        this.playNote(stringIndex);\n                        this.lastPlucked[fingerID] = stringIndex;\n                        noteIndicator.innerText = `ðŸŽµ Finger ${f + 1} hit string ${stringIndex + 1}`;\n                    }\n                }\n            }\n\n            for (const trail of Object.values(this.fingerTrails)) {\n                for (const p of trail) {\n                    const age = Date.now() - p.time;\n                    const alpha = 1 - age / this.trailDuration;\n                    ctx.beginPath();\n                    ctx.arc(p.x, p.y, 5, 0, 2 * Math.PI);\n                    ctx.fillStyle = `rgba(0, 255, 255, ${alpha.toFixed(2)})`;\n                    ctx.fill();\n                }\n            }\n\n        });\n    }\n\n    isFingerExtended(landmarks, tipIndex) {\n        const mcp = landmarks[tipIndex - 3]; // MCP joint (base of finger)\n        const pip = landmarks[tipIndex - 2]; // PIP joint (mid)\n        const dip = landmarks[tipIndex - 1]; // DIP joint\n        const tip = landmarks[tipIndex];     // fingertip\n\n        // Calculate angles between joints: tip -> dip -> pip -> mcp\n        const vec1 = { x: dip.x - tip.x, y: dip.y - tip.y };\n        const vec2 = { x: pip.x - dip.x, y: pip.y - dip.y };\n        const vec3 = { x: mcp.x - pip.x, y: mcp.y - pip.y };\n\n        const dot1 = vec1.x * vec2.x + vec1.y * vec2.y;\n        const dot2 = vec2.x * vec3.x + vec2.y * vec3.y;\n\n        const len1 = Math.hypot(vec1.x, vec1.y);\n        const len2 = Math.hypot(vec2.x, vec2.y);\n        const len3 = Math.hypot(vec3.x, vec3.y);\n\n        const angle1 = Math.acos(dot1 / (len1 * len2));\n        const angle2 = Math.acos(dot2 / (len2 * len3));\n\n        // If both angles are close to straight (i.e., 180 deg or pi), finger is likely extended\n        return angle1 < 0.5 && angle2 < 0.5; // radians\n    }\n\n    playNote(stringIndex, velocity = 1) {\n        const now = Date.now();\n        if (now - this.lastPluckTime[stringIndex] < this.cooldown) return;\n\n        const notes = ['C4', 'D4', 'E4', 'G4', 'A4', 'C5', 'D5', 'E5'];\n        const note = notes[stringIndex % notes.length];\n\n        try {\n            // Scale volume based on velocity (0.1 to 1)\n            const volume = Math.min(1, Math.max(0.1, velocity * 2));\n            this.synth.set({ volume: -20 + volume * 20 }); // -20dB to 0dB\n            this.synth.triggerAttackRelease(note, '8n');\n            this.stringVibrations[stringIndex] = velocity; // Scale vibration with velocity\n            this.lastPluckTime[stringIndex] = now;\n        } catch (err) {\n            console.warn('Error playing note:', err);\n        }\n    }\n\n    startLoadingSequence() {\n        const steps = [\n            \"Initializing camera...\",\n            \"Loading vision model...\",\n            \"Warming up tensors...\",\n            \"Calibrating hand gestures...\",\n            \"Initializing Synth...\",\n            \"Finalizing setup...\"\n        ];\n\n        let stepIndex = 0;\n        const $loadingText = $('#loading-text', this.win.content);\n\n        const interval = setInterval(() => {\n            $loadingText.text(steps[stepIndex]);\n            stepIndex++;\n\n            // End of steps â€” stop interval\n            if (stepIndex >= steps.length) {\n                clearInterval(interval);\n            }\n        }, 1200); // Change step every 1.2s\n    }\n\n}\n"],"names":["VisionInstrument","constructor","bp","options","this","numStrings","lastPlucked","stringVibrations","Array","fill","lastPluckTime","cooldown","fingerPositions","velocityThreshold","fingerTrails","trailDuration","init","appendScript","appendCSS","html","load","open","win","console","log","restore","focus","window","synth","Tone","PolySynth","FMSynth","harmonicity","modulationIndex","oscillator","type","envelope","attack","decay","sustain","release","chorus","Chorus","start","reverb","Reverb","wet","toDestination","gain","Gain","connect","startLoadingSequence","startVisionInstrument","maximize","id","title","icon","x","y","width","height","minWidth","content","parent","$","resizable","maximizable","closable","onClose","video","srcObject","getTracks","forEach","track","stop","document","getElementById","canvas","ctx","getContext","noteIndicator","stream","navigator","mediaDevices","getUserMedia","Promise","resolve","onloadeddata","play","hands","Hands","locateFile","file","setOptions","maxNumHands","modelComplexity","minDetectionConfidence","minTrackingConfidence","selfieMode","Camera","onFrame","async","send","image","firstResults","onResults","results","fadeOut","clearRect","i","vibration","offset","Math","sin","Date","now","beginPath","moveTo","lineTo","hue","strokeStyle","lineWidth","stroke","multiHandLandmarks","handIndex","length","hand","fingers","f","fingerLandmarkIndex","isFingerExtended","tip","arc","PI","fillStyle","fingerID","push","time","filter","p","stringWidth","stringIndex","floor","velocity","prev","dx","dy","sqrt","playNote","innerText","trail","Object","values","alpha","toFixed","landmarks","tipIndex","mcp","pip","dip","vec1","vec2","vec3","dot1","dot2","len1","hypot","len2","len3","angle1","acos","angle2","notes","note","volume","min","max","set","triggerAttackRelease","err","warn","steps","stepIndex","$loadingText","interval","setInterval","text","clearInterval"],"mappings":"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"}