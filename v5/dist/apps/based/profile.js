const e={};function t(e){for(let t in bp.apps.wallpaper.wallpaperManager._wallpapers){let i=bp.apps.wallpaper.wallpaperManager._wallpapers[t],o="";t===desktop.settings.wallpaper_name&&(o="checked");let l=`\n      <input type="radio" id="wallPaperRadio${t}" name="wallpaper_opt" class="wallpaper_opt" value="${t}" ${o}>\n      <label for="wallPaperRadio${t}">${i.label}</label>\n      <br>\n      `;e.append(l)}}function i(e,t){const i=e.target.files[0],o=e.target,l=document.querySelector(".aim-profile-picture-upload-status"),a=l.querySelector(".status-text"),s=(e,t)=>{l.classList.remove("uploading","success","error","hidden"),a.textContent=e,l.classList.add(t),l.style.display="block"},n=(e=3e3)=>{setTimeout((()=>{l.classList.add("hidden"),l.style.display="none"}),e)};if(i){if(!["image/jpeg","image/png","image/gif","image/jpg","image/webp"].includes(i.type))return s("Please select a valid image file (JPEG, PNG, or GIF).","error"),o.value="",void n();const e=new Image,l=new FileReader;l.onload=l=>{e.src=l.target.result,e.onload=async()=>{const l=document.createElement("canvas"),a=l.getContext("2d");l.width=128,l.height=128;const p=Math.min(128/e.width,128/e.height),r=e.width*p,d=e.height*p,c=(128-r)/2,f=(128-d)/2;a.fillStyle="white",a.fillRect(0,0,128,128),a.drawImage(e,c,f,r,d);try{const e=await new Promise((e=>{l.toBlob((t=>e(t)),"image/jpeg",.8)})),a=307200;if(e.size>a)return s("Resized image exceeds 300KB. Please choose a smaller image.","error"),o.value="",void n();const p=URL.createObjectURL(e);t.src=p;const r=document.createElement("img");r.src=p,r.classList.add("aim-profile-picture-img");const d=document.querySelector(".aim-profile-picture-preview");d.innerHTML="",d.appendChild(r),s("Uploading...","uploading");const c=new File([e],i.name,{type:"image/jpeg",lastModified:Date.now()});try{let e,t=e=>{const t=Math.round(100*e);s(`Uploading: ${t}%`,"uploading")};c.filePath="/profile-pics/"+c.name,console.log("Uploading file:",c);try{e=await buddypond.uploadFile(c,t),console.log("File uploaded to:",e),s("Upload complete!","success"),n()}catch(e){return console.error("Error uploading file:",e),void s("Upload failed: "+e.message,"error")}console.log("File uploaded to:",e),await this.bp.apps.buddylist.client.setStatus(this.bp.me,{profilePicture:e}),this.bp.apps.buddylist.data.profileState.profilePicture=e}catch(e){console.error("Upload error:",e),s("Upload failed. Please try again.","error"),n()}}catch(e){console.error("Error processing image:",e),s("Error processing image. Please try again.","error"),o.value="",n()}},e.onerror=()=>{s("Failed to load image. Please select a valid image file.","error"),o.value="",n()}},l.readAsDataURL(i)}}e.legacyWallpapers=function(e){if(e.apps.wallpaper){function i(t,i){e.set("wallpaper_color","#"+i)}function o(t,i){e.set("wallpaper_color","#"+i)}t($(".wallpaperTypes")),e.on("settings::wallpaper_color","update-wallpaper-color-picker",(function(t){$(".wallpaperOptionColor").setColor(t),$(".simpleColorDisplay").html(t);let i=e.apps.wallpaper.wallpaperManager.active,o=e.apps.wallpaper.wallpaperManager.wallpapers[i];o?o.changeColor(t):console.log("cannot change color, active wallpaper not found",i)})),$(".wallpaperOptionColor").simpleColor({boxHeight:20,cellWidth:16,cellHeight:16,defaultColor:desktop.settings.wallpaper_color||"#008F11",inputCSS:{"border-radius":"4px","font-size":"4px",width:"10px"},chooserCSS:{border:"1px solid #660033",top:"20px"},displayCSS:{},displayColorCode:!0,livePreview:!0,insert:"before",onSelect:function(t,o){i(e.apps.wallpaper.active,t)},onCellEnter:function(t,i){o(e.apps.wallpaper.active,t)},onClose:function(e){}}),$("input[name=wallpaper_opt]").on("input",(function(){let t=$("input[name=wallpaper_opt]:checked").val();e.set("wallpaper_name",t)}))}};class o{constructor(e,t={}){return this.bp=e,this}async init(){return await this.bp.load("/v5/apps/based/profile/profile.css"),await this.bp.load("browser"),await this.bp.appendScript("/desktop/assets/js/jquery.simple-color.js"),this.html=await this.bp.load("/v5/apps/based/profile/profile.html"),"loaded Profile"}async open(t={}){let o=this.bp.me||t.context;o=o.replace(":",""),o=o.replace(" ","");let s=document.createElement("div");s.classList.add("customProfile");let n=document.createElement("div");if(n.innerHTML=this.html,this.profileWindow)this.profileWindow.content=s,this.profileWindow.context!==o&&(this.profileWindow.context=o,$(this.profileWindow.content).html(s.innerHTML),this.profileWindow.setTitle("Profile - "+o),new this.bp.apps.ui.Tabs("#"+this.profileWindow.id));else{this.profileWindow=this.bp.apps.ui.windowManager.createWindow({id:"profile",title:"Profile - "+o,x:50,y:100,width:800,height:500,minWidth:200,minHeight:200,parent:$("#desktop")[0],icon:"/desktop/assets/images/icons/icon_profile_64.png",context:o||"default",content:n,resizable:!0,minimizable:!0,maximizable:!0,closable:!0,focusable:!0,maximized:!1,minimized:!1,onClose:()=>{this.profileWindow=null}}),this.profileWindow.loggedIn=!0,this.tabs=new this.bp.apps.ui.Tabs(".tabs-container","#"+this.profileWindow.id),e.legacyWallpapers(bp);const t=document.getElementById("profile-picture-input"),l=document.querySelector(".aim-profile-picture-img");$(".aim-set-password-email").on("click",(e=>{this.tabs.navigateToTab("#tabs-3")})),t.addEventListener("change",(async e=>{i.call(this,e,l)}));let a=this.bp.apps.buddylist.data.profileState.profilePicture,s=$(".aim-profile-picture-preview");if(a){let e=document.createElement("img");e.src=a,e.classList.add("aim-profile-picture-img"),s.append(e)}else{const e=this.bp.vendor.dicebear.createAvatar(this.bp.vendor.dicebearAvatars,{seed:this.bp.me,size:128,backgroundColor:["#f0f0f0"]}).toString();console.log("Avatar SVG:",e),s.html(e)}}$(".yourApps tbody",this.profileWindow.content).html("");for(let e in bp.settings.apps_installed)l(e,$(".yourApps")[0]);let p=this.bp.config.host+"/"+this.bp.me;$(".liveProfileLink",this.profileWindow.content).attr("href",p),$(".liveProfileLink",this.profileWindow.content).html(p),$(".editProfileButton",this.profileWindow.content).on("click",(()=>{$(".profileEditor",this.profileWindow.content).flexShow(),$(".customProfile",this.profileWindow.content).flexHide(),$(".updateProfileHtml",this.profileWindow.content).flexShow(),$(".cancelProfileEdit",this.profileWindow.content).flexShow()})),$(".cancelProfileEdit",this.profileWindow.content).on("click",(()=>{$(".profileEditor",this.profileWindow.content).flexHide(),$(".customProfile",this.profileWindow.content).flexShow(),$(".updateProfileHtml",this.profileWindow.content).flexHide(),$(".cancelProfileEdit",this.profileWindow.content).flexHide()})),$(".updateProfileHtml").flexHide(),$(".cancelProfileEdit").flexHide(),async function(e){$(".updateProfileButton").on("click",(async function(){let t={};if(t.email=$(".buddy_email").val(),t.password=$(".buddy_password").val(),t.confirmPassword=$(".confirm_buddy_password").val(),$(".updateProfileResponse").html(""),t.password&&(!t.confirmPassword||t.password!==t.confirmPassword))return $(".updateProfileResponse").addClass("error"),void $(".updateProfileResponse").html("Passwords do not match");console.log("Updating profile with",t),$(".updateProfileResponse").removeClass("error");try{let i=await buddypond.updateAccount({buddyname:e.me,password:t.password,email:t.email});console.log("password changed",i),i&&$(".updateProfileResponse").html("Account updated successfully")}catch(e){return $(".updateProfileResponse").addClass("error"),void $(".updateProfileResponse").html("Failed to change password "+e.message)}})),e.apps.buddylist&&e.apps.buddylist.data.profileState&&e.apps.buddylist.data.profileState.email&&$(".buddy_email").val(e.apps.buddylist.data.profileState.email),$(".updateProfileForm").on("submit",(function(e){return e.preventDefault(),!1})),e.apps.say&&e.apps.say.voices.forEach((function(e){$(".ttsVoice").append(`<option value="${e.voiceURI}">${e.name} ${e.lang}</option>`)}));desktop.settings.tts_voice_index&&$(".ttsVoice").prop("selectedIndex",desktop.settings.tts_voice_index),$(".ttsVoice").on("change",(function(){let t=voices[$(this).prop("selectedIndex")];e.apps.say.setVoice($(this).prop("selectedIndex")),desktop.set("tts_voice",t),desktop.set("tts_voice_index",$(this).prop("selectedIndex")),e.say("Hello Beautiful")})),$(".hideFlag").on("click",(function(){$(this).prop("checked")?desktop.set("geo_flag_hidden",!0):desktop.set("geo_flag_hidden",!1)}))}(bp);let r=$(".pad-editor-holder",this.profileWindow.content)[0],d=this.bp.config.host+"/"+this.bp.me;-1===this.bp.config.host.indexOf("buddypond.com")&&(d+="/index.html"),this.browser||(this.browser=new this.bp.apps.browser.BrowserWindow(this.bp,r,d));let c=$("#your-profile",this.profileWindow.content);this.bp.on("file-explorer::update","update-profile-preview-if-profile-index",(e=>{this.browser.navigate(d)})),c.append(r),t.context&&"themes"===t.context&&$(".themesLink").click(),$(".me").html(this.bp.me),t&&"settings"===t.type&&this.tabs.showTab("#tabs-3"),t&&"themes"===t.type&&this.tabs.showTab("#tabs-2"),$(".themeSelect",this.profileWindow.content).on("change",(e=>{let t=$(e.target).val();if("Custom"===t)return;this.bp.apps.themes.applyTheme(t);let i=this.bp.apps.themes.themes[t],o=i.styles||{},l=$(".theme-styles",this.profileWindow.content);l.html("");let s=JSON.parse(JSON.stringify(i));for(let e in o){let t=o[e],i=$("<tr></tr>"),s=$('<td colspan="2"></td>');s.append(`<div class="style-block"><div class="style-title">${e}</div>`);for(let i in t){let o=t[i],l=`input_${e}_${i}`.replace(/\W+/g,"_"),n="";if(a(i,o)){n=`<input type="color" value="${o.startsWith("#")?o:"#ffffff"}" data-style="${e}" data-prop="${i}" class="color-picker" />`}s.append(`\n        <div class="prop-row">\n            <label class="prop-name">${i}:</label>\n            <input type="text" id="${l}" value="${o}" data-style="${e}" data-prop="${i}" />\n            ${n}\n        </div>\n    `)}i.append(s),l.append(i)}l.on("input",'input[type="text"], input.color-picker',function(e){$(".themeSelect",this.profileWindow.content).val("Custom");let t=$(e.target).data("style"),i=$(e.target).data("prop");if(console.log("style",t,"prop",i),!t||!i)return;let o=$(e.target).val();s.styles[t][i]=o,console.log("editableTheme.styles",s),this.bp.apps.themes.applyTheme(s)}.bind(this)),l.on("click",".add-prop-btn",function(e){let t=$(e.target).data("style"),i=$(e.target).closest("div"),o=i.find(".new-prop-name"),l=i.find(".new-prop-value"),a=o.val().trim(),n=l.val().trim();a&&n&&(s.styles[t][a]=n,$(".themeSelect",this.profileWindow.content).trigger("change"))}.bind(this)),l.on("click",".remove-prop-btn",function(e){let t=$(e.target).data("style"),i=$(e.target).data("prop");delete s.styles[t][i],$(".themeSelect",this.profileWindow.content).trigger("change")}.bind(this)),console.log("themeData",i)}));let f=this.bp.get("active_theme")||"Light";return $(".themeSelect",this.profileWindow.content).val(f),$(".themeSelect",this.profileWindow.content).trigger("change"),this.bp.on("settings::active_theme","update-dropdown",(e=>{this.bp.get("active_theme")})),this.profileWindow}}function l(e,t){let i=bp.apps.appstore.apps[e];if("profile"===e)return;let o=`\n      <tr class="open-app" data-app="${e}">\n        <td>\n          <img class="appStoreIcon float-left" src="desktop/assets/images/icons/icon_${i.icon||e}_64.png" />\n        </td>\n        <td>\n         ${i.description||i.label||e}\n        </td>\n    </tr>`,l=document.createElement("tr");return l.classList.add("open-app"),l.setAttribute("data-app",e),l.innerHTML=o,t.append(l),o}function a(e,t){const i=["color","background","background-color","border-color","outline-color","text-decoration-color","column-rule-color","fill","stroke"].includes(e.toLowerCase()),o=(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i||/^rgba?\(.+\)$/i||/^hsla?\(.+\)$/i||/^[a-z]+$/i).test(t);return i||o}export{o as default};
//# sourceMappingURL=profile.js.map
