class e{constructor(e,t={}){return this.bp=e,this.options=t,this.waveCount=0,this.isSpinning=!1,this.spinAngle=0,this.backgroundColor="rgb(50, 50, 100)",this}async init(){return await this.bp.appendScript("https://cdn.jsdelivr.net/npm/@mediapipe/pose"),await this.bp.appendScript("https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"),await this.bp.appendCSS("/v5/apps/based/posepuppet/pose-puppet.css"),"loaded PosePuppet"}async open(){return this.win=this.bp.window(this.window()),this.startPosePuppet(),this.win.maximize(),this.win}window(){return{id:"posepuppet",title:"PosePuppet",icon:"desktop/assets/images/icons/icon_puppet_64.png",x:300,y:100,width:700,height:520,content:'\n        <video class="pose-puppet-video" id="video" width="640" height="480" autoplay style="display:none;"></video>\n        <canvas id="canvas" width="640" height="480" style="cursor:none;"></canvas>\n        <div style="position:absolute; top:10px; left:10px; color:white; font-size:14px;" id="status">\n            üßç PosePuppet | Waves: 0 | B: Change Background, R: Reset\n        </div>\n        ',parent:$("#desktop")[0],resizable:!0,maximizable:!0,closable:!0}}isWaveGesture(e){const t=e[15],i=e[16],n=e[11],s=e[12];return t.y<n.y&&i.y<s.y}async startPosePuppet(){const e=document.getElementById("video"),t=document.getElementById("canvas"),i=t.getContext("2d"),n=document.getElementById("status");let s=null;document.addEventListener("keydown",(e=>{switch(e.key.toLowerCase()){case"b":this.backgroundColor=`rgb(${255*Math.random()}, ${255*Math.random()}, ${255*Math.random()})`,n.innerText=`üßç PosePuppet | Waves: ${this.waveCount} | B: Change Background, R: Reset`;break;case"r":this.waveCount=0,this.isSpinning=!1,this.spinAngle=0,n.innerText=`üßç PosePuppet | Waves: ${this.waveCount} | B: Change Background, R: Reset`}}));const a=await navigator.mediaDevices.getUserMedia({video:!0});e.srcObject=a,await new Promise((t=>e.onloadeddata=t)),e.play();const o=new Pose({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${e}`});o.setOptions({modelComplexity:1,smoothLandmarks:!0,minDetectionConfidence:.7,minTrackingConfidence:.7});new Camera(e,{onFrame:async()=>await o.send({image:e}),width:640,height:480}).start(),o.onResults((e=>{s=e.poseLandmarks?e.poseLandmarks:null}));const p=e=>{const s=t.width,a=t.height,o=t=>({x:e[t].x*s,y:e[t].y*a}),p=o(11),d=o(12),h=o(13),r=o(14),c=o(15),l=o(16),u=o(23),g=o(24),m=o(25),w=o(26),y=o(27),v=o(28),x=(u.x+g.x)/2,P=(u.y+g.y)/2,b={x:(p.x+d.x)/2,y:(p.y+d.y)/2};i.strokeStyle="white",i.lineWidth=4,i.fillStyle="white",i.beginPath(),i.moveTo(b.x,b.y),i.lineTo(x,P),i.stroke();const C=(e,t,n)=>{i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.lineTo(n.x,n.y),i.stroke()};C(p,h,c),C(d,r,l),C(u,m,y),C(g,w,v),i.beginPath(),i.arc(b.x,b.y-30,20,0,2*Math.PI),i.fill(),[p,d,h,r,c,l,u,g,m,w,y,v].forEach((e=>{i.beginPath(),i.arc(e.x,e.y,5,0,2*Math.PI),i.fill()})),this.isWaveGesture(e)&&!this.isSpinning&&(this.waveCount++,this.isSpinning=!0,n.innerText=`üßç PosePuppet | Waves: ${this.waveCount} | B: Change Background, R: Reset`)},d=()=>{i.clearRect(0,0,t.width,t.height),i.fillStyle=this.backgroundColor,i.fillRect(0,0,t.width,t.height),s?p(s):n.innerText=`üßç PosePuppet | Waves: ${this.waveCount} | No body detected | B: Change Background, R: Reset`,requestAnimationFrame(d)};requestAnimationFrame(d)}}export{e as default};
//# sourceMappingURL=posepuppet.js.map
