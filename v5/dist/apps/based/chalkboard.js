class e{constructor(e,t={}){return this.bp=e,this.options=t,this}async init(){return"loaded Chalkbord"}async open(e={}){return this.output=e.output,this.context=e.context,this.chalkWindow||(this.chalkWindow=this.bp.window(this.window(e)),this.bc=new BroadcastChannel("buddypond-desktop"),this.bc.onmessage=async e=>{if(e.data.app,"chalkboard"===e.data.app&&"save"===e.data.action){let t=e.data.image,o=e.data.fileName||"untitled.png",a=`paints/${o}`;function i(e,t,o){return fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return new File([e],t,{type:o})}))}i(t,o,"image/png").then((async e=>{if(e.filePath=a,console.log("File created:",e,e instanceof File),document.createElement("img"),!this.context||!this.output){console.warn("No context or output specified, saving file locally.");let t=document.createElement("a");return t.href=URL.createObjectURL(e),t.download=o,document.body.appendChild(t),t.click(),void document.body.removeChild(t)}let t=e=>{console.log(`Upload progress: ${e}%`)};try{let o=await buddypond.uploadFile(e,t);console.log("Upload successful:",o);let a={to:this.context,from:bp.me,type:this.output,text:o};console.log("sending multimedia message",a),bp.emit("buddy::sendMessage",a)}catch(e){console.error("Upload failed:",e)}}))}}),this.chalkWindow}window(e={}){return{id:"chalkboard",title:"Chalkboard",icon:"desktop/assets/images/icons/icon_chalkboard_64.png",x:250,y:75,width:600,height:400,minWidth:400,minHeight:300,parent:$("#desktop")[0],iframeContent:"/v5/apps/based/chalkboard/vendor/chalkboard.html",resizable:!0,minimizable:!0,maximizable:!0,closable:!0,focusable:!0,maximized:!1,minimized:!1,onClose:()=>{this.chalkWindow=null,this.bc.close()}}}}export{e as default};
//# sourceMappingURL=chalkboard.js.map
