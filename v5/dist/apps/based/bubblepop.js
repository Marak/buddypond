class t{constructor(t,e={}){return this.bp=t,this.options=e,this.bubbles=[],this.score=0,this.maxBubbles=50,this.lastPos=null,this.positionHistory=[],this.maxHistory=3,this.spawnRate=1e3,this.burstAnimations=[],this.lastPopTime=0,this.cooldown=50,this}async init(){await this.bp.appendScript("https://cdn.jsdelivr.net/npm/@mediapipe/hands"),await this.bp.appendScript("https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"),await this.bp.appendScript("https://cdnjs.cloudflare.com/ajax/libs/tone/15.2.6/Tone.js"),await this.bp.appendCSS("/v5/apps/based/bubblepop/bubble-pop.css"),this.synth=new Tone.Synth({oscillator:{type:"sine"},envelope:{attack:.001,decay:.1,sustain:0,release:.1}}).toDestination();try{Tone.start()}catch(t){console.log(t)}return"loaded BubblePop"}async open(){return this.win=this.bp.window(this.window()),this.startBubblePop(),this.win.maximize(),this.win}window(){return{id:"bubblepop",title:"BubblePop",icon:"desktop/assets/images/icons/icon_game_64.png",x:300,y:100,width:700,height:520,content:'\n        <video class="bubble-pop-video" id="video" width="640" height="480" autoplay style="display:none;"></video>\n        <canvas id="canvas" width="640" height="480" style="background:black; cursor:none;"></canvas>\n        <div style="position:absolute; top:10px; left:10px; color:white; font-size:14px;" id="status">\n            ðŸŽˆ BubblePop | Score: 0 | C: Clear, R: Reset\n        </div>\n        ',parent:$("#desktop")[0],resizable:!0,maximizable:!0,closable:!0}}smoothPosition(t){this.positionHistory.push(t),this.positionHistory.length>this.maxHistory&&this.positionHistory.shift();const e={x:0,y:0};return this.positionHistory.forEach((t=>{e.x+=t.x,e.y+=t.y})),e.x/=this.positionHistory.length,e.y/=this.positionHistory.length,e}spawnBubble(){const t=20+20*Math.random(),e=Math.random()*(640-2*t)+t,s=-(1+2*Math.random()),i=2*(Math.random()-.5);this.bubbles.length>=this.maxBubbles||this.bubbles.push({x:e,y:480+t,radius:t,speedY:s,speedX:i})}async startBubblePop(){const t=document.getElementById("video"),e=document.getElementById("canvas"),s=e.getContext("2d"),i=document.getElementById("status");document.addEventListener("keydown",(t=>{switch(t.key.toLowerCase()){case"c":this.bubbles=[],s.clearRect(0,0,e.width,e.height),i.innerText=`ðŸŽˆ BubblePop | Score: ${this.score} | C: Clear, R: Reset`;break;case"r":this.bubbles=[],this.score=0,this.spawnRate=1e3,s.clearRect(0,0,e.width,e.height),i.innerText=`ðŸŽˆ BubblePop | Score: ${this.score} | C: Clear, R: Reset`}}));const a=setInterval((()=>{this.spawnBubble(),this.spawnRate=Math.max(300,.95*this.spawnRate)}),this.spawnRate),n=await navigator.mediaDevices.getUserMedia({video:!0});t.srcObject=n,await new Promise((e=>t.onloadeddata=e)),t.play();const o=new Hands({locateFile:t=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${t}`});o.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:.7,minTrackingConfidence:.7,selfieMode:!0});new Camera(t,{onFrame:async()=>await o.send({image:t}),width:640,height:480}).start();const h=()=>{s.clearRect(0,0,e.width,e.height),this.bubbles.forEach((t=>{s.beginPath(),s.arc(t.x,t.y,t.radius,0,2*Math.PI),s.fillStyle="rgba(100, 150, 255, 0.5)",s.fill(),s.strokeStyle="rgba(255, 255, 255, 0{atan2(0, 0)})",s.stroke(),t.y+=t.speedY,t.x+=t.speedX})),this.burstAnimations=this.burstAnimations.filter((t=>t.radius<60)),this.burstAnimations.forEach((t=>{s.beginPath(),s.arc(t.x,t.y,t.radius,0,2*Math.PI),s.strokeStyle=`rgba(255, 255, 255, ${1-t.radius/60})`,s.lineWidth=2,s.stroke(),t.radius+=2})),this.bubbles=this.bubbles.filter((t=>t.y>-t.radius)),clearInterval(a),setInterval((()=>this.spawnBubble()),this.spawnRate),requestAnimationFrame(h)};requestAnimationFrame(h),o.onResults((t=>{if(!t.multiHandLandmarks||0===t.multiHandLandmarks.length)return this.lastPos=null,this.positionHistory=[],void(i.innerText=`ðŸŽˆ BubblePop | Score: ${this.score} | C: Clear, R: Reset`);const a=t.multiHandLandmarks[0][8];let n=a.x*e.width,o=a.y*e.height;const h=this.smoothPosition({x:n,y:o});n=h.x,o=h.y,s.beginPath(),s.arc(n,o,6,0,2*Math.PI),s.fillStyle="rgba(255, 255, 255, 0.9)",s.fill();const r=Date.now();this.bubbles=this.bubbles.filter((t=>!(Math.hypot(n-t.x,o-t.y)<t.radius&&r-this.lastPopTime>=this.cooldown)||(this.score++,this.synth.triggerAttackRelease("C5","16n",Tone.now()),this.lastPopTime=r,this.burstAnimations.push({x:t.x,y:t.y,radius:t.radius}),i.innerText=`ðŸŽˆ BubblePop | Score: ${this.score} | C: Clear, R: Reset`,!1))),this.lastPos={x:n,y:o}}))}}export{t as default};
//# sourceMappingURL=bubblepop.js.map
