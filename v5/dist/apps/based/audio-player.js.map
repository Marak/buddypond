{"version":3,"file":"audio-player.js","sources":["../../../apps/based/audio-track/render/defaultRender.js","../../../apps/based/fetch-in-webworker/WebWorkerFetchWithProgress.js","../../../apps/based/fetch-in-webworker/fetch-in-webworker.js","../../../apps/based/audio-track/load.js","../../../apps/based/audio-track/AudioTrack.js","../../../apps/based/audio-track/render/pvrtybvx/transport/SongInfo.js","../../../apps/based/audio-track/render/pvrtybvx/waveform/CuePoints.js","../../../apps/based/audio-track/lib/setBPM.js","../../../apps/based/audio-track/render/pvrtybvx/transport/CueControls.js","../../../apps/based/ui/Slider.js","../../../apps/based/audio-track/nodes/EQ3.js","../../../apps/based/audio-track/render/pvrtybvx/transport/Filter.js","../../../apps/based/audio-track/nodes/Filter.js","../../../apps/based/audio-track/render/pvrtybvx/transport/LoopControls.js","../../../apps/based/audio-track/render/pvrtybvx/transport/TransportButtons.js","../../../apps/based/audio-track/render/pvrtybvx/render.js","../../../apps/based/audio-track/render/pvrtybvx/transport/EQ3.js","../../../apps/based/audio-track/render/pvrtybvx/transport/TempoSlider.js","../../../apps/based/audio-track/render/pvrtybvx/transport/PlayPauseCue.js","../../../apps/based/audio-track/render/pvrtybvx/transport/VolumeSlider.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/event-emitter.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/decoder.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/dom.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/fetcher.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/player.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/renderer.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/draggable.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/timer.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/webaudio.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/wavesurfer.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/base-plugin.js","../../../apps/based/audio-track/render/pvrtybvx/waveform/waveSurferShim.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/plugins/regions.esm.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/plugins/hover.esm.js","../../../apps/based/audio-track/render/vendor/wavesurfer.js/dist/plugins/timeline.esm.js","../../../apps/based/audio-track/render/pvrtybvx/waveform/WaveForms.js","../../../apps/based/audio-stripe/lib/detectBPM.js","../../../apps/based/audio-stripe/lib/beatGrid.js","../../../apps/based/audio-stripe/lib/detectCuePoints.js","../../../apps/based/audio-stripe/lib/stripeTrack.js","../../../apps/based/audio-stripe/lib/detectID3.js","../../../apps/based/audio-stripe/lib/detectKey.js","../../../apps/based/audio-stripe/lib/detectFirstBeatOffset.js","../../../apps/based/audio-track/render/pvrtybvx/databind.js","../../../apps/based/audio-stripe/lib/hasTrackMetadata.js","../../../apps/based/audio-player/lib/DeckKeyboardBindings.js","../../../apps/based/audio-player/AudioPlayer.js","../../../apps/based/audio-player/lib/PlayerKeyboardBindings.js","../../../apps/based/audio-player/lib/menuBarConfig.js","../../../apps/based/audio-player/audio-player.js"],"sourcesContent":["export default function defaultRender(track) {\n    const container = document.createElement('div');\n    container.className = 'audio-track';\n  \n    const fileName = document.createElement('p');\n    fileName.textContent = track.metadata.fileName || 'No file loaded';\n    container.appendChild(fileName);\n\n    const playPauseButton = document.createElement('button');\n    playPauseButton.textContent = 'Play';\n    playPauseButton.addEventListener('click', () => {\n        console.log('playPauseButton clicked', track.isPlaying());\n      if (track.isPlaying()) {\n        track.pause();\n        playPauseButton.textContent = 'Play';\n      } else {\n        track.play();\n        playPauseButton.textContent = 'Pause';\n      }\n    });\n    \n    container.appendChild(playPauseButton);\n  \n    return container;\n}","export default class WebworkerFetchWithProgress {\n    constructor(workerScript = 'workerFetchWithProgress.js') {\n        this.worker = new Worker(workerScript);\n        this.requests = {};\n\n        this.worker.onmessage = (event) => {\n            const { type, id, progress, data, error } = event.data;\n            const request = this.requests[id];\n            if (!request) return; // onProgress never happens since request is not defined until fetch is called?\n            switch (type) {\n                case 'progress':\n                    if (request.onProgress) {\n                        request.onProgress(progress); // Call progress callback\n                    }\n                    break;\n                case 'completed':\n                    if (request.resolve) {\n                        request.resolve(event.data); // Resolve the promise\n                    }\n                    delete this.requests[id]; // Clean up\n                    break;\n                case 'error':\n                    if (request.reject) {\n                        request.reject(error); // Reject the promise\n                    }\n                    delete this.requests[id]; // Clean up\n                    break;\n            }\n        };\n    }\n\n    fetch(url, options = {}, onProgress) {\n        const id = Math.random().toString(36).substr(2, 9); // Generate unique ID\n        this.requests[id] = { onProgress, id };\n        return new Promise((resolve, reject) => {\n            this.requests[id].resolve = resolve;\n            this.requests[id].reject = reject;\n            this.worker.postMessage({ url, options, id }); // Start the fetch process\n        });\n    }\n}","import WebworkerFetchWithProgress from \"./WebWorkerFetchWithProgress.js\";\n\nexport default class FetchInWebWorker {\n    constructor(bp) {\n        this.bp = bp;\n\n        return this;\n\n    }\n\n    async init() {\n    }\n\n    async fetchWithProgress(url, options = {}, onProgress) {\n        const fetcher = new WebworkerFetchWithProgress();\n        return fetcher.fetch(url, options, onProgress);\n    }\n}","import FetchInWebWorker from '../fetch-in-webworker/fetch-in-webworker.js';\n\n//await this.bp.appendScript('/v5/apps/based/audio-track/vendor/ffmpeg/ffmpeg/package/dist/umd/ffmpeg.js');\n//await this.bp.appendScript('/v5/apps/based/audio-track/vendor/ffmpeg/util/package/dist/umd/index.js');\n\n\n//import { FFmpeg } from \"/v5/apps/based/audio-track/vendor/ffmpeg/ffmpeg/package/dist/esm/index.js\";\n//import { fetchFile } from \"/v5/apps/based/audio-track/vendor/ffmpeg/util/package/dist/esm/index.js\";\n\n// HTTP Provider implementation\nclass HTTPAudioProvider {\n    constructor(bp) {\n        this.bp = bp;\n        this.fetchInWebWorker = new FetchInWebWorker();\n\n    }\n\n    async loadAudioData(url, options = {}, onProgress = () => { }) {\n        // Ensure HTTP protocol ???\n        // url = url.replace('https', 'http');\n                /* \n        const response = await fetch(url, options);\n        // make a copy of response so we can parse it twice\n        const responseCopy = response.clone();\n        console.log('response', response);\n        let blob = await response.blob();\n        let arrayBuffer = await responseCopy.arrayBuffer();\n        console.log('arrayBuffer', arrayBuffer);\n        console.log('blob', blob);\n        return { arrayBuffer, blob };\n       */\n        const response = await this.fetchInWebWorker.fetchWithProgress(\n            url,\n            {},\n            onProgress\n        );\n\n        return {\n            arrayBuffer: response.arrayBufferResponse,\n            blob: response.blobResponse\n        };\n    }\n}\n\n\nexport default function bindPrototypeMethods(AudioTrack) {\n\n    AudioTrack.prototype.load = async function (options = {}) {\n        if (this.options?.noFile) return this;\n    \n        if (options.url) {\n            this.metadata.url = options.url;\n        }\n\n        try {\n    \n            // Ensure we have a provider\n            if (!this.provider) {\n                this.provider = new HTTPAudioProvider(this.bp);\n            }\n            console.log(\"Loading audio track:\", this.metadata.url, this);\n    \n            // Load audio data from provider\n            const { arrayBuffer, blob } = await this.provider.loadAudioData(\n                this.metadata.url,\n                options,\n                (progress) => this.loadingProgress(progress)\n            );\n    \n            // Decode and process audio\n            await this._processAudioData(arrayBuffer, blob);\n    \n            // Setup media source and handle platform-specific loading\n            return await this._setupMediaSource(blob);\n        } catch (error) {\n            console.error(`Failed to load track: ${this.metadata.url}`, error);\n            throw error;\n        }\n    };\n    \n    AudioTrack.prototype._setupMediaSource = async function (blob) {\n        return new Promise(async (resolve, reject) => {\n            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n    \n            if (isIOS) {\n                // Directly use blob URL for iOS\n                this.audioElement.src = URL.createObjectURL(blob);\n                this.audioElement.addEventListener(\"canplaythrough\", () => {\n                    // set the duration on t.metadata.duration\n                    this.metadata.duration = this.audioElement.duration;\n                    resolveLoad();\n                });\n                this.audioElement.addEventListener(\"error\", rejectLoad);\n            } else {\n                // Use MediaSource for other platforms\n                const mediaSource = new MediaSource();\n                this.audioElement.src = URL.createObjectURL(mediaSource);\n    \n                mediaSource.addEventListener(\"sourceopen\", async () => {\n                    try {\n                        const sourceBuffer = mediaSource.addSourceBuffer(\"audio/mpeg\");\n                        const arrayBuffer = await blob.arrayBuffer();\n                        // set the duration on t.metadata.duration\n                        this.metadata.duration = this.audioBuffer.duration;\n                        sourceBuffer.addEventListener(\"updateend\", resolveLoad);\n                        sourceBuffer.addEventListener(\"error\", rejectLoad);\n                        sourceBuffer.appendBuffer(arrayBuffer);\n                    } catch (err) {\n                        console.error(\"Error with MediaSource or SourceBuffer:\", err);\n                        rejectLoad(err);\n                    }\n                });\n            }\n    \n            const resolveLoad = () => {\n                if (this.isLoaded) return;\n                this.isLoaded = true;\n                console.log(\"Track loaded:\", this.metadata.url);\n                resolve(this);\n            };\n    \n            const rejectLoad = (err) => {\n                console.error(\"Audio element error:\", err);\n                reject(`Failed to load track: ${this.metadata.url}`);\n            };\n    \n            // Load and setup the media if not using MediaSource\n            if (isIOS || (this.url && this.url.endsWith('.wav'))) {\n                this.audioElement.load();\n            }\n        });\n    };\n    \n    AudioTrack.prototype._initializeAudioElements = function () {\n        this.audioElement = new Audio();\n        this.audioElement.crossOrigin = \"anonymous\";\n        this.audioElement.preservesPitch = true;\n    };\n\n    AudioTrack.prototype._processAudioData = async function (arrayBuffer, blob) {\n        this.audioData = arrayBuffer;\n        this.blob = blob;\n        console.log('Audio data received:', this.audioData);\n    \n        // Decode using Web Worker\n        // this.audioBuffer = await this._decodeAudioWithFFmpeg(arrayBuffer);\n        // decode with audioContext\n        this.audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\n        this.metadata.fileSize = this.audioBuffer.length;\n    \n        // Extract channel data\n        const channelData = extractAudioBuffer(this.audioBuffer);\n    };\n    AudioTrack.prototype._decodeAudioWithFFmpeg = async function (arrayBuffer) {\n\n        let ffmpeg = new FFmpeg();\n\n            await ffmpeg.load();\n            console.log(\"✅ FFmpeg WASM loaded successfully\");\n    \n        return new Promise(async (resolve, reject) => {\n            try {\n                console.log(\"⏳ Decoding audio with FFmpeg...\");\n    \n                // Write audio data into FFmpeg virtual filesystem\n                const inputFileName = 'input.mp3';\n                const outputFileName = 'output.raw';\n                await ffmpeg.writeFile(inputFileName, await fetchFile(arrayBuffer));\n    \n                // Convert input audio to raw PCM Float32\n                await ffmpeg.exec([\n                    '-i', inputFileName, \n                    '-f', 'f32le', \n                    '-acodec', 'pcm_f32le', \n                    '-ar', '44100', // Force 44.1kHz sample rate\n                    '-ac', '2', // Stereo output\n                    outputFileName\n                ]);\n    \n                // Read decoded PCM data\n                const outputData = await ffmpeg.readFile(outputFileName);\n    \n                // Convert PCM data to Web Audio API's AudioBuffer\n                const sampleRate = 44100; // Match conversion settings\n                const numberOfChannels = 2; // Stereo\n                const frameCount = outputData.length / (numberOfChannels * 4); // 4 bytes per Float32 sample\n    \n                const audioContext = new AudioContext();\n                const audioBuffer = audioContext.createBuffer(numberOfChannels, frameCount, sampleRate);\n    \n                // De-interleave PCM data into separate channels\n                const interleaved = new Float32Array(outputData.buffer);\n                for (let i = 0; i < numberOfChannels; i++) {\n                    const channelData = new Float32Array(frameCount);\n                    for (let j = 0; j < frameCount; j++) {\n                        channelData[j] = interleaved[j * numberOfChannels + i];\n                    }\n                    audioBuffer.copyToChannel(channelData, i);\n                }\n    \n                console.log(\"✅ Audio decoded successfully\");\n                resolve(audioBuffer);\n            } catch (err) {\n                console.log(err)\n                reject(new Error(`❌ FFmpeg decoding failed: ${err.message}`));\n            }\n        });\n    };\n    \n\n    /*\n    TODO: use the audioWOrker instead of the audioContext.decodeAudioData\n    const audioWorker = new Worker('audioWorker.js');\n\nfunction decodeAudioWithFFmpeg(arrayBuffer) {\n    return new Promise((resolve, reject) => {\n        audioWorker.onmessage = (e) => {\n            if (e.data.error) {\n                reject(new Error(e.data.error));\n            } else {\n                resolve(e.data);\n            }\n        };\n        audioWorker.postMessage(arrayBuffer, [arrayBuffer]); // Transfer data\n    });\n}\n\n// Example usage:\nfetch('your-audio-file.mp3')\n    .then(response => response.arrayBuffer())\n    .then(arrayBuffer => decodeAudioWithFFmpeg(arrayBuffer))\n    .then(decodedData => {\n        console.log('Decoded WAV received:', decodedData);\n        // Use AudioContext.decodeAudioData here if needed\n    })\n    .catch(err => console.error('FFmpeg decoding failed:', err));\n\n\n\n    */\n\n    \n    // Helper methods for tracking load progress\n    AudioTrack.prototype.loadingProgress = function (progress) {\n        // Implement loading progress updates\n        this.emit('audio-track::loading::progress', progress);\n    };\n\n    AudioTrack.prototype.loadingComplete = function (progress) {\n        // Implement loading completion\n        this.emit('audio-track::loading::complete', progress);\n    };\n\n}\n\n\n// Extract channel data from AudioBuffer\nfunction extractAudioBuffer(audioBuffer) {\n    const channelData = [];\n    for (let i = 0; i < audioBuffer.numberOfChannels; i++) {\n        channelData.push(audioBuffer.getChannelData(i));\n    }\n    return channelData;\n}\n","import defaultRender from './render/defaultRender.js';\nimport load from './load.js';\n\nimport setBPM from './lib/setBPM.js';\n\nexport default class Track {\n  constructor(options = {}) {\n    this.id = options.id || `track-${Math.random().toString(36).substr(2, 9)}`;\n    this.metadata = options || {};\n    this.metadata.cuePoints = this.metadata.cuePoints || [];\n    this.provider = options.provider || null;\n\n    // Audio properties\n    this.source = null;\n    this.audioNodes = new Map();\n\n    // UI properties\n    this.element = null;\n    this.renderers = new Map();\n    this.currentRenderer = 'default';\n\n    // State\n    this.isLoaded = false;\n    this.isRendered = false;\n\n    load(Track);\n\n    // Event Listeners\n    this.eventListeners = {};\n\n    // Audio Graph / FX\n    this.fx = {};\n\n    // Setup initial audio elements\n    this._initializeAudioElements();\n\n    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n\n    this.masterBus = this.audioContext.createGain(); // Create a gain node as the master bus\n    this.distributionNode = this.audioContext.createGain(); // Node for distribution\n\n\n    // Connect nodes\n    this.source = this.audioContext.createMediaElementSource(this.audioElement);\n    this.source.disconnect();\n    this.source.connect(this.masterBus);\n\n\n    // Setup basic audio path\n    this.masterBus.connect(this.distributionNode); // Connect master bus to distribution node\n    this.distributionNode.connect(this.audioContext.destination); // Connect to output\n\n    // Distribution node doesn't alter the signal\n    this.distributionNode.gain.value = 1;\n\n    // Initialize a map to hold analyzers\n    this.analyzers = new Map();\n\n\n    // this.addAnalyzer('master', this.audioContext.createAnalyser()); // Create a master analyzer\n\n    /*\n   this.analyser = this.audioContext.createAnalyser();\n   this.masterBus.connect(this.analyser); // Connect the master bus to the analyser\n   this.analyser.connect(this.audioContext.destination); // Connect the analyser to the destination\n   this.analyser.fftSize = 2048; // Example FFT size\n   this.analyser.smoothingTimeConstant = 0.8; // Example smoothing time constant\n   */\n\n\n    this.setRenderer('default', defaultRender);\n\n    return this;\n\n  }\n\n  async unload() {\n\n    console.log('Unloading track:', this);\n\n    this.metadata = {};\n\n    // remove t.element from the DOM\n    if (this.waveform) {\n      this.waveform.destroy();\n    }\n\n    if (!this.isLoaded) return;\n    // Cleanup audio nodes\n    this.audioNodes.clear();\n    if (this.source) {\n      this.source.disconnect();\n    }\n\n    if (this.audioElement) {\n      this.audioElement.pause();\n      this.audioElement.src = '';\n    }\n\n    if (this.audioContext) {\n      this.audioContext.close();\n    }\n\n    // clean-up audioContext and audioBuffer\n    this.audioContext = null;\n    this.audioBuffer = null;\n\n    this.isLoaded = false;\n\n\n    console.log('track should be fully unloaded now going to rebind with empty data', this);\n    this.databind();\n  }\n\n  async remove() {\n    await this.unload();\n    await this.unrender();\n  }\n\n  // Rendering methods\n  setRenderer(name, renderFunction) {\n    // this.renderer = renderFunction; // set as active renderer, maybe can remove this\n    this.renderers.set(name, renderFunction);\n    this.currentRenderer = name;\n  }\n\n  databind() {\n    const renderer = this.renderers.get(this.currentRenderer);\n    if (!renderer) {\n      throw new Error(`No renderer found for name: ${this.currentRenderer}`);\n    }\n    const databind = renderer.databind;\n    if (!databind) {\n      throw new Error(`No databind function found for renderer: ${this.currentRenderer}`);\n    }\n    return databind(this);\n  }\n\n  render() {\n    if (this.isRendered) {\n      return this.element;\n    }\n\n    const renderer = this.renderers.get(this.currentRenderer);\n    const render = renderer.render;\n    const databind = renderer.databind;\n    console.log(\"using renderer:\", this.currentRenderer, renderer);\n    if (!renderer) {\n      throw new Error(`No renderer found for name: ${this.currentRenderer}`);\n    }\n\n    this.element = render(this);\n    this.isRendered = true;\n    return this.element;\n  }\n\n  unrender() {\n    if (!this.isRendered || !this.element) return;\n\n    this.element.remove();\n    this.element = null;\n    this.isRendered = false;\n  }\n\n  // UI Data methods\n  setData(data) {\n    this.metadata = { ...this.metadata, ...data };\n\n    if (this.isRendered) {\n      this._updateRenderedData(data);\n    }\n  }\n\n  switchLayout(rendererName) {\n    if (!this.renderers.has(rendererName)) {\n      throw new Error(`No renderer found for name: ${rendererName}`);\n    }\n\n    this.unrender();\n    this.currentRenderer = rendererName;\n    return this.render();\n  }\n\n  // Audio graph methods\n  addNode(name, node) {\n    console.log(\"Adding node:\", name, node, this);\n    if (!this.isLoaded || !this.source) {\n      throw new Error('Cannot add node: track not loaded');\n    }\n\n    // If this node already exists, remove it first\n    if (this.audioNodes.has(name)) {\n      this.removeNode(name);\n    }\n\n    // Store the node\n    this.audioNodes.set(name, node);\n\n    // Reconnect the audio graph\n    this._reconnectAudioGraph();\n  }\n\n  removeNode(name) {\n    if (!this.audioNodes.has(name)) return;\n\n    const node = this.audioNodes.get(name);\n    node.disconnect();\n    this.audioNodes.delete(name);\n\n    // Reconnect the remaining nodes\n    this._reconnectAudioGraph();\n  }\n\n  addAnalyzer(name, analyzer) {\n    if (this.analyzers.has(name)) {\n      this.removeAnalyzer(name); // Remove existing analyzer if it's already there\n    }\n    this.analyzers.set(name, analyzer);\n    this.distributionNode.connect(analyzer); // Connect new analyzer\n  }\n\n  removeAnalyzer(name) {\n    if (this.analyzers.has(name)) {\n      this.distributionNode.disconnect(this.analyzers.get(name)); // Disconnect analyzer\n      this.analyzers.delete(name);\n    }\n  }\n\n  // Private methods\n  async _initializeAudio() {\n    // Implementation for initializing audio context and source\n  }\n\n  async _loadAudioFile(url) {\n    // Implementation for loading audio file\n  }\n\n  _reconnectAudioGraph() {\n    let lastNode = this.masterBus;\n    this.audioNodes.forEach(node => {\n      lastNode.disconnect(); // Disconnect from previous node\n      lastNode.connect(node); // Connect current node\n      lastNode = node; // Update lastNode\n    });\n    lastNode.disconnect(); // Ensure no double connections\n    lastNode.connect(this.distributionNode); // Connect the final processing node to the analyser\n    this.distributionNode.connect(this.audioContext.destination); // Connect the analyser to the destination\n  }\n\n\n  _updateRenderedData(data) {\n    console.log(\"Updating rendered data:\", data);\n    // Implementation for updating DOM elements with new data\n  }\n\n  pause() {\n    // check to make sure is not already playing\n    if (!this.audioElement.paused) {\n      this.audioElement.pause();\n    }\n\n  }\n\n  play() {\n\n    // check to make sure is not already playing\n    if (this.audioElement.paused) {\n      console.log(\"Playing audio track\");\n      this.audioElement.play();\n    }\n  }\n\n  playPause() {\n    if (this.audioElement.paused) {\n      this.play();\n    } else {\n      this.pause();\n    }\n  }\n\n  setTime(time) {\n    this.audioElement.currentTime = time;\n  }\n\n  cueTo(cueNumber) {\n\n    const cue = this.metadata.cuePoints[cueNumber - 1] ?? 0;\n    let cueTime = cue.time;\n    //cueTime -= 4;\n    console.log(\"CUE TO TIME\", cueTime);\n\n    // Set the time first, then we can determine if phase lock of sync needs to be performed\n    // a phase lock true will mean that we don't start / play / cue the track until time is ready ( forward delay )\n    // This is like reverse direction of the current phaseLockPlayback which is a backward delay\n    // for cueing with a forward motion, we need to delay the play / cue until the time is ready\n\n    // will this \"click?\"? do we need to toggle volume or order?\n    this.setTime(cueTime); // Snap precisely to cueTime\n\n\n  }\n\n  setCuePoint(cueNumber, time) {\n    let cue = {\n      time: time,\n      name: `Cue ${cueNumber}`,\n      type: 'cue'\n    };\n    this.metadata.cuePoints[cueNumber - 1] = cue;\n\n    // update the cue point in the UI ??\n    //transport.renderCuePoint(cueNumber - 1, t.detailedWaveform, t, cue)\n    //transport.renderCuePoint(cueNumber - 1, t.overviewWaveform, t, cue)\n\n    // optionally save the track with new metadata\n    // library.updateTrackData(t);\n\n  }\n\n  isPlaying() {\n    return !this.audioElement.paused;\n  }\n\n  emit(event, data) {\n    // console.log(\"AudioTrack Emitting event:\", event, data);\n    if (this.eventListeners[event]) {\n      this.eventListeners[event].forEach(callback => callback(data));\n    }\n  }\n\n  on(event, callback) {\n    if (!this.eventListeners[event]) {\n      this.eventListeners[event] = [];\n    }\n    this.eventListeners[event].push(callback);\n  }\n\n  toggleMute() {\n    this.audioElement.muted = !this.audioElement.muted;\n  }\n\n  toggleKeyLock() {\n    this.audioElement.preservesPitch = !this.audioElement.preservesPitch;\n  }\n\n  mute() {\n    this.audioElement.muted = true;\n    // set the style on the volumeSliderIcon if exists\n    if (this.transport.volumeSliderIcon) {\n      this.transport.volumeSliderIcon.classList.remove('headphones-active');\n      this.transport.volumeSliderIcon.classList.add('headphones-inactive');\n    }\n  }\n\n  unmute() {\n    this.audioElement.muted = false;\n    // set the style on the volumeSliderIcon if exists\n    if (this.transport.volumeSliderIcon) {\n      this.transport.volumeSliderIcon.classList.remove('headphones-inactive');\n      this.transport.volumeSliderIcon.classList.add('headphones-active');\n    }\n  }\n\n  setVolume(value) {\n    this.audioElement.volume = value;\n  }\n\n  getTitle() {\n\n    let metadata = this.metadata;\n    let trackTitle = metadata.title || metadata.fileName;\n    console.log('attempting to get track title', metadata, trackTitle);\n    if (!trackTitle) {\n      return 'loading track...';\n    }\n\n    if (metadata.title) {\n      trackTitle = metadata.title;\n      if (metadata.artist) {\n        trackTitle = `${metadata.artist} - ${metadata.title}`;\n      }\n    } else if (metadata.artist) {\n      trackTitle = metadata.artist;\n    }\n    // clean up track title ( todo: rename files for real )\n    trackTitle = trackTitle.replace('_(mp3.pm)', '');\n    trackTitle = trackTitle.replace('.mp3', '');\n    // replaces all instances of _ with space\n    trackTitle = trackTitle.split('_').join(' ');\n\n    console.log(\"GOT TRACK TITLE\", trackTitle);\n    return trackTitle;\n\n\n  }\n\n}\n\nTrack.prototype.getAudioBuffer = async function () {\n  this.audioBuffer = await this.audioContext.decodeAudioData(audioData);\n}\n\nTrack.prototype.setBPM = setBPM;\n\n\n\n/*\nclass Track2 {\n  constructor(options = {}) {\n    this.id = options.id || `track-${Math.random().toString(36).substr(2, 9)}`;\n    this.metadata = options.metadata || {};\n\n    // Audio properties\n    this.source = null;\n    this.audioNodes = new Map();\n\n    // UI properties\n    this.element = null;\n    this.renderers = new Map();\n    this.currentRenderer = 'default';\n\n    // State\n    this.isLoaded = false;\n    this.isRendered = false;\n\n    // Playback state\n    this.isPlaying = false;\n    this.currentTime = 0;\n    this.volume = 1.0;\n    this.speed = 1.0;\n\n    // Beat-matching properties\n    this.beatGridOffset = 0;  // milliseconds offset for beat grid alignment\n    this.syncEnabled = false;\n    this.quantizeEnabled = false;\n\n    // Loop and cue points\n    this.loops = new Map();   // stored as {startTime, endTime, enabled}\n    this.cuePoints = new Map(); // stored as {time, color, name}\n\n    // Effects state\n    this.effectsChain = [];   // order of effects in the chain\n    this.effectsEnabled = new Map();  // which effects are active\n\n    // Analysis results\n    this.waveformData = null;\n    this.beatData = null;\n    this.phraseData = null;\n  }\n\n  // Existing methods...\n\n  // New Playback Methods\n  play(time = this.currentTime) {\n    this.currentTime = time;\n    this.isPlaying = true;\n    // Implementation\n  }\n\n  pause() {\n    this.isPlaying = false;\n    // Implementation\n  }\n\n  seek(time) {\n    this.currentTime = time;\n    // Implementation\n  }\n\n  setVolume(value) {\n    this.volume = Math.max(0, Math.min(1, value));\n    // Implementation\n  }\n\n  setSpeed(value) {\n    this.speed = value;\n    // Implementation\n  }\n\n  // Beat-matching Methods\n  setBeatGridOffset(offset) {\n    this.beatGridOffset = offset;\n    // Update beat grid visualization\n  }\n\n  toggleSync() {\n    this.syncEnabled = !this.syncEnabled;\n    // Implementation\n  }\n\n  toggleQuantize() {\n    this.quantizeEnabled = !this.quantizeEnabled;\n    // Implementation\n  }\n\n  // Loop Methods\n  addLoop(id, startTime, endTime) {\n    this.loops.set(id, {\n      startTime,\n      endTime,\n      enabled: false\n    });\n  }\n\n  toggleLoop(id) {\n    const loop = this.loops.get(id);\n    if (loop) {\n      loop.enabled = !loop.enabled;\n      // Implementation\n    }\n  }\n\n  // Cue Point Methods\n  setCuePoint(id, options = {}) {\n    this.cuePoints.set(id, {\n      time: options.time || this.currentTime,\n      color: options.color || '#ffffff',\n      name: options.name || `Cue ${this.cuePoints.size + 1}`\n    });\n  }\n\n  jumpToCue(id) {\n    const cue = this.cuePoints.get(id);\n    if (cue) {\n      this.seek(cue.time);\n    }\n  }\n\n  // Effects Methods\n  setEffectParameter(effectId, param, value) {\n    const node = this.audioNodes.get(effectId);\n    if (node) {\n      // Implementation\n    }\n  }\n\n  reorderEffectChain(newOrder) {\n    this.effectsChain = newOrder;\n    this._reconnectAudioGraph();\n  }\n\n  // Analysis Methods\n  async analyze() {\n    await this._analyzeWaveform();\n    await this._analyzeBeatGrid();\n    await this._analyzePhrases();\n  }\n\n  // Beat Jump Methods\n  beatJump(beats) {\n    if (this.beatData) {\n      // Implementation: Jump forward/backward by number of beats\n    }\n  }\n\n  // Extended metadata methods\n  addTag(tag) {\n    if (!this.metadata.tags) {\n      this.metadata.tags = new Set();\n    }\n    this.metadata.tags.add(tag);\n  }\n\n  setRating(rating) {\n    this.metadata.rating = rating;\n    this.setData({ rating });\n  }\n\n  // History tracking\n  addToHistory(timestamp = Date.now()) {\n    if (!this.metadata.playHistory) {\n      this.metadata.playHistory = [];\n    }\n    this.metadata.playHistory.push(timestamp);\n  }\n\n  // Key detection and manipulation\n  detectKey() {\n    // Implementation: Analyze audio and detect musical key\n  }\n\n  setKey(key) {\n    this.metadata.detectedKey = key;\n    this.setData({ detectedKey: key });\n  }\n\n  // Extended private methods\n  async _analyzeWaveform() {\n    // Implementation: Generate waveform data\n  }\n\n  async _analyzeBeatGrid() {\n    // Implementation: Detect beats and tempo\n  }\n\n  async _analyzePhrases() {\n    // Implementation: Detect musical phrases\n  }\n\n\n}\n\n*/","\n// stubs\nconst api = {\n\n   \n    addonManager: {\n        initAddon: () => {}\n    }\n};\n\nconst automator = {\n    updateAutomation: () => {}\n};\n\n\nexport default function createTopTrackControls(track, container) {\n    console.log('Creating top track controls for:', track);\n    let trackId = track.id;\n\n    let titleElement = createTitleDisplay(track, trackId);\n    track.transport.titleElement = titleElement;\n    container.appendChild(titleElement);\n    // setupScrollingTitle(container, titleElement);\n\n    let tagsElement = createTagsDisplay(track, trackId);\n    track.transport.tagsElement = tagsElement;\n    container.appendChild(tagsElement);\n\n    // Create a common container for the time and BPM data\n    let dataContainer = document.createElement('div');\n    dataContainer.className = 'data-container';\n    // dataContainer.style.width = '200px';\n    // Create time display element\n    let detailedTimeDisplay = document.createElement('div');\n    detailedTimeDisplay.className = 'time-display';\n    detailedTimeDisplay.innerText = '00:00'; // Initial display\n    dataContainer.appendChild(detailedTimeDisplay);\n\n    // Create current track BPM display\n    let currentTrackBpm = document.createElement('div');\n    currentTrackBpm.className = 'current-bpm';\n    currentTrackBpm.innerText = track.metadata.bpm ? Number(track.metadata.bpm).toFixed(2) : 'N/A';\n    dataContainer.appendChild(currentTrackBpm);\n\n    // Create key text element\n    let keyText = document.createElement('div');\n    keyText.className = 'key-text';\n    keyText.innerText = track.metadata.initialKey || 'N/A';\n    dataContainer.appendChild(keyText);\n\n    // Append the entire container to the main container\n    container.appendChild(dataContainer);\n\n    // Create time duration element\n    let detailedTimeDuration = document.createElement('div');\n    detailedTimeDuration.className = 'time-duration';\n    detailedTimeDuration.innerText = ''; // Initial display\n    dataContainer.appendChild(detailedTimeDuration);\n\n    // Create track BPM element\n    let trackBpm = document.createElement('div');\n    trackBpm.className = 'bpm-text';\n    trackBpm.innerText = track.metadata.bpm ? Number(track.metadata.bpm).toFixed(2) : 'N/A';\n    trackBpm.addEventListener('click', async () => {\n        console.log('Setting BPM to', track.metadata.bpm);\n        await track.setBPM(track.metadata.bpm);\n    });\n    dataContainer.appendChild(trackBpm);\n\n    // Create BPM percentage display\n    let trackBpmPercentage = document.createElement('div');\n    trackBpmPercentage.className = 'bpm-percentage';\n    trackBpmPercentage.innerText = '0%'; // Initial display\n    trackBpmPercentage.style.fontSize = '14px !important';\n    dataContainer.appendChild(trackBpmPercentage);\n\n    // Save elements to transport for external control\n    track.transport.detailedTimeDisplay = detailedTimeDisplay;\n    track.transport.detailedTimeDuration = detailedTimeDuration;\n    track.transport.trackBpmPercentage = trackBpmPercentage;\n    track.transport.currentTrackBpm = currentTrackBpm;\n\n    // create keyLock button\n    // use font-awesome icons for music note\n    let keyLockButton = document.createElement('button');\n    keyLockButton.classList.add('key-lock-btn', 'key-lock-btn-active');\n    keyLockButton.title = 'Pitch Bend Key Lock';\n    //keyLockButton.className = 'key-lock-btn';\n    keyLockButton.innerHTML = '<i class=\"fas fa-music\"></i>';\n    //keyLockButton.innerHTML = '<i class=\"fas fa-music\"></i>';\n    keyLockButton.addEventListener('click', async () => {\n        console.log('Key Lock button clicked');\n\n        // if selected, remove the style\n        if (keyLockButton.classList.contains('key-lock-btn-active')) {\n            keyLockButton.classList.remove('key-lock-btn-active');\n            keyLockButton.classList.add('key-lock-btn-inactive');\n\n        } else {\n            keyLockButton.classList.add('key-lock-btn-active');\n            keyLockButton.classList.remove('key-lock-btn-inactive');\n        }\n\n        await track.toggleKeyLock();\n    });\n    container.appendChild(keyLockButton);\n\n}\n\nlet CONTAINER_WIDTH = 385; // Adjust container width\nlet SCROLL_RATE = -0.1; // Adjust scroll speed\nlet WAIT_TO_SCROLL_TIME = 2000; // Wait time before starting scroll\n\nfunction setupScrollingTitle(container, textElement) {\n    console.log(\"Setting up scrolling title for:\", container);\n\n    // Clone the text element for seamless effect\n    const clone = textElement.cloneNode(true);\n    clone.style.paddingLeft = \"20px\"; // Add spacing between repeated text\n    // container.appendChild(clone);\n\n    // Get the dynamic scroll width\n    const textWidth = textElement.offsetWidth;\n    const containerWidth = container.offsetWidth;\n    let scrollWidth = textWidth + parseInt(clone.style.paddingLeft, 10);\n    scrollWidth = scrollWidth * 0.3;\n\n    let scrollPosition = 0;\n\n    // Scroll function\n    function scrollText() {\n        scrollPosition += SCROLL_RATE;\n\n        textElement.style.transform = `translateX(${scrollPosition}px)`;\n        clone.style.transform = `translateX(${scrollPosition}px)`;\n\n        // Reset or bounce the scroll position\n        // TODO: Use CONTAINER_WIDTH?\n        console.log('scrollPosition', scrollPosition, 'scrollWidth', scrollWidth);\n        if (Math.abs(scrollPosition) >= scrollWidth) {\n            // scrollPosition = 0; // Reset for seamless loop\n            SCROLL_RATE = SCROLL_RATE * -1; // Reverse scroll direction\n        }\n\n        requestAnimationFrame(scrollText);\n    }\n\n    // Delay scrolling to allow initial view\n    setTimeout(scrollText, WAIT_TO_SCROLL_TIME);\n}\n\n\nfunction createTitleDisplay(track, trackId) {\n\n    const titleContainer = document.createElement('div');\n    titleContainer.className = 'titleContainer';\n\n    // Song Title Display\n    const titleElement = document.createElement('span');\n\n    let titleText = track.getTitle(track);\n\n    /*\n    let titleText = trackData && trackData.metadata ? trackData.metadata.title : 'Unknown Title';\n\n    // clean up track title ( todo: rename files for real )\n    titleText = titleText.replace('_(mp3.pm)', '');\n    // replaces all instances of _ with space\n    titleText = titleText.split('_').join(' ');\n    */\n\n    titleElement.textContent = `${titleText}`;\n    titleElement.className = 'titleElement';\n    titleElement.style.overflow = 'hidden';\n    titleElement.style.textOverflow = 'ellipsis';\n\n    titleContainer.appendChild(titleElement);\n    return titleContainer;\n\n}\n\n\nfunction createTagsDisplay(track, trackId) {\n    // Create a container for the tags\n    const tagsElement = document.createElement('div');\n    tagsElement.className = 'tags-container';\n\n    // TODO: replace with real tags\n    // TODO: when click tag, open library with suggest tracks on that tag search\n    // Create a tag for the track's key\n    const keyTag = document.createElement('div');\n    keyTag.className = 'tag key-tag';\n    keyTag.innerText = track.metadata.key ? track.metadata.key.note : 'N/A';\n    tagsElement.appendChild(keyTag);\n\n    // Create a tag for the track's BPM\n    const bpmTag = document.createElement('div');\n    bpmTag.className = 'tag bpm-tag';\n    bpmTag.innerText = track.metadata.bpm ? Number(track.metadata.bpm).toFixed(2) : 'N/A';\n    tagsElement.appendChild(bpmTag);\n\n    // Create a tag for the track's genre\n    const genreTag = document.createElement('div');\n    genreTag.className = 'tag genre-tag';\n    genreTag.innerText = track.metadata.genre || 'N/A';\n    tagsElement.appendChild(genreTag);\n\n    // Create a tag for the track's artist\n    const artistTag = document.createElement('div');\n    artistTag.className = 'tag artist-tag';\n    artistTag.innerText = track.metadata.artist || 'N/A';\n    tagsElement.appendChild(artistTag);\n\n    // tag for adding new tags\n    const addTag = document.createElement('div');\n    addTag.className = 'tag add-tag';\n    addTag.innerText = '+';\n    addTag.addEventListener('click', () => {\n        console.log('Add tag clicked');\n        // api.toggleAddTagDialog(track, function () {\n    });\n    tagsElement.appendChild(addTag);\n\n    return tagsElement;\n}\n","function renderCuePoints(waveform, track, color = '#8a2be2', barWidth = 1, style = null) {\n    //console.log('showCuePoint', waveform, track);\n    let cuePoints = track.metadata.cuePoints || []; // could autofill here\n    // console.log('found cuePoints:', cuePoints);\n  \n    if (!cuePoints.length) {\n      // is {}?? could be old data...\n      return;\n    }\n  \n    cuePoints.forEach((cue, i) => {\n  \n      renderCuePoint(i, waveform, track, cue, style, color, barWidth);\n    });\n  }\n  \n  function renderCuePoint(i, waveform, track, cue, style = null, color = '#8a2be2', barWidth = 1) {\n    //console.log('showCuePoint', waveform, track);\n    //console.log('found cuePoints:', cuePoints);\n  \n    if (!style) {\n      // create default style\n      style = {\n        color: 'white',\n        backgroundColor: 'rgba(0, 0, 0, 0.5)',\n        border: '1px solid white',\n        borderRadius: '5px',\n        paddingLeft: '5px',\n        paddingRight: '5px',\n        marginLeft: '5px',\n        // marginTop: '5px',\n  \n        lineHeight: '1em',\n      }\n    }\n  \n    barWidth = track.metadata.beatLength / 8;\n  \n    if (!cue || typeof cue.time !== 'number') {\n      console.error('Invalid cue point:', cue);\n      return\n    }\n  \n    let cueTime = cue.time;\n    let cuePoint = cue.point || (i + 1).toString();\n    // let cuePoint = cue.point \n  \n    let regionLabel = document.createElement('span');\n    regionLabel.classList.add('region-label');\n  \n    // on click cueTo region\n    regionLabel.addEventListener('click', function (ev) {\n      let target = ev.target;\n      let value = target.textContent;\n      api.track.cueTo(track.id, value);\n      ev.preventDefault();\n      ev.stopPropagation();\n      return false;\n      //alert(value)\n    });\n  \n    // apply custom style to regionLabel\n    for (let key in style) {\n      regionLabel.style[key] = style[key];\n    }\n  \n    regionLabel.textContent = cuePoint;\n  \n    // let adjustedCueTime = cueTime - track.metadata.firstBeatOffset;\n    let adjustedCueTime = cueTime;\n  \n    waveform.regions.addRegion({\n      start: adjustedCueTime,\n      end: adjustedCueTime + barWidth,  // Short duration to mark the snap point\n      content: regionLabel,\n      color: color,\n      drag: false,\n      resize: false,\n    });\n  }\n  \n\n  const CuePoints = {\n    renderCuePoints,\n    renderCuePoint\n  };\n\n  export default CuePoints;","\nexport default function setBPM (bpm) {\n    bpm = Number(bpm);\n    console.log('AAAA track.setBPM', this.id, bpm)\n    let waveform = this.waveform;\n\n    if (this) {\n\n        // console.log('found track bpm', this, this.bpm, bpm);\n\n        this.currentBPM = bpm;\n        const originalBPM = this.bpm || 120; // Use the current BPM or a default value\n        let playbackRate = bpm / originalBPM;\n        //track.bpm = bpm;\n        // console.log('Setting playback rate to:', playbackRate);\n        // round to nearest 2 decimals\n        playbackRate = Math.round(playbackRate * 100) / 100;\n        waveform.setPlaybackRate(playbackRate);\n\n        // track.setBPM(trackId, originalBPM);\n        this.audioElement.playbackRate = playbackRate; // Set the playback rate of the audio element\n\n        let currentBpmText = this.detailedContainer.querySelector('.current-bpm');\n        let paddedString = bpm.toFixed(2);\n        // currentBpmText.textContent = paddedString;\n\n        // in addition, we need to set the .bpm-percentage element to the percentage difference between the current BPM and the original BPM\n        // this is a simple calculation of (bpm / originalBPM) * 100\n        let bpmPercentage = (bpm / originalBPM) * 100;\n        let el = this.detailedContainer.querySelector('.bpm-percentage');\n        // round bpmPercentage to 2 decimals\n\n        // instead of percentage, value should be + or - the difference\n        // if bpmPercentage is positive, add a + sign\n        bpmPercentage = bpmPercentage - 100;\n\n        if (bpmPercentage > 0) {\n            bpmPercentage = '+' + bpmPercentage;\n        } else {\n            bpmPercentage = '' + bpmPercentage;\n        }\n        bpmPercentage = Math.round(bpmPercentage * 100) / 100;\n\n        // el.textContent = bpmPercentage + '%';\n\n\n\n\n    }\n}\n","import CuePoints from '../waveform/CuePoints.js';\n\n\n\nconst automator = {\n    updateAutomation: () => {}\n};\n\nconst transport = {\n    createTrackControls: () => {}\n};\n\n//import api from '../api.js';\n//import transport from '../transport.js';\n\nconst cueControls = {};\n\n// creates container div for all cue controls\ncueControls.createCueControls = function (track) {\n    let cueControlsContainer = document.createElement('div');\n    cueControlsContainer.id = `#cueControls-${track.id}`;\n    cueControlsContainer.classList.add('cue-controls');\n    // create the buttons\n    let cueButtons = cueControls.createCueButtons(track);\n    cueControlsContainer.appendChild(cueButtons);\n    return cueControlsContainer;\n};\n\n// creates a set of buttons for cue points 1-8\ncueControls.createCueButtons = function (track) {\n    let cueButtons = document.createElement('div');\n    cueButtons.classList.add('cue-buttons');\n    for (let i = 1; i <= 8; i++) {\n        let cueButton = cueControls.createCueButton(track, i);\n        cueButtons.appendChild(cueButton);\n    }\n    return cueButtons;\n};\n\n// creates a single cue button\ncueControls.createCueButton = function (track, cueNumber) {\n    let cueButton = document.createElement('button');\n    cueButton.classList.add('cue-button');\n    // TODO: add shift key functionality\n    // cueButton.classList.add('has-shift-key');\n\n    let isMappedToCuePoint = '';\n    let wasAlreadyPlaying = false;\n\n    let cueIndex = Number(cueNumber) - 1;\n\n    // check if this cue point is already set\n    if (track && track.metadata.cuePoints) {\n\n        let cuePoints = track.metadata.cuePoints;\n        // console.log('createCueButton track', cuePoints, cueNumber);\n        if (cuePoints && cuePoints[Number(cueNumber)]) {\n            isMappedToCuePoint = 'cue-mapped';\n        }\n    }\n    //console.log('isMappedToCuePoint', isMappedToCuePoint)\n    cueButton.innerHTML = `<span class=\"cue-number ${isMappedToCuePoint}\">${cueNumber}</span>`;\n    cueButton.dataset.cueNumber = cueNumber;\n\n    track.transport.cueButtons = track.transport.cueButtons || {};\n    track.transport.cueButtons[cueNumber] = cueButton;\n\n    // on click, set cue point\n    cueButton.addEventListener('mousedown', function () {\n        //        console.log('cueButton mousedown', cueButton.dataset.cueNumber);\n\n        /* TODO: leave this for now\n        // check to see if this cue point is already set\n        if (track.isCueSet && track.cueNumber === cueNumber) {\n            // if already set, return to cue point\n            api.transport.cueTo(trackId, cueNumber);\n            return;\n        } else {\n            // set cue point\n            api.transport.setCue(trackId, cueNumber);\n            cueButton.classList.add('btn-active');\n        }\n            */\n\n        if (track.isPlaying(track.id)) {\n            wasAlreadyPlaying = true;\n        }\n\n        // check if there is a cuePoint associated with this button\n        let cuePoints = track.metadata.cuePoints;\n        console.log(\"using cuePoints\", cuePoints)\n        if (cuePoints && cuePoints[Number(cueNumber) - 1]) {\n            console.log('cueButton mousedown', cueButton.dataset.cueNumber);\n            track.cueTo((cueIndex + 1).toString());\n    \n        } else {\n            console.log(\"No cue point set for this button\");\n            let currentTime = track.waveform.getCurrentTime();\n            console.log('Setting cue point', cueNumber, currentTime);\n            track.setCuePoint(cueNumber, currentTime);\n            // CuePoints.renderCuePoints(track, track.waveform, track.metadata.cuePoints);\n            CuePoints.renderCuePoint(cueNumber - 1, track.detailedWaveform, t, cue)\n\n    //transport.renderCuePoint(cueNumber - 1, t.detailedWaveform, t, cue)\n    //transport.renderCuePoint(cueNumber - 1, t.overviewWaveform, t, cue)\n\n\n\n\n        }\n\n\n\n        // Remark: This is actually a cue operation..\n        // TODO: track.isCueing = true;\n//        track.isCueing = true;\n        // api.track.play(trackId);\n\n        // toggle the btn-active class on all other buttons to off\n        let buttons = document.querySelectorAll('.cue-button');\n        buttons.forEach(button => {\n            if (button !== cueButton) {\n                button.classList.remove('btn-active');\n            }\n        });\n    });\n\n    cueButton.addEventListener('mouseup', function () {\n        // api.transport.releaseCue(track.id);\n        return;\n        if (!wasAlreadyPlaying /*&& !track.isCueing */ ) { // TOOD: && !track.isCueing\n\n            let track = transport.tracks[trackId];\n            if (track.keepPlayingOnCueRelease) {\n\n            } else {\n                api.track.pause(trackId);\n                api.track.cueTo(trackId, (cueIndex + 1).toString());\n            }\n        }\n        wasAlreadyPlaying = false;\n    });\n\n    return cueButton;\n};\n\nexport default cueControls.createCueControls;","export default function createSliderComponent(track, trackId, config = {}) {\n    let slider = new SliderComponent(track, trackId, config);\n    return slider;\n}\n\nfunction SliderComponent(track, trackId, config = {}) {\n    // Default configuration options\n    const defaultConfig = {\n        className: 'volume-slider',\n        thumbClassName: 'slider-thumb',\n        labelClassName: 'label', // New option for label class\n        orientation: 'vertical', // 'vertical' or 'horizontal'\n        trackColor: '#333',\n        thumbColor: '#fff',\n        trackWidth: '60px',\n        trackHeight: '200px',\n        thumbWidth: '48px',\n        thumbHeight: '8px',\n        showLabel: true,\n        showScale: false,\n        showCenterLine: false, // Option to enable/disable the center line\n        centerLineColor: '#aeafaf', // Default color for the center line\n        centerLineLength: '32px', // Length of the center line\n        scaleLineLength: '32px', // Length of the scale lines\n        centerLineWidth: '2px', // Default width for the center line\n        centerLineSpacing: 10, // Spacing between each line in pixels\n        progressBarColor: '#4caf50', // Default color for the progress bar\n        progressBarSize: '8px', // Default size for the progress bar\n        minValue: 0,\n        maxValue: 1,\n        step: 0.01,\n        value: 0,\n        defaultValue: 0, // Default value when double-clicking the slider\n        onDoubleClick: (value) => {\n            console.log('Must implement double-click handler to reset the value');\n            // resets the value to default\n            this.setValue(value);\n        },\n        onClick : (value) => {\n            // console.log('Must implement onClick to evoke changes to state');\n        },\n        onChange: (value, val) => {\n            console.log('Must implement changeFunction to evoke changes to state');\n        },\n        formatLabel: (value) => {\n            return value.toFixed(2);\n        }\n    };\n\n    const options = { ...defaultConfig, ...config };\n    this.options = options;\n\n    this.onClick = options.onClick.bind(this); // Binding the onClick method to ensure proper context\n    this.onChange = options.onChange.bind(this); // Binding the onChange method to ensure proper context\n    this.onDoubleClick = options.onDoubleClick.bind(this); // Binding the onDoubleClick method to ensure proper context\n    this.formatLabel = options.formatLabel.bind(this);\n    this.thumbHeight = options.thumbHeight;\n    this.thumbWidth = options.thumbWidth;\n    this.trackWidth = options.trackWidth;\n    this.trackHeight = options.trackHeight;\n    this.orientation = options.orientation;\n\n    this.defaultValue = options.defaultValue;\n\n\n    this.trackLength = options.orientation === 'vertical'\n        ? parseInt(options.trackHeight)\n        : parseInt(options.trackWidth);\n\n\n    const sliderContainer = document.createElement('div');\n    this.sliderContainer = sliderContainer;\n    this.minValue = options.minValue;\n    this.maxValue = options.maxValue;\n    this.value = options.value;\n\n    sliderContainer.style.background = options.trackColor;\n    sliderContainer.style.borderRadius = '5px';\n    sliderContainer.classList.add(options.className);\n    sliderContainer.classList.add('slider-component');\n\n    if (options.orientation === 'vertical') {\n        sliderContainer.style.width = options.trackWidth;\n        sliderContainer.style.height = options.trackHeight;\n    } else {\n        sliderContainer.style.width = options.trackHeight; // Flip dimensions for horizontal\n        sliderContainer.style.height = options.trackWidth;\n    }\n\n    if (options.showCenterLine) {\n        const centerLine = document.createElement('div');\n        centerLine.style.position = 'absolute';\n        centerLine.style.background = options.centerLineColor;\n\n        if (options.orientation === 'vertical') {\n            centerLine.style.width = options.centerLineLength;\n            centerLine.style.height = options.centerLineWidth;\n            centerLine.style.left = `calc(50% - ${parseInt(options.centerLineLength) / 2}px)`;\n            centerLine.style.top = '50%';\n        } else {\n            centerLine.style.height = options.centerLineLength;\n            centerLine.style.width = options.centerLineWidth;\n            centerLine.style.top = `calc(50% - ${parseInt(options.centerLineLength) / 2}px)`;\n            centerLine.style.left = '50%';\n        }\n\n        sliderContainer.appendChild(centerLine);\n    }\n\n    if (options.showScale) {\n        const createLine = (position) => {\n            const line = document.createElement('div');\n            line.style.position = 'absolute';\n            line.style.background = options.centerLineColor;\n            line.style.opacity = 0.2;\n\n            if (options.orientation === 'vertical') {\n                line.style.width = options.scaleLineLength;\n                line.style.height = options.centerLineWidth;\n                line.style.left = `calc(50% - ${parseInt(options.scaleLineLength) / 2}px)`;\n                line.style.top = `${position}px`;\n            } else {\n                line.style.height = options.scaleLineLength;\n                line.style.width = options.centerLineWidth;\n                line.style.top = `calc(50% - ${parseInt(options.scaleLineLength) / 2}px)`;\n                line.style.left = `${position}px`;\n            }\n\n            sliderContainer.appendChild(line);\n        };\n\n        // Add lines symmetrically starting from the center\n        const trackLength = options.orientation === 'vertical'\n            ? parseInt(options.trackHeight)\n            : parseInt(options.trackWidth);\n\n        const center = trackLength / 2;\n        const spacing = options.centerLineSpacing;\n\n        // Create lines from the center outward\n        for (let offset = 0; center + offset <= trackLength || center - offset >= 0; offset += spacing) {\n            if (center + offset <= trackLength) createLine(center + offset); // Line below/after center\n            if (center - offset >= 0 && offset !== 0) createLine(center - offset); // Line above/before center\n        }\n    }\n\n    if (options.showProgress) {\n        const progressBar = document.createElement('div');\n        progressBar.style.position = 'absolute';\n        progressBar.style.background = options.progressBarColor;\n        progressBar.style.zIndex = '1'; // Ensure it appears below the thumb\n        this.progressBar = progressBar;\n\n        if (options.orientation === 'vertical') {\n            progressBar.style.width = options.progressBarSize;\n            progressBar.style.left = `calc(50% - ${parseInt(options.progressBarSize) / 2}px)`;\n        } else {\n            progressBar.style.height = options.progressBarSize;\n            progressBar.style.top = `calc(50% - ${parseInt(options.progressBarSize) / 2}px)`;\n        }\n        sliderContainer.appendChild(progressBar);\n\n    }\n\n    // Slider thumb\n    const sliderThumb = document.createElement('div');\n    sliderThumb.classList.add(options.thumbClassName);\n    sliderThumb.style.position = 'absolute';\n    sliderThumb.style.background = options.thumbColor;\n    sliderThumb.style.borderRadius = '4px';\n    sliderThumb.style.cursor = 'pointer';\n    sliderThumb.title = this.options.title || \"Track Volume\";\n\n    if (this.options.sliderThumbStyles) {\n        // object array of styles with keys as the css property and values as the css value\n        // iterate and apply\n        Object.keys(this.options.sliderThumbStyles).forEach((key) => {\n            sliderThumb.style[key] = this.options.sliderThumbStyles[key];\n        });\n    }\n\n    if (options.orientation === 'vertical') {\n        sliderThumb.style.width = options.thumbWidth;\n        sliderThumb.style.height = options.thumbHeight;\n        // sliderThumb.style.left = `calc(50% - ${parseInt(options.thumbWidth) / 2}px)`;\n    } else {\n        sliderThumb.style.width = options.thumbHeight; // Flip dimensions for horizontal\n        sliderThumb.style.height = options.thumbWidth;\n        // sliderThumb.style.top = `calc(50% - ${parseInt(options.thumbWidth) / 2}px)`;\n    }\n\n    this.sliderThumb = sliderThumb;\n\n    const initialPosition =\n        options.orientation === 'vertical'\n            ? (1 - options.value) * this.trackLength\n            : options.value * this.trackLength;\n\n    if (options.orientation === 'vertical') {\n        sliderThumb.style.top = `${initialPosition - parseInt(options.thumbHeight) / 2}px`;\n    } else {\n        sliderThumb.style.left = `${initialPosition - parseInt(options.thumbWidth) / 2}px`;\n    }\n\n    sliderContainer.appendChild(sliderThumb);\n\n    const sliderLabel = document.createElement('div');\n    sliderLabel.classList.add(options.labelClassName);\n    sliderLabel.textContent = options.value.toFixed(2); // Initial value\n    sliderLabel.style.position = 'absolute';\n    sliderLabel.style.top = options.orientation === 'vertical' ? '-22px' : '50%';\n    sliderLabel.style.left = options.orientation === 'vertical' ? '50%' : 'calc(100% + 10px)';\n    sliderLabel.style.transform = options.orientation === 'vertical' ? 'translateX(-50%)' : 'translateY(-50%)';\n    this.sliderLabel = sliderLabel;\n\n    if (!this.options.showLabel) {\n        sliderLabel.style.display = 'none';\n    }\n\n    sliderContainer.appendChild(sliderLabel);\n\n    let self = this;\n\n    let isDragging = false;\n\n    sliderThumb.addEventListener('mousedown', (e) => {\n        this.onClick(this.getValue());\n        isDragging = true;\n        this._onChange(e);\n    });\n\n    sliderThumb.addEventListener('touchstart', (e) => {\n        isDragging = true;\n        this._onChange(e.touches[0]);\n    });\n\n    document.addEventListener('mousemove', (e) => {\n        if (isDragging) this._onChange(e);\n    });\n\n    document.addEventListener('touchmove', (e) => {\n        if (isDragging) this._onChange(e.touches[0]);\n    });\n\n    document.addEventListener('mouseup', () => {\n        isDragging = false;\n    });\n\n    document.addEventListener('touchend', () => {\n        isDragging = false;\n    });\n\n    sliderContainer.addEventListener('mousedown', (e) => {\n        if (e.target === sliderThumb) return;\n        this.onClick(this.getValue());\n        this._onChange(e);\n        isDragging = true;\n    });\n\n    // mobile touch events\n    sliderContainer.addEventListener('touchstart', (e) => {\n        if (e.target === sliderThumb) return;\n        this._onChange(e.touches[0]);\n        isDragging = true;\n    });\n\n    sliderContainer.addEventListener('touchend', () => {\n        isDragging = false;\n    });\n\n    sliderContainer.addEventListener('touchmove', (e) => {\n        if (isDragging) this._onChange(e.touches[0]);\n    });\n\n    sliderContainer.addEventListener('dblclick', (e) => {\n        // TODO: ensure a delay of 200ms has passed\n        // before resetting the value\n        this.onDoubleClick(this.defaultValue);\n    });\n\n    this.setValue(options.value, false);\n\n    return this;\n}\n\nSliderComponent.prototype._onChange = function (e) {\n    // Custom scale for zoomed-in elements\n    let scale = 1;\n    //scale = 1;\n    const rect = this.sliderContainer.getBoundingClientRect();\n    let position;\n\n    // Adjust rect dimensions based on scale\n    const scaledWidth = rect.width / scale;\n    const scaledHeight = rect.height / scale;\n\n    if (this.orientation === 'vertical') {\n        // Calculate position accounting for the scale\n        position = (e.clientY - rect.top) / scale;\n        position = Math.min(Math.max(position, 0), scaledHeight);\n\n        const volume = 1 - position / scaledHeight;\n\n        // Adjust slider thumb position based on scale\n        this.sliderThumb.style.top = `${Math.min(\n            Math.max(position - parseInt(this.thumbHeight) / 2 / scale, 0),\n            scaledHeight - parseInt(this.thumbHeight) / scale\n        )}px`;\n\n        // Update value and UI elements\n        this.value = volume;\n        this.updateProgressBar(volume);\n        this.updateLabel(this.formatLabel(volume));\n\n        this.onChange(volume, this.getValue());\n    } else {\n        // Calculate position accounting for the scale\n        position = (e.clientX - rect.left) / scale;\n        position = Math.min(Math.max(position, 0), scaledWidth);\n\n        const volume = position / scaledWidth;\n\n        // Adjust slider thumb position based on scale\n        this.sliderThumb.style.left = `${Math.min(\n            Math.max(position - parseInt(this.thumbWidth) / 2 / scale, 0),\n            scaledWidth - parseInt(this.thumbWidth) / scale\n        )}px`;\n\n        // Update value and UI elements\n        this.value = volume;\n        this.updateProgressBar(volume);\n        this.updateLabel(this.formatLabel(volume));\n\n        this.onChange(volume, this.getValue());\n    }\n};\n\nSliderComponent.prototype.getValue = function () {\n    // returns actual value from with 0 to 1 multipled by the range\n    return this.value * (this.maxValue - this.minValue) + this.minValue;\n}\n\nSliderComponent.prototype.setValue = function (value, propigate = true) {\n    const clampedValue = Math.min(Math.max(value, this.options.minValue), this.options.maxValue);\n    // incoming value is in units of the range,\n    // we need to conver this into 0-1 value\n    let range = this.maxValue - this.minValue;\n    let normalizedValue = (clampedValue - this.minValue) / range;\n\n    this.value = normalizedValue;\n\n    const position =\n        this.orientation === 'vertical'\n            ? (1 - normalizedValue) * this.trackLength\n            : normalizedValue * this.trackLength;\n\n    if (this.orientation === 'vertical') {\n        this.sliderThumb.style.top = `${Math.min(\n            Math.max(position - parseInt(this.thumbHeight) / 2, 0),\n            this.trackLength - parseInt(this.thumbHeight)\n        )}px`;\n        if (this.options.showProgress) {\n\n            this.progressBar.style.height = `${(1 - normalizedValue) * this.trackLength}px`;\n            this.progressBar.style.top = `${normalizedValue * this.trackLength}px`;\n        }\n    } else {\n        this.sliderThumb.style.left = `${Math.min(\n            Math.max(position - parseInt(this.thumbWidth) / 2, 0),\n            this.trackLength - parseInt(this.thumbWidth)\n        )}px`;\n        if (this.options.showProgress) {\n            this.progressBar.style.width = `${normalizedValue * this.trackLength}px`;\n        }\n    }\n    this.updateLabel(this.formatLabel(value));\n    this.updateProgressBar();\n\n    if (propigate) {\n        // this.onChange(normalizedValue, this.getValue()); // Ensure onChange is always called\n        this.onChange(normalizedValue, this.getValue());\n\n    }\n};\n\nSliderComponent.prototype.updateProgressBar = function (value) {\n    if (!this.options.showProgress) return;\n    const position = value * this.trackLength; // Position based on current value\n    console.log('value', value, 'position', position);\n\n    if (this.orientation === 'vertical') {\n        // Ensure the progress bar grows upward for vertical orientation\n        this.progressBar.style.height = `${position}px`;\n        this.progressBar.style.top = `${this.trackLength - position}px`;\n    } else {\n        // Ensure the progress bar grows to the right for horizontal orientation\n        this.progressBar.style.width = `${position}px`;\n        this.progressBar.style.left = '0'; // Reset any previous left offset\n    }\n};\n\nSliderComponent.prototype.updateLabel = function (val) {\n    this.sliderLabel.textContent = this.getValue().toFixed(2);\n};","export default function applyEQ3(track, type, gainValue) {\n\n    // TODO: use track.audioNodes Map instead of track.eqNodes\n    // if (!track.audioNodes.has('eq3')) {\n\n    if (!track.eqNodes) {\n        console.log(\"Creating EQ nodes for track\", track.id);\n        // Create and configure EQ nodes\n        track.eqNodes = {\n            lowshelf: track.audioContext.createBiquadFilter(),\n            peaking: track.audioContext.createBiquadFilter(),\n            highshelf: track.audioContext.createBiquadFilter(),\n        };\n\n        track.eqNodes.lowshelf.type = \"lowshelf\";\n        track.eqNodes.lowshelf.frequency.value = 200;\n        track.eqNodes.lowshelf.gain.value = 0;\n\n        track.eqNodes.peaking.type = \"peaking\";\n        track.eqNodes.peaking.frequency.value = 1000;\n        track.eqNodes.peaking.Q.value = 1;\n        track.eqNodes.peaking.gain.value = 0;\n\n        track.eqNodes.highshelf.type = \"highshelf\";\n        track.eqNodes.highshelf.frequency.value = 5000;\n        track.eqNodes.highshelf.gain.value = 0;\n\n        track.addNode('eq-lowshelf', track.eqNodes.lowshelf);\n        track.addNode('eq-peaking', track.eqNodes.peaking);\n        track.addNode('eq-highshelf', track.eqNodes.highshelf);\n\n    }\n\n    // Adjust EQ gain\n    const eqNode = track.eqNodes[type];\n    if (eqNode) {\n        eqNode.gain.value = gainValue;\n        // console.log(`Applied ${type} EQ with gain ${gainValue}`);\n    } else {\n        console.warn(`Invalid EQ type: ${type}`);\n    }\n}","\nimport Filter from '../../../nodes/Filter.js';\nimport sliderComponent from '../../../../ui/Slider.js';\n\nexport default function createFilterComponent(track) {\n    const { id: trackId, transport } = track;\n    const { eq3Container } = transport;\n\n    let filterContainer = document.createElement('div');\n    filterContainer.classList.add('filter-container');\n\n    // Filter/EQ Switch Button\n    const filterEqSwitch = document.createElement('button');\n    filterEqSwitch.textContent = 'FILTER';\n    filterEqSwitch.classList.add('filterEqSwitch', 'btn-active');\n\n    const filterSlider = sliderComponent(track, trackId, {\n        trackWidth: '110px',\n        trackHeight: '150px',\n        thumbHeight: '24px',\n        thumbWidth: '96px',\n        className: 'filter-slider',\n        thumbColor: 'yellow',\n        showCenterLine: true,\n        showScale: true,\n        minValue: -1,\n        maxValue: 1,\n        value: -0.911,\n        defaultValue: -1,\n        sliderThumbStyles: { left: '6px' },\n        onChange: (val) => Filter(track, val),\n    });\n\n    transport.filterSlider = filterSlider;\n    filterContainer.append(filterSlider.sliderContainer);\n\n    filterEqSwitch.addEventListener('click', () => {\n        // fxSwitch.style.display = 'none';\n\n        if (filterSlider.sliderContainer.style.display === 'block') {\n            filterSlider.sliderContainer.style.display = 'none';\n            filterEqSwitch.textContent = 'FILTER';\n            eq3Container.style.display = 'block';\n            //filterEqSwitch.style.display = 'none';\n            filterSlider.style.display = 'none';\n\n            eq3Container.querySelectorAll('div.label').forEach(label => {\n                label.style.display = 'block';\n            });\n        } else {\n            filterSlider.sliderContainer.style.display = 'block';\n            filterEqSwitch.textContent = 'EQ3';\n            eq3Container.style.display = 'none';\n            //filterEqSwitch.style.display = 'block';\n\n            eq3Container.querySelectorAll('div.label').forEach(label => {\n                label.style.display = 'none';\n            });\n        }\n    });\n\n    filterContainer.append(filterEqSwitch);\n    return filterContainer;\n}","// TODO: This is the legacy function we need to update to the new style as above\nexport default function applyFilter(track, value, resonance = 1) {\n\n    if (!track) return;\n\n    console.log('applyFilter', track.id, value);\n\n    // Ensure the value is clamped within the range [-22050, 22050]\n    value = Math.max(-22050, Math.min(22050, Number(value)));\n    // Clamp resonance to a sensible range, typically [0.1, 10]\n    resonance = Math.max(0.1, Math.min(10, Number(resonance)));\n\n    // Initialize the filter node if it doesn't exist\n\n    // Check if the filter node already exists, if not create and add it\n    if (!track.audioNodes.has('filter')) {\n        let filterNode = track.audioContext.createBiquadFilter();\n        console.log(\"Creating filter node for track\", track.id, filterNode);\n        track.addNode('filter', filterNode); // Use addNode to manage the filter\n        track.filterNode = filterNode; // Store the filter node reference ( for now, should use track API instead )\n    }\n\n    const filterNode = track.audioNodes.get('filter');\n\n\n    // console.log('applyFilter', track.id, value);\n\n    const minFrequency = 10; // Minimum valid frequency\n    const maxFrequency = 22050; // Maximum valid frequency\n\n    if (value < 0) {\n        // Lowpass: Map value [-1, 0) to frequencies [maxFrequency, minFrequency]\n        const normalizedValue = Math.max(-1, Math.min(0, value)); // Clamp value to [-1, 0]\n        track.filterNode.type = 'lowpass';\n        track.filterNode.frequency.value =\n            maxFrequency * Math.pow(minFrequency / maxFrequency, -normalizedValue);\n    } else if (value > 0) {\n        // Highpass: Map value (0, 1] to frequencies [minFrequency, maxFrequency]\n        const normalizedValue = Math.max(0, Math.min(1, value)); // Clamp value to [0, 1]\n        track.filterNode.type = 'highpass';\n        track.filterNode.frequency.value =\n            minFrequency * Math.pow(maxFrequency / minFrequency, normalizedValue);\n    } else {\n        // Allpass: No filtering\n        // console.log('ALLPASS');\n        track.filterNode.type = 'allpass';\n        track.filterNode.frequency.value = maxFrequency; // Full range\n    }\n\n    // Set the resonance (Q value) for the filter\n    filterNode.Q.value = resonance;\n}\n\n","const loopControls = {};\n\n// Main function to create loop controls\nexport default function createLoopControls(track, className) {\n    let lc = new LoopControls(track, className);\n    lc.createLoopButtons();\n    lc.setValue('4');\n    return lc.getContainer();\n}\n\n// Class to manage loop controls\nclass LoopControls {\n    constructor(track, className) {\n        this.track = track;\n        this.trackId = track.id;\n        this.className = className;\n        this.loopButtons = [];\n        this.currentStartIndex = 0;\n        this.visibleCount = 3; // Number of buttons visible at a time\n        this.selectedBeat = null;\n\n        this.container = this.createContainer();\n        this.buttonsWrapper = this.createButtonsWrapper();\n        this.leftButton = this.createNavButton('left');\n        this.rightButton = this.createNavButton('right');\n\n        this.container.appendChild(this.leftButton);\n        this.container.appendChild(this.buttonsWrapper);\n        this.container.appendChild(this.rightButton);\n    }\n\n    // Create the main container for loop controls\n    createContainer() {\n        const container = document.createElement('div');\n        container.id = `loopControls-${this.trackId}`;\n        container.classList.add('loop-controls', this.className);\n        return container;\n    }\n\n    // Create the wrapper for loop buttons\n    createButtonsWrapper() {\n        const wrapper = document.createElement('div');\n        wrapper.classList.add('loop-buttons-wrapper');\n        const buttonsContainer = document.createElement('div');\n        buttonsContainer.classList.add('loop-buttons');\n        wrapper.appendChild(buttonsContainer);\n        return wrapper;\n    }\n\n    // Create navigation buttons (left/right)\n    createNavButton(direction) {\n        const button = document.createElement('button');\n        button.textContent = direction === 'left' ? '<' : '>';\n        button.classList.add('loop-nav', `loop-nav-${direction}`);\n        button.addEventListener('click', () => this.scrollButtons(direction));\n        return button;\n    }\n\n    // Create and populate loop buttons\n    createLoopButtons(start = 1 / 64, end = 32) {\n        const buttonsContainer = this.buttonsWrapper.querySelector('.loop-buttons');\n        for (let i = start; i <= end; i *= 2) {\n            const button = this.createLoopButton(i);\n            this.loopButtons.push(button);\n            buttonsContainer.appendChild(button);\n        }\n        this.updateVisibleButtons();\n    }\n\n    // Create a single loop button\n    createLoopButton(beat) {\n        const button = document.createElement('button');\n        button.classList.add('loop-button');\n        button.textContent = this.formatBeatText(beat);\n        button.dataset.beat = beat;\n\n        button.addEventListener('mousedown', () => {\n            this.setLoopBeat(this.track, beat, button);\n        });\n\n        return button;\n    }\n\n    // Format beat text for display\n    formatBeatText(beat) {\n        const beatMap = {\n            [1 / 64]: '1/64',\n            [1 / 32]: '1/32',\n            [1 / 16]: '1/16',\n            [1 / 8]: '1/8',\n            [1 / 4]: '1/4',\n            [1 / 2]: '1/2',\n            [1]: '1',\n            [2]: '2',\n            [4]: '4',\n            [8]: '8',\n            [16]: '16',\n            [32]: '32'\n        };\n        return beatMap[beat] || beat;\n    }\n\n    // Scroll the visible loop buttons\n    scrollButtons(direction) {\n        if (direction === 'left' && this.currentStartIndex > 0) {\n            this.currentStartIndex--;\n        } else if (direction === 'right' && this.currentStartIndex < this.loopButtons.length - this.visibleCount) {\n            this.currentStartIndex++;\n        }\n        this.updateVisibleButtons();\n\n        let t = this.track;\n        if (t.isLooping) {\n            const newBeatButton = this.loopButtons[this.currentStartIndex];\n            if (newBeatButton) {\n                const newBeat = parseFloat(newBeatButton.dataset.beat);\n                // TODO: in this case we need to ensure the new loop start position is the same as the current loop start position\n                this.updateActiveLoop(t, newBeat);\n            }\n\n            this.loopButtons.forEach(button => button.classList.remove('btn-selected', 'btn-active'));\n            newBeatButton.classList.add('btn-selected', 'btn-active');\n        }\n    }\n\n    // Update the active loop with a new beat size\n    updateActiveLoop(track, newBeat) {\n        const buttons = document.querySelectorAll(`#loopControls-${this.trackId} .loop-button`);\n        buttons.forEach((btn) => btn.classList.remove('btn-active'));\n\n        const activeButton = this.loopButtons.find((btn) => parseFloat(btn.dataset.beat) === newBeat);\n        if (activeButton) {\n            activeButton.classList.add('btn-active');\n            track.loopBeat = newBeat;\n            startLoop(track, newBeat);\n        }\n    }\n\n    // Update visibility of loop buttons\n    updateVisibleButtons() {\n        this.loopButtons.forEach((button, index) => {\n            button.style.display =\n                index >= this.currentStartIndex && index < this.currentStartIndex + this.visibleCount\n                    ? 'inline-block'\n                    : 'none';\n        });\n    }\n\n    // Set the loop beat programmatically\n    setBeat(beat) {\n        const button = this.loopButtons.find((btn) => btn.dataset.beat == beat);\n        if (button) {\n            this.scrollToButton(button);\n            button.click();\n        }\n    }\n\n    // Scroll to a specific button to make it visible\n    scrollToButton(targetButton) {\n        const targetIndex = this.loopButtons.indexOf(targetButton);\n        if (targetIndex === -1) return;\n\n        if (targetIndex < this.currentStartIndex) {\n            this.currentStartIndex = targetIndex;\n        } else if (targetIndex >= this.currentStartIndex + this.visibleCount) {\n            this.currentStartIndex = targetIndex - this.visibleCount + 1;\n        }\n        this.updateVisibleButtons();\n    }\n\n    // Set the loop beat and update the UI\n    setLoopBeat(track, beat, button) {\n        const buttons = document.querySelectorAll(`#loopControls-${this.trackId} .loop-button`);\n        buttons.forEach((btn) => btn.classList.remove('btn-selected'));\n\n        if (track.isLooping && track.loopBeat === beat) {\n            stopLoop(track);\n        } else {\n            button.classList.add('btn-selected');\n            startLoop(track, beat);\n        }\n    }\n\n    // Get the main container for rendering\n    getContainer() {\n        return this.container;\n    }\n\n    // Set the slider value (beat) without activating the loop\n    setValue(beat) {\n        this.selectedBeat = beat;\n        const button = this.loopButtons.find((btn) => btn.dataset.beat === beat);\n        if (button) {\n            this.scrollToButton(button);\n        }\n    }\n}\n\n// Stop the loop for a track\nfunction stopLoop(track) {\n    console.log(\"STOPPING LOOP\", track.id);\n\n    if (track.loopRegion) {\n        track.loopRegion.remove();\n        track.loopRegion = null;\n        track.isLooping = false;\n    }\n\n    if (track.regionOutHandler) {\n        track.regionOutHandler = null;\n    }\n}\n\n// Start the loop for a track\nfunction startLoop(track, beat, previousBeat = null) {\n    console.log(\"LOOPING TRACK\", track.id, beat);\n    // TODO: when updating the updateActiveLoop / startLoop, we should always respect the current loop start position\n    // such that if the loop is extended, it should extend from the current loop start position ( this does not work )\n    // and if the loop is shortened, it should shorten from the current loop start position ( this appears already working? )\n\n    track.isLooping = true;\n    track.loopBeat = Number(beat);\n    const waveform = track.waveform;\n\n    const bpm = track.metadata.bpm || 120;\n    const secondsPerBeat = 60 / bpm;\n    const loopDuration = secondsPerBeat * beat;\n    console.log('Loop Duration:', loopDuration, 'Current BPM:', bpm);\n\n    const currentPosition = waveform.getCurrentTime();\n    let closestBeat = 0;\n\n    const gridSnaps = track.metadata.beatGrid;\n    for (let i = 0; i < gridSnaps.length; i++) {\n        if (gridSnaps[i] <= currentPosition) {\n            closestBeat = gridSnaps[i];\n        } else {\n            break;\n        }\n    }\n\n    if (previousBeat) {\n        closestBeat = previousBeat;\n    }\n\n    console.log('Closest Beat:', closestBeat);\n\n    const loopEnd = closestBeat + loopDuration;\n    const loopStart = closestBeat;\n    track.loopStart = loopStart;\n    track.loopEnd = loopEnd;\n\n    if (track.loopRegion) {\n        track.loopRegion.remove();\n    }\n\n    track.loopRegion = waveform.regions.addRegion({\n        start: loopStart,\n        end: loopEnd,\n        loop: false,\n        drag: false,\n        resize: false,\n        color: 'rgba(0, 123, 255, 0.3)'\n    });\n\n    if (!track.regionOutHandler) {\n        track.regionOutHandler = (region) => {\n            if (region === track.loopRegion && !track.looping) {\n                console.log('Region out - restarting loop');\n                const loopStartTime = track.loopRegion.start;\n                track.looping = true;\n\n                waveform.regions.un('region-out', track.regionOutHandler);\n                track.setTime(loopStartTime);\n\n                setTimeout(() => {\n                    track.looping = false;\n                    waveform.regions.on('region-out', track.regionOutHandler);\n                }, 10);\n            }\n        };\n\n        waveform.regions.on('region-out', track.regionOutHandler);\n    } else {\n        if (currentPosition < loopStart || currentPosition > loopEnd) {\n            track.regionOutHandler(track.loopRegion);\n        }\n    }\n}","export default function createTransportButtons(track) {\n\n    let trackId = track.id;\n\n    let transportUtilButtonsContainer = document.createElement('div');\n    transportUtilButtonsContainer.classList.add('transport-util-buttons-container');\n\n\n    let cloneBtn = createCloneTrackButton(trackId);\n    cloneBtn.classList.add('fancy-button');\n    transportUtilButtonsContainer.appendChild(cloneBtn);\n\n    let partyContainer = document.getElementById('party-container');\n\n    let nextTrackBtn = createNextTrackButton(trackId);\n    nextTrackBtn.classList.add('fancy-button');\n    transportUtilButtonsContainer.appendChild(nextTrackBtn);\n\n    let openSuggestionsBtn = createOpenSuggestionsButton(trackId);\n    openSuggestionsBtn.classList.add('fancy-button');\n    //transportUtilButtonsContainer.appendChild(openSuggestionsBtn);\n\n    let closeBtn = createCloseButton(track);\n    closeBtn.classList.add('fancy-button');\n    transportUtilButtonsContainer.appendChild(closeBtn);\n    return transportUtilButtonsContainer;\n}\n\nfunction createCloseButton(track) {\n    let trackId = track.id;\n    // Close/Stop Track Button\n    const closeBtn = document.createElement('button');\n    closeBtn.innerHTML = '<i class=\"fa-solid fa-right-from-bracket\"></i>'; // Close (X) icon\n    closeBtn.title = 'Unload and close track';\n    closeBtn.classList.add('closeButton');\n    closeBtn.classList.add('btn-active');\n    closeBtn.addEventListener('click', async () => {\n        // closeTrack(trackId);\n        await track.unload();\n    });\n\n    return closeBtn;\n}\n\nfunction createCloneTrackButton(trackId) {\n    // Clone Track Button\n    const cloneBtn = document.createElement('button');\n    cloneBtn.innerHTML = '<i class=\"fa-solid fa-copy\"></i>'; // Copy (clone) icon\n    cloneBtn.title = 'Clone track into a new deck';\n    cloneBtn.classList.add('cloneButton');\n    cloneBtn.classList.add('btn-active');\n    cloneBtn.addEventListener('click', async () => {\n        // cloneTrack(trackId);\n        // load the selected track into a new deck\n        // await transport.loadInitialDecks([file]);\n        // TODO: better api.track.load()\n        //let track = transport.tracks[trackId];\n        //await api.track.load(track.metadata);\n        bp.open('audio-player');\n    });\n\n    return cloneBtn;\n}\n\n\n\nfunction createOpenSuggestionsButton(trackId) {\n    // Open Suggestions Button\n    const openSuggestionsBtn = document.createElement('button');\n    openSuggestionsBtn.innerHTML = '<i class=\"fas fa-music\"></i>'; // Music note icon\n    openSuggestionsBtn.title = 'Open track suggestions';\n    openSuggestionsBtn.classList.add('openSuggestionsButton');\n    openSuggestionsBtn.classList.add('btn-active');\n    openSuggestionsBtn.addEventListener('click', () => {\n        // openSuggestions(trackId);\n        // console.log('openSuggestions', trackId)\n        api.ui.toggleLibrary();\n\n        // give it a moment to load\n        setTimeout(() => {\n            let el = document.getElementById('library-next-tracks-button');\n            if (el) {\n                el.click();\n            }\n\n        }, 222);\n    });\n\n    return openSuggestionsBtn;\n}\n\n\n\n\nfunction createNextTrackButton(trackId) {\n    // TODO: move api.track.suggest() logic to separate file\n    // or api.brain.suggestNextTrack(), etc\n    // Next Track Button\n    const nextTrackBtn = document.createElement('button');\n    //nextTrackBtn.textContent = 'Next Track';\n    nextTrackBtn.innerHTML = '<i class=\"fa-solid fa-record-vinyl\"></i>'; // Vinyl record icon\n    nextTrackBtn.classList.add('nextTrackButton');\n    nextTrackBtn.classList.add('btn-active');\n    nextTrackBtn.title = 'Load next suggested track';\n    nextTrackBtn.addEventListener('click', () => {\n        // nextTrack(trackId);\n        let prevTrack = transport.tracks[trackId];\n        // unload the current track\n        // api.track.unload(trackId);\n\n        // suggest a new track based on previous and load it\n        //let nextTracks = transport.suggestNextTrack(prevTrack);\n        // TODO: implement brain API for track suggestions\n        //console.log('nextTracks', nextTracks)\n        // load the next track\n\n        // get random track from nextTrack array\n        //let randomIndex = Math.floor(Math.random() * nextTracks.length);\n        //api.track.load(nextTracks[randomIndex]);\n\n        // for now load a hard-coded track\n        \n        // console.log('nextTrack', trackId)\n    });\n\n    return nextTrackBtn;\n\n}\n","import SongInfo from \"./transport/SongInfo.js\";\nimport CueControls from \"./transport/CueControls.js\";\nimport PlayPauseCue from \"./transport/PlayPauseCue.js\";\nimport EQ3 from \"./transport/EQ3.js\";\nimport FX from \"./fx/FX.js\";\nimport Filter from \"./transport/Filter.js\";\nimport VolumeSlider from \"./transport/VolumeSlider.js\";\nimport LoopControls from \"./transport/LoopControls.js\";\nimport TempoSlider from \"./transport/TempoSlider.js\";\nimport TransportButtons from \"./transport/TransportButtons.js\";\n\nexport default function createTrackControls(track, trackContainer) {\n    // let container = document.querySelector(`#waveform${trackId.slice(-1)}`);\n    //let trackContainer = document.getElementById(trackId);\n    let trackId = track.id;\n    if (!trackContainer) {\n        // throw new Error(`Track container not found for trackId: ${trackId}. Cannot createWaveform()`);\n        // create a new div for the track\n        trackContainer = document.createElement('div');\n        trackContainer.id = `#track${track.id}`;\n        trackContainer.classList.add('track-container');\n\n        console.log(\"setupTrackControls making new div...\", document.body, trackContainer)\n    }\n\n    track.transport = track.transport || {};\n\n    // Track controls that appear left and right of the waveforms\n    let rightTrackControls = document.getElementById(`#rightTrackControls-${trackId}`);\n    let topTrackControls = document.getElementById(`#topTrackControls-${trackId}`);\n\n    if (!topTrackControls) {\n        topTrackControls = document.createElement('div');\n        topTrackControls.id = `topTrackControls-${trackId}`;\n        topTrackControls.className = \"track-controls\";\n        topTrackControls.classList.add('top-controls');\n        trackContainer.appendChild(topTrackControls);\n        track.transport.topTrackControls = topTrackControls;\n    }\n \n    if (!rightTrackControls) {\n        rightTrackControls = document.createElement('div');\n        rightTrackControls.id = `rightTrackControls-${trackId}`;\n        rightTrackControls.className = \"track-controls\";\n        rightTrackControls.classList.add('right-controls');\n        trackContainer.appendChild(rightTrackControls);\n        track.transport.rightTrackControls = rightTrackControls;\n    }\n\n    if (trackContainer == null) {\n        trackContainer = document.createElement('div');\n        trackContainer.id = `#waveform${trackId}`;\n        console.log(\"setupTrackControls making new div...\", document.body, trackContainer)\n        document.body.appendChild(trackContainer);\n    }\n\n    track.transport = track.transport || {};\n    SongInfo(track, track.transport.topTrackControls)\n\n    let leftControls = document.createElement('div');\n    leftControls.className = 'left-controls';\n    rightTrackControls.appendChild(leftControls);\n\n    let eq3 = EQ3(track);\n    leftControls.appendChild(eq3);\n\n    let filter = Filter(track);\n    leftControls.appendChild(filter);\n\n    //let fx = FX(track);\n    //leftControls.appendChild(fx);\n\n    let rightControls = document.createElement('div');\n    rightControls.className = 'right-controls';\n    rightTrackControls.appendChild(rightControls);\n\n    let tempoSlider = TempoSlider(track);\n    leftControls.appendChild(tempoSlider);\n\n    let deckLabel = document.createElement('div');\n    deckLabel.classList.add('deck-label');\n\n    deckLabel.textContent = track.currentDeck || 'A';\n    rightControls.appendChild(deckLabel);\n\n    let loopControls = LoopControls(track, 'loopControlsA');\n    rightControls.appendChild(loopControls);\n\n    let playPauseCueButtons = PlayPauseCue(track);\n    rightControls.appendChild(playPauseCueButtons);\n\n    let volumeSlider = VolumeSlider(track);\n    rightTrackControls.appendChild(volumeSlider);\n\n    let transportButtons = TransportButtons(track);\n    trackContainer.appendChild(transportButtons);\n\n    let bottomRow = document.createElement('div');\n    bottomRow.className = 'bottom-row';\n    trackContainer.appendChild(bottomRow);\n\n    let cueControlsContainer = CueControls(track);\n    bottomRow.appendChild(cueControlsContainer);\n    return trackContainer;\n\n}","import sliderComponent from '../../../../ui/Slider.js';\nimport EQ3 from '../../../nodes/EQ3.js'\n// remove eqContainer and bands data\n// replace all hard coded values with config values\n// TODO: provide the new example code for generating the EQ3 knobs with eqContainer and bands data and config\n// from a parent function\nexport default function createEQ3(track, trackId, config = {}) {\n    // Container for EQ sliders\n    const eqContainer = document.createElement('div');\n    eqContainer.classList.add('eq-container');\n\n    track.transport.eq3Container = eqContainer;\n    // Create knobs for high, mid, and low EQ\n    const bands = [\n        { name: 'Hi', type: 'highshelf', defaultValue: 0, fgColor: '#FF5733' },\n        { name: 'Mid', type: 'peaking', defaultValue: 0, fgColor: '#33FF57' },\n        { name: 'Lo', type: 'lowshelf', defaultValue: 0, fgColor: '#3357FF' },\n    ];\n\n    let sliderHi = new sliderComponent(track, trackId, {\n        className: 'eq-slider-hi',\n        thumbWidth: '32px',\n        thumbHeight: '32px',\n        trackHeight: '150px',\n        trackWidth: '32px',\n        thumbColor: '#00c0e3',\n        minValue: -15,\n        maxValue: 15,\n        onChange: function(value, val) {\n            EQ3(track, 'highshelf', val);\n        }\n    });\n\n    let sliderMid = new sliderComponent(track, trackId, {\n        className: 'eq-slider-mid',\n        thumbWidth: '32px',\n        thumbHeight: '32px',\n        trackHeight: '150px',\n        trackWidth: '32px',\n        thumbColor: '#00c0e3',\n        minValue: -15,\n        maxValue: 15,\n        onChange: function(value, val) {\n           EQ3(track, 'peaking', val);\n        }\n    });\n\n    let sliderLo = new sliderComponent(track, trackId, {\n        className: 'eq-slider-lo',\n        thumbWidth: '32px',\n        thumbHeight: '32px',\n        trackHeight: '150px',\n        trackWidth: '32px',\n        thumbColor: '#00c0e3',\n        minValue: -15,\n        maxValue: 15,\n        onChange: function(value, val) {\n            EQ3(track, 'lowshelf', val);\n        }\n    });\n\n    let eqSliderContainer = document.createElement('div');\n    eqSliderContainer.style.display = 'flex';\n    eqSliderContainer.style.justifyContent = 'center';\n    eqSliderContainer.style.alignItems = 'center';\n    eqSliderContainer.style.gap = '20px';\n    eqSliderContainer.style.position = 'relative';\n\n    eqSliderContainer.appendChild(sliderHi.sliderContainer);\n    eqSliderContainer.appendChild(sliderMid.sliderContainer);\n    eqSliderContainer.appendChild(sliderLo.sliderContainer);\n\n    eqContainer.appendChild(eqSliderContainer)\n\n\n    bands.forEach((band, i) => {\n        return;\n        // Create a div wrapper for each knob\n        const knobWrapper = document.createElement('div');\n        knobWrapper.style.textAlign = 'center';\n\n        knobWrapper.style.cursor = 'pointer';\n        // Create a canvas element for the knob\n        const knobInput = document.createElement('input');\n        knobInput.type = 'text';\n        knobInput.value = band.defaultValue; // Start at center\n        knobInput.setAttribute('data-fgColor', '#09ccf1');\n        knobInput.setAttribute('data-bgColor', '#818180');\n        knobInput.setAttribute('data-width', '72'); // Larger for better control\n        knobInput.setAttribute('data-height', '72');\n        knobInput.setAttribute('data-angleOffset', '-125'); // Start angle\n        knobInput.setAttribute('data-angleArc', '250'); // Full arc for EQ knobs\n        knobInput.setAttribute('data-min', '-12'); // Minimum EQ value\n        knobInput.setAttribute('data-max', '12'); // Maximum EQ value\n        knobInput.setAttribute('data-step', '0.1'); // Step for smooth control\n        knobInput.setAttribute('data-displayInput', 'false'); // Hide numeric display\n        // set  data-thickness=\".1\"\n        knobInput.setAttribute('data-thickness', '.5');\n\n        knobInput.classList.add(`${band.name.toLowerCase()}-eq-knob`);\n\n        // Create the +/- buttons\n        const decrementButton = document.createElement('button');\n        decrementButton.textContent = '-';\n        decrementButton.style.position = 'relative';\n        decrementButton.style.top = `${(60 * i) + 60}px`;\n        decrementButton.style.left = '0px';\n        // decrementButton.style.transform = 'translateX(-50%)';\n        decrementButton.style.fontSize = '12px';\n        decrementButton.style.color = '#fff';\n        decrementButton.style.background = 'transparent';\n        decrementButton.style.border = 'none';\n        decrementButton.style.cursor = 'pointer';\n        decrementButton.style.display = 'none'; // Hidden by default\n        decrementButton.style.margin = '0px';\n        decrementButton.style.padding = '0px';\n        // flaot right\n        decrementButton.style.float = 'left';\n\n\n        const incrementButton = document.createElement('button');\n        incrementButton.textContent = '+';\n        incrementButton.style.position = 'relative';\n        incrementButton.style.top = `60px`;\n        incrementButton.style.left = '40px';\n        // incrementButton.style.transform = 'translateX(-50%)';\n        incrementButton.style.fontSize = '12px';\n        incrementButton.style.color = '#fff';\n        incrementButton.style.background = 'transparent';\n        incrementButton.style.border = 'none';\n        incrementButton.style.cursor = 'pointer';\n        incrementButton.style.display = 'none'; // Hidden by default\n        incrementButton.style.margin = '0px';\n        incrementButton.style.padding = '0px';\n        // float\n        incrementButton.style.float = 'left';\n\n        // Increment and decrement functionality\n        decrementButton.addEventListener('click', () => {\n            let currentValue = parseFloat(knobInput.value);\n            if (currentValue > -12) {\n                currentValue -= 1;\n                $(knobInput).val(currentValue).trigger('change');\n                api.track.applyEQ3(trackId, band.type, currentValue);\n            }\n        });\n\n        incrementButton.addEventListener('click', () => {\n            let currentValue = parseFloat(knobInput.value);\n            if (currentValue < 12) {\n                currentValue += 1;\n                $(knobInput).val(currentValue).trigger('change');\n                api.track.applyEQ3(trackId, band.type, currentValue);\n            }\n        });\n\n        // Show/hide +/- buttons on hover\n        knobWrapper.addEventListener('mouseover', () => {\n            decrementButton.style.display = 'block';\n            incrementButton.style.display = 'block';\n        });\n\n        knobWrapper.addEventListener('mouseout', () => {\n            //decrementButton.style.display = 'none';\n            //incrementButton.style.display = 'none';\n        });\n\n        console.log('knobInput', knobInput)\n        // Initialize the jQuery.knob plugin\n\n        // Create a label for the knob\n        const label = document.createElement('div');\n        label.textContent = band.name;\n        label.style.marginTop = '0px';\n        label.style.color = '#fff';\n        label.style.position = 'relative';\n        label.style.bottom = '0px';\n        label.style.right = '13px';\n        label.style.fontSize = '12px';\n        label.style.zIndex = '-1';\n\n        // Create the bypass button\n        const bypassButton = document.createElement('button');\n        bypassButton.textContent = '';\n        bypassButton.title = `Bypass ${band.name}`;\n        bypassButton.style.width = '14px';\n        bypassButton.style.height = '14px';\n        bypassButton.style.borderRadius = '50%';\n        bypassButton.style.border = '2px solid #000';\n        bypassButton.style.backgroundColor = '#818180';\n        bypassButton.style.marginRight = '10px';\n        bypassButton.style.cursor = 'pointer';\n        bypassButton.style.boxSizing = 'border-box'; // Ensure border is included in width and height\n        bypassButton.style.display = 'inline-block'; // Ensure the button respects its width and height\n\n        bypassButton.classList.add(`${band.name.toLowerCase()}-bypass-button`);\n\n        // Add toggle functionality to the bypass button\n        let isBypassed = false;\n        bypassButton.addEventListener('click', () => {\n            isBypassed = !isBypassed;\n            bypassButton.style.backgroundColor = isBypassed ? '#09ccf1' : '#333';\n            console.log(`${band.name} EQ Bypass: ${isBypassed}`);\n            // TODO: implement bypass functionality\n            api.track.bypassEQ3(trackId, band.type, isBypassed); // Trigger bypass API\n        });\n\n\n        // Handle mouseover and mouseout for dynamic label updates\n        knobWrapper.addEventListener('mouseover', () => {\n            const currentValue = parseFloat(knobInput.value) || 0;\n            const percentage = ((currentValue / 12) * 100).toFixed(0);\n            label.textContent = `${percentage}%`; // Show percentage on hover\n        });\n\n        knobWrapper.addEventListener('mouseout', () => {\n            label.textContent = band.name; // Revert to band name on mouseout\n        });\n\n        // Append the knob and label to the wrapper\n        //knobWrapper.appendChild(decrementButton);\n        //knobWrapper.appendChild(incrementButton);\n        knobWrapper.appendChild(knobInput);\n        knobWrapper.appendChild(bypassButton);\n        knobWrapper.appendChild(label);\n\n\n        // Add the wrapper to the container\n        eqContainer.appendChild(knobWrapper);\n\n        setTimeout(function () {\n\n            $(knobInput).knob({\n                release: (value) => {\n                    console.log(`${band.name} EQ`, value);\n                },\n                change: (value) => {\n                    console.log(`${band.name} EQ changing`, value);\n                    api.track.applyEQ3(trackId, band.type, Number(value));\n                    // Update label with real-time percentage\n                    const percentage = ((value / 12) * 100).toFixed(0); // Map value to percentage (-100% to 100%)\n                    label.textContent = `${percentage}%`;\n                },\n                // double click to reset\n                dblclick: (value) => {\n                    console.log(`${band.name} EQ reset to ${band.defaultValue}`);\n                    $(knobInput).val(band.defaultValue).trigger('change'); // Reset value\n                    api.track.applyEQ3(trackId, band.type, band.defaultValue); // Apply reset\n                }\n            });\n\n            // Event listener to reset the knob on double-click\n            $(knobInput).on('dblclick', () => {\n                console.log(\"dblclick KNob\");\n                $(knobInput).val(band.defaultValue).trigger('change'); // Reset value\n                api.track.applyEQ3(trackId, band.type, band.defaultValue); // Apply reset\n                console.log(`${band.name} EQ reset to ${band.defaultValue}`);\n            });\n\n\n\n        }, 0);\n        console.log('knobInput', knobInput)\n\n    });\n\n    return eqContainer;\n}\n","import Slider from '../../../../ui/Slider.js';\n\nexport default function TempoSlider (track) {\n    let trackId = track.id;\n    // Create the tempoSlider\n    let tempoSlider = Slider(track, trackId, {\n        // value: 120,\n        trackHeight: '150px',\n        trackWidth: '60px',\n        defaultValue: 0,\n        sliderThumbStyles: { // not sure why override is needed for this one, was misaligned?\n            left: '6px',     // could be due to custom width ( wider bar, thumb didn't adjust? )\n        },\n        value: 0,\n        minValue: -1,\n        maxValue: 1,\n        step: 0.001, // rounding / precision issue here, we need finer tuned bpm control\n        showCenterLine: true,\n        showScale: true,\n        showLabel: false,\n        formatLabel: (value) => {\n            // invert value\n            value = 1 - value;\n            return value;\n        },\n        className: 'tempo-slider',\n\n        onDoubleClick: (value) => {\n            // console.log('onDoubleClick', value);\n            track.setBPM(track.metadata.bpm, true);\n        },\n\n        onChange: function (value) {\n\n            // let track = transport.tracks[trackId];\n\n            // if value is 0, return to original bpm\n            if (value === 0) {\n                track.setBPM(track.metadata.bpm, false);\n                return;\n            }\n\n            // invert the value for tempo slider\n            value = 1 - value;\n\n            let bpmRangeStart = 60;\n            let bpmRangeEnd = 180;\n            let bpmRange = bpmRangeEnd - bpmRangeStart;\n\n            // Calculate the BPM based on the slider value\n            let bpm = bpmRangeStart + (bpmRange * value);\n\n\n            // console.log(\"THIS\", this, this.getValue())\n            /*\n            if (track.isSync) {\n                console.log('Cannot change tempo while track is sync');\n                ev.preventDefault();\n                tempoSlider.value = track.currentBPM;\n                return false;\n            }\n                */\n\n            //console.log('tempoSlider', tempoSlider, Number(tempoSlider.value), tempoSlider.minValue);\n\n            // TODO: The slider needs to work in reverse, moving up should decrease the BPM\n            // Moving down should increase the BPM\n            // const reversedValue = this.maxValue - (bpm - this.minValue);\n            //const reverseBPM = this.maxValue - ()\n            //console.log('setting reversedValue', reversedValue)\n            // api.track.setBPM(trackId, Number(tempoSlider.value));\n            // console.log(\"SETTING VALUES\", reversedValue, bpm, this.minValue, this.maxValue);\n            track.setBPM(bpm, false);\n\n        }\n    });\n    track.transport.tempoSlider = tempoSlider;\n    console.log(\"returning tempoSlider\", tempoSlider);\n    return tempoSlider.sliderContainer;\n\n}\n\n","export default function PlayPauseCue(track, className = 'playPauseCueButtonsA') {\n    let trackId = track.id;\n    // Container for buttons\n    const container = document.createElement('div');\n    container.classList.add(className);\n\n    // Cue Button\n    const cueButton = document.createElement('button');\n    cueButton.classList.add('cueButton');\n    cueButton.classList.add('btn-active');\n    cueButton.title = 'Cue';\n    cueButton.innerHTML = 'CUE';\n\n    let isDragging = false;\n\n\n    // let previousCueTime = 0;\n    // Cue Button Events\n    cueButton.addEventListener('mousedown', (ev) => {\n    // get current time\n        //let { t } = api.resolveTrack(trackId)\n        //api.transport.cue(trackId, ev.target)\n        cueButton.style.backgroundColor = '#666'; // Highlight on press\n        isDragging = false; // Reset dragging state\n    });\n\n    cueButton.addEventListener('mouseup', (ev) => {\n        if (!isDragging) {\n            //let { t } = api.resolveTrack(trackId)\n            //api.track.pause(trackId, playPauseButton); // Stop track if not dragging\n            //api.track.setTime(t.id, t.transport.previousCueTime);\n        }\n        cueButton.style.backgroundColor = '#444'; // Reset background\n        cueButton.classList.remove('btn-selected');\n        //cueButton.classList.add('btn-inactive');\n    });\n\n    cueButton.addEventListener('mouseleave', (ev) => {\n        /* cueButton.style.backgroundColor = '#444'; // Reset background */\n    });\n\n    cueButton.addEventListener('mousemove', (ev) => {\n        if (ev.buttons === 1) {\n            isDragging = true; // Mark as dragging if mouse is moved with the button held\n        }\n\n    });\n\n    // Play/Pause Button\n    const playPauseButton = document.createElement('button');\n    playPauseButton.classList.add('playButton');\n    playPauseButton.classList.add('btn-active');\n    playPauseButton.title = 'Play/Pause';\n    playPauseButton.innerHTML = '<i class=\"fa-duotone fa-solid fa-play\"></i> <i class=\"fa-duotone fa-solid fa-solid fa-pause\"></i>';\n\n    // Play/Pause Button Event\n    playPauseButton.addEventListener('click', (ev) => {\n        // previousCueTime = null;\n        // api.stopAutoDJ();\n        // api.track.playPause(trackId, playPauseButton);\n        console.log('Play/Pause button clicked', track);\n        track.playPause();\n    });\n\n\n    // Add drag-and-hold behavior\n    cueButton.addEventListener('mousemove', (ev) => {\n        const rect = playPauseButton.getBoundingClientRect();\n        if (\n            ev.clientX >= rect.left &&\n            ev.clientX <= rect.right &&\n            ev.clientY >= rect.top &&\n            ev.clientY <= rect.bottom\n        ) {\n            // api.track.play(trackId, playPauseButton); // Start playing the track\n            isDragging = true; // Set dragging state\n        }\n    });\n\n    track.transport.playPauseButton = playPauseButton;\n    \n\n    // Add buttons to container\n    container.appendChild(cueButton);\n    container.appendChild(playPauseButton);\n\n    return container;\n}\n","import sliderComponent from '../../../../ui/Slider.js';\n\nexport default function createVolumeSlider (track) {\n\n    let trackId = track.id;\n\n    let container = document.createElement('div');\n    container.classList.add('volume-slider-container');\n\n    let volumeSliderIcon = document.createElement('i');\n    volumeSliderIcon.classList.add('fa-solid', 'fa-headphones-simple');\n    volumeSliderIcon.classList.add('volumeSliderIcon', 'headphones');\n    //volumeSliderIcon.classList.add('fancy-button');\n    volumeSliderIcon.style.fontSize = '24px';\n    volumeSliderIcon.style.marginRight = '10px';\n    \n    volumeSliderIcon.title = \"Mute / Unmute track\";\n    // click handler\n    volumeSliderIcon.addEventListener('click', () => {\n        // console.log('Mute / Unmute track');\n        console.log('track', track);\n        track.toggleMute();\n    \n        // toggle the icon btn-active / btn-inactive\n        if (volumeSliderIcon.classList.contains('headphones-inactive')) {\n            //volumeSliderIcon.classList.add('btn-active');\n            volumeSliderIcon.classList.remove('headphones-inactive');\n        } else {\n            //volumeSliderIcon.classList.remove('btn-inactive');\n            volumeSliderIcon.classList.add('headphones-inactive');\n        }\n    \n    });\n    \n    track.transport.volumeSliderIcon = volumeSliderIcon;\n    \n    container.append(volumeSliderIcon);\n    \n    let volumeSlider = sliderComponent(track, trackId, {\n        minValue: 0,\n        maxValue: 1, // TODO: could be higher...needs better gain logic linear gain is not ideal after 1\n        value: 1,\n        trackWidth: '20px',\n        trackHeight: '260px',\n        thumbHeight: '48px',\n        thumbWidth: '26px',\n        sliderThumbStyles: {\n            left: '0px',\n        },\n    \n        showLabel: false,\n        className: 'volume-slider',\n        onClick: function (value) {\n            // api.stopAutoDJ();\n        },\n        onChange: function (value) {\n            // console.log(\"CHANGED VAL\", value, this)\n            track.setVolume(value);\n        }\n    });\n    track.transport.volumeSlider = volumeSlider;\n    \n    container.append(volumeSlider.sliderContainer);\n    //return volumeSlider.sliderContainer\n\n    return container;\n}","/** A simple event emitter that can be used to listen to and emit events. */\nclass EventEmitter {\n    constructor() {\n        this.listeners = {};\n    }\n    /** Subscribe to an event. Returns an unsubscribe function. */\n    on(event, listener, options) {\n        if (!this.listeners[event]) {\n            this.listeners[event] = new Set();\n        }\n        this.listeners[event].add(listener);\n        if (options === null || options === void 0 ? void 0 : options.once) {\n            const unsubscribeOnce = () => {\n                this.un(event, unsubscribeOnce);\n                this.un(event, listener);\n            };\n            this.on(event, unsubscribeOnce);\n            return unsubscribeOnce;\n        }\n        return () => this.un(event, listener);\n    }\n    /** Unsubscribe from an event */\n    un(event, listener) {\n        var _a;\n        (_a = this.listeners[event]) === null || _a === void 0 ? void 0 : _a.delete(listener);\n    }\n    /** Subscribe to an event only once */\n    once(event, listener) {\n        return this.on(event, listener, { once: true });\n    }\n    /** Clear all events */\n    unAll() {\n        this.listeners = {};\n    }\n    /** Emit an event */\n    emit(eventName, ...args) {\n        if (this.listeners[eventName]) {\n            this.listeners[eventName].forEach((listener) => listener(...args));\n        }\n    }\n}\nexport default EventEmitter;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/** Decode an array buffer into an audio buffer */\nfunction decode(audioData, sampleRate) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const audioCtx = new AudioContext({ sampleRate });\n        const decode = audioCtx.decodeAudioData(audioData);\n        return decode.finally(() => audioCtx.close());\n    });\n}\n/** Normalize peaks to -1..1 */\nfunction normalize(channelData) {\n    const firstChannel = channelData[0];\n    if (firstChannel.some((n) => n > 1 || n < -1)) {\n        const length = firstChannel.length;\n        let max = 0;\n        for (let i = 0; i < length; i++) {\n            const absN = Math.abs(firstChannel[i]);\n            if (absN > max)\n                max = absN;\n        }\n        for (const channel of channelData) {\n            for (let i = 0; i < length; i++) {\n                channel[i] /= max;\n            }\n        }\n    }\n    return channelData;\n}\n/** Create an audio buffer from pre-decoded audio data */\nfunction createBuffer(channelData, duration) {\n    // If a single array of numbers is passed, make it an array of arrays\n    if (typeof channelData[0] === 'number')\n        channelData = [channelData];\n    // Normalize to -1..1\n    normalize(channelData);\n    return {\n        duration,\n        length: channelData[0].length,\n        sampleRate: channelData[0].length / duration,\n        numberOfChannels: channelData.length,\n        getChannelData: (i) => channelData === null || channelData === void 0 ? void 0 : channelData[i],\n        copyFromChannel: AudioBuffer.prototype.copyFromChannel,\n        copyToChannel: AudioBuffer.prototype.copyToChannel,\n    };\n}\nconst Decoder = {\n    decode,\n    createBuffer,\n};\nexport default Decoder;\n","function renderNode(tagName, content) {\n    const element = content.xmlns\n        ? document.createElementNS(content.xmlns, tagName)\n        : document.createElement(tagName);\n    for (const [key, value] of Object.entries(content)) {\n        if (key === 'children') {\n            for (const [key, value] of Object.entries(content)) {\n                if (typeof value === 'string') {\n                    element.appendChild(document.createTextNode(value));\n                }\n                else {\n                    element.appendChild(renderNode(key, value));\n                }\n            }\n        }\n        else if (key === 'style') {\n            Object.assign(element.style, value);\n        }\n        else if (key === 'textContent') {\n            element.textContent = value;\n        }\n        else {\n            element.setAttribute(key, value.toString());\n        }\n    }\n    return element;\n}\nexport function createElement(tagName, content, container) {\n    const el = renderNode(tagName, content || {});\n    container === null || container === void 0 ? void 0 : container.appendChild(el);\n    return el;\n}\nexport default createElement;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nfunction watchProgress(response, progressCallback) {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (!response.body || !response.headers)\n            return;\n        const reader = response.body.getReader();\n        const contentLength = Number(response.headers.get('Content-Length')) || 0;\n        let receivedLength = 0;\n        // Process the data\n        const processChunk = (value) => __awaiter(this, void 0, void 0, function* () {\n            // Add to the received length\n            receivedLength += (value === null || value === void 0 ? void 0 : value.length) || 0;\n            const percentage = Math.round((receivedLength / contentLength) * 100);\n            progressCallback(percentage);\n        });\n        const read = () => __awaiter(this, void 0, void 0, function* () {\n            let data;\n            try {\n                data = yield reader.read();\n            }\n            catch (_a) {\n                // Ignore errors because we can only handle the main response\n                return;\n            }\n            // Continue reading data until done\n            if (!data.done) {\n                processChunk(data.value);\n                yield read();\n            }\n        });\n        read();\n    });\n}\nfunction fetchBlob(url, progressCallback, requestInit) {\n    return __awaiter(this, void 0, void 0, function* () {\n        // Fetch the resource\n        const response = yield fetch(url, requestInit);\n        if (response.status >= 400) {\n            throw new Error(`Failed to fetch ${url}: ${response.status} (${response.statusText})`);\n        }\n        // Read the data to track progress\n        watchProgress(response.clone(), progressCallback);\n        return response.blob();\n    });\n}\nconst Fetcher = {\n    fetchBlob,\n};\nexport default Fetcher;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport EventEmitter from './event-emitter.js';\nclass Player extends EventEmitter {\n    constructor(options) {\n        super();\n        this.isExternalMedia = false;\n        if (options.media) {\n            this.media = options.media;\n            this.isExternalMedia = true;\n        }\n        else {\n            this.media = document.createElement('audio');\n        }\n        // Controls\n        if (options.mediaControls) {\n            this.media.controls = true;\n        }\n        // Autoplay\n        if (options.autoplay) {\n            this.media.autoplay = true;\n        }\n        // Speed\n        if (options.playbackRate != null) {\n            this.onMediaEvent('canplay', () => {\n                if (options.playbackRate != null) {\n                    this.media.playbackRate = options.playbackRate;\n                }\n            }, { once: true });\n        }\n    }\n    onMediaEvent(event, callback, options) {\n        this.media.addEventListener(event, callback, options);\n        return () => this.media.removeEventListener(event, callback, options);\n    }\n    getSrc() {\n        return this.media.currentSrc || this.media.src || '';\n    }\n    revokeSrc() {\n        const src = this.getSrc();\n        if (src.startsWith('blob:')) {\n            URL.revokeObjectURL(src);\n        }\n    }\n    canPlayType(type) {\n        return this.media.canPlayType(type) !== '';\n    }\n    setSrc(url, blob) {\n        const src = this.getSrc();\n        if (url && src === url)\n            return;\n        this.revokeSrc();\n        const newSrc = blob instanceof Blob && (this.canPlayType(blob.type) || !url) ? URL.createObjectURL(blob) : url;\n        try {\n            this.media.src = newSrc;\n        }\n        catch (e) {\n            this.media.src = url;\n        }\n    }\n    destroy() {\n        this.media.pause();\n        if (this.isExternalMedia)\n            return;\n        this.media.remove();\n        this.revokeSrc();\n        this.media.src = '';\n        // Load resets the media element to its initial state\n        this.media.load();\n    }\n    setMediaElement(element) {\n        this.media = element;\n    }\n    /** Start playing the audio */\n    play() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.media.play();\n        });\n    }\n    /** Pause the audio */\n    pause() {\n        this.media.pause();\n    }\n    /** Check if the audio is playing */\n    isPlaying() {\n        return !this.media.paused && !this.media.ended;\n    }\n    /** Jump to a specific time in the audio (in seconds) */\n    setTime(time) {\n        this.media.currentTime = time;\n    }\n    /** Get the duration of the audio in seconds */\n    getDuration() {\n        return this.media.duration;\n    }\n    /** Get the current audio position in seconds */\n    getCurrentTime() {\n        return this.media.currentTime;\n    }\n    /** Get the audio volume */\n    getVolume() {\n        return this.media.volume;\n    }\n    /** Set the audio volume */\n    setVolume(volume) {\n        this.media.volume = volume;\n    }\n    /** Get the audio muted state */\n    getMuted() {\n        return this.media.muted;\n    }\n    /** Mute or unmute the audio */\n    setMuted(muted) {\n        this.media.muted = muted;\n    }\n    /** Get the playback speed */\n    getPlaybackRate() {\n        return this.media.playbackRate;\n    }\n    /** Check if the audio is seeking */\n    isSeeking() {\n        return this.media.seeking;\n    }\n    /** Set the playback speed, pass an optional false to NOT preserve the pitch */\n    setPlaybackRate(rate, preservePitch) {\n        // preservePitch is true by default in most browsers\n        if (preservePitch != null) {\n            this.media.preservesPitch = preservePitch;\n        }\n        this.media.playbackRate = rate;\n    }\n    /** Get the HTML media element */\n    getMediaElement() {\n        return this.media;\n    }\n    /** Set a sink id to change the audio output device */\n    setSinkId(sinkId) {\n        // See https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/setSinkId\n        const media = this.media;\n        return media.setSinkId(sinkId);\n    }\n}\nexport default Player;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { makeDraggable } from './draggable.js';\nimport EventEmitter from './event-emitter.js';\nclass Renderer extends EventEmitter {\n    constructor(options, audioElement) {\n        super();\n        this.timeouts = [];\n        this.isScrollable = false;\n        this.audioData = null;\n        this.resizeObserver = null;\n        this.lastContainerWidth = 0;\n        this.isDragging = false;\n        this.subscriptions = [];\n        this.subscriptions = [];\n        this.options = options;\n        const parent = this.parentFromOptionsContainer(options.container);\n        this.parent = parent;\n        const [div, shadow] = this.initHtml();\n        parent.appendChild(div);\n        this.container = div;\n        this.scrollContainer = shadow.querySelector('.scroll');\n        this.wrapper = shadow.querySelector('.wrapper');\n        this.canvasWrapper = shadow.querySelector('.canvases');\n        this.progressWrapper = shadow.querySelector('.progress');\n        this.cursor = shadow.querySelector('.cursor');\n        if (audioElement) {\n            shadow.appendChild(audioElement);\n        }\n        this.initEvents();\n    }\n    parentFromOptionsContainer(container) {\n        let parent;\n        if (typeof container === 'string') {\n            parent = document.querySelector(container);\n        }\n        else if (container instanceof HTMLElement) {\n            parent = container;\n        }\n        if (!parent) {\n            throw new Error('Container not found');\n        }\n        return parent;\n    }\n    initEvents() {\n        const getClickPosition = (e) => {\n            const rect = this.wrapper.getBoundingClientRect();\n            const x = e.clientX - rect.left;\n            const y = e.clientY - rect.top;\n            const relativeX = x / rect.width;\n            const relativeY = y / rect.height;\n            return [relativeX, relativeY];\n        };\n        // Add a click listener\n        this.wrapper.addEventListener('click', (e) => {\n            const [x, y] = getClickPosition(e);\n            this.emit('click', x, y);\n        });\n        // Add a double click listener\n        this.wrapper.addEventListener('dblclick', (e) => {\n            const [x, y] = getClickPosition(e);\n            this.emit('dblclick', x, y);\n        });\n        // Drag\n        if (this.options.dragToSeek === true || typeof this.options.dragToSeek === 'object') {\n            this.initDrag();\n        }\n        // Add a scroll listener\n        this.scrollContainer.addEventListener('scroll', () => {\n            const { scrollLeft, scrollWidth, clientWidth } = this.scrollContainer;\n            const startX = scrollLeft / scrollWidth;\n            const endX = (scrollLeft + clientWidth) / scrollWidth;\n            this.emit('scroll', startX, endX, scrollLeft, scrollLeft + clientWidth);\n        });\n        // Re-render the waveform on container resize\n        if (typeof ResizeObserver === 'function') {\n            const delay = this.createDelay(100);\n            this.resizeObserver = new ResizeObserver(() => {\n                delay()\n                    .then(() => this.onContainerResize())\n                    .catch(() => undefined);\n            });\n            this.resizeObserver.observe(this.scrollContainer);\n        }\n    }\n    onContainerResize() {\n        const width = this.parent.clientWidth;\n        if (width === this.lastContainerWidth && this.options.height !== 'auto')\n            return;\n        this.lastContainerWidth = width;\n        this.reRender();\n    }\n    initDrag() {\n        this.subscriptions.push(makeDraggable(this.wrapper, \n        // On drag\n        (_, __, x) => {\n            this.emit('drag', Math.max(0, Math.min(1, x / this.wrapper.getBoundingClientRect().width)));\n        }, \n        // On start drag\n        (x) => {\n            this.isDragging = true;\n            this.emit('dragstart', Math.max(0, Math.min(1, x / this.wrapper.getBoundingClientRect().width)));\n        }, \n        // On end drag\n        (x) => {\n            this.isDragging = false;\n            this.emit('dragend', Math.max(0, Math.min(1, x / this.wrapper.getBoundingClientRect().width)));\n        }));\n    }\n    getHeight(optionsHeight, optionsSplitChannel) {\n        var _a;\n        const defaultHeight = 128;\n        const numberOfChannels = ((_a = this.audioData) === null || _a === void 0 ? void 0 : _a.numberOfChannels) || 1;\n        if (optionsHeight == null)\n            return defaultHeight;\n        if (!isNaN(Number(optionsHeight)))\n            return Number(optionsHeight);\n        if (optionsHeight === 'auto') {\n            const height = this.parent.clientHeight || defaultHeight;\n            if (optionsSplitChannel === null || optionsSplitChannel === void 0 ? void 0 : optionsSplitChannel.every((channel) => !channel.overlay))\n                return height / numberOfChannels;\n            return height;\n        }\n        return defaultHeight;\n    }\n    initHtml() {\n        const div = document.createElement('div');\n        const shadow = div.attachShadow({ mode: 'open' });\n        shadow.innerHTML = `\n      <style>\n        :host {\n          user-select: none;\n          min-width: 1px;\n        }\n        :host audio {\n          display: block;\n          width: 100%;\n        }\n        :host .scroll {\n          overflow-x: auto;\n          overflow-y: hidden;\n          width: 100%;\n          position: relative;\n        }\n        :host .noScrollbar {\n          scrollbar-color: transparent;\n          scrollbar-width: none;\n        }\n        :host .noScrollbar::-webkit-scrollbar {\n          display: none;\n          -webkit-appearance: none;\n        }\n        :host .wrapper {\n          position: relative;\n          overflow: visible;\n          z-index: 2;\n        }\n        :host .canvases {\n          min-height: ${this.getHeight(this.options.height, this.options.splitChannels)}px;\n        }\n        :host .canvases > div {\n          position: relative;\n        }\n        :host canvas {\n          display: block;\n          position: absolute;\n          top: 0;\n          image-rendering: pixelated;\n        }\n        :host .progress {\n          pointer-events: none;\n          position: absolute;\n          z-index: 2;\n          top: 0;\n          left: 0;\n          width: 0;\n          height: 100%;\n          overflow: hidden;\n        }\n        :host .progress > div {\n          position: relative;\n        }\n        :host .cursor {\n          pointer-events: none;\n          position: absolute;\n          z-index: 5;\n          top: 0;\n          left: 0;\n          height: 100%;\n          border-radius: 2px;\n        }\n      </style>\n\n      <div class=\"scroll\" part=\"scroll\">\n        <div class=\"wrapper\" part=\"wrapper\">\n          <div class=\"canvases\" part=\"canvases\"></div>\n          <div class=\"progress\" part=\"progress\"></div>\n          <div class=\"cursor\" part=\"cursor\"></div>\n        </div>\n      </div>\n    `;\n        return [div, shadow];\n    }\n    /** Wavesurfer itself calls this method. Do not call it manually. */\n    setOptions(options) {\n        if (this.options.container !== options.container) {\n            const newParent = this.parentFromOptionsContainer(options.container);\n            newParent.appendChild(this.container);\n            this.parent = newParent;\n        }\n        if (options.dragToSeek === true || typeof this.options.dragToSeek === 'object') {\n            this.initDrag();\n        }\n        this.options = options;\n        // Re-render the waveform\n        this.reRender();\n    }\n    getWrapper() {\n        return this.wrapper;\n    }\n    getWidth() {\n        return this.scrollContainer.clientWidth;\n    }\n    getScroll() {\n        return this.scrollContainer.scrollLeft;\n    }\n    setScroll(pixels) {\n        this.scrollContainer.scrollLeft = pixels;\n    }\n    setScrollPercentage(percent) {\n        const { scrollWidth } = this.scrollContainer;\n        const scrollStart = scrollWidth * percent;\n        this.setScroll(scrollStart);\n    }\n    destroy() {\n        var _a, _b;\n        this.subscriptions.forEach((unsubscribe) => unsubscribe());\n        this.container.remove();\n        (_a = this.resizeObserver) === null || _a === void 0 ? void 0 : _a.disconnect();\n        (_b = this.unsubscribeOnScroll) === null || _b === void 0 ? void 0 : _b.call(this);\n    }\n    createDelay(delayMs = 10) {\n        let timeout;\n        let reject;\n        const onClear = () => {\n            if (timeout)\n                clearTimeout(timeout);\n            if (reject)\n                reject();\n        };\n        this.timeouts.push(onClear);\n        return () => {\n            return new Promise((resolveFn, rejectFn) => {\n                onClear();\n                reject = rejectFn;\n                timeout = setTimeout(() => {\n                    timeout = undefined;\n                    reject = undefined;\n                    resolveFn();\n                }, delayMs);\n            });\n        };\n    }\n    // Convert array of color values to linear gradient\n    convertColorValues(color) {\n        if (!Array.isArray(color))\n            return color || '';\n        if (color.length < 2)\n            return color[0] || '';\n        const canvasElement = document.createElement('canvas');\n        const ctx = canvasElement.getContext('2d');\n        const gradientHeight = canvasElement.height * (window.devicePixelRatio || 1);\n        const gradient = ctx.createLinearGradient(0, 0, 0, gradientHeight);\n        const colorStopPercentage = 1 / (color.length - 1);\n        color.forEach((color, index) => {\n            const offset = index * colorStopPercentage;\n            gradient.addColorStop(offset, color);\n        });\n        return gradient;\n    }\n    getPixelRatio() {\n        return Math.max(1, window.devicePixelRatio || 1);\n    }\n    renderBarWaveform(channelData, options, ctx, vScale) {\n        const topChannel = channelData[0];\n        const bottomChannel = channelData[1] || channelData[0];\n        const length = topChannel.length;\n        const { width, height } = ctx.canvas;\n        const halfHeight = height / 2;\n        const pixelRatio = this.getPixelRatio();\n        const barWidth = options.barWidth ? options.barWidth * pixelRatio : 1;\n        const barGap = options.barGap ? options.barGap * pixelRatio : options.barWidth ? barWidth / 2 : 0;\n        const barRadius = options.barRadius || 0;\n        const barIndexScale = width / (barWidth + barGap) / length;\n        const rectFn = barRadius && 'roundRect' in ctx ? 'roundRect' : 'rect';\n        ctx.beginPath();\n        let prevX = 0;\n        let maxTop = 0;\n        let maxBottom = 0;\n        for (let i = 0; i <= length; i++) {\n            const x = Math.round(i * barIndexScale);\n            if (x > prevX) {\n                const topBarHeight = Math.round(maxTop * halfHeight * vScale);\n                const bottomBarHeight = Math.round(maxBottom * halfHeight * vScale);\n                const barHeight = topBarHeight + bottomBarHeight || 1;\n                // Vertical alignment\n                let y = halfHeight - topBarHeight;\n                if (options.barAlign === 'top') {\n                    y = 0;\n                }\n                else if (options.barAlign === 'bottom') {\n                    y = height - barHeight;\n                }\n                ctx[rectFn](prevX * (barWidth + barGap), y, barWidth, barHeight, barRadius);\n                prevX = x;\n                maxTop = 0;\n                maxBottom = 0;\n            }\n            const magnitudeTop = Math.abs(topChannel[i] || 0);\n            const magnitudeBottom = Math.abs(bottomChannel[i] || 0);\n            if (magnitudeTop > maxTop)\n                maxTop = magnitudeTop;\n            if (magnitudeBottom > maxBottom)\n                maxBottom = magnitudeBottom;\n        }\n        ctx.fill();\n        ctx.closePath();\n    }\n    renderLineWaveform(channelData, _options, ctx, vScale) {\n        const drawChannel = (index) => {\n            const channel = channelData[index] || channelData[0];\n            const length = channel.length;\n            const { height } = ctx.canvas;\n            const halfHeight = height / 2;\n            const hScale = ctx.canvas.width / length;\n            ctx.moveTo(0, halfHeight);\n            let prevX = 0;\n            let max = 0;\n            for (let i = 0; i <= length; i++) {\n                const x = Math.round(i * hScale);\n                if (x > prevX) {\n                    const h = Math.round(max * halfHeight * vScale) || 1;\n                    const y = halfHeight + h * (index === 0 ? -1 : 1);\n                    ctx.lineTo(prevX, y);\n                    prevX = x;\n                    max = 0;\n                }\n                const value = Math.abs(channel[i] || 0);\n                if (value > max)\n                    max = value;\n            }\n            ctx.lineTo(prevX, halfHeight);\n        };\n        ctx.beginPath();\n        drawChannel(0);\n        drawChannel(1);\n        ctx.fill();\n        ctx.closePath();\n    }\n    renderWaveform(channelData, options, ctx) {\n        ctx.fillStyle = this.convertColorValues(options.waveColor);\n        // Custom rendering function\n        if (options.renderFunction) {\n            options.renderFunction(channelData, ctx);\n            return;\n        }\n        // Vertical scaling\n        let vScale = options.barHeight || 1;\n        if (options.normalize) {\n            const max = Array.from(channelData[0]).reduce((max, value) => Math.max(max, Math.abs(value)), 0);\n            vScale = max ? 1 / max : 1;\n        }\n        // Render waveform as bars\n        if (options.barWidth || options.barGap || options.barAlign) {\n            this.renderBarWaveform(channelData, options, ctx, vScale);\n            return;\n        }\n        // Render waveform as a polyline\n        this.renderLineWaveform(channelData, options, ctx, vScale);\n    }\n    renderSingleCanvas(data, options, width, height, offset, canvasContainer, progressContainer) {\n        const pixelRatio = this.getPixelRatio();\n        const canvas = document.createElement('canvas');\n        canvas.width = Math.round(width * pixelRatio);\n        canvas.height = Math.round(height * pixelRatio);\n        canvas.style.width = `${width}px`;\n        canvas.style.height = `${height}px`;\n        canvas.style.left = `${Math.round(offset)}px`;\n        canvasContainer.appendChild(canvas);\n        const ctx = canvas.getContext('2d');\n        this.renderWaveform(data, options, ctx);\n        // Draw a progress canvas\n        if (canvas.width > 0 && canvas.height > 0) {\n            const progressCanvas = canvas.cloneNode();\n            const progressCtx = progressCanvas.getContext('2d');\n            progressCtx.drawImage(canvas, 0, 0);\n            // Set the composition method to draw only where the waveform is drawn\n            progressCtx.globalCompositeOperation = 'source-in';\n            progressCtx.fillStyle = this.convertColorValues(options.progressColor);\n            // This rectangle acts as a mask thanks to the composition method\n            progressCtx.fillRect(0, 0, canvas.width, canvas.height);\n            progressContainer.appendChild(progressCanvas);\n        }\n    }\n    renderMultiCanvas(channelData, options, width, height, canvasContainer, progressContainer) {\n        const pixelRatio = this.getPixelRatio();\n        const { clientWidth } = this.scrollContainer;\n        // Render a single canvas if it fits in the viewport\n        if (clientWidth * pixelRatio >= width) {\n            this.renderSingleCanvas(channelData, options, clientWidth, height, 0, canvasContainer, progressContainer);\n            return;\n        }\n        const totalWidth = width / pixelRatio;\n        let singleCanvasWidth = Math.min(Renderer.MAX_CANVAS_WIDTH, clientWidth, totalWidth);\n        let drawnIndexes = {};\n        // Adjust width to avoid gaps between canvases when using bars\n        if (options.barWidth || options.barGap) {\n            const barWidth = options.barWidth || 0.5;\n            const barGap = options.barGap || barWidth / 2;\n            const totalBarWidth = barWidth + barGap;\n            if (singleCanvasWidth % totalBarWidth !== 0) {\n                singleCanvasWidth = Math.floor(singleCanvasWidth / totalBarWidth) * totalBarWidth;\n            }\n        }\n        // Draw a single canvas\n        const draw = (index) => {\n            if (index < 0 || index >= numCanvases)\n                return;\n            if (drawnIndexes[index])\n                return;\n            drawnIndexes[index] = true;\n            const offset = index * singleCanvasWidth;\n            const clampedWidth = Math.min(totalWidth - offset, singleCanvasWidth);\n            if (clampedWidth <= 0)\n                return;\n            const data = channelData.map((channel) => {\n                const start = Math.floor((offset / totalWidth) * channel.length);\n                const end = Math.floor(((offset + clampedWidth) / totalWidth) * channel.length);\n                return channel.slice(start, end);\n            });\n            this.renderSingleCanvas(data, options, clampedWidth, height, offset, canvasContainer, progressContainer);\n        };\n        // Clear canvases to avoid too many DOM nodes\n        const clearCanvases = () => {\n            if (Object.keys(drawnIndexes).length > Renderer.MAX_NODES) {\n                canvasContainer.innerHTML = '';\n                progressContainer.innerHTML = '';\n                drawnIndexes = {};\n            }\n        };\n        // Calculate how many canvases to render\n        const numCanvases = Math.ceil(totalWidth / singleCanvasWidth);\n        const viewPosition = this.scrollContainer.scrollLeft / totalWidth;\n        const startCanvas = Math.floor(viewPosition * numCanvases);\n        // Draw the canvases in the viewport first\n        draw(startCanvas - 1);\n        draw(startCanvas);\n        draw(startCanvas + 1);\n        // Subscribe to the scroll event to draw additional canvases\n        if (numCanvases > 1) {\n            this.unsubscribeOnScroll = this.on('scroll', () => {\n                const { scrollLeft } = this.scrollContainer;\n                const canvasIndex = Math.floor((scrollLeft / totalWidth) * numCanvases);\n                clearCanvases();\n                draw(canvasIndex - 1);\n                draw(canvasIndex);\n                draw(canvasIndex + 1);\n            });\n        }\n    }\n    renderChannel(channelData, _a, width, channelIndex) {\n        var { overlay } = _a, options = __rest(_a, [\"overlay\"]);\n        // A container for canvases\n        const canvasContainer = document.createElement('div');\n        const height = this.getHeight(options.height, options.splitChannels);\n        canvasContainer.style.height = `${height}px`;\n        if (overlay && channelIndex > 0) {\n            canvasContainer.style.marginTop = `-${height}px`;\n        }\n        this.canvasWrapper.style.minHeight = `${height}px`;\n        this.canvasWrapper.appendChild(canvasContainer);\n        // A container for progress canvases\n        const progressContainer = canvasContainer.cloneNode();\n        this.progressWrapper.appendChild(progressContainer);\n        // Render the waveform\n        this.renderMultiCanvas(channelData, options, width, height, canvasContainer, progressContainer);\n    }\n    render(audioData) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            // Clear previous timeouts\n            this.timeouts.forEach((clear) => clear());\n            this.timeouts = [];\n            // Clear the canvases\n            this.canvasWrapper.innerHTML = '';\n            this.progressWrapper.innerHTML = '';\n            // Width\n            if (this.options.width != null) {\n                this.scrollContainer.style.width =\n                    typeof this.options.width === 'number' ? `${this.options.width}px` : this.options.width;\n            }\n            // Determine the width of the waveform\n            const pixelRatio = this.getPixelRatio();\n            const parentWidth = this.scrollContainer.clientWidth;\n            const scrollWidth = Math.ceil(audioData.duration * (this.options.minPxPerSec || 0));\n            // Whether the container should scroll\n            this.isScrollable = scrollWidth > parentWidth;\n            const useParentWidth = this.options.fillParent && !this.isScrollable;\n            // Width of the waveform in pixels\n            const width = (useParentWidth ? parentWidth : scrollWidth) * pixelRatio;\n            // Set the width of the wrapper\n            this.wrapper.style.width = useParentWidth ? '100%' : `${scrollWidth}px`;\n            // Set additional styles\n            this.scrollContainer.style.overflowX = this.isScrollable ? 'auto' : 'hidden';\n            this.scrollContainer.classList.toggle('noScrollbar', !!this.options.hideScrollbar);\n            this.cursor.style.backgroundColor = `${this.options.cursorColor || this.options.progressColor}`;\n            this.cursor.style.width = `${this.options.cursorWidth}px`;\n            this.audioData = audioData;\n            this.emit('render');\n            // Render the waveform\n            if (this.options.splitChannels) {\n                // Render a waveform for each channel\n                for (let i = 0; i < audioData.numberOfChannels; i++) {\n                    const options = Object.assign(Object.assign({}, this.options), (_a = this.options.splitChannels) === null || _a === void 0 ? void 0 : _a[i]);\n                    this.renderChannel([audioData.getChannelData(i)], options, width, i);\n                }\n            }\n            else {\n                // Render a single waveform for the first two channels (left and right)\n                const channels = [audioData.getChannelData(0)];\n                if (audioData.numberOfChannels > 1)\n                    channels.push(audioData.getChannelData(1));\n                this.renderChannel(channels, this.options, width, 0);\n            }\n            // Must be emitted asynchronously for backward compatibility\n            Promise.resolve().then(() => this.emit('rendered'));\n        });\n    }\n    reRender() {\n        var _a;\n        (_a = this.unsubscribeOnScroll) === null || _a === void 0 ? void 0 : _a.call(this);\n        delete this.unsubscribeOnScroll;\n        // Return if the waveform has not been rendered yet\n        if (!this.audioData)\n            return;\n        // Remember the current cursor position\n        const { scrollWidth } = this.scrollContainer;\n        const { right: before } = this.progressWrapper.getBoundingClientRect();\n        // Re-render the waveform\n        this.render(this.audioData);\n        // Adjust the scroll position so that the cursor stays in the same place\n        if (this.isScrollable && scrollWidth !== this.scrollContainer.scrollWidth) {\n            const { right: after } = this.progressWrapper.getBoundingClientRect();\n            let delta = after - before;\n            // to limit compounding floating-point drift\n            // we need to round to the half px furthest from 0\n            delta *= 2;\n            delta = delta < 0 ? Math.floor(delta) : Math.ceil(delta);\n            delta /= 2;\n            this.scrollContainer.scrollLeft += delta;\n        }\n    }\n    zoom(minPxPerSec) {\n        this.options.minPxPerSec = minPxPerSec;\n        this.reRender();\n    }\n    scrollIntoView(progress, isPlaying = false) {\n        const { scrollLeft, scrollWidth, clientWidth } = this.scrollContainer;\n        const progressWidth = progress * scrollWidth;\n        const startEdge = scrollLeft;\n        const endEdge = scrollLeft + clientWidth;\n        const middle = clientWidth / 2;\n        if (this.isDragging) {\n            // Scroll when dragging close to the edge of the viewport\n            const minGap = 30;\n            if (progressWidth + minGap > endEdge) {\n                this.scrollContainer.scrollLeft += minGap;\n            }\n            else if (progressWidth - minGap < startEdge) {\n                this.scrollContainer.scrollLeft -= minGap;\n            }\n        }\n        else {\n            if (progressWidth < startEdge || progressWidth > endEdge) {\n                this.scrollContainer.scrollLeft = progressWidth - (this.options.autoCenter ? middle : 0);\n            }\n            // Keep the cursor centered when playing\n            const center = progressWidth - scrollLeft - middle;\n            if (isPlaying && this.options.autoCenter && center > 0) {\n                this.scrollContainer.scrollLeft += Math.min(center, 10);\n            }\n        }\n        // Emit the scroll event\n        {\n            const newScroll = this.scrollContainer.scrollLeft;\n            const startX = newScroll / scrollWidth;\n            const endX = (newScroll + clientWidth) / scrollWidth;\n            this.emit('scroll', startX, endX, newScroll, newScroll + clientWidth);\n        }\n    }\n    renderProgress(progress, isPlaying) {\n        if (isNaN(progress))\n            return;\n        const percents = progress * 100;\n        this.canvasWrapper.style.clipPath = `polygon(${percents}% 0, 100% 0, 100% 100%, ${percents}% 100%)`;\n        this.progressWrapper.style.width = `${percents}%`;\n        this.cursor.style.left = `${percents}%`;\n        this.cursor.style.transform = `translateX(-${Math.round(percents) === 100 ? this.options.cursorWidth : 0}px)`;\n        if (this.isScrollable && this.options.autoScroll) {\n            this.scrollIntoView(progress, isPlaying);\n        }\n    }\n    exportImage(format, quality, type) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const canvases = this.canvasWrapper.querySelectorAll('canvas');\n            if (!canvases.length) {\n                throw new Error('No waveform data');\n            }\n            // Data URLs\n            if (type === 'dataURL') {\n                const images = Array.from(canvases).map((canvas) => canvas.toDataURL(format, quality));\n                return Promise.resolve(images);\n            }\n            // Blobs\n            return Promise.all(Array.from(canvases).map((canvas) => {\n                return new Promise((resolve, reject) => {\n                    canvas.toBlob((blob) => {\n                        blob ? resolve(blob) : reject(new Error('Could not export image'));\n                    }, format, quality);\n                });\n            }));\n        });\n    }\n}\nRenderer.MAX_CANVAS_WIDTH = 8000;\nRenderer.MAX_NODES = 10;\nexport default Renderer;\n","export function makeDraggable(element, onDrag, onStart, onEnd, threshold = 3, mouseButton = 0, touchDelay = 100) {\n    if (!element)\n        return () => void 0;\n    const isTouchDevice = matchMedia('(pointer: coarse)').matches;\n    let unsubscribeDocument = () => void 0;\n    const onPointerDown = (event) => {\n        if (event.button !== mouseButton)\n            return;\n        event.preventDefault();\n        event.stopPropagation();\n        let startX = event.clientX;\n        let startY = event.clientY;\n        let isDragging = false;\n        const touchStartTime = Date.now();\n        const onPointerMove = (event) => {\n            event.preventDefault();\n            event.stopPropagation();\n            if (isTouchDevice && Date.now() - touchStartTime < touchDelay)\n                return;\n            const x = event.clientX;\n            const y = event.clientY;\n            const dx = x - startX;\n            const dy = y - startY;\n            if (isDragging || Math.abs(dx) > threshold || Math.abs(dy) > threshold) {\n                const rect = element.getBoundingClientRect();\n                const { left, top } = rect;\n                if (!isDragging) {\n                    onStart === null || onStart === void 0 ? void 0 : onStart(startX - left, startY - top);\n                    isDragging = true;\n                }\n                onDrag(dx, dy, x - left, y - top);\n                startX = x;\n                startY = y;\n            }\n        };\n        const onPointerUp = (event) => {\n            if (isDragging) {\n                const x = event.clientX;\n                const y = event.clientY;\n                const rect = element.getBoundingClientRect();\n                const { left, top } = rect;\n                onEnd === null || onEnd === void 0 ? void 0 : onEnd(x - left, y - top);\n            }\n            unsubscribeDocument();\n        };\n        const onPointerLeave = (e) => {\n            // Listen to events only on the document and not on inner elements\n            if (!e.relatedTarget || e.relatedTarget === document.documentElement) {\n                onPointerUp(e);\n            }\n        };\n        const onClick = (event) => {\n            if (isDragging) {\n                event.stopPropagation();\n                event.preventDefault();\n            }\n        };\n        const onTouchMove = (event) => {\n            if (isDragging) {\n                event.preventDefault();\n            }\n        };\n        document.addEventListener('pointermove', onPointerMove);\n        document.addEventListener('pointerup', onPointerUp);\n        document.addEventListener('pointerout', onPointerLeave);\n        document.addEventListener('pointercancel', onPointerLeave);\n        document.addEventListener('touchmove', onTouchMove, { passive: false });\n        document.addEventListener('click', onClick, { capture: true });\n        unsubscribeDocument = () => {\n            document.removeEventListener('pointermove', onPointerMove);\n            document.removeEventListener('pointerup', onPointerUp);\n            document.removeEventListener('pointerout', onPointerLeave);\n            document.removeEventListener('pointercancel', onPointerLeave);\n            document.removeEventListener('touchmove', onTouchMove);\n            setTimeout(() => {\n                document.removeEventListener('click', onClick, { capture: true });\n            }, 10);\n        };\n    };\n    element.addEventListener('pointerdown', onPointerDown);\n    return () => {\n        unsubscribeDocument();\n        element.removeEventListener('pointerdown', onPointerDown);\n    };\n}\n","import EventEmitter from './event-emitter.js';\nclass Timer extends EventEmitter {\n    constructor() {\n        super(...arguments);\n        this.unsubscribe = () => undefined;\n    }\n    start() {\n        this.unsubscribe = this.on('tick', () => {\n            requestAnimationFrame(() => {\n                this.emit('tick');\n            });\n        });\n        this.emit('tick');\n    }\n    stop() {\n        this.unsubscribe();\n    }\n    destroy() {\n        this.unsubscribe();\n    }\n}\nexport default Timer;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport EventEmitter from './event-emitter.js';\n/**\n * A Web Audio buffer player emulating the behavior of an HTML5 Audio element.\n */\nclass WebAudioPlayer extends EventEmitter {\n    constructor(audioContext = new AudioContext()) {\n        super();\n        this.bufferNode = null;\n        this.playStartTime = 0;\n        this.playedDuration = 0;\n        this._muted = false;\n        this._playbackRate = 1;\n        this._duration = undefined;\n        this.buffer = null;\n        this.currentSrc = '';\n        this.paused = true;\n        this.crossOrigin = null;\n        this.seeking = false;\n        this.autoplay = false;\n        /** Subscribe to an event. Returns an unsubscribe function. */\n        this.addEventListener = this.on;\n        /** Unsubscribe from an event */\n        this.removeEventListener = this.un;\n        this.audioContext = audioContext;\n        this.gainNode = this.audioContext.createGain();\n        this.gainNode.connect(this.audioContext.destination);\n    }\n    load() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return;\n        });\n    }\n    get src() {\n        return this.currentSrc;\n    }\n    set src(value) {\n        this.currentSrc = value;\n        this._duration = undefined;\n        if (!value) {\n            this.buffer = null;\n            this.emit('emptied');\n            return;\n        }\n        fetch(value)\n            .then((response) => {\n            if (response.status >= 400) {\n                throw new Error(`Failed to fetch ${value}: ${response.status} (${response.statusText})`);\n            }\n            return response.arrayBuffer();\n        })\n            .then((arrayBuffer) => {\n            if (this.currentSrc !== value)\n                return null;\n            return this.audioContext.decodeAudioData(arrayBuffer);\n        })\n            .then((audioBuffer) => {\n            if (this.currentSrc !== value)\n                return;\n            this.buffer = audioBuffer;\n            this.emit('loadedmetadata');\n            this.emit('canplay');\n            if (this.autoplay)\n                this.play();\n        });\n    }\n    _play() {\n        var _a;\n        if (!this.paused)\n            return;\n        this.paused = false;\n        (_a = this.bufferNode) === null || _a === void 0 ? void 0 : _a.disconnect();\n        this.bufferNode = this.audioContext.createBufferSource();\n        if (this.buffer) {\n            this.bufferNode.buffer = this.buffer;\n        }\n        this.bufferNode.playbackRate.value = this._playbackRate;\n        this.bufferNode.connect(this.gainNode);\n        let currentPos = this.playedDuration * this._playbackRate;\n        if (currentPos >= this.duration) {\n            currentPos = 0;\n            this.playedDuration = 0;\n        }\n        this.bufferNode.start(this.audioContext.currentTime, currentPos);\n        this.playStartTime = this.audioContext.currentTime;\n        this.bufferNode.onended = () => {\n            if (this.currentTime >= this.duration) {\n                this.pause();\n                this.emit('ended');\n            }\n        };\n    }\n    _pause() {\n        var _a;\n        this.paused = true;\n        (_a = this.bufferNode) === null || _a === void 0 ? void 0 : _a.stop();\n        this.playedDuration += this.audioContext.currentTime - this.playStartTime;\n    }\n    play() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.paused)\n                return;\n            this._play();\n            this.emit('play');\n        });\n    }\n    pause() {\n        if (this.paused)\n            return;\n        this._pause();\n        this.emit('pause');\n    }\n    stopAt(timeSeconds) {\n        var _a, _b;\n        const delay = timeSeconds - this.currentTime;\n        (_a = this.bufferNode) === null || _a === void 0 ? void 0 : _a.stop(this.audioContext.currentTime + delay);\n        (_b = this.bufferNode) === null || _b === void 0 ? void 0 : _b.addEventListener('ended', () => {\n            this.bufferNode = null;\n            this.pause();\n        }, { once: true });\n    }\n    setSinkId(deviceId) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const ac = this.audioContext;\n            return ac.setSinkId(deviceId);\n        });\n    }\n    get playbackRate() {\n        return this._playbackRate;\n    }\n    set playbackRate(value) {\n        this._playbackRate = value;\n        if (this.bufferNode) {\n            this.bufferNode.playbackRate.value = value;\n        }\n    }\n    get currentTime() {\n        const time = this.paused\n            ? this.playedDuration\n            : this.playedDuration + (this.audioContext.currentTime - this.playStartTime);\n        return time * this._playbackRate;\n    }\n    set currentTime(value) {\n        const wasPlaying = !this.paused;\n        wasPlaying && this._pause();\n        this.playedDuration = value / this._playbackRate;\n        wasPlaying && this._play();\n        this.emit('seeking');\n        this.emit('timeupdate');\n    }\n    get duration() {\n        var _a, _b;\n        return (_a = this._duration) !== null && _a !== void 0 ? _a : (((_b = this.buffer) === null || _b === void 0 ? void 0 : _b.duration) || 0);\n    }\n    set duration(value) {\n        this._duration = value;\n    }\n    get volume() {\n        return this.gainNode.gain.value;\n    }\n    set volume(value) {\n        this.gainNode.gain.value = value;\n        this.emit('volumechange');\n    }\n    get muted() {\n        return this._muted;\n    }\n    set muted(value) {\n        if (this._muted === value)\n            return;\n        this._muted = value;\n        if (this._muted) {\n            this.gainNode.disconnect();\n        }\n        else {\n            this.gainNode.connect(this.audioContext.destination);\n        }\n    }\n    canPlayType(mimeType) {\n        return /^(audio|video)\\//.test(mimeType);\n    }\n    /** Get the GainNode used to play the audio. Can be used to attach filters. */\n    getGainNode() {\n        return this.gainNode;\n    }\n    /** Get decoded audio */\n    getChannelData() {\n        const channels = [];\n        if (!this.buffer)\n            return channels;\n        const numChannels = this.buffer.numberOfChannels;\n        for (let i = 0; i < numChannels; i++) {\n            channels.push(this.buffer.getChannelData(i));\n        }\n        return channels;\n    }\n}\nexport default WebAudioPlayer;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport BasePlugin from './base-plugin.js';\nimport Decoder from './decoder.js';\nimport * as dom from './dom.js';\nimport Fetcher from './fetcher.js';\nimport Player from './player.js';\nimport Renderer from './renderer.js';\nimport Timer from './timer.js';\nimport WebAudioPlayer from './webaudio.js';\nconst defaultOptions = {\n    waveColor: '#999',\n    progressColor: '#555',\n    cursorWidth: 1,\n    minPxPerSec: 0,\n    fillParent: true,\n    interact: true,\n    dragToSeek: false,\n    autoScroll: true,\n    autoCenter: true,\n    sampleRate: 8000,\n};\nclass WaveSurfer extends Player {\n    /** Create a new WaveSurfer instance */\n    static create(options) {\n        return new WaveSurfer(options);\n    }\n    /** Create a new WaveSurfer instance */\n    constructor(options) {\n        const media = options.media ||\n            (options.backend === 'WebAudio' ? new WebAudioPlayer() : undefined);\n        super({\n            media,\n            mediaControls: options.mediaControls,\n            autoplay: options.autoplay,\n            playbackRate: options.audioRate,\n        });\n        this.plugins = [];\n        this.decodedData = null;\n        this.subscriptions = [];\n        this.mediaSubscriptions = [];\n        this.abortController = null;\n        this.options = Object.assign({}, defaultOptions, options);\n        this.timer = new Timer();\n        const audioElement = media ? undefined : this.getMediaElement();\n        this.renderer = new Renderer(this.options, audioElement);\n        this.initPlayerEvents();\n        this.initRendererEvents();\n        this.initTimerEvents();\n        this.initPlugins();\n        // Read the initial URL before load has been called\n        const initialUrl = this.options.url || this.getSrc() || '';\n        // Init and load async to allow external events to be registered\n        Promise.resolve().then(() => {\n            this.emit('init');\n            // Load audio if URL or an external media with an src is passed,\n            // of render w/o audio if pre-decoded peaks and duration are provided\n            const { peaks, duration } = this.options;\n            if (initialUrl || (peaks && duration)) {\n                // Swallow async errors because they cannot be caught from a constructor call.\n                // Subscribe to the wavesurfer's error event to handle them.\n                this.load(initialUrl, peaks, duration).catch(() => null);\n            }\n        });\n    }\n    updateProgress(currentTime = this.getCurrentTime()) {\n        this.renderer.renderProgress(currentTime / this.getDuration(), this.isPlaying());\n        return currentTime;\n    }\n    initTimerEvents() {\n        // The timer fires every 16ms for a smooth progress animation\n        this.subscriptions.push(this.timer.on('tick', () => {\n            if (!this.isSeeking()) {\n                const currentTime = this.updateProgress();\n                this.emit('timeupdate', currentTime);\n                this.emit('audioprocess', currentTime);\n            }\n        }));\n    }\n    initPlayerEvents() {\n        if (this.isPlaying()) {\n            this.emit('play');\n            this.timer.start();\n        }\n        this.mediaSubscriptions.push(this.onMediaEvent('timeupdate', () => {\n            const currentTime = this.updateProgress();\n            this.emit('timeupdate', currentTime);\n        }), this.onMediaEvent('play', () => {\n            this.emit('play');\n            this.timer.start();\n        }), this.onMediaEvent('pause', () => {\n            this.emit('pause');\n            this.timer.stop();\n        }), this.onMediaEvent('emptied', () => {\n            this.timer.stop();\n        }), this.onMediaEvent('ended', () => {\n            this.emit('finish');\n        }), this.onMediaEvent('seeking', () => {\n            this.emit('seeking', this.getCurrentTime());\n        }), this.onMediaEvent('error', (err) => {\n            this.emit('error', err.error);\n        }));\n    }\n    initRendererEvents() {\n        this.subscriptions.push(\n        // Seek on click\n        this.renderer.on('click', (relativeX, relativeY) => {\n            if (this.options.interact) {\n                this.seekTo(relativeX);\n                this.emit('interaction', relativeX * this.getDuration());\n                this.emit('click', relativeX, relativeY);\n            }\n        }), \n        // Double click\n        this.renderer.on('dblclick', (relativeX, relativeY) => {\n            this.emit('dblclick', relativeX, relativeY);\n        }), \n        // Scroll\n        this.renderer.on('scroll', (startX, endX, scrollLeft, scrollRight) => {\n            const duration = this.getDuration();\n            this.emit('scroll', startX * duration, endX * duration, scrollLeft, scrollRight);\n        }), \n        // Redraw\n        this.renderer.on('render', () => {\n            this.emit('redraw');\n        }), \n        // RedrawComplete\n        this.renderer.on('rendered', () => {\n            this.emit('redrawcomplete');\n        }), \n        // DragStart\n        this.renderer.on('dragstart', (relativeX) => {\n            this.emit('dragstart', relativeX);\n        }), \n        // DragEnd\n        this.renderer.on('dragend', (relativeX) => {\n            this.emit('dragend', relativeX);\n        }));\n        // Drag\n        {\n            let debounce;\n            this.subscriptions.push(this.renderer.on('drag', (relativeX) => {\n                if (!this.options.interact)\n                    return;\n                // Update the visual position\n                this.renderer.renderProgress(relativeX);\n                // Set the audio position with a debounce\n                clearTimeout(debounce);\n                let debounceTime;\n                if (this.isPlaying()) {\n                    debounceTime = 0;\n                }\n                else if (this.options.dragToSeek === true) {\n                    debounceTime = 200;\n                }\n                else if (typeof this.options.dragToSeek === 'object' && this.options.dragToSeek !== undefined) {\n                    debounceTime = this.options.dragToSeek['debounceTime'];\n                }\n                debounce = setTimeout(() => {\n                    this.seekTo(relativeX);\n                }, debounceTime);\n                this.emit('interaction', relativeX * this.getDuration());\n                this.emit('drag', relativeX);\n            }));\n        }\n    }\n    initPlugins() {\n        var _a;\n        if (!((_a = this.options.plugins) === null || _a === void 0 ? void 0 : _a.length))\n            return;\n        this.options.plugins.forEach((plugin) => {\n            this.registerPlugin(plugin);\n        });\n    }\n    unsubscribePlayerEvents() {\n        this.mediaSubscriptions.forEach((unsubscribe) => unsubscribe());\n        this.mediaSubscriptions = [];\n    }\n    /** Set new wavesurfer options and re-render it */\n    setOptions(options) {\n        this.options = Object.assign({}, this.options, options);\n        this.renderer.setOptions(this.options);\n        if (options.audioRate) {\n            this.setPlaybackRate(options.audioRate);\n        }\n        if (options.mediaControls != null) {\n            this.getMediaElement().controls = options.mediaControls;\n        }\n    }\n    /** Register a wavesurfer.js plugin */\n    registerPlugin(plugin) {\n        plugin._init(this);\n        this.plugins.push(plugin);\n        // Unregister plugin on destroy\n        this.subscriptions.push(plugin.once('destroy', () => {\n            this.plugins = this.plugins.filter((p) => p !== plugin);\n        }));\n        return plugin;\n    }\n    /** For plugins only: get the waveform wrapper div */\n    getWrapper() {\n        return this.renderer.getWrapper();\n    }\n    /** For plugins only: get the scroll container client width */\n    getWidth() {\n        return this.renderer.getWidth();\n    }\n    /** Get the current scroll position in pixels */\n    getScroll() {\n        return this.renderer.getScroll();\n    }\n    /** Set the current scroll position in pixels */\n    setScroll(pixels) {\n        return this.renderer.setScroll(pixels);\n    }\n    /** Move the start of the viewing window to a specific time in the audio (in seconds) */\n    setScrollTime(time) {\n        const percentage = time / this.getDuration();\n        this.renderer.setScrollPercentage(percentage);\n    }\n    /** Get all registered plugins */\n    getActivePlugins() {\n        return this.plugins;\n    }\n    loadAudio(url, blob, channelData, duration) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            this.emit('load', url);\n            if (!this.options.media && this.isPlaying())\n                this.pause();\n            this.decodedData = null;\n            // Fetch the entire audio as a blob if pre-decoded data is not provided\n            if (!blob && !channelData) {\n                const fetchParams = this.options.fetchParams || {};\n                if (window.AbortController && !fetchParams.signal) {\n                    this.abortController = new AbortController();\n                    fetchParams.signal = (_a = this.abortController) === null || _a === void 0 ? void 0 : _a.signal;\n                }\n                const onProgress = (percentage) => this.emit('loading', percentage);\n                blob = yield Fetcher.fetchBlob(url, onProgress, fetchParams);\n            }\n            // Set the mediaelement source\n            this.setSrc(url, blob);\n            // Wait for the audio duration\n            const audioDuration = yield new Promise((resolve) => {\n                const staticDuration = duration || this.getDuration();\n                if (staticDuration) {\n                    resolve(staticDuration);\n                }\n                else {\n                    this.mediaSubscriptions.push(this.onMediaEvent('loadedmetadata', () => resolve(this.getDuration()), { once: true }));\n                }\n            });\n            // Set the duration if the player is a WebAudioPlayer without a URL\n            if (!url && !blob) {\n                const media = this.getMediaElement();\n                if (media instanceof WebAudioPlayer) {\n                    media.duration = audioDuration;\n                }\n            }\n            // Decode the audio data or use user-provided peaks\n            if (channelData) {\n                this.decodedData = Decoder.createBuffer(channelData, audioDuration || 0);\n            }\n            else if (blob) {\n                const arrayBuffer = yield blob.arrayBuffer();\n                this.decodedData = yield Decoder.decode(arrayBuffer, this.options.sampleRate);\n            }\n            if (this.decodedData) {\n                this.emit('decode', this.getDuration());\n                this.renderer.render(this.decodedData);\n            }\n            this.emit('ready', this.getDuration());\n        });\n    }\n    /** Load an audio file by URL, with optional pre-decoded audio data */\n    load(url, channelData, duration) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                return yield this.loadAudio(url, undefined, channelData, duration);\n            }\n            catch (err) {\n                this.emit('error', err);\n                throw err;\n            }\n        });\n    }\n    /** Load an audio blob */\n    loadBlob(blob, channelData, duration) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                return yield this.loadAudio('', blob, channelData, duration);\n            }\n            catch (err) {\n                this.emit('error', err);\n                throw err;\n            }\n        });\n    }\n    /** Zoom the waveform by a given pixels-per-second factor */\n    zoom(minPxPerSec) {\n        if (!this.decodedData) {\n            throw new Error('No audio loaded');\n        }\n        this.renderer.zoom(minPxPerSec);\n        this.emit('zoom', minPxPerSec);\n    }\n    /** Get the decoded audio data */\n    getDecodedData() {\n        return this.decodedData;\n    }\n    /** Get decoded peaks */\n    exportPeaks({ channels = 2, maxLength = 8000, precision = 10000 } = {}) {\n        if (!this.decodedData) {\n            throw new Error('The audio has not been decoded yet');\n        }\n        const maxChannels = Math.min(channels, this.decodedData.numberOfChannels);\n        const peaks = [];\n        for (let i = 0; i < maxChannels; i++) {\n            const channel = this.decodedData.getChannelData(i);\n            const data = [];\n            const sampleSize = channel.length / maxLength;\n            for (let i = 0; i < maxLength; i++) {\n                const sample = channel.slice(Math.floor(i * sampleSize), Math.ceil((i + 1) * sampleSize));\n                let max = 0;\n                for (let x = 0; x < sample.length; x++) {\n                    const n = sample[x];\n                    if (Math.abs(n) > Math.abs(max))\n                        max = n;\n                }\n                data.push(Math.round(max * precision) / precision);\n            }\n            peaks.push(data);\n        }\n        return peaks;\n    }\n    /** Get the duration of the audio in seconds */\n    getDuration() {\n        let duration = super.getDuration() || 0;\n        // Fall back to the decoded data duration if the media duration is incorrect\n        if ((duration === 0 || duration === Infinity) && this.decodedData) {\n            duration = this.decodedData.duration;\n        }\n        return duration;\n    }\n    /** Toggle if the waveform should react to clicks */\n    toggleInteraction(isInteractive) {\n        this.options.interact = isInteractive;\n    }\n    /** Jump to a specific time in the audio (in seconds) */\n    setTime(time) {\n        super.setTime(time);\n        this.updateProgress(time);\n        this.emit('timeupdate', time);\n    }\n    /** Seek to a percentage of audio as [0..1] (0 = beginning, 1 = end) */\n    seekTo(progress) {\n        const time = this.getDuration() * progress;\n        this.setTime(time);\n    }\n    /** Play or pause the audio */\n    playPause() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.isPlaying() ? this.pause() : this.play();\n        });\n    }\n    /** Stop the audio and go to the beginning */\n    stop() {\n        this.pause();\n        this.setTime(0);\n    }\n    /** Skip N or -N seconds from the current position */\n    skip(seconds) {\n        this.setTime(this.getCurrentTime() + seconds);\n    }\n    /** Empty the waveform */\n    empty() {\n        this.load('', [[0]], 0.001);\n    }\n    /** Set HTML media element */\n    setMediaElement(element) {\n        this.unsubscribePlayerEvents();\n        super.setMediaElement(element);\n        this.initPlayerEvents();\n    }\n    exportImage() {\n        return __awaiter(this, arguments, void 0, function* (format = 'image/png', quality = 1, type = 'dataURL') {\n            return this.renderer.exportImage(format, quality, type);\n        });\n    }\n    /** Unmount wavesurfer */\n    destroy() {\n        var _a;\n        this.emit('destroy');\n        (_a = this.abortController) === null || _a === void 0 ? void 0 : _a.abort();\n        this.plugins.forEach((plugin) => plugin.destroy());\n        this.subscriptions.forEach((unsubscribe) => unsubscribe());\n        this.unsubscribePlayerEvents();\n        this.timer.destroy();\n        this.renderer.destroy();\n        super.destroy();\n    }\n}\nWaveSurfer.BasePlugin = BasePlugin;\nWaveSurfer.dom = dom;\nexport default WaveSurfer;\n","import EventEmitter from './event-emitter.js';\n/** Base class for wavesurfer plugins */\nexport class BasePlugin extends EventEmitter {\n    /** Create a plugin instance */\n    constructor(options) {\n        super();\n        this.subscriptions = [];\n        this.options = options;\n    }\n    /** Called after this.wavesurfer is available */\n    onInit() {\n        return;\n    }\n    /** Do not call directly, only called by WavesSurfer internally */\n    _init(wavesurfer) {\n        this.wavesurfer = wavesurfer;\n        this.onInit();\n    }\n    /** Destroy the plugin and unsubscribe from all events */\n    destroy() {\n        this.emit('destroy');\n        this.subscriptions.forEach((unsubscribe) => unsubscribe());\n    }\n}\nexport default BasePlugin;\n","// wavesurfer-shim.js\nclass WaveSurferShim {\n    constructor(options) {\n        this.media = options.media || null;\n        this.currentTime = 0;\n        this.playbackRate = 1;\n        this.volume = 1;\n        this.eventListeners = {};\n        this.container = options.container || document.body;\n        this.waveColor = options.waveColor || 'green';\n        this.progressColor = options.progressColor || 'blue';\n        this.width = options.width || 500;\n        this.height = options.height || 100;\n        this.peaks = options.peaks || null;\n        this.showWaveform = true;\n\n        if (typeof options.showWaveform === 'boolean') {\n            this.showWaveform = options.showWaveform;\n        }\n\n        if (!this.media) {\n            console.warn(\"WaveSurferShim initialized without a media element.\");\n        }\n\n        this._setupMediaListeners();\n\n        // check to make sure we wish to have visual waveform\n        // in mobile mode we are just using shim API, no visual waveform\n        if (this.showWaveform) {\n            this._createCanvas();\n\n            if (this.peaks) {\n                this._renderWaveform(this.peaks);\n            }\n            this._startAnimationLoop();\n        }\n    }\n\n    _createCanvas() {\n        // Create and configure canvas\n        this.canvas = document.createElement('canvas');\n        this.canvas.width = this.width;\n        this.canvas.height = this.height;\n        this.canvas.style.border = '1px solid #ccc';\n        this.container.appendChild(this.canvas);\n        this.ctx = this.canvas.getContext('2d');\n    }\n\n    _renderWaveform(peaks) {\n        if (!peaks) {\n            console.warn(\"WaveSurferShim: No peaks provided for rendering.\");\n            return;\n        }\n\n        const samples = this._downsampleData(peaks, this.width);\n\n        // Draw the waveform\n        this.ctx.clearRect(0, 0, this.width, this.height);\n        this.ctx.strokeStyle = this.waveColor;\n        this.ctx.lineWidth = 1;\n        this.ctx.beginPath();\n\n        for (let i = 0; i < samples.length; i++) {\n            const x = (i / samples.length) * this.width;\n            const y = (1 - samples[i]) * (this.height / 2); // Normalize and center\n            const centerY = this.height / 2;\n\n            // Draw top half\n            this.ctx.moveTo(x, centerY);\n            this.ctx.lineTo(x, y);\n\n            // Draw bottom half (inverted)\n            this.ctx.moveTo(x, centerY);\n            this.ctx.lineTo(x, centerY + (centerY - y));\n        }\n\n        this.ctx.stroke();\n    }\n\n    _updateProgress() {\n        if (!this.media) return;\n\n        if (!this.showWaveform) {\n            return;\n        }\n        const progress = this.media.currentTime / this.media.duration;\n\n        // Redraw waveform and overlay progress\n        this._renderWaveform(this.peaks);\n        this.ctx.fillStyle = this.progressColor;\n        this.ctx.globalAlpha = 0.5; // Make the progress overlay slightly transparent\n        this.ctx.fillRect(0, 0, this.width * progress, this.height);\n        this.ctx.globalAlpha = 1; // Reset transparency\n    }\n\n    _downsampleData(data, width) {\n        const sampleRate = Math.floor(data.length / width);\n        const samples = [];\n        for (let i = 0; i < data.length; i += sampleRate) {\n            samples.push(data[i]);\n        }\n        return samples.map(value => (value + 1) / 2); // Normalize to [0, 1]\n    }\n\n    _startAnimationLoop() {\n        const update = () => {\n            this._updateProgress();\n            requestAnimationFrame(update);\n        };\n        update();\n    }\n\n\n    play() {\n        if (this.media) {\n            this.media.play();\n            this._emit('play');\n            this._startProgress();\n        } else {\n            console.warn(\"WaveSurferShim: No media element to play.\");\n        }\n    }\n\n    pause() {\n        if (this.media) {\n            this.media.pause();\n            this._emit('pause');\n            this._stopProgress();\n        } else {\n            console.warn(\"WaveSurferShim: No media element to pause.\");\n        }\n    }\n\n    seekTo(time) {\n        this.currentTime = time;\n        if (this.media) {\n            this.media.currentTime = time;\n        }\n        this._updateProgress();\n    }\n\n    _startProgress() {\n        if (this.media) {\n            this.progressInterval = setInterval(() => this._updateProgress(), 5);\n        }\n    }\n\n    _stopProgress() {\n        clearInterval(this.progressInterval);\n    }\n\n \n    getVolume() {\n        return this.volume;\n    }\n\n    getDuration() {\n        return this.media ? this.media.duration : 0;\n    }\n\n    seekTo(time) {\n        this.currentTime = time;\n        if (this.media) {\n            this.media.currentTime = time;\n        }\n    }\n\n    setTime(time) {\n        this.currentTime = time;\n        if (this.media) {\n            this.media.currentTime = time;\n        }\n    }\n\n    isPlaying() {\n        return this.media ? !this.media.paused : false;\n    }\n    getCurrentTime() {\n        return this.media ? this.media.currentTime : this.currentTime;\n    }\n\n    setPlaybackRate(rate) {\n        this.playbackRate = rate;\n        if (this.media) {\n            this.media.playbackRate = rate;\n        }\n    }\n\n    getPlaybackRate() {\n        return this.playbackRate;\n    }\n\n    setVolume(volume) {\n        this.volume = volume;\n        if (this.media) {\n            this.media.volume = volume;\n        }\n    }\n\n    destroy() {\n        console.log(\"WaveSurferShim: destroy called.\");\n        if (this.media) {\n            this.media.pause();\n            this.media = null;\n        }\n\n        if (this.progressInterval) {\n            clearInterval(this.progressInterval);\n        }\n        if (this._timeUpdateTimeout) {\n            clearTimeout(this._timeUpdateTimeout);\n        }\n\n        this.eventListeners = {};\n    }\n\n    on(event, callback) {\n        if (!this.eventListeners[event]) {\n            this.eventListeners[event] = [];\n        }\n        this.eventListeners[event].push(callback);\n    }\n\n    _emit(event, ...args) {\n        if (this.eventListeners[event]) {\n            this.eventListeners[event].forEach(callback => callback(...args));\n        }\n    }\n\n\n    _setupMediaListeners() {\n        //if (!this.media) return;\n\n\n        if (this.media) {\n            this.media.addEventListener('loadeddata', () => {\n                this._emit('ready');\n            });\n            this.media.addEventListener('timeupdate', () => {\n                // this event timeupdate is taking up a lot of CPU?\n                // we are seeing Commit / Animation Frame fired near this event\n                // even with showWaveform set to false \n                this._emit('audioprocess', this.getCurrentTime());\n            });\n\n            this.media.addEventListener('seeked', () => {\n                this._emit('seeking', this.getCurrentTime());\n            });\n\n        } else {\n        }\n        setTimeout(() => {\n            this._emit('ready');\n        }, 0);\n\n    }\n}\n\n// Factory function to mimic WaveSurfer.create()\nWaveSurferShim.create = function (options) {\n\n    let container = options.container || document.body;\n    console.log(\"FFFF\", options)\n    let waveform = new WaveSurferShim(options);\n\n    // create a new shim div with options.width and options.height\n    let shim = document.createElement('div');\n    shim.style.width = options.width + 'px';\n    shim.style.height = options.height + 'px';\n    // shim.style.backgroundColor = options.waveColor || 'green';\n    shim.style.color = options.color || 'white';\n    shim.style.border = '1px solid white';\n    shim.style.borderRadius = '5px';\n\n    // Add the shim to the container\n    //container.appendChild(shim);\n\n    waveform.container = shim;\n    console.log(\"WAAAV\", waveform);\n\n\n    waveform.regions = {};\n    waveform.regions.addRegion = function (options) {\n        let region = document.createElement('div');\n        region.style.position = 'absolute';\n        region.style.backgroundColor = options.color || 'rgba(255, 0, 0, 0.3)';\n        region.style.height = '100%';\n        region.style.width = (options.end - options.start) * options.width + 'px';\n        region.style.left = options.start * options.width + 'px';\n        //shim.appendChild(region);\n    };\n\n    return waveform;\n};\n\n// Export as the default module\nexport default WaveSurferShim;\n\n\n","class t{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}}class e extends t{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit(\"destroy\"),this.subscriptions.forEach((t=>t()))}}function i(t,e,i,n,s=3,r=0,o=100){if(!t)return()=>{};const a=matchMedia(\"(pointer: coarse)\").matches;let l=()=>{};const h=h=>{if(h.button!==r)return;h.preventDefault(),h.stopPropagation();let d=h.clientX,c=h.clientY,u=!1;const v=Date.now(),g=n=>{if(n.preventDefault(),n.stopPropagation(),a&&Date.now()-v<o)return;const r=n.clientX,l=n.clientY,h=r-d,g=l-c;if(u||Math.abs(h)>s||Math.abs(g)>s){const n=t.getBoundingClientRect(),{left:s,top:o}=n;u||(null==i||i(d-s,c-o),u=!0),e(h,g,r-s,l-o),d=r,c=l}},p=e=>{if(u){const i=e.clientX,s=e.clientY,r=t.getBoundingClientRect(),{left:o,top:a}=r;null==n||n(i-o,s-a)}l()},m=t=>{t.relatedTarget&&t.relatedTarget!==document.documentElement||p(t)},f=t=>{u&&(t.stopPropagation(),t.preventDefault())},b=t=>{u&&t.preventDefault()};document.addEventListener(\"pointermove\",g),document.addEventListener(\"pointerup\",p),document.addEventListener(\"pointerout\",m),document.addEventListener(\"pointercancel\",m),document.addEventListener(\"touchmove\",b,{passive:!1}),document.addEventListener(\"click\",f,{capture:!0}),l=()=>{document.removeEventListener(\"pointermove\",g),document.removeEventListener(\"pointerup\",p),document.removeEventListener(\"pointerout\",m),document.removeEventListener(\"pointercancel\",m),document.removeEventListener(\"touchmove\",b),setTimeout((()=>{document.removeEventListener(\"click\",f,{capture:!0})}),10)}};return t.addEventListener(\"pointerdown\",h),()=>{l(),t.removeEventListener(\"pointerdown\",h)}}function n(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,s]of Object.entries(e))if(\"children\"===t)for(const[t,s]of Object.entries(e))\"string\"==typeof s?i.appendChild(document.createTextNode(s)):i.appendChild(n(t,s));else\"style\"===t?Object.assign(i.style,s):\"textContent\"===t?i.textContent=s:i.setAttribute(t,s.toString());return i}function s(t,e,i){const s=n(t,e||{});return null==i||i.appendChild(s),s}class r extends t{constructor(t,e,i=0){var n,s,r,o,a,l,h,d;super(),this.totalDuration=e,this.numberOfChannels=i,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.subscriptions=[],this.id=t.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(t.start),this.end=this.clampPosition(null!==(n=t.end)&&void 0!==n?n:t.start),this.drag=null===(s=t.drag)||void 0===s||s,this.resize=null===(r=t.resize)||void 0===r||r,this.color=null!==(o=t.color)&&void 0!==o?o:\"rgba(0, 0, 0, 0.1)\",this.minLength=null!==(a=t.minLength)&&void 0!==a?a:this.minLength,this.maxLength=null!==(l=t.maxLength)&&void 0!==l?l:this.maxLength,this.channelIdx=null!==(h=t.channelIdx)&&void 0!==h?h:-1,this.contentEditable=null!==(d=t.contentEditable)&&void 0!==d?d:this.contentEditable,this.element=this.initElement(),this.setContent(t.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(t){return Math.max(0,Math.min(this.totalDuration,t))}setPart(){const t=this.start===this.end;this.element.setAttribute(\"part\",`${t?\"marker\":\"region\"} ${this.id}`)}addResizeHandles(t){const e={position:\"absolute\",zIndex:\"2\",width:\"6px\",height:\"100%\",top:\"0\",cursor:\"ew-resize\",wordBreak:\"keep-all\"},n=s(\"div\",{part:\"region-handle region-handle-left\",style:Object.assign(Object.assign({},e),{left:\"0\",borderLeft:\"2px solid rgba(0, 0, 0, 0.5)\",borderRadius:\"2px 0 0 2px\"})},t),r=s(\"div\",{part:\"region-handle region-handle-right\",style:Object.assign(Object.assign({},e),{right:\"0\",borderRight:\"2px solid rgba(0, 0, 0, 0.5)\",borderRadius:\"0 2px 2px 0\"})},t);this.subscriptions.push(i(n,(t=>this.onResize(t,\"start\")),(()=>null),(()=>this.onEndResizing()),1),i(r,(t=>this.onResize(t,\"end\")),(()=>null),(()=>this.onEndResizing()),1))}removeResizeHandles(t){const e=t.querySelector('[part*=\"region-handle-left\"]'),i=t.querySelector('[part*=\"region-handle-right\"]');e&&t.removeChild(e),i&&t.removeChild(i)}initElement(){const t=this.start===this.end;let e=0,i=100;this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(i=100/this.numberOfChannels,e=i*this.channelIdx);const n=s(\"div\",{style:{position:\"absolute\",top:`${e}%`,height:`${i}%`,backgroundColor:t?\"none\":this.color,borderLeft:t?\"2px solid \"+this.color:\"none\",borderRadius:\"2px\",boxSizing:\"border-box\",transition:\"background-color 0.2s ease\",cursor:this.drag?\"grab\":\"default\",pointerEvents:\"all\"}});return!t&&this.resize&&this.addResizeHandles(n),n}renderPosition(){const t=this.start/this.totalDuration,e=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*t+\"%\",this.element.style.right=100*e+\"%\"}toggleCursor(t){var e;this.drag&&(null===(e=this.element)||void 0===e?void 0:e.style)&&(this.element.style.cursor=t?\"grabbing\":\"grab\")}initMouseEvents(){const{element:t}=this;t&&(t.addEventListener(\"click\",(t=>this.emit(\"click\",t))),t.addEventListener(\"mouseenter\",(t=>this.emit(\"over\",t))),t.addEventListener(\"mouseleave\",(t=>this.emit(\"leave\",t))),t.addEventListener(\"dblclick\",(t=>this.emit(\"dblclick\",t))),t.addEventListener(\"pointerdown\",(()=>this.toggleCursor(!0))),t.addEventListener(\"pointerup\",(()=>this.toggleCursor(!1))),this.subscriptions.push(i(t,(t=>this.onMove(t)),(()=>this.toggleCursor(!0)),(()=>{this.toggleCursor(!1),this.drag&&this.emit(\"update-end\")}))),this.contentEditable&&this.content&&(this.content.addEventListener(\"click\",(t=>this.onContentClick(t))),this.content.addEventListener(\"blur\",(()=>this.onContentBlur()))))}_onUpdate(t,e){if(!this.element.parentElement)return;const{width:i}=this.element.parentElement.getBoundingClientRect(),n=t/i*this.totalDuration,s=e&&\"start\"!==e?this.start:this.start+n,r=e&&\"end\"!==e?this.end:this.end+n,o=r-s;s>=0&&r<=this.totalDuration&&s<=r&&o>=this.minLength&&o<=this.maxLength&&(this.start=s,this.end=r,this.renderPosition(),this.emit(\"update\",e))}onMove(t){this.drag&&this._onUpdate(t)}onResize(t,e){this.resize&&this._onUpdate(t,e)}onEndResizing(){this.resize&&this.emit(\"update-end\")}onContentClick(t){t.stopPropagation();t.target.focus(),this.emit(\"click\",t)}onContentBlur(){this.emit(\"update-end\")}_setTotalDuration(t){this.totalDuration=t,this.renderPosition()}play(){this.emit(\"play\")}setContent(t){var e;if(null===(e=this.content)||void 0===e||e.remove(),t){if(\"string\"==typeof t){const e=this.start===this.end;this.content=s(\"div\",{style:{padding:`0.2em ${e?.2:.4}em`,display:\"inline-block\"},textContent:t})}else this.content=t;this.contentEditable&&(this.content.contentEditable=\"true\"),this.content.setAttribute(\"part\",\"region-content\"),this.element.appendChild(this.content)}else this.content=void 0}setOptions(t){var e,i;if(t.color&&(this.color=t.color,this.element.style.backgroundColor=this.color),void 0!==t.drag&&(this.drag=t.drag,this.element.style.cursor=this.drag?\"grab\":\"default\"),void 0!==t.start||void 0!==t.end){const n=this.start===this.end;this.start=this.clampPosition(null!==(e=t.start)&&void 0!==e?e:this.start),this.end=this.clampPosition(null!==(i=t.end)&&void 0!==i?i:n?this.start:this.end),this.renderPosition(),this.setPart()}if(t.content&&this.setContent(t.content),t.id&&(this.id=t.id,this.setPart()),void 0!==t.resize&&t.resize!==this.resize){const e=this.start===this.end;this.resize=t.resize,this.resize&&!e?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}}remove(){this.emit(\"remove\"),this.subscriptions.forEach((t=>t())),this.element.remove(),this.element=null}}class o extends e{constructor(t){super(t),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(t){return new o(t)}onInit(){if(!this.wavesurfer)throw Error(\"WaveSurfer is not initialized\");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let t=[];this.subscriptions.push(this.wavesurfer.on(\"timeupdate\",(e=>{const i=this.regions.filter((t=>t.start<=e&&(t.end===t.start?t.start+.05:t.end)>=e));i.forEach((e=>{t.includes(e)||this.emit(\"region-in\",e)})),t.forEach((t=>{i.includes(t)||this.emit(\"region-out\",t)})),t=i})))}initRegionsContainer(){return s(\"div\",{style:{position:\"absolute\",top:\"0\",left:\"0\",width:\"100%\",height:\"100%\",zIndex:\"3\",pointerEvents:\"none\"}})}getRegions(){return this.regions}avoidOverlapping(t){t.content&&setTimeout((()=>{const e=t.content,i=e.getBoundingClientRect(),n=this.regions.map((e=>{if(e===t||!e.content)return 0;const n=e.content.getBoundingClientRect();return i.left<n.left+n.width&&n.left<i.left+i.width?n.height:0})).reduce(((t,e)=>t+e),0);e.style.marginTop=`${n}px`}),10)}adjustScroll(t){var e,i;const n=null===(i=null===(e=this.wavesurfer)||void 0===e?void 0:e.getWrapper())||void 0===i?void 0:i.parentElement;if(!n)return;const{clientWidth:s,scrollWidth:r}=n;if(r<=s)return;const o=n.getBoundingClientRect(),a=t.element.getBoundingClientRect(),l=a.left-o.left,h=a.right-o.left;l<0?n.scrollLeft+=l:h>s&&(n.scrollLeft+=h-s)}virtualAppend(t,e,i){const n=()=>{if(!this.wavesurfer)return;const n=this.wavesurfer.getWidth(),s=this.wavesurfer.getScroll(),r=e.clientWidth,o=this.wavesurfer.getDuration(),a=Math.round(t.start/o*r);a+(Math.round((t.end-t.start)/o*r)||1)>s&&a<s+n?e.appendChild(i):i.remove()};setTimeout((()=>{if(!this.wavesurfer)return;n();const e=this.wavesurfer.on(\"scroll\",n);this.subscriptions.push(t.once(\"remove\",e),e)}),0)}saveRegion(t){this.virtualAppend(t,this.regionsContainer,t.element),this.avoidOverlapping(t),this.regions.push(t);const e=[t.on(\"update\",(e=>{e||this.adjustScroll(t),this.emit(\"region-update\",t,e)})),t.on(\"update-end\",(()=>{this.avoidOverlapping(t),this.emit(\"region-updated\",t)})),t.on(\"play\",(()=>{var e,i;null===(e=this.wavesurfer)||void 0===e||e.play(),null===(i=this.wavesurfer)||void 0===i||i.setTime(t.start)})),t.on(\"click\",(e=>{this.emit(\"region-clicked\",t,e)})),t.on(\"dblclick\",(e=>{this.emit(\"region-double-clicked\",t,e)})),t.once(\"remove\",(()=>{e.forEach((t=>t())),this.regions=this.regions.filter((e=>e!==t)),this.emit(\"region-removed\",t)}))];this.subscriptions.push(...e),this.emit(\"region-created\",t)}addRegion(t){var e,i;if(!this.wavesurfer)throw Error(\"WaveSurfer is not initialized\");const n=this.wavesurfer.getDuration(),s=null===(i=null===(e=this.wavesurfer)||void 0===e?void 0:e.getDecodedData())||void 0===i?void 0:i.numberOfChannels,o=new r(t,n,s);return n?this.saveRegion(o):this.subscriptions.push(this.wavesurfer.once(\"ready\",(t=>{o._setTotalDuration(t),this.saveRegion(o)}))),o}enableDragSelection(t,e=3){var n;const s=null===(n=this.wavesurfer)||void 0===n?void 0:n.getWrapper();if(!(s&&s instanceof HTMLElement))return()=>{};let o=null,a=0;return i(s,((t,e,i)=>{o&&o._onUpdate(t,i>a?\"end\":\"start\")}),(e=>{var i,n;if(a=e,!this.wavesurfer)return;const s=this.wavesurfer.getDuration(),l=null===(n=null===(i=this.wavesurfer)||void 0===i?void 0:i.getDecodedData())||void 0===n?void 0:n.numberOfChannels,{width:h}=this.wavesurfer.getWrapper().getBoundingClientRect(),d=e/h*s,c=(e+5)/h*s;o=new r(Object.assign(Object.assign({},t),{start:d,end:c}),s,l),this.regionsContainer.appendChild(o.element)}),(()=>{o&&(this.saveRegion(o),o=null)}),e)}clearRegions(){this.regions.forEach((t=>t.remove()))}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}}export{o as default};\n","class t{constructor(){this.listeners={}}on(t,e,s){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==s?void 0:s.once){const s=()=>{this.un(t,s),this.un(t,e)};return this.on(t,s),s}return()=>this.un(t,e)}un(t,e){var s;null===(s=this.listeners[t])||void 0===s||s.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}}class e extends t{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit(\"destroy\"),this.subscriptions.forEach((t=>t()))}}function s(t,e){const i=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,n]of Object.entries(e))if(\"children\"===t)for(const[t,n]of Object.entries(e))\"string\"==typeof n?i.appendChild(document.createTextNode(n)):i.appendChild(s(t,n));else\"style\"===t?Object.assign(i.style,n):\"textContent\"===t?i.textContent=n:i.setAttribute(t,n.toString());return i}function i(t,e,i){const n=s(t,e||{});return null==i||i.appendChild(n),n}const n={lineWidth:1,labelSize:11,formatTimeCallback:t=>`${Math.floor(t/60)}:${`0${Math.floor(t)%60}`.slice(-2)}`};class r extends e{constructor(t){super(t||{}),this.unsubscribe=()=>{},this.onPointerMove=t=>{if(!this.wavesurfer)return;const e=this.wavesurfer.getWrapper().getBoundingClientRect(),{width:s}=e,i=t.clientX-e.left,n=Math.min(1,Math.max(0,i/s)),r=Math.min(s-this.options.lineWidth-1,i);this.wrapper.style.transform=`translateX(${r}px)`,this.wrapper.style.opacity=\"1\";const o=this.wavesurfer.getDuration()||0;this.label.textContent=this.options.formatTimeCallback(o*n);const a=this.label.offsetWidth;this.label.style.transform=r+a>s?`translateX(-${a+this.options.lineWidth}px)`:\"\",this.emit(\"hover\",n)},this.onPointerLeave=()=>{this.wrapper.style.opacity=\"0\"},this.options=Object.assign({},n,t),this.wrapper=i(\"div\",{part:\"hover\"}),this.label=i(\"span\",{part:\"hover-label\"},this.wrapper)}static create(t){return new r(t)}addUnits(t){return`${t}${\"number\"==typeof t?\"px\":\"\"}`}onInit(){if(!this.wavesurfer)throw Error(\"WaveSurfer is not initialized\");const t=this.wavesurfer.options,e=this.options.lineColor||t.cursorColor||t.progressColor;Object.assign(this.wrapper.style,{position:\"absolute\",zIndex:10,left:0,top:0,height:\"100%\",pointerEvents:\"none\",borderLeft:`${this.addUnits(this.options.lineWidth)} solid ${e}`,opacity:\"0\",transition:\"opacity .1s ease-in\"}),Object.assign(this.label.style,{display:\"block\",backgroundColor:this.options.labelBackground,color:this.options.labelColor,fontSize:`${this.addUnits(this.options.labelSize)}`,transition:\"transform .1s ease-in\",padding:\"2px 3px\"});const s=this.wavesurfer.getWrapper();s.appendChild(this.wrapper),s.addEventListener(\"pointermove\",this.onPointerMove),s.addEventListener(\"pointerleave\",this.onPointerLeave),s.addEventListener(\"wheel\",this.onPointerMove),this.unsubscribe=()=>{s.removeEventListener(\"pointermove\",this.onPointerMove),s.removeEventListener(\"pointerleave\",this.onPointerLeave),s.removeEventListener(\"wheel\",this.onPointerLeave)}}destroy(){super.destroy(),this.unsubscribe(),this.wrapper.remove()}}export{r as default};\n","class t{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==i?void 0:i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){var i;null===(i=this.listeners[t])||void 0===i||i.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>t(...e)))}}class e extends t{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit(\"destroy\"),this.subscriptions.forEach((t=>t()))}}function i(t,e){const n=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,s]of Object.entries(e))if(\"children\"===t)for(const[t,s]of Object.entries(e))\"string\"==typeof s?n.appendChild(document.createTextNode(s)):n.appendChild(i(t,s));else\"style\"===t?Object.assign(n.style,s):\"textContent\"===t?n.textContent=s:n.setAttribute(t,s.toString());return n}function n(t,e,n){return i(t,e||{})}const s={height:20,formatTimeCallback:t=>{if(t/60>1){return`${Math.floor(t/60)}:${`${(t=Math.round(t%60))<10?\"0\":\"\"}${t}`}`}return`${Math.round(1e3*t)/1e3}`}};class r extends e{constructor(t){super(t||{}),this.options=Object.assign({},s,t),this.timelineWrapper=this.initTimelineWrapper()}static create(t){return new r(t)}onInit(){var t;if(!this.wavesurfer)throw Error(\"WaveSurfer is not initialized\");let e=this.wavesurfer.getWrapper();if(this.options.container instanceof HTMLElement)e=this.options.container;else if(\"string\"==typeof this.options.container){const t=document.querySelector(this.options.container);if(!t)throw Error(`No Timeline container found matching ${this.options.container}`);e=t}this.options.insertPosition?(e.firstElementChild||e).insertAdjacentElement(this.options.insertPosition,this.timelineWrapper):e.appendChild(this.timelineWrapper),this.subscriptions.push(this.wavesurfer.on(\"redraw\",(()=>this.initTimeline()))),((null===(t=this.wavesurfer)||void 0===t?void 0:t.getDuration())||this.options.duration)&&this.initTimeline()}destroy(){this.timelineWrapper.remove(),super.destroy()}initTimelineWrapper(){return n(\"div\",{part:\"timeline-wrapper\",style:{pointerEvents:\"none\"}})}defaultTimeInterval(t){return t>=25?1:5*t>=25?5:15*t>=25?15:60*Math.ceil(.5/t)}defaultPrimaryLabelInterval(t){return t>=25?10:5*t>=25?6:4}defaultSecondaryLabelInterval(t){return t>=25?5:2}virtualAppend(t,e,i){let n=!1;const s=(s,r)=>{if(!this.wavesurfer)return;const o=i.clientWidth,l=t>s&&t+o<r;l!==n&&(n=l,l?e.appendChild(i):i.remove())};setTimeout((()=>{var t;this.wavesurfer&&(s(0,(null===(t=this.wavesurfer)||void 0===t?void 0:t.getWidth())||0),this.subscriptions.push(this.wavesurfer.on(\"scroll\",((t,e,i,n)=>{s(i,n)}))))}),0)}initTimeline(){var t,e,i,s,r,o,l,a;const h=null!==(i=null!==(e=null===(t=this.wavesurfer)||void 0===t?void 0:t.getDuration())&&void 0!==e?e:this.options.duration)&&void 0!==i?i:0,p=((null===(s=this.wavesurfer)||void 0===s?void 0:s.getWrapper().scrollWidth)||this.timelineWrapper.scrollWidth)/h,u=null!==(r=this.options.timeInterval)&&void 0!==r?r:this.defaultTimeInterval(p),c=null!==(o=this.options.primaryLabelInterval)&&void 0!==o?o:this.defaultPrimaryLabelInterval(p),d=this.options.primaryLabelSpacing,f=null!==(l=this.options.secondaryLabelInterval)&&void 0!==l?l:this.defaultSecondaryLabelInterval(p),v=this.options.secondaryLabelSpacing,m=\"beforebegin\"===this.options.insertPosition,y=n(\"div\",{style:Object.assign({height:`${this.options.height}px`,overflow:\"hidden\",fontSize:this.options.height/2+\"px\",whiteSpace:\"nowrap\"},m?{position:\"absolute\",top:\"0\",left:\"0\",right:\"0\",zIndex:\"2\"}:{position:\"relative\"})});y.setAttribute(\"part\",\"timeline\"),\"string\"==typeof this.options.style?y.setAttribute(\"style\",y.getAttribute(\"style\")+this.options.style):\"object\"==typeof this.options.style&&Object.assign(y.style,this.options.style);const b=n(\"div\",{style:{width:\"0\",height:\"50%\",display:\"flex\",flexDirection:\"column\",justifyContent:m?\"flex-start\":\"flex-end\",top:m?\"0\":\"auto\",bottom:m?\"auto\":\"0\",overflow:\"visible\",borderLeft:\"1px solid currentColor\",opacity:`${null!==(a=this.options.secondaryLabelOpacity)&&void 0!==a?a:.25}`,position:\"absolute\",zIndex:\"1\"}});for(let t=0,e=0;t<h;t+=u,e++){const i=b.cloneNode(),n=Math.round(100*t)/100%c==0||d&&e%d==0,s=Math.round(100*t)/100%f==0||v&&e%v==0;(n||s)&&(i.style.height=\"100%\",i.style.textIndent=\"3px\",i.textContent=this.options.formatTimeCallback(t),n&&(i.style.opacity=\"1\"));const r=n?\"primary\":s?\"secondary\":\"tick\";i.setAttribute(\"part\",`timeline-notch timeline-notch-${r}`);const o=t*p;i.style.left=`${o}px`,this.virtualAppend(o,y,i)}this.timelineWrapper.innerHTML=\"\",this.timelineWrapper.appendChild(y),this.emit(\"ready\")}}export{r as default};\n","import WaveSurfer from '../../vendor/wavesurfer.js/dist/wavesurfer.js';\nimport WaveSurferShim from './waveSurferShim.js';\nimport RegionsPlugin from '../../vendor/wavesurfer.js/dist/plugins/regions.esm.js';\nimport HoverPlugin from '../../vendor/wavesurfer.js/dist/plugins/hover.esm.js';\nimport TimelinePlugin from '../../vendor/wavesurfer.js/dist/plugins/timeline.esm.js';\n\n\nlet WaveSurferClass = WaveSurfer;\nlet RegionsPluginClass = RegionsPlugin;\n\nlet RegionsPluginShim = {\n    create: function (options) {\n        return {\n            addRegion: function (options) {\n                console.log('RegionsPluginShim.addRegion', options);\n            },\n            on: function (event, callback) {\n                console.log('RegionsPluginShim.on', event, callback);\n            }\n        }\n    }\n};\n\nlet prevPeaks = null;\n\nexport default async function createWaveform(track, trackId, index, trackContainer) {\n\n    if (track.noWavesurfer) {\n        WaveSurferClass = WaveSurferShim;\n        RegionsPluginClass = RegionsPluginShim;\n    }\n\n    trackContainer = trackContainer || document.getElementById(trackId);\n\n\n    console.log('createWaveform', track, trackId, index, trackContainer);\n\n    if (!trackContainer) {\n        throw new Error(`Track container not found for trackId: ${trackId}. Cannot createWaveform()`);\n    }\n\n\n    let waveformContainer = document.getElementById(`#waveformContainer${index + 1}`);\n\n    // Overview of entire track ( zoomed out smaller size )\n    let overviewContainer = document.querySelector(`#overviewWaveform${index + 1}`);\n\n    // Detailed view of track ( zoomed in larger size )\n    let detailedContainer = document.querySelector(`#detailedWaveform${index + 1}`);\n\n    // Initialize the seeking flag\n    let isProgrammaticSeek = false;\n\n    // console.log('track.metadata.beatLength', track.metadata.beatLength)\n    // Create a timeline plugin instance with custom options\n    const topTimeline = TimelinePlugin.create({\n        height: 20,\n        insertPosition: 'beforebegin',\n        timeInterval: track.metadata.beatLength,\n        primaryLabelInterval: track.metadata.beatLength * 4,\n        secondaryLabelInterval: track.metadata.beatLength,\n        formatTimeCallback: (seconds, timeline) => {\n            // return beats and measures\n            const beats = Math.floor(seconds / track.metadata.beatLength);\n            const measures = Math.floor(beats / 4);\n            const beat = beats % 4;\n            return `${measures}:${beat}`;\n        },\n        style: {\n            fontSize: '12px',\n            color: 'white',\n        },\n    })\n\n    // Create a second timeline\n    const bottomTimeline = TimelinePlugin.create({\n        height: 10,\n        timeInterval: 0.1,\n        primaryLabelInterval: 1,\n        style: {\n            fontSize: '10px',\n            color: 'white',\n        },\n    })\n\n\n    if (!waveformContainer) {\n        waveformContainer = document.createElement('div');\n        waveformContainer.id = `waveformContainer${index}`;\n        waveformContainer.className = \"waveform-container\";\n        trackContainer.prepend(waveformContainer);\n    }\n\n\n    if (!overviewContainer) {\n        overviewContainer = document.createElement('div');\n        overviewContainer.id = `overviewWaveform${index}`;\n        overviewContainer.className = \"waveform-container-overview\";\n        waveformContainer.prepend(overviewContainer);\n    }\n\n    if (!detailedContainer) {\n        detailedContainer = document.createElement('div');\n        detailedContainer.id = `detailedWaveform${index}`;\n        detailedContainer.className = \"waveform-container-detailed\";\n        waveformContainer.prepend(detailedContainer);\n    }\n    track.detailedContainer = detailedContainer;\n\n\n    if (!track.audioBuffer) {\n        // no audio data availble we need to return placeholder div\n\n        let detailedWaveformPlaceholder = document.createElement('div');\n        detailedWaveformPlaceholder.className = \"detailed-waveform-placeholder\";\n        detailedWaveformPlaceholder.innerText = \"No audio data available\";\n        detailedContainer.prepend(detailedWaveformPlaceholder);\n\n\n        let overviewWaveformPlaceholder = document.createElement('div');\n        overviewWaveformPlaceholder.className = \"overview-waveform-placeholder\";\n        overviewWaveformPlaceholder.innerText = \"No audio data available\";\n        overviewContainer.prepend(overviewWaveformPlaceholder);\n\n\n        return { detailedWaveform: null, overviewWaveform: null, overviewContainer, detailedContainer };\n    }\n\n    let peaksData =  null;\n\n    if (!peaksData) {\n        console.log('No peaks data available, generating from audioBuffer...slow in main process. Use worker...');\n        let channelData = track.audioBuffer.getChannelData(0);\n        console.log('track.arrayBuffer', track.arrayBuffer);\n        peaksData = channelData;\n    }\n\n    let overviewRegions = RegionsPluginClass.create();\n    // Initialize the overview waveform (zoomed-out)\n    const overviewWaveform = WaveSurferClass.create({\n        sampleRate: 44100,\n        scale: 512, // I\n        showWaveform: false,\n        container: overviewContainer,\n        waveColor: 'grey',\n        autoCenter: true,\n        autoCenterImmediately: true, // fake?\n        progressColor: 'purple',\n        cursorColor: 'red',  // Hide the cursor on the overview\n        height: 55,\n        barGap: 1,\n        barWidth: 1,\n        normalize: true,\n        partialRender: true,\n        responsive: false,\n        cursorWidth: 1,\n        peaks: peaksData, // Use the first channel data for overview\n        duration: track.metadata.duration,\n        minPxPerSec: 1,  // Lower resolution for full-track view\n        scrollParent: false,\n        plugins: [\n            overviewRegions,\n            HoverPlugin.create({\n                lineColor: '#ff0000',\n                lineWidth: 2,\n                labelBackground: '#555',\n                labelColor: '#fff',\n                labelSize: '11px',\n            }),\n        ]\n    });\n\n    overviewWaveform.regions = overviewRegions;\n    const detailedRegions = RegionsPluginClass.create();\n    // Initialize the detailed waveform (zoomed-in)\n    \n    const detailedWaveform = WaveSurferClass.create({\n        showWaveform: false,\n        container: detailedContainer,\n        waveColor: 'purple',\n        autoCenter: true,\n        autoCenterImmediately: true, // fake?\n        progressColor: 'purple',\n        cursorColor: 'red',\n        media: track.audioElement,\n        height: 140,\n        // width: 560,\n        interact: true,\n        barWidth: 1,\n        barGap: 1,\n        pixelRatio: 1,\n        partialRender: true,\n        normalize: false,\n        dragToSeek: false,\n        peaks: peaksData,\n        // peaks: channelData,\n        duration: track.metadata.duration,\n        cursorWidth: 1,\n        responsive: false,\n        hideScrollbar: true,\n        minPxPerSec: 130,  // Higher resolution for detailed view\n        scrollParent: false,\n        isScrollable: false,\n        plugins: [\n            detailedRegions,\n        ]\n    });\n    detailedWaveform.regions = detailedRegions;\n\n    // console.log(\"tttt\", transport.tracks)\n    track.waveform = detailedWaveform;\n    track.detailedWaveform = detailedWaveform;\n\n    // Helper function to format time in mm:ss\n    function formatTime(seconds) {\n        const minutes = Math.floor(seconds / 60);\n        const secs = Math.floor(seconds % 60);\n        return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n    }\n\n    // Sync overview waveform position to the detailed waveform\n    detailedWaveform.on('audioprocess', () => {\n        const progress = detailedWaveform.getCurrentTime() / detailedWaveform.getDuration();\n        const currentTime = detailedWaveform.getCurrentTime();\n\n        // query document for all elements with 'time-display' class inside the context\n        // of track.transport.trackContainer\n        let timeDisplays = trackContainer.querySelectorAll('.time-display');\n        // iterate over all time-display elements\n        timeDisplays.forEach((timeDisplay) => {\n            // update the text content of each time-display element\n            timeDisplay.innerText = formatTime(currentTime);\n        });\n\n        // Only update overviewWaveform if not in a programmatic seek\n        if (!isProgrammaticSeek) {\n            isProgrammaticSeek = true;\n            overviewWaveform.seekTo(progress);\n            isProgrammaticSeek = false;\n        }\n    });\n\n    detailedWaveform.on('seeking', (progress) => {\n        //console.log(\"detailedWaveform seeking to\", progress);\n        const currentTime = detailedWaveform.getCurrentTime();\n        const duration = detailedWaveform.getDuration();\n        //console.log('Current Time', currentTime);\n        if (track.transport.detailedTimeDisplay) {\n            track.transport.detailedTimeDisplay.innerText = '-' + formatTime(currentTime);\n            track.transport.previousCueTime = currentTime;\n        }\n    });\n\n    // Event listener for drag start\n    detailedWaveform.on(\"dragstart\", (relativeX) => {\n        console.log('dragstart', relativeX)\n        detailedWaveform.pause(); // Pause playback while dragging\n    });\n\n    // Event listener for dragging\n    detailedWaveform.on(\"drag\", (relativeX) => {\n        console.log('drag', relativeX)\n        const duration = detailedWaveform.getDuration();\n        const newTime = duration * relativeX; // Calculate time based on relativeX position\n        detailedWaveform.seekTo(newTime); // Update playback position\n    });\n\n    // Event listener for drag end\n    detailedWaveform.on(\"dragend\", (relativeX) => {\n        console.log('dragend', relativeX)\n        const duration = detailedWaveform.getDuration();\n        const newTime = duration * relativeX; // Final time based on end drag position\n        detailedWaveform.seekTo(newTime); // Set final position\n        detailedWaveform.play(); // Resume playback\n    });\n\n    overviewWaveform.on('click', (e, ev) => {\n\n        // update the detailed waveform to the click position\n        let overviewWaveformPosition = overviewWaveform.getCurrentTime();\n        console.log('overviewWaveform mousedown', overviewWaveformPosition)\n        detailedWaveform.setTime(overviewWaveformPosition);\n        /*\n        const currentTimeCode = track.waveform.getCurrentTime();\n        const hostDateTime = Date.now();\n        const hostTrackUrl = track.metadata.fileName;\n        if (api.bridge && api.bridge.sendMessage) {\n            api.bridge.sendMessage('timecode', {\n                hostTrackTimeCode: currentTimeCode,\n                hostTrackUrl: hostTrackUrl,\n                hostDateTime,\n                hostTrackId: 'host-' + track.id,\n                resetSync: true,\n            });\n        }\n        */\n        return false;\n    });\n\n    overviewWaveform.on('seeking', (progress) => {\n        console.log(\"overviewWaveform seeking to\", progress);\n        //console.log('ppprogress', progress)\n        if (!isProgrammaticSeek) {\n            isProgrammaticSeek = true;\n            const pprogress = overviewWaveform.getCurrentTime() / overviewWaveform.getDuration();\n            detailedWaveform.seekTo(pprogress);\n            isProgrammaticSeek = false;\n        }\n    });\n\n    detailedWaveform.on('click', (e, ev) => {\n        console.log('detailedWaveform mousedown')\n        // check to see if the waveform is playing\n        if (detailedWaveform.isPlaying()) {\n            // play pause\n            //return;\n        }\n        track.playPause();\n        return false;\n    });\n\n    detailedWaveform.on('mouseup', () => {\n        console.log('detailedWaveform mouseup')\n        //detailedWaveform.play(); // Resume playback\n    });\n\n    console.log('before set', track.overviewWaveform);\n\n    track.overviewWaveform = overviewWaveform;\n    track.detailedWaveform = detailedWaveform;\n    track.overviewWaveform._ = track.overviewWaveform._ || {};\n\n    console.log('after set', track.overviewWaveform);\n    // Set volume and other transport properties\n    // detailedWaveform.setVolume(transport.globalVolume);\n    overviewWaveform.setVolume(0);  // Mute the overview waveform\n\n\n    return { detailedWaveform, overviewWaveform, overviewContainer, detailedContainer };\n}","export default class BPMDetectPlugin {\n\n    constructor(track) {\n        this.track = track;\n        this.bpm = 0;\n        this.audioBuffer = null;\n    }\n\n    async init(trackId, audioElement, audioContext) {\n        this.audioBuffer = this.track.audioBuffer;\n        this.duration = this.audioBuffer.duration;\n        this.trackId = trackId;\n        if (this.audioBuffer) {\n            this.trackLength = audioElement.duration;\n        }\n    }\n\n    // Method to detect BPM, can be called anytime after initialization\n    async detectBPM() {\n        let audioBuffer = this.track.audioBuffer;\n        return 125; // for now, need to add back web-audio-beat-detector, aubio is too slow\n        // Load the Aubio.js module\n        const aubioModule = await aubio();\n\n        // Create a new instance of the Tempo class\n        const sampleRate = audioBuffer.sampleRate;\n        // large files / whole files\n        let bufferSize = 1024; // Size of the buffer for each analysis frame\n        let hopSize = 512;     // Number of samples between each analysis frame\n\n        const tempo = new aubioModule.Tempo(bufferSize, hopSize, sampleRate);\n\n        // Get the audio data from the buffer\n        const audioData = audioBuffer.getChannelData(0);\n        if (!audioData || !(audioData instanceof Float32Array)) {\n            throw new Error('Invalid audio data: Ensure audio decoding is correct.');\n        }\n\n        // Process the audio data in chunks\n        for (let i = 0; i < audioData.length; i += hopSize) {\n            const frame = audioData.slice(i, i + bufferSize);\n\n            // Ensure the frame has valid data\n            if (frame.length < bufferSize) {\n                console.warn('Skipping incomplete frame at the end of audio data.');\n                continue; // Skip the final chunk if it's incomplete\n            }\n\n            const isBeat = tempo.do(frame);\n\n        }\n\n\n        // Get the estimated BPM\n        const bpm = tempo.getBpm();\n\n        console.log(`Estimated BPM: ${bpm}`);\n\n        // beatTimes is now an array of strings with the beat times in seconds\n        // conver this to an array of numbers with precision to 3 decimal places\n        // beatTimes = beatTimes.map(time => Number(parseFloat(time).toFixed(3)));\n\n        // console.log('Detected beat times (in seconds):', beatTimes);\n\n\n        return bpm;\n\n    }\n}","\nconst beatGrid = {};\n\nexport default beatGrid;\n\nbeatGrid.calculateGrid = function (track) {\n    \n    let trackDuration = track.audioBuffer.duration;\n    let bpm = track.metadata.bpm;\n    console.log('Using trackDuration', trackDuration, bpm);\n    console.log(\"beatGrid.calculateGrid    trackDuration\", track, trackDuration, bpm);\n    // throw new Error('Not implemented');\n    const secondsPerBeat = 60 / bpm;\n    const gridSnaps = [];\n\n    // Generate the beat grid based on the BPM and track duration\n    for (let i = 0; i <= trackDuration; i += secondsPerBeat) {\n        gridSnaps.push(i);\n    }\n\n    // Map the first cue point with an offset adjustment\n    // track.metadata.cuePoints = []; // Initialize cuePoints object if not defined\n    // track.metadata.cuePoints['1'] = (gridSnaps[0] + track.metadata.firstBeatOffset) / trackDuration;\n\n    /*\n    track.metadata.cuePoints.push({\n        time: (gridSnaps[0] + track.metadata.firstBeatOffset) / trackDuration,\n        type: \"start\"\n    });\n    */\n\n\n    // Calculate 3 additional cue points at 25%, 50%, and 75% of the track duration\n    const cuePositions = [0.25, 0.5, 0.75];\n    cuePositions.forEach((position, index) => {\n        // Find the closest beat in the grid to the desired position\n        let cueTime = trackDuration * position;\n        let closestBeat = gridSnaps.reduce((prev, curr) =>\n            Math.abs(curr - cueTime) < Math.abs(prev - cueTime) ? curr : prev\n        );\n        // console.log('closestBeatclosestBeat', closestBeat)\n        // Assign the cue point, e.g., cuePoints['2'], cuePoints['3'], cuePoints['4']\n            /*\n        track.metadata.cuePoints.push({\n            time: closestBeat / trackDuration,\n            type: \"cue\"\n        });\n        */\n    });\n\n    return gridSnaps;\n};\n\nbeatGrid.visualizeGrid = async function visualizeGrid(wavesurfer, gridSnaps, firstBeatOffset, showLabels = false) {\n\n    const trackDuration = wavesurfer.getDuration();\n    // console.log('visualizeGrid', trackDuration, gridSnaps, firstBeatOffset);\n    // Offset each snapTime by the firstBeatOffset\n    gridSnaps.forEach((snapTime, i) => {\n        const adjustedSnapTime = snapTime;\n        if (adjustedSnapTime <= trackDuration) {\n            let regionLabel = '';\n            \n            if (showLabels) {\n                regionLabel = document.createElement('span');\n                regionLabel.classList.add('region-label');\n                regionLabel.style.color = 'white';\n                regionLabel.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\n                regionLabel.style.border = '1px solid white';\n                regionLabel.style.borderRadius = '5px';\n                regionLabel.style.padding = '5px';\n                regionLabel.lineHeight = '1em';\n                regionLabel.textContent = i + 1;\n    \n            }\n            // new rgb color from '#aeafaf', with opacity 0.5\n            let color = 'rgba(174, 175, 175, 0.5)';\n            // console.log(\"wavesurfer.regions.addRegion\", adjustedSnapTime, regionLabel, color);\n            wavesurfer.regions.addRegion({\n                start: adjustedSnapTime,\n                content: regionLabel,\n                // end: adjustedSnapTime + 0.001,  // Short duration to mark the snap point\n                color: color,\n                drag: false,\n                resize: false,\n            });\n            \n        }\n    });\n}\n","export default async function detectCuePoints(track) {\n    console.log('detectCuePoints was called', track);\n\n    const audioContext = track.audioContext;\n    const audioElement = track.audioElement;\n\n    if (!track.audioBuffer) {\n\n    }\n\n    // Fetch and decode the audio data\n    //const audioData = await api.fetch(audioElement.src).then(response => response.arrayBuffer());\n    //const audioBuffer = await audioContext.decodeAudioData(audioData);\n    let audioBuffer = track.audioBuffer;\n\n\n\n    const duration = audioBuffer.duration;\n\n    // Create an OfflineAudioContext for analysis\n    const offlineContext = new OfflineAudioContext(1, audioBuffer.length, audioBuffer.sampleRate);\n\n    // Create a buffer source in the offline context\n    const offlineSource = offlineContext.createBufferSource();\n    offlineSource.buffer = audioBuffer;\n    offlineSource.connect(offlineContext.destination);\n\n    // Start the source and render the audio offline\n    offlineSource.start(0);\n    const renderedBuffer = await offlineContext.startRendering();\n\n    // Analyze the rendered buffer\n    const channelData = renderedBuffer.getChannelData(0);  // Use the first channel's data\n    const sampleRate = renderedBuffer.sampleRate;\n    const threshold = 0.01;  // Adjust threshold for noticeable energy spikes\n\n    // Create an Analyser node\n    const analyser = offlineContext.createAnalyser();\n    analyser.fftSize = 1024;\n    offlineSource.connect(analyser);\n    const frequencyData = new Float32Array(analyser.frequencyBinCount);\n\n    // Approach 1: Using the track's metadata.beatGrid to segment the track into sections\n    const beatGrid = track.metadata.beatGrid;  // Assuming beatGrid is an array of beats (e.g., [0, 1, 2, 3, 4, 5...])\n    const cuePointsFromBeatGrid = generateCuePointsFromBeatGrid(beatGrid, duration);\n\n    // Approach 2: Perform energy-based audio analysis to detect interesting cue points\n    const cuePointsFromAudio = await analyzeAudioForCuePoints(channelData, sampleRate, analyser, frequencyData, threshold);\n\n    // Combine both approaches and select the top 8 cue points\n    let allCuePoints = [...cuePointsFromBeatGrid /*, ...cuePointsFromAudio*/];\n\n    // allCuePoints = await analyzeAudioForAmplitudeChanges(track, channelData, sampleRate, track.metadata, threshold);\n    //allCuePoints = await analyzeAudioForFFT(track, channelData, sampleRate, track.metadata, threshold);\n\n\n    const uniqueCuePoints = Array.from(new Set(allCuePoints));  // Ensure no duplicate cue points\n    const sortedCuePoints = uniqueCuePoints.sort((a, b) => a - b);  // Sort cue points by their timestamps\n\n\n    //let caculatedCuePoints = generateCuePointsFromCommonSongStructure(beatGrid, duration);\n    //return caculatedCuePoints;\n    // Limit to 8 cue points\n    // const finalCuePoints = sortedCuePoints.slice(0, 8);\n    const finalCuePoints = allCuePoints;\n\n   // console.log('Generated Cue Points:', finalCuePoints);\n\n    return finalCuePoints;\n}\nfunction generateCuePointsFromCommonSongStructure(beatGrid, duration) {\n    const cuePoints = [];\n\n    // Determine the duration of one bar in seconds\n    const beatsPerBar = 4;  // Assuming 4/4 time signature\n    const totalBeats = beatGrid.length;  // Total number of beats in the track\n    \n    // Estimate the beats per second (BPS) by dividing total beats by track duration\n    const beatsPerSecond = totalBeats / duration;\n\n    // Calculate the time for each cue point at evenly spaced intervals along the duration\n    const numberOfCuePoints = 8;  // We want 8 cue points\n\n    // Divide the track duration into 8 equal parts, each part representing the position of a cue point\n    for (let i = 0; i < numberOfCuePoints; i++) {\n        const targetTime = (i + 1) * duration / numberOfCuePoints;\n\n        // Find the closest beat to the target time using beatsPerSecond\n        const targetBeat = targetTime * beatsPerSecond;\n        const cuePointTime = getTimeForBeat(targetBeat, beatGrid, totalBeats);\n\n        if (cuePointTime !== null) {\n            cuePoints.push(cuePointTime);\n        }\n    }\n    // console.log(\"RETURNING\", cuePoints)\n    // Return the 8 cue points\n    return cuePoints;\n}\n\nfunction getTimeForBeat(targetBeat, beatGrid, totalBeats) {\n    // If the target beat exceeds the available beats in the grid, return null\n    if (targetBeat > beatGrid[totalBeats - 1]) {\n        return null;\n    }\n\n    // Find the closest beat in the beat grid\n    for (let i = 0; i < beatGrid.length; i++) {\n        if (beatGrid[i] >= targetBeat) {\n            return beatGrid[i];\n        }\n    }\n    return null;  // In case no beat is found (should not happen with correct data)\n}\n\n\nfunction generateCuePointsFromBeatGrid(beatGrid) {\n    console.log('generateCuePointsFromBeatGrid was called')\n    if (!beatGrid || beatGrid.length === 0) {\n        throw new Error(\"Invalid beatGrid: empty or null.\");\n    }\n\n    const cuePoints = [];\n    for (let i = 0; i < beatGrid.length; i++) {\n        // Only create cue points at intervals of 64 beats\n        if (i % 64 !== 0) {\n            continue;\n        }\n\n        let cueType = 'cue';\n        if (i === 0) {\n            cueType = 'start';\n        }\n\n        // Use the exact beatGrid value as the cue point\n        const cueTime = beatGrid[i];\n        cuePoints.push({\n            time: cueTime,\n            type: cueType,\n        });\n    }\n    return cuePoints;\n}\n\n\n// Analyze audio data to find interesting cue points (e.g., spikes, build-ups, drops)\n\n\n/*\n\n\n\n3. **Frequency Analysis for \"Interesting\" Sections**:\n   - Perform a **Fourier Transform** (or a simplified version) on each frame to extract dominant frequencies and overall frequency energy distribution.\n   - Look for distinct shifts in frequency patterns:\n      - *Bass Drop Detection*: If the low-frequency energy (e.g., around 20-150 Hz) suddenly spikes or dips, it could indicate the start or end of a **bass-heavy section**.\n      - *Buildup Identification*: If high frequencies (above 500 Hz) consistently rise, this could indicate a buildup leading to a drop.\n      - *Verse and Hook Segments*: Identify sections with varied frequency patterns that differ from the repetitive bass or drum patterns, suggesting a verse or hook. Verses often have a more stable, balanced frequency distribution, while hooks might have more intense or complex frequency arrangements.\n\n\n*/\nasync function analyzeAudioForAmplitudeChanges(track, channelData, sampleRate, trackMetadata, threshold) {\n    const cuePoints = [];\n    //const windowSize = Math.floor(track.metadata.beatLength / 50 * sampleRate);  // Align window to one beat\n    //let windowSize = Math.floor(0.5 * sampleRate);\n    //windowSize = Math.floor(0.2 * sampleRate);\n    const windowSize = 1024;  // Use a fixed window size for analysis\n\n    // TODO: calculate all averages of each window\n\n    const stepSize = windowSize / 2;  // Use half-beat steps for finer resolution\n    const dropThreshold = 0.50;  // Drop threshold as a percentage (e.g., 50%)\n\n    let lastAverageAmplitude = 0;\n    let inBreakdown = false;\n\n    for (let i = 0; i < channelData.length; i += stepSize) {\n        // Calculate average amplitude for the current window\n        let sumAmplitude = 0;\n        for (let j = i; j < i + windowSize && j < channelData.length; j++) {\n            sumAmplitude += Math.abs(channelData[j]);\n        }\n        const averageAmplitude = sumAmplitude / windowSize;\n //       console.log(averageAmplitude, 'averageAmplitude', lastAverageAmplitude, 'lastAverageAmplitude');\n        // Check for significant drop in amplitude (possible breakdown start)\n        if (!inBreakdown && averageAmplitude < lastAverageAmplitude * dropThreshold) {\n            // console.log('BREAKDOWN START', i / sampleRate);\n            cuePoints.push({\n                time: i / sampleRate,\n                type: \"breakdown start\"\n            });\n            inBreakdown = true;\n        }\n\n        // Check for return of amplitude after breakdown (possible breakdown end)\n        if (inBreakdown && averageAmplitude >= lastAverageAmplitude * dropThreshold) {\n            cuePoints.push({\n                time: i / sampleRate,\n                type: \"breakdown end\"\n            });\n            inBreakdown = false;\n        }\n\n        // Update lastAverageAmplitude for the next iteration\n        lastAverageAmplitude = averageAmplitude;\n    }\n\n    // console.log('analyzeAudioForAmplitudeChanges cuePoints', cuePoints);\n\n    return cuePoints;\n}\n\n\n/*\n\n\n\n    Write pseudo code that will find the best areas of interest in a song to set cue points.\n    This will be done by making some assumptions about frequency data and energy levels in the song.\n    Then figuring out start and end points and using those as cue points.\n\n*/\nasync function analyzeAudioForCuePoints(channelData, sampleRate, analyser, frequencyData, threshold) {\n    const cuePoints = [];\n    const windowSize = 1024;\n    // TODO: align windowSize to beatLength / beatGrid\n    //     const windowSize = Math.floor(trackMetadata.beatLength * sampleRate);  // Align window to one beat\n\n    const stepSize = windowSize / 4;\n\n    let energy = 0;\n    let lastEnergy = 0;\n    let isSpike = false;\n    const spikeThreshold = 1.5;  // Example spike threshold\n\n    for (let i = 0; i < channelData.length; i += stepSize) {\n        analyser.getFloatFrequencyData(frequencyData);\n        \n        // Calculate energy in low frequencies (e.g., bass)\n        const lowFrequencyEnergy = frequencyData.slice(0, 50).reduce((sum, val) => sum + val, 0);\n\n        if (lowFrequencyEnergy > threshold) {\n            // Detect energy spikes\n            if (lowFrequencyEnergy > lastEnergy * spikeThreshold) {\n                // High energy spike\n                cuePoints.push(i / sampleRate);  // Mark this time as a cue point\n                isSpike = true;\n            }\n            lastEnergy = lowFrequencyEnergy;\n        }\n\n        // Detect breakdowns or other interesting sections\n        if (!isSpike && lowFrequencyEnergy < threshold) {\n            // A quiet section after a spike could indicate a breakdown\n            cuePoints.push(i / sampleRate);  // Mark this time as a cue point\n        }\n\n        isSpike = false;  // Reset spike detection\n    }\n\n    return cuePoints;\n}\n","import detectBPMClass from './detectBPM.js';\nimport detectKey from './detectKey.js';\nimport detectFirstBeatOffset from './detectFirstBeatOffset.js';\nimport beatGrid from './beatGrid.js';\nimport detectCuePoints from './detectCuePoints.js';\nimport detectID3 from './detectID3.js';\n\nexport default async function stripeTrack(t) {\n\n    console.log(\"stripe.stripeTrack - striping track\", t);\n    let loadingText;\n\n    if (t.trackElement) {\n        loadingText = t.trackElement.querySelector('.loading-text');\n    }\n\n    if (typeof t.metadata.title === 'undefined') {\n        // track has not been striped at all, id3 tags not processed\n        console.log(\"CALCULATING ID3 TAGS FOR \", t.metadata.fileName)\n        if (loadingText) {\n            loadingText.innerText = \"Detecting ID3 Tags.\\n\";\n        }\n\n        console.log('ttttt prob not defined here', t.blob)\n\n        try {\n            const id3Info = await detectID3(t.blob);\n\n            console.log('id3Info', id3Info);\n    \n            let id3Props = ['title', 'artist', 'album', 'year', 'genre', 'initialKey', 'bpm', 'duration'];\n            id3Props.forEach(prop => {\n                if (typeof id3Info[prop] !== 'undefined') {\n                    t.metadata[prop] = id3Info[prop];\n                }\n            });\n            console.log('ID3 set props', t.metadata);\n    \n        } catch (err) {\n            console.error('Error reading ID3 tags:', err);\n            // there is no id3 data, set title to filename\n            t.metadata.title = t.metadata.fileName;\n\n        }\n    }\n\n    // check bpm first ( todo: firstBeatOffset here as well )\n    if (typeof t.metadata.bpm !== 'number') {\n        console.log(\"CALCULATING BPM FOR \", t.metadata.fileName)\n        // TODO: await stripe.detectBPM(t);\n        let detectBPM = new detectBPMClass(t);\n        await detectBPM.init(t.id, t.audioElement, t.audioContext);\n        let bpm;\n        try {\n            bpm = await detectBPM.detectBPM();\n            // round bpm to 2 decimal places, if 0.99, round up\n            bpm = Math.round(bpm * 100) / 100;\n            if (bpm % 1 !== 0) {\n                bpm = Math.ceil(bpm);\n            }\n            t.metadata.bpm = bpm;\n\n            console.log(`Detected BPM for track ${t.metadata.fileName}: ${bpm}`);\n        } catch (err) {\n            console.error('Error detecting BPM', err);\n        }\n\n        //track.duration = detectBPM.duration;\n        //track.bpm = bpm;\n\n\n    } else {\n        console.log(\"BPM ALREADY FOUND FOR \", t.metadata.fileName, t.metadata.bpm)\n    }\n\n\n    // check to see if there is an initialKey\n    let forceInitialKeyRestripe = true;\n    if (forceInitialKeyRestripe || typeof t.metadata.initialKey === 'undefined') {\n        console.log(\"CALCULATING KEY FOR \", t.metadata.fileName)\n        let estimatedKey = await detectKey(t.audioBuffer);\n        // t.metadata.initialKey = estimatedKey;\n        console.log('estimatedKey', estimatedKey);\n\n        const traktorKey = mapKeyToTraktor(estimatedKey);\n        console.log(`Detected Key: ${estimatedKey}, Traktor Key: ${traktorKey}`);\n        console.log('current initialKey', t.metadata.initialKey);\n\n        let adjustedKey = adjustToTraktorKey(traktorKey);\n        console.log('adjustedKey', adjustedKey);\n\n        // TODO: save the adjustedKey to the track metadata\n        t.metadata.initialKey = adjustedKey;\n\n    }\n\n    console.log(\"ATTEMPTING TO CALCULATE FIRST BEAT OFFSET AND DURATION FOR \", t.metadata.fileName, t.metadata);\n    // Check to see if we already have a firstBeatOffset and duration calculated\n    if (typeof t.metadata.firstBeatOffset !== 'number' || typeof t.metadata.duration !== 'number') {\n\n        if (loadingText) {\n            loadingText.innerText = \"Detecting First Beat Offset and Duration for first time.\\n This may take a moment\";\n        }\n\n        console.log(\"CALCULATING firstBeatOffset and duration \", t.metadata.fileName, 'existing', t.metadata);\n        console.log('ty', typeof t.metadata.firstBeatOffset, typeof t.metadata.duration)\n        const { firstBeatOffset, duration } = await detectFirstBeatOffset(t);\n        t.metadata.duration = t.audioBuffer.duration;\n        t.metadata.firstBeatOffset = firstBeatOffset;\n    } else {\n        console.log(\"firstBeatOffset and duration ALREADY FOUND FOR \", t.metadata.fileName, t.metadata)\n    }\n\n        // Check to see if we already have a beatgrid calculated\n        let firstBeatOffset = t.metadata.firstBeatOffset;\n\n    let newBeatGridAlgo = false;\n\n    // This will use new beatgrid algo via aubio.js\n    // Might not be as good? Needs work with phaseLock now that grids aren't aligned?\n    if (newBeatGridAlgo) {\n        let gridSnaps = t.metadata.beatGrid;\n\n        if (!gridSnaps || gridSnaps.length === 0) {\n            console.log(\"CALCULATING BEATGRID FOR \", t.metadata.fileName, t.audioBuffer)\n\n            console.log('loadingText', loadingText)\n            // update the textContent to \"Detecting Beat Grid\"\n            if (loadingText) {\n                loadingText.innerText = \"Detecting Beat Grid for first time.\\n This may take a moment\";\n            }\n\n            let result = await detectBeats(t.audioBuffer);\n            gridSnaps = result.beatTimes;\n            console.log('calculated gridSnaps', gridSnaps);\n            t.metadata.beatGrid = gridSnaps;\n        }\n\n\n\n    } else {\n        // Calculate the beatgrid and visualize it\n        let gridSnaps = t.metadata.beatGrid;\n        console.log(\"BBB CALCULATING BEATGRID FOR \", t.metadata.fileName, gridSnaps)\n        if (!gridSnaps || gridSnaps.length === 0) {\n            //console.log(\"CALCULATING BEATGRID FOR \", t.metadata.fileName)\n            gridSnaps = beatGrid.calculateGrid(t);\n            console.log(\"CALCULATED BEATGRID FOR \", t.metadata.fileName, gridSnaps)\n            // console.log('calculated gridSnaps', gridSnaps);\n            t.metadata.beatGrid = gridSnaps;\n            // Set default gridLength based on calculated values\n            t.metadata.beatLength = gridSnaps[1] - gridSnaps[0];\n        } else {\n            console.log(\"BEATGRID ALREADY FOUND FOR \", t.metadata.fileName, gridSnaps)\n        }\n\n\n        // Take the firstBeatOffset and add it to each value in the gridSnaps array\n        // this is much easier further in the API than having to add it each time at run-time\n        console.log('what are gridSnaps', gridSnaps)\n        t.metadata.beatGrid = gridSnaps.map((snap) => snap + firstBeatOffset);\n\n    }\n\n    // Remark: May want to move cuePoints further up in logic\n    let cuePoints = t.metadata.cuePoints;\n\n    if (typeof cuePoints === 'undefined' || cuePoints.length === 0) {\n        console.log(\"CALCULATING CUEPOINTS FOR \", t.metadata.fileName)\n        // Detect the cue points and visualize them\n        cuePoints = await detectCuePoints(t);\n        t.metadata.cuePoints = cuePoints;\n    } else {\n        console.log(\"CUEPOINTS ALREADY FOUND FOR \", t.metadata.fileName, cuePoints)\n    }\n\n    t.metadata.cuePoints = cuePoints;\n\n};\n\n\n\n\nfunction normalizeKey(inputKey) {\n    // Split the input key into note and type (e.g., \"Eb Minor\" -> \"Eb\", \"Minor\")\n    const [note, type] = inputKey.split(\" \");\n\n    if (!note || !type) {\n        console.error(`Invalid key format: \"${inputKey}\"`);\n        return null;\n    }\n\n    // Normalize the type (e.g., \"Minor\" -> \"min\", \"Major\" -> \"maj\")\n    const normalizedType = type.toLowerCase() === \"minor\" ? \"min\" : \"maj\";\n\n    // Return the normalized key (e.g., \"Ebmin\" or \"C#maj\")\n    return `${note}${normalizedType}`;\n}\n\nfunction mapKeyToTraktor(inputKey) {\n    // Normalize the input key\n    const normalizedKey = normalizeKey(inputKey);\n\n    if (!normalizedKey) {\n        console.error(`Failed to normalize key: \"${inputKey}\"`);\n        return null;\n    }\n\n    // Find the Traktor key from the keyMap\n    const traktorKey = keyMap[normalizedKey];\n    if (!traktorKey) {\n        console.error(`Key \"${normalizedKey}\" not found in keyMap.`);\n        return null;\n    }\n\n    return traktorKey;\n}\n\n\nconst keyMap = {\n    // Minor Keys\n    \"Amin\": \"8m\", \"Bbmin\": \"3m\", \"Bmin\": \"10m\",\n    \"Cmin\": \"5m\", \"C#min\": \"12m\", \"Dbmin\": \"12m\", // Dbmin = C#min\n    \"Dmin\": \"7m\", \"Ebmin\": \"2m\", \"Emin\": \"9m\",\n    \"Fmin\": \"4m\", \"F#min\": \"11m\", \"Gbmin\": \"11m\", // Gbmin = F#min\n    \"Gmin\": \"6m\", \"Abmin\": \"1m\", \"G#min\": \"1m\",  // G#min = Abmin\n\n    // Major Keys\n    \"Amaj\": \"11d\", \"Bbmaj\": \"6d\", \"Bmaj\": \"1d\",\n    \"Cmaj\": \"8d\", \"C#maj\": \"3d\", \"Dbmaj\": \"3d\",  // Dbmaj = C#maj\n    \"Dmaj\": \"10d\", \"Ebmaj\": \"5d\", \"Emaj\": \"12d\",\n    \"Fmaj\": \"7d\", \"F#maj\": \"2d\", \"Gbmaj\": \"2d\",  // Gbmaj = F#maj\n    \"Gmaj\": \"9d\", \"Abmaj\": \"4d\", \"G#maj\": \"4d\"   // G#maj = Abmaj\n};\n\n\n\n\nfunction adjustToTraktorKey(libKeyFinderKey) {\n    const relativeKeys = {\n        // Minor Keys (m)\n        \"1m\": \"5m\",  // Ab Minor -> C Minor\n        \"2m\": \"6m\",  // Eb Minor -> G Minor\n        \"3m\": \"7m\",  // Bb Minor -> D Minor\n        \"4m\": \"8m\",  // F Minor -> A Minor\n        \"5m\": \"9m\",  // C Minor -> E Minor\n        \"6m\": \"10m\", // G Minor -> B Minor\n        \"7m\": \"11m\", // D Minor -> F# Minor\n        \"8m\": \"12m\", // A Minor -> C# Minor\n        \"9m\": \"1m\",  // E Minor -> Ab Minor\n        \"10m\": \"2m\", // B Minor -> Eb Minor\n        \"11m\": \"3m\", // F# Minor -> Bb Minor\n        \"12m\": \"4m\", // C# Minor -> F Minor\n\n        // Major Keys (d)\n        \"1d\": \"5d\",  // Ab Major -> C Major\n        \"2d\": \"6d\",  // Eb Major -> G Major\n        \"3d\": \"7d\",  // Bb Major -> D Major\n        \"4d\": \"8d\",  // F Major -> A Major\n        \"5d\": \"9d\",  // C Major -> E Major\n        \"6d\": \"10d\", // G Major -> B Major\n        \"7d\": \"11d\", // D Major -> F# Major\n        \"8d\": \"12d\", // A Major -> C# Major\n        \"9d\": \"1d\",  // E Major -> Ab Major\n        \"10d\": \"2d\", // B Major -> Eb Major\n        \"11d\": \"3d\", // F# Major -> Bb Major\n        \"12d\": \"4d\"  // C# Major -> F Major\n    };\n\n    return relativeKeys[libKeyFinderKey] || libKeyFinderKey; // Default to original key if no mapping exists\n}","// Function to read ID3 tags from a file Blob\nexport default async function detectID3Tags(blob) {\n    try {\n        return new Promise((resolve, reject) => {\n            jsmediatags.read(blob, {\n                onSuccess: function (tag) {\n                    // console.log('readID3Tags onSuccess', tag);\n\n                    const id3Info = {};\n                    const tagMappings = {\n                        title: 'title',\n                        artist: 'artist',\n                        album: 'album',\n                        year: 'year',\n                        genre: 'genre',\n                        track: 'trackNumber',\n                        TBPM: 'bpm',\n                        TKEY: 'key',\n                        COMM: 'comment',\n                        TCON: 'genre',\n                        TLEN: 'duration',\n                        TPE1: 'artist',\n                        TPE2: 'band',\n                        TPOS: 'discNumber',\n                        TIT1: 'group',\n                        TIT2: 'title',\n                        TIT3: 'subtitle',\n                        TYER: 'year',\n                        TDAT: 'date',\n                        TIME: 'time',\n                        TORY: 'originalYear',\n                        TXXX: 'userDefined',\n                        WXXX: 'userDefinedUrl',\n                        TCMP: 'compilation',\n                        TENC: 'encodedBy',\n                        TFLT: 'fileType',\n                        TMED: 'mediaType',\n                        TMOO: 'mood',\n                        TPE3: 'conductor',\n                        TPE4: 'remixer',\n                    };\n                \n                    // Generic tag extraction\n                    for (const [tagKey, infoKey] of Object.entries(tagMappings)) {\n                        const value = tag.tags[tagKey]?.data || tag.tags[tagKey];\n                        if (value) id3Info[infoKey] = value;\n                    }\n                \n                    // Special case for POPM (Popularimeter) tag\n                    if (tag.tags.POPM) {\n                        const popm = tag.tags.POPM;\n                        if (typeof popm.rating === 'number') {\n                            // Map rating from 0-255 to a 5-star system\n                            id3Info.rating = Math.round((popm.rating / 255) * 5);\n                        }\n                        id3Info.playCount = popm.counter || 0; // Optional play count\n                    }\n                \n                    // console.log('Extracted ID3 Info:', id3Info);\n\n\n                    resolve(id3Info);\n                },\n                onError: function (error) {\n                    console.error('Error reading ID3 tags:', error);\n                    reject(error);\n                }\n            });\n        });\n    } catch (error) {\n        console.error('Failed to fetch the file:', error);\n        throw error;\n    }\n}\n","export default async function detectKey (audioBuffer) {\n    return new Promise((resolve, reject) => {\n        const keyFinderWorker = new Worker('/v5/apps/based/audio-stripe/vendor/keyFinderProgressiveWorker.js');\n        const channelData = extractAudioBuffer(audioBuffer);\n\n        // Initialize the worker\n        keyFinderWorker.postMessage({\n            funcName: 'initialize',\n            data: [audioBuffer.sampleRate, audioBuffer.numberOfChannels],\n        });\n\n        // Send audio data in segments to the worker\n        channelData.forEach((segment) => {\n            keyFinderWorker.postMessage({\n                funcName: 'feedAudioData',\n                data: [segment],\n            });\n        });\n\n        // Signal the worker to perform final detection\n        keyFinderWorker.postMessage({ funcName: 'finalDetection' });\n\n        // Listen for worker messages\n        keyFinderWorker.onmessage = (event) => {\n            console.log('keyFinderWorker event', event);\n\n            if (event.data && event.data.data instanceof Uint8Array) {\n                // Decode the result\n                const decoder = new TextDecoder(); // Decodes Uint8Array into a string\n                const detectedKey = decoder.decode(event.data.data);\n                console.log('Detected Key:', detectedKey);\n                resolve(detectedKey); // Resolve the promise with the detected key\n                keyFinderWorker.terminate(); // Clean up the worker\n            } else if (event.data.type === 'error') {\n                console.error('Error detecting key:', event.data.error);\n                reject(new Error(event.data.error)); // Reject the promise on error\n                keyFinderWorker.terminate(); // Clean up the worker\n            } else {\n                console.warn('Unexpected message from keyFinderWorker:', event.data);\n            }\n        };\n\n        // Handle worker errors\n        keyFinderWorker.onerror = (error) => {\n            console.error('Worker encountered an error:', error);\n            reject(error); // Reject the promise on error\n            keyFinderWorker.terminate(); // Clean up the worker\n        };\n    });\n};\n\n\n\n // Extract channel data from AudioBuffer\n function extractAudioBuffer(audioBuffer) {\n    const channelData = [];\n    for (let i = 0; i < audioBuffer.numberOfChannels; i++) {\n        channelData.push(audioBuffer.getChannelData(i));\n    }\n    return channelData;\n}\n\n\n\n","export default async function detectFirstBeatOffset(track) {\n    // console.log('detectFirstBeatOffset', track);\n\n    const audioContext = track.audioContext;\n    const audioElement = track.audioElement;\n\n    // Fetch and decode the audio data\n    //const audioData = await api.fetch(audioElement.src).then(response => response.arrayBuffer());\n    //const audioBuffer = await audioContext.decodeAudioData(audioData);\n    const audioData = track.audioData;\n    const audioBuffer = track.audioBuffer;\n\n    const duration = audioBuffer.duration;\n\n    // Create an OfflineAudioContext for analysis\n    const offlineContext = new OfflineAudioContext(1, audioBuffer.length, audioBuffer.sampleRate);\n\n    // Create a buffer source in the offline context\n    const offlineSource = offlineContext.createBufferSource();\n    offlineSource.buffer = audioBuffer;\n    offlineSource.connect(offlineContext.destination);\n\n    // Start the source and render the audio offline\n    offlineSource.start(0);\n    const renderedBuffer = await offlineContext.startRendering();\n\n    // Analyze the rendered buffer\n    const channelData = renderedBuffer.getChannelData(0);  // Use the first channel's data\n    const sampleRate = renderedBuffer.sampleRate;\n    const threshold = 0.01;  // Adjust threshold for a more noticeable beat spike\n\n    // Sliding window analysis to detect the first beat\n    let firstBeatOffset = 0;\n    const windowSize = 512;  // Similar to fftSize\n    const stepSize = windowSize / 4;\n\n    // Create an Analyser node\n    const analyser = offlineContext.createAnalyser();\n    analyser.fftSize = windowSize;\n    offlineSource.connect(analyser);\n\n    // Analyze frequency data within each window\n    const frequencyData = new Float32Array(analyser.frequencyBinCount);\n    // let firstBeatOffset = 0;\n    const lowFrequencyRange = 50;  // Focus on first 50 bins for low frequencies\n\n    for (let i = 0; i < channelData.length; i += stepSize) {\n        analyser.getFloatFrequencyData(frequencyData);\n\n        const lowFrequencyEnergy = frequencyData.slice(0, lowFrequencyRange).reduce((sum, val) => sum + val, 0);\n        if (lowFrequencyEnergy > threshold) {\n            firstBeatOffset = i / sampleRate;\n            break;\n        }\n    }\n\n\n\n    for (let i = 0; i < channelData.length; i += stepSize) {\n        const window = channelData.slice(i, i + windowSize);\n\n        // Check if any sample in the window exceeds the threshold\n        if (window.some(value => Math.abs(value) > threshold)) {\n            firstBeatOffset = i / sampleRate;\n            // console.log(`Detected first beat offset at: ${firstBeatOffset} seconds`);\n            break;\n        }\n    }\n\n    return { firstBeatOffset, duration };\n}\n","//import transport from '../../../transport.js';\n//import timecode from '../../../timecode.js';\n//import api from '../../../api.js';\n//import beatGrid from '../../../plugins/beatGrid.js';\nimport WaveForms from \"./waveform/WaveForms.js\";\nimport hasTrackMetadata from '../../../audio-stripe/lib/hasTrackMetadata.js';\nimport stripeTrack from '../../../audio-stripe/lib/stripeTrack.js';\nimport beatGrid from '../../../audio-stripe/lib/beatGrid.js';\nimport CuePoints from './waveform/CuePoints.js';\n// response for taking in fresh track data and rendering it\n// reloading it into the same track\n\n// stubs\nconst api = {\n    track: {\n        getTitle: (track) => {\n            return track.metadata.title;\n        },\n        playPause: (trackId, button) => {\n            console.log('playpPause', trackId, button);\n        },\n        play: (trackId) => {\n            console.log('play', trackId);\n        },\n        pause: (trackId) => {\n            console.log('pause', trackId);\n        },\n        unload: (trackId) => {\n            console.log('unload', trackId);\n        },\n        isPlaying: () => {\n            return false;\n        }\n    },\n    helpers: {\n        formatTime: (time) => {\n            return time;\n        }\n    },\n    addonManager: {\n        initAddon: () => {}\n    }\n};\n\nconst automator = {\n    updateAutomation: () => {}\n};\n\n\n\n\nexport default async function defaultDatabind(track) {\n    let t = track;\n    let container = track.element;\n    console.log(\"Loading the track\", t, container)\n\n    let hasMetadata = hasTrackMetadata(track.metadata)\n    if (!hasMetadata.hasMetadata && track.audioBuffer) { // don't attempt to stripe unless there is data\n        console.error(\"Track is missing metadata\", hasMetadata.missing);\n        //return;\n\n        await stripeTrack(track);\n    }\n    console.log(\"HAS METADATA\", hasMetadata)\n    // re-render is simple data binding to class names of elements\n    // be sure to use common classnames and structures between renderers to keep code clean\n    // t.load() *will* need to be called again ( now that is has fileName it should work )\n    // will most likely need separate code paths below to deal with both cases\n    // case 1. loading track data into an existing track\n    // case 2. loading track data into a new track\n\n    // Assume all elements already exist and just update their content\n\n    //\n    // Mobile view: TODO: move this to separate layout ( switch layout on media query)\n    //\n    /*\n    const songTitle = container.querySelector('.mobile-song-name');\n    songTitle.textContent = api.track.getTitle(t) || 'Unknown Track';\n\n    const songBPM = container.querySelector('.mobile-song-bpm');\n    songBPM.textContent = `BPM: ${t.metadata.bpm || 'n/a'}`;\n\n    const songKey = container.querySelector('.mobile-song-key');\n    songKey.textContent = `Key: ${t.metadata.initialKey || 'n/a'}`;\n\n    const songEnergy = container.querySelector('.mobile-song-energy');\n    songEnergy.textContent = `Energy: ${t.metadata.rating || 'n/a'}`;\n\n    const songCurrentTime = container.querySelector('.mobile-song-current-time');\n    // Update with current time if necessary or leave static if this is handled elsewhere\n\n    const songDuration = container.querySelector('.mobile-song-duration');\n    songDuration.textContent = api.helpers.formatTime(t.metadata.duration);\n    */\n    // Track\n\n\n    // Update the title display\n    let titleElement = container.querySelector('.titleElement');\n    let titleText = track.getTitle(t);\n\n    titleElement.textContent = titleText || 'Unknown Track';\n    // Update tags display\n    let tagsElement = container.querySelector('.tags-display');\n    //tagsElement.textContent = t.metadata.tags.join(', ') || 'No Tags';\n\n    // Update time display\n    let detailedTimeDisplay = container.querySelector('.time-display');\n    detailedTimeDisplay.innerText = '00:00'; // Update this dynamically as needed\n\n    // Update current track BPM display\n    let currentTrackBpm = container.querySelector('.current-bpm');\n    currentTrackBpm.innerText = t.metadata.bpm ? Number(t.metadata.bpm).toFixed(2) : 'N/A';\n\n    // Update key text\n    let keyText = container.querySelector('.key-text');\n    keyText.innerText = t.metadata.initialKey || 'N/A';\n\n    // Update time duration\n    let detailedTimeDuration = container.querySelector('.time-duration');\n    detailedTimeDuration.innerText = formatTime(t.metadata.duration);\n\n    // Update track BPM\n    let trackBpm = container.querySelector('.bpm-text');\n    trackBpm.innerText = t.metadata.bpm ? Number(t.metadata.bpm).toFixed(2) : 'N/A';\n\n    // Update BPM percentage display\n    let trackBpmPercentage = container.querySelector('.bpm-percentage');\n    trackBpmPercentage.innerText = '0%'; // Update this dynamically as needed\n\n    // render the waveforms\n\n    // remove existing waveform placeholders ( if exists )\n    let oldWaveforms = container.querySelectorAll('.waveform-container');\n\n    if (oldWaveforms.length) {\n        oldWaveforms.forEach(waveform => waveform.remove());\n    }\n\n\n    console.log(\"Creating waveform for track\", t, container)\n    let resp = await WaveForms(t, t.id, 1, container);\n    let { detailedWaveform, overviewWaveform, overviewContainer, detailedContainer } = resp;\n    console.log('Waveform created:', detailedWaveform, overviewWaveform, overviewContainer, detailedContainer);\n    if (t.noWavesurfer) {\n        detailedContainer.style.display = 'none';\n        overviewContainer.style.display = 'none';\n    }\n\n    if (t.audioBuffer && t.metadata.beatGrid) {\n\n        setTimeout(() => {\n            console.log('beatGrid.visualizeGrid', t.metadata.beatGrid, t.metadata.firstBeatOffset);\n            beatGrid.visualizeGrid(detailedWaveform, t.metadata.beatGrid, t.metadata.firstBeatOffset);\n            CuePoints.renderCuePoints(detailedWaveform, t, '#8a2be2', t.metadata.beatLength / 8, {\n                color: '#aeafaf',\n                backgroundColor: 'rgba(0, 0, 0, 0.5)',\n                border: '1px solid white',\n                borderRadius: '5px',\n                paddingLeft: '5px',\n                paddingRight: '5px',\n                marginLeft: '5px',\n                lineHeight: '1em',\n            });\n            CuePoints.renderCuePoints(overviewWaveform, t, '#8a2be2', t.metadata.beatLength * 2, {\n                color: '#aeafaf',\n                backgroundColor: 'rgba(0, 0, 0, 0.5)',\n                border: '0.2em thin white',\n                borderRadius: '5px',\n                marginLeft: '5px',\n                marginRight: '5px',\n            });\n    \n            // timecode.snapToBeat(t);\n\n        }, 10);\n\n    }\n\n\n};\n\nfunction formatTime(seconds) {\n    const minutes = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n}","export default function hasTrackMetadata (metadata) {\n    const requiredProps = ['title', 'initialKey', 'bpm', 'firstBeatOffset', 'duration', /* 'beatGrid', 'cuePoints'*/ ];\n\n    if (!metadata) {\n        return {\n            hasMetadata: false,\n            missing: requiredProps\n        };\n    }\n\n    // console.log(\"WHACK\", metadata)\n    const missing = requiredProps.filter(prop => {\n        if (prop === 'firstBeatOffset' || prop === 'duration') {\n            return typeof metadata[prop] !== 'number';\n        } else if (prop === 'beatGrid' || prop === 'cuePoints') {\n            return !Array.isArray(metadata[prop]) || metadata[prop].length === 0;\n        } else {\n            return typeof metadata[prop] === 'undefined';\n        }\n    });\n\n    if (missing.length > 0) {\n        return {\n            hasMetadata: false,\n            missing\n        };\n    }\n\n    return {\n        hasMetadata: true\n    };\n};\n","const KeyboardBindings = {\n    deckControlMappings: {\n        deckA: {},\n        deckB: {}\n    },\n    eventListener: null,\n};\n\n/**\n * Generate key bindings for a given track.\n */\nfunction createDeckBindings(track, deck) {\n    if (deck === 'deckA') {\n        return {\n            '1': () => track.cueTo(1),\n            '2': () => track.cueTo(2),\n            '3': () => track.cueTo(3),\n            '4': () => track.cueTo(4),\n            'w': () => track.playPause()\n        };\n    } else if (deck === 'deckB') {\n        return {\n            '5': () => track.cueTo(1),\n            '6': () => track.cueTo(2),\n            '7': () => track.cueTo(3),\n            '8': () => track.cueTo(4),\n            's': () => track.playPause()\n        };\n    }\n    return {};\n}\n\n/**\n * Binds keyboard controls to the given track and deck.\n */\nKeyboardBindings.bindKeys = function (track, deck = 'deckA') {\n    if (!track || !deck) {\n        console.error('Track instance and deck name are required for binding keys.');\n        return;\n    }\n\n    this.unbindKeys(deck); // Ensure no duplicate bindings\n    this.deckControlMappings[deck] = createDeckBindings(track, deck);\n\n    this.eventListener = (e) => {\n        if (this.deckControlMappings[deck][e.key]) {\n            e.preventDefault();\n            this.deckControlMappings[deck][e.key]();\n        }\n    };\n\n    document.addEventListener('keydown', this.eventListener);\n};\n\n/**\n * Unbinds all keyboard events for a given deck.\n */\nKeyboardBindings.unbindKeys = function (deck = 'deckA') {\n    if (this.eventListener) {\n        document.removeEventListener('keydown', this.eventListener);\n        this.eventListener = null;\n    }\n    if (deck && this.deckControlMappings[deck]) {\n        this.deckControlMappings[deck] = {};\n    }\n};\n\nexport default KeyboardBindings;\n","import AudioTrack from '../audio-track/AudioTrack.js';\nimport pvrtybvxRenderer from '../audio-track/render/pvrtybvx/render.js';\nimport pvrtybvxDatabind from '../audio-track/render/pvrtybvx/databind.js';\nimport DeckKeyboardBindings from './lib/DeckKeyboardBindings.js';\n\nexport default class AudioPlayer {\n  constructor(bp, config) {\n    this.bp = bp;\n    this.config = config;\n    this.container = config.container;\n    this.audioTracks = [];\n  }\n\n  async init() {\n    console.log(\"AudioPlayer init\", this.config);\n\n    // create a new track\n    this.track = new AudioTrack({\n    });\n\n    // set the renderer based on user preference\n    this.track.setRenderer('pvrtybvx', {\n      render: pvrtybvxRenderer,\n      databind: pvrtybvxDatabind\n    });\n\n    // render the track\n    let trackElement = await this.track.render();\n    console.log('rendered audio track', trackElement);\n    this.track.element = trackElement;\n    // append the track to the container\n    this.container.appendChild(trackElement);\n\n    // bind keyboard controls to the track\n    DeckKeyboardBindings.bindKeys(this.track);\n\n\n  }\n\n  async play () {\n    await this.track.play();\n  }\n\n  // load a new track by URL, defaulting to this.config.url if no URL is provided\n  async load(url) {\n\n    console.log(\"AudioPlayer load\", url);\n\n\n    // load the track\n    await this.track.load({\n      url: url\n    });\n\n    console.log('created audio track', this.track);\n\n    // databind the track after rendering and loading\n    await this.track.databind(this.track.element);\n\n  }\n\n  // unload the current track and unbind keyboard controls\n  async unload() {\n    console.log(\"AudioPlayer unload\");\n    await this.track.unload();\n    DeckKeyboardBindings.unbindKeys(this.track);\n  }\n\n  // close the AudioPlayer and unload all tracks\n  async close() {\n    console.log(\"AudioPlayer close\");\n    await this.track.unload();\n    DeckKeyboardBindings.unbindKeys(this.track);\n  }\n}","const AudioPlayerBindings = {\n    eventListener: null,\n    bindings: {\n        'n': (bp) => bp.open('audio-player'),\n        'p': (bp) => bp.open('audio-player', { context: 'playlist' })\n    }\n};\n\n/**\n * Binds keyboard controls for the audio player.\n */\nAudioPlayerBindings.bindKeys = function (bp, controller = 'keyboard') {\n    if (!bp) {\n        console.error('Audio player instance is required for binding keys.');\n        return;\n    }\n    \n    this.unbindKeys(); // Ensure no duplicate bindings\n\n    this.eventListener = (e) => {\n        if (this.bindings[e.key]) {\n            e.preventDefault();\n            this.bindings[e.key](bp);\n        }\n    };\n\n    document.addEventListener('keydown', this.eventListener);\n};\n\n/**\n * Unbinds all keyboard events.\n */\nAudioPlayerBindings.unbindKeys = function () {\n    if (this.eventListener) {\n        document.removeEventListener('keydown', this.eventListener);\n        this.eventListener = null;\n    }\n};\n\nexport default AudioPlayerBindings;","let logo = document.createElement(\"h1\");\nlogo.classList.add(\"logo\");\nlogo.textContent = \"PVRTY BVX\";\n\n\nexport default [\n  \n    {\n        label: logo,\n        submenu: [\n            { label: 'Device Settings', click: () => api.ui.toggleDeviceSettings() }, // auto-load and play if empty\n            { type: 'separator' },\n\n            { label: 'Play Deck A - [ W ] Key', click: () => api.track.playPause('deckA', null, true) }, // auto-load and play if empty\n\n            { label: 'Play Deck B - [ S ] Key', click: () => api.track.playPause('deckB', null, true) },\n\n            { type: 'separator' },\n            { label: 'Next Song [ N ]', click: () => api.transport.nextTrack() },\n            { label: 'New Sampler [ M ]', click: () => api.sampler.load() },\n            { type: 'separator' },\n            { label: 'AutoDJ [ O ] ', click: () => api.toggleAutoDJ() },\n\n            { label: 'Phase Lock [ P ] ', click: () => api.togglePhaseLock() },\n            { label: 'Party [ I ]', click: () => api.party() },\n            { type: 'separator' },\n            { label: 'Login', className: 'loggedOut', click: () => api.bp.apps.buddylist.init() },\n            { label: 'Logout', className: 'loggedIn', click: () => api.bp.apps.buddylist.logout() },\n        ],\n    },\n\n    // View Menu\n    {\n        label: 'View',\n        submenu: [\n            {\n                label: 'Layouts', submenu: [\n                    { label: 'Default', click: () => api.ui.switchLayout('default') },\n                    { label: 'Perform', click: () => api.ui.switchLayout('perform') },\n                    { label: 'Minimal', click: () => api.ui.switchLayout('minimal') },\n                    { label: 'Create custom layout', disabled: true },\n                ]\n            },\n            { type: 'separator' },\n            { label: 'Transport', click: (ev) => api.ui.toggleTransport(ev) },\n            { label: 'Library', click: (ev) => api.ui.toggleLibrary(ev) },\n            { label: 'Playlist', click: (ev) => api.ui.togglePlaylist(ev) },\n            { label: 'Social Hub', click: () => api.ui.toggleSocialHubDisplay() },\n            { type: 'separator' },\n            { id: \"menubar-set-window-as-background\", label: 'Set Window as Background', click: () => api.ui.setActiveWindowAsBackground(), disabled: true, title: 'Requires an open Window element' },\n            // restore background window\n            { id: \"menubar-restore-background-window\", label: 'Restore Background Window', click: () => api.ui.restoreBackgroundWindows(), disabled: true },\n            { type: 'separator' },\n            { label: 'Toggle Effects', click: () => console.log('Toggle Effects') },\n            { label: 'Auto-hide Menubar', id: 'menu-bar-autohide', click: () => api.ui.toggleAutoHideMenuBar() },\n            { label: 'Enter Fullscreen', click: () => api.ui.toggleFullscreen() },\n        ],\n    },\n\n    // Library Menu (custom for DJ app)\n    {\n        label: 'Library',\n        submenu: [\n            // export library file\n            { label: 'Analyze Tracks', click: () => console.log('Analyze Tracks') },\n            { label: 'Search Library', click: (ev) => api.ui.toggleLibrary(ev) },\n            { type: 'separator' },\n            // load library file\n            { label: 'Import Songs', click: () => api.transport.importLibraryComponent.toggle() },\n            { type: 'separator' },\n            // stripe all tracks\n            { label: 'Check Consistency', click: () => api.library.showCheckConsistency() },\n            { type: 'separator' },\n            { label: 'Switch Library', click: () => api.ui.switchLibrary.toggle() },\n            { label: 'Export Library', click: () => api.library.download() },\n\n        ],\n    },\n    {\n        label: 'Vibes',\n        submenu: [\n            { label: 'Show Vibes', click: () => api.ui.vibeSelector.toggle() },\n            { label: 'Edit Vibes', click: () => api.ui.vibeEditor.toggle() },\n        ],\n    },\n\n    // Sampler\n    {\n        label: { label: 'New Sampler', click: () => api.sampler.load() },\n    },\n\n    // Addons\n    {\n        label: 'Addons',\n        submenu: [\n            { label: 'Install Addon from URL...', disabled: true, click: () => console.log('Install Addon from URL') },\n            //separator\n            { type: 'separator' },\n            { label: 'Manage Addons', click: () => toggleAddonModal(), disabled: true },\n            { type: 'separator' },\n\n            { label: 'Ultimate Air Horn', id: 'addon-ultimate-air-horn', click: () => api.ui.toggleAirhornWindow() },\n\n            { type: 'separator' },\n\n            { label: 'Audio Visualizer', id: 'addon-audio-visualizer', click: () => toggleAddon('audio-visualizer', './addons') },\n            { label: 'Audio Visualizer Fractal', id: 'addon-audio-visualizer-fractal', click: () => toggleAddon('audio-visualizer-fractal', './addons') },\n            { label: 'Audio Visualizer Particles', id: 'addon-audio-visualizer-particles', click: () => toggleAddon('audio-visualizer-particles', './addons') },\n            // { label: 'Audio Visualizer Oscilloscope', id: 'addon-audio-visualizer-oscilloscope', click: () => toggleAddon('audio-visualizer-oscilloscope', './addons') },\n\n        ],\n    },\n   \n    // Help Menu\n    {\n        label: 'Help',\n        submenu: [\n            //{ label: 'Documentation', click: () => console.log('Open Documentation') },\n            { label: 'Keyboard Shortcuts', disabled: true, click: () => console.log('Open Keyboard Shortcuts') },\n            // { label: 'Check for Updates...', click: () => console.log('Check for Updates') },\n            //    { type: 'separator' },\n            { label: 'About', click: () => confirm('Pvrty Bvx is Awesome!') },\n        ],\n    },\n];","import AudioPlayerClass from './AudioPlayer.js';\nimport PlayerKeyboardBindings from './lib/PlayerKeyboardBindings.js';\n\nimport menuBarConfig from './lib/menuBarConfig.js';\n\n\nexport default class AudioPlayer {\n  constructor(bp) {\n    this.bp = bp;\n    this.AudioPlayer = AudioPlayerClass;\n  }\n\n  async init() {\n    console.log(\"AudioPlayer init\");\n    await this.bp.appendCSS('/v5/apps/based/audio-track/render/pvrtybvx/style.css', false, true);\n\n    // window.webAudioBeatDetector = {};\n    // TODO: move this to audio-stripe.js\n    // await this.bp.importModule('/v5/apps/based/audio-stripe/vendor/web-audio-beat-detector.js', {}, false);\n    //await this.bp.appendScript('/v5/apps/based/audio-stripe/vendor/web-audio-beat-detector.js');\n    ///await this.bp.appendScript('https://unpkg.com/web-audio-beat-detector@8.2.20/build/es5/bundle.js');\n    await this.bp.appendScript('/v5/apps/based/audio-stripe/vendor/jsmediatags.min.js');\n    // let aubio = await this.bp.importModule('/v5/apps/based/audio-stripe/vendor/aubio.js', {}, false);\n    //let webAudioBeatDetector = await this.bp.importModule('/v5/apps/based/audio-stripe/vendor/web-audio-beat-detector.js', {}, false);\n    //window.webAudioBeatDetector = webAudioBeatDetector.default;\n\n\n    // window.aubio = aubio.default;\n\n\n\n    // adds a document click handler that will revert the menuBar to default if clicked\n    // anywhere outside of the menuBar or any of the audioPlayer windows\n    $(document).on('click', (e) => {\n      let menuBar = this.bp.apps.menubar;\n      let audioPlayers = this.audioPlayers;\n      let clickedOnAudioPlayer = false;\n      let clickedOnMenuBar = false;\n      let clickedOnWindow = false;\n\n      // check if the click was on the menuBar\n      if ($(e.target).closest('#menuBar').length) {\n        clickedOnMenuBar = true;\n      }\n\n      // check if the click was on an audioPlayer window\n      audioPlayers.forEach((ap) => {\n        // check for data-type=audioPlayer\n        if ($(e.target).closest(`[data-type=\"audioPlayer\"]`).length) {\n          clickedOnAudioPlayer = true;\n        }\n      });\n\n      // if the click was not on the menuBar or an audioPlayer window, revert to default menu\n      if (!clickedOnMenuBar && !clickedOnAudioPlayer) {\n        // menuBar.setDefaultMenu();\n      }\n      \n      if (clickedOnAudioPlayer) {\n        // menuBar.setMenu(\"customMenu\", menuBarConfig);\n      }\n\n    });\n    this.audioPlayers = [];\n\n  }\n\n  play() {\n    alert('play'); \n  }\n\n  load(song) {\n    alert(JSON.stringify(song));\n  }\n\n  async open(config) {\n    console.log(\"AudioPlayer open\", config);\n    PlayerKeyboardBindings.bindKeys(this.bp);\n    let playerId = 'audio-player-' + this.audioPlayers.length;\n    let menuBar = this.bp.apps.menubar;\n\n    // TODO: this should trigger on open and unload on close / onfocus\n    // menuBar.setMenu(\"customMenu\", menuBarConfig);\n\n    let audioPlayerWindow = this.bp.apps.ui.windowManager.createWindow({\n      id: playerId,\n      title: 'Audio Player',\n      icon: `desktop/assets/images/icons/icon_audio-player_64.png`,\n      x: 250,\n      y: 75,\n      width: 980,\n      height: 360,\n      minWidth: 200,\n      minHeight: 200,\n      parent: $('#desktop')[0],\n      type: 'audioPlayer',\n      resizable: true,\n      minimizable: true,\n      maximizable: true,\n      closable: true,\n      focusable: true,\n      maximized: false,\n      minimized: false,\n      onClose: () => {\n        // find the audio player and close it\n        let audioPlayer = this.audioPlayers.find((ap) => {\n          return ap.id === playerId;\n        });\n        audioPlayer.close();\n        let menuBar = this.bp.apps.menubar;\n\n        menuBar.setDefaultMenu();\n        PlayerKeyboardBindings.unbindKeys(this.bp);\n      }\n    });\n    console.log('new win', this.audioPlayerWindow)\n\n    config.url = 'v5/apps/based/audio-player/vendor/One%20More%20Night%20[MetroGnome%20Remix].mp3';\n\n    config.container = audioPlayerWindow.content;\n    // if this is the first time, create the audio player and load a file\n    let audioPlayer = new AudioPlayerClass(this.bp, config);\n    audioPlayer.id = playerId;\n\n    // TODO: audioPlayer.load()\n    // TODO: audioPlayer.unload()\n    await audioPlayer.init();\n    await audioPlayer.load(config.url, {});\n\n    this.audioPlayers.push(audioPlayer);\n\n    await audioPlayer.play();\n    // creates or opens a new window\n    // if config.context has audio file, load it\n\n  }\n\n  createAudioPlayer(config) {\n    let p = new this.AudioPlayer(config);\n    // this.tracks.push(t);\n    return p;\n  }\n\n}"],"names":["defaultRender","track","container","document","createElement","className","fileName","textContent","metadata","appendChild","playPauseButton","addEventListener","console","log","isPlaying","pause","play","WebworkerFetchWithProgress","constructor","workerScript","this","worker","Worker","requests","onmessage","event","type","id","progress","data","error","request","onProgress","resolve","reject","fetch","url","options","Math","random","toString","substr","Promise","postMessage","FetchInWebWorker","bp","init","fetchWithProgress","HTTPAudioProvider","fetchInWebWorker","loadAudioData","response","arrayBuffer","arrayBufferResponse","blob","blobResponse","Track","AudioTrack","cuePoints","provider","source","audioNodes","Map","element","renderers","currentRenderer","isLoaded","isRendered","prototype","load","async","noFile","loadingProgress","_processAudioData","_setupMediaSource","isIOS","test","navigator","userAgent","window","MSStream","audioElement","src","URL","createObjectURL","duration","resolveLoad","rejectLoad","mediaSource","MediaSource","sourceBuffer","addSourceBuffer","audioBuffer","appendBuffer","err","endsWith","_initializeAudioElements","Audio","crossOrigin","preservesPitch","audioData","audioContext","decodeAudioData","fileSize","length","channelData","i","numberOfChannels","push","getChannelData","extractAudioBuffer","_decodeAudioWithFFmpeg","ffmpeg","FFmpeg","inputFileName","outputFileName","writeFile","fetchFile","exec","outputData","readFile","sampleRate","frameCount","AudioContext","createBuffer","interleaved","Float32Array","buffer","j","copyToChannel","Error","message","emit","loadingComplete","eventListeners","fx","webkitAudioContext","masterBus","createGain","distributionNode","createMediaElementSource","disconnect","connect","destination","gain","value","analyzers","setRenderer","unload","waveform","destroy","clear","close","databind","remove","unrender","name","renderFunction","set","renderer","get","render","setData","_updateRenderedData","switchLayout","rendererName","has","addNode","node","removeNode","_reconnectAudioGraph","delete","addAnalyzer","analyzer","removeAnalyzer","_initializeAudio","_loadAudioFile","lastNode","forEach","paused","playPause","setTime","time","currentTime","cueTo","cueNumber","cueTime","setCuePoint","cue","callback","on","toggleMute","muted","toggleKeyLock","mute","transport","volumeSliderIcon","classList","add","unmute","setVolume","volume","getTitle","trackTitle","title","artist","replace","split","join","createTopTrackControls","titleElement","titleContainer","titleText","style","overflow","textOverflow","createTitleDisplay","tagsElement","keyTag","innerText","key","note","bpmTag","bpm","Number","toFixed","genreTag","genre","artistTag","addTag","createTagsDisplay","dataContainer","detailedTimeDisplay","currentTrackBpm","keyText","initialKey","detailedTimeDuration","trackBpm","setBPM","trackBpmPercentage","fontSize","keyLockButton","innerHTML","contains","renderCuePoint","color","barWidth","backgroundColor","border","borderRadius","paddingLeft","paddingRight","marginLeft","lineHeight","beatLength","cuePoint","point","regionLabel","ev","target","api","preventDefault","stopPropagation","adjustedCueTime","regions","addRegion","start","end","content","drag","resize","getAudioBuffer","currentBPM","playbackRate","round","setPlaybackRate","detailedContainer","querySelector","CuePoints","renderCuePoints","cueControls","cueControlsContainer","cueButtons","createCueButtons","cueButton","createCueButton","isMappedToCuePoint","cueIndex","dataset","getCurrentTime","detailedWaveform","t","querySelectorAll","button","CueControls","createCueControls","createSliderComponent","trackId","config","SliderComponent","thumbClassName","labelClassName","orientation","trackColor","thumbColor","trackWidth","trackHeight","thumbWidth","thumbHeight","showLabel","showScale","showCenterLine","centerLineColor","centerLineLength","scaleLineLength","centerLineWidth","centerLineSpacing","progressBarColor","progressBarSize","minValue","maxValue","step","defaultValue","onDoubleClick","setValue","onClick","onChange","val","formatLabel","bind","trackLength","parseInt","sliderContainer","background","width","height","centerLine","position","left","top","createLine","line","opacity","center","spacing","offset","showProgress","progressBar","zIndex","sliderThumb","cursor","sliderThumbStyles","Object","keys","initialPosition","sliderLabel","transform","display","isDragging","e","getValue","_onChange","touches","applyEQ3","gainValue","eqNodes","lowshelf","createBiquadFilter","peaking","highshelf","frequency","Q","eqNode","warn","createFilterComponent","eq3Container","filterContainer","filterEqSwitch","filterSlider","sliderComponent","resonance","max","min","filterNode","maxFrequency","normalizedValue","pow","Filter","append","label","rect","getBoundingClientRect","scaledWidth","scaledHeight","clientY","updateProgressBar","updateLabel","clientX","propigate","clampedValue","range","LoopControls","loopButtons","currentStartIndex","visibleCount","selectedBeat","createContainer","buttonsWrapper","createButtonsWrapper","leftButton","createNavButton","rightButton","wrapper","buttonsContainer","direction","scrollButtons","createLoopButtons","createLoopButton","updateVisibleButtons","beat","formatBeatText","setLoopBeat","isLooping","newBeatButton","newBeat","parseFloat","updateActiveLoop","btn","activeButton","find","loopBeat","startLoop","index","setBeat","scrollToButton","click","targetButton","targetIndex","indexOf","loopRegion","regionOutHandler","stopLoop","getContainer","previousBeat","loopDuration","currentPosition","closestBeat","gridSnaps","beatGrid","loopEnd","loopStart","loop","region","looping","loopStartTime","un","setTimeout","createTransportButtons","transportUtilButtonsContainer","cloneBtn","open","createCloneTrackButton","getElementById","nextTrackBtn","tracks","createNextTrackButton","openSuggestionsBtn","ui","toggleLibrary","el","createOpenSuggestionsButton","closeBtn","createCloseButton","createTrackControls","trackContainer","body","rightTrackControls","topTrackControls","SongInfo","leftControls","eq3","eqContainer","sliderHi","EQ3","sliderMid","sliderLo","eqSliderContainer","justifyContent","alignItems","gap","filter","rightControls","tempoSlider","Slider","bpmRangeEnd","TempoSlider","deckLabel","currentDeck","loopControls","lc","playPauseCueButtons","buttons","right","bottom","PlayPauseCue","volumeSlider","marginRight","VolumeSlider","transportButtons","TransportButtons","bottomRow","EventEmitter","listeners","listener","Set","once","unsubscribeOnce","_a","unAll","eventName","args","__awaiter","thisArg","_arguments","P","generator","fulfilled","next","rejected","result","done","then","apply","Decoder","decode","audioCtx","finally","firstChannel","some","n","absN","abs","channel","normalize","copyFromChannel","AudioBuffer","renderNode","tagName","xmlns","createElementNS","entries","createTextNode","assign","setAttribute","Fetcher","fetchBlob","progressCallback","requestInit","status","statusText","headers","reader","getReader","contentLength","receivedLength","processChunk","percentage","read","watchProgress","clone","Player","super","isExternalMedia","media","mediaControls","controls","autoplay","onMediaEvent","removeEventListener","getSrc","currentSrc","revokeSrc","startsWith","revokeObjectURL","canPlayType","setSrc","newSrc","Blob","setMediaElement","ended","getDuration","getVolume","getMuted","setMuted","getPlaybackRate","isSeeking","seeking","rate","preservePitch","getMediaElement","setSinkId","sinkId","__rest","s","p","hasOwnProperty","call","getOwnPropertySymbols","propertyIsEnumerable","Renderer","timeouts","isScrollable","resizeObserver","lastContainerWidth","subscriptions","parent","parentFromOptionsContainer","div","shadow","initHtml","scrollContainer","canvasWrapper","progressWrapper","initEvents","HTMLElement","getClickPosition","x","y","dragToSeek","initDrag","scrollLeft","scrollWidth","clientWidth","startX","endX","ResizeObserver","delay","createDelay","onContainerResize","catch","observe","reRender","onDrag","onStart","onEnd","threshold","mouseButton","touchDelay","isTouchDevice","matchMedia","matches","unsubscribeDocument","onPointerDown","startY","touchStartTime","Date","now","onPointerMove","dx","dy","onPointerUp","onPointerLeave","relatedTarget","documentElement","onTouchMove","passive","capture","makeDraggable","_","__","getHeight","optionsHeight","optionsSplitChannel","isNaN","clientHeight","every","overlay","attachShadow","mode","splitChannels","setOptions","newParent","getWrapper","getWidth","getScroll","setScroll","pixels","setScrollPercentage","percent","scrollStart","_b","unsubscribe","unsubscribeOnScroll","delayMs","timeout","onClear","clearTimeout","resolveFn","rejectFn","undefined","convertColorValues","Array","isArray","canvasElement","ctx","getContext","gradientHeight","devicePixelRatio","gradient","createLinearGradient","colorStopPercentage","addColorStop","getPixelRatio","renderBarWaveform","vScale","topChannel","bottomChannel","canvas","halfHeight","pixelRatio","barGap","barRadius","barIndexScale","rectFn","beginPath","prevX","maxTop","maxBottom","topBarHeight","barHeight","barAlign","magnitudeTop","magnitudeBottom","fill","closePath","renderLineWaveform","_options","drawChannel","hScale","moveTo","lineTo","renderWaveform","fillStyle","waveColor","from","reduce","renderSingleCanvas","canvasContainer","progressContainer","progressCanvas","cloneNode","progressCtx","drawImage","globalCompositeOperation","progressColor","fillRect","renderMultiCanvas","totalWidth","singleCanvasWidth","MAX_CANVAS_WIDTH","drawnIndexes","totalBarWidth","floor","draw","numCanvases","clampedWidth","map","slice","ceil","viewPosition","startCanvas","canvasIndex","MAX_NODES","renderChannel","channelIndex","marginTop","minHeight","parentWidth","minPxPerSec","useParentWidth","fillParent","overflowX","toggle","hideScrollbar","cursorColor","cursorWidth","channels","before","after","delta","zoom","scrollIntoView","progressWidth","startEdge","endEdge","middle","minGap","autoCenter","newScroll","renderProgress","percents","clipPath","autoScroll","exportImage","format","quality","canvases","images","toDataURL","all","toBlob","Timer","arguments","requestAnimationFrame","stop","WebAudioPlayer","bufferNode","playStartTime","playedDuration","_muted","_playbackRate","_duration","gainNode","_play","createBufferSource","currentPos","onended","_pause","stopAt","timeSeconds","deviceId","wasPlaying","mimeType","getGainNode","numChannels","defaultOptions","interact","WaveSurfer","create","backend","audioRate","plugins","decodedData","mediaSubscriptions","abortController","timer","initPlayerEvents","initRendererEvents","initTimerEvents","initPlugins","initialUrl","peaks","updateProgress","relativeX","relativeY","seekTo","scrollRight","debounce","debounceTime","plugin","registerPlugin","unsubscribePlayerEvents","_init","setScrollTime","getActivePlugins","loadAudio","fetchParams","AbortController","signal","audioDuration","staticDuration","loadBlob","getDecodedData","exportPeaks","maxLength","precision","maxChannels","sampleSize","sample","Infinity","toggleInteraction","isInteractive","skip","seconds","empty","abort","BasePlugin","onInit","wavesurfer","dom","WaveSurferShim","showWaveform","_setupMediaListeners","_createCanvas","_renderWaveform","_startAnimationLoop","samples","_downsampleData","clearRect","strokeStyle","lineWidth","centerY","stroke","_updateProgress","globalAlpha","update","_emit","_startProgress","_stopProgress","progressInterval","setInterval","clearInterval","_timeUpdateTimeout","shim","e$2","r","o","a","l","h","d","c","u","v","g","m","f","b","r$2","totalDuration","minLength","contentEditable","clampPosition","channelIdx","initElement","setContent","setPart","renderPosition","initMouseEvents","addResizeHandles","wordBreak","part","borderLeft","borderRight","onResize","onEndResizing","removeResizeHandles","removeChild","boxSizing","transition","pointerEvents","toggleCursor","onMove","onContentClick","onContentBlur","_onUpdate","parentElement","focus","_setTotalDuration","padding","regionsContainer","initRegionsContainer","includes","getRegions","avoidOverlapping","adjustScroll","virtualAppend","saveRegion","enableDragSelection","clearRegions","t$2","e$1","labelSize","formatTimeCallback","r$1","offsetWidth","addUnits","lineColor","labelBackground","labelColor","timelineWrapper","initTimelineWrapper","insertPosition","firstElementChild","insertAdjacentElement","initTimeline","defaultTimeInterval","defaultPrimaryLabelInterval","defaultSecondaryLabelInterval","timeInterval","primaryLabelInterval","primaryLabelSpacing","secondaryLabelInterval","secondaryLabelSpacing","whiteSpace","getAttribute","flexDirection","secondaryLabelOpacity","textIndent","WaveSurferClass","RegionsPluginClass","RegionsPlugin","RegionsPluginShim","BPMDetectPlugin","detectBPM","detectCuePoints","offlineContext","OfflineAudioContext","offlineSource","renderedBuffer","startRendering","analyser","createAnalyser","fftSize","frequencyData","frequencyBinCount","cuePointsFromBeatGrid","cueType","generateCuePointsFromBeatGrid","stepSize","windowSize","lastEnergy","isSpike","spikeThreshold","getFloatFrequencyData","lowFrequencyEnergy","sum","analyzeAudioForCuePoints","allCuePoints","sort","stripeTrack","loadingText","trackElement","id3Info","jsmediatags","onSuccess","tag","tagMappings","album","year","TBPM","TKEY","COMM","TCON","TLEN","TPE1","TPE2","TPOS","TIT1","TIT2","TIT3","TYER","TDAT","TIME","TORY","TXXX","WXXX","TCMP","TENC","TFLT","TMED","TMOO","TPE3","TPE4","tagKey","infoKey","tags","POPM","popm","rating","playCount","counter","onError","detectID3","prop","detectBPMClass","estimatedKey","keyFinderWorker","funcName","segment","Uint8Array","detectedKey","TextDecoder","terminate","onerror","detectKey","traktorKey","inputKey","normalizedKey","normalizedType","toLowerCase","normalizeKey","keyMap","mapKeyToTraktor","adjustedKey","libKeyFinderKey","firstBeatOffset","detectFirstBeatOffset","calculateGrid","snap","trackDuration","secondsPerBeat","prev","curr","visualizeGrid","showLabels","snapTime","adjustedSnapTime","Amin","Bbmin","Bmin","Cmin","Dbmin","Dmin","Ebmin","Emin","Fmin","Gbmin","Gmin","Abmin","Amaj","Bbmaj","Bmaj","Cmaj","Dbmaj","Dmaj","Ebmaj","Emaj","Fmaj","Gbmaj","Gmaj","Abmaj","defaultDatabind","hasMetadata","requiredProps","missing","hasTrackMetadata","minutes","secs","padStart","formatTime","oldWaveforms","resp","noWavesurfer","waveformContainer","overviewContainer","isProgrammaticSeek","TimelinePlugin","timeline","beats","prepend","detailedWaveformPlaceholder","overviewWaveformPlaceholder","overviewWaveform","peaksData","overviewRegions","scale","autoCenterImmediately","partialRender","responsive","scrollParent","HoverPlugin","detailedRegions","timeDisplay","previousCueTime","newTime","overviewWaveformPosition","pprogress","WaveForms","KeyboardBindings","deckControlMappings","deckA","deckB","eventListener","bindKeys","deck","unbindKeys","w","createDeckBindings","AudioPlayer$1","audioTracks","pvrtybvxRenderer","pvrtybvxDatabind","DeckKeyboardBindings","AudioPlayerBindings","bindings","context","controller","logo","AudioPlayer","AudioPlayerClass","appendCSS","appendScript","$","apps","menubar","audioPlayers","closest","ap","alert","song","JSON","stringify","PlayerKeyboardBindings","playerId","audioPlayerWindow","windowManager","createWindow","icon","minWidth","resizable","minimizable","maximizable","closable","focusable","maximized","minimized","onClose","setDefaultMenu","audioPlayer","createAudioPlayer"],"mappings":"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"}