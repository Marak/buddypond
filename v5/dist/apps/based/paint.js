class t{constructor(t,n={}){return this.bp=t,this.output=null,this.icon="/desktop/assets/images/icons/icon_paint_64.png",this}async init(){this.bp.log("Hello from Paint");let t=this.bp.load("/v5/apps/based/paint/paint.html");return this.html=await t,"loaded Paint"}async open(t={}){let n=this;if(!this.paintWindow){this.paintWindow=this.bp.apps.ui.windowManager.createWindow({id:"paint",title:"Paint",x:50,y:100,width:750,height:520,minWidth:200,minHeight:200,parent:$("#desktop")[0],icon:this.icon,content:this.html,resizable:!0,minimizable:!0,maximizable:!0,closable:!0,focusable:!0,maximized:!1,minimized:!1,onClose:()=>{this.paintWindow=null}}),console.log("checkings embed params",t),t.src?$("#paintIframe",this.paintWindow.content).attr("src","/v5/apps/based/paint/vendor/index.html#load:"+encodeURI(t.src)):$("#paintIframe",this.paintWindow.content).attr("src","/v5/apps/based/paint/vendor/index.html"),$(".sendPaint",this.paintWindow.content).on("click",(function(){$(this).hasClass("updateGif")?n.send({action:"insert"}):n.send({action:"replace"})})),$(".sendGifStudio",this.paintWindow.container).on("click",(function(){let t=$(this).data("action");n.send({action:t})})),Object.keys(localStorage).forEach((function(t){-1!==t.search("image#")&&localStorage.removeItem(t)})),t.output?n.output=t.output:n.output="localhost",t.context?n.context=t.context:n.context="file-system",$(".paintOutputTarget").html(n.output+"/"+n.context),n.output&&"localhost"!==n.output?($(".sendPaintHolder .sendPaint").html("SEND PAINT"),$(".sendPaintHolder").show()):$(".sendPaintHolder").hide(),"gifstudio"===n.output||($(".sendPaint",this.paintWindow.content).show(),$(".sendGifStudio",this.paintWindow.content).hide());let e=window.addEventListener?"addEventListener":"attachEvent";(0,window[e])("attachEvent"==e?"onmessage":"message",(function(t){let n=t[t.message?"message":"data"];console.log("got event from paint",n),"app_paint_needs_close"===n&&JQDX.closeWindow("#window_paint")}),!1)}return this.paintWindow}}t.prototype.send=function(t){let n=this;$(".sendPaint").attr("disabled",!0);let e=Object.keys(localStorage),i=null,o=null;if(e.forEach((function(t){-1!==t.search("image#")&&(i=localStorage.getItem(t),o=t)})),!o)return console.log("FAILED TO FIND IMAGE IN LOCALSTORAGE. SOMEONE PLEASE FIX JSPAINT INTEGRATION"),void $(".touchPaint").show();$(".touchPaint").hide();let a=this.output,s=this.context;setTimeout((function(){"pond"!==a&&"buddy"!==a||bp.apps.client.api.sendSnaps(a,s,"I sent a Paint",i,100,"paint",(function(t,i){if(t)return alert("Issue sending Paint. Please try again or contact support."),desktop.log(t),void $(".sendPaint").attr("disabled",!1);e.forEach((function(t){-1!==t.search("image#")&&(localStorage.removeItem(t),console.log("clearing key",o))})),n.paintWindow.close();let d={to:s,from:bp.me,type:a,text:i};console.log("sending multimedia message",d),bp.emit("buddy::sendMessage",d),$(".sendPaint").attr("disabled",!1)}))}),333)};export{t as default};
//# sourceMappingURL=paint.js.map
