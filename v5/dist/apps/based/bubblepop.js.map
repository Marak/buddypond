{"version":3,"file":"bubblepop.js","sources":["../../../apps/based/bubblepop/bubblepop.js"],"sourcesContent":["export default class BubblePop {\n    constructor(bp, options = {}) {\n        this.bp = bp;\n        this.options = options;\n        this.bubbles = []; // Array of bubble objects {x, y, radius, speedY, speedX}\n        this.score = 0;\n        this.maxBubbles = 50; // Maximum bubbles on screen\n        this.lastPos = null;\n        this.positionHistory = []; // For smoothing finger position\n        this.maxHistory = 3; // Number of points to average\n        this.spawnRate = 1000; // Milliseconds between bubble spawns\n        this.burstAnimations = []; // Array for burst effect animations\n        this.lastPopTime = 0; // Track last pop sound time\n        this.cooldown = 50; // Cooldown in milliseconds\n        return this;\n    }\n\n    async init() {\n        await this.bp.appendScript('https://cdn.jsdelivr.net/npm/@mediapipe/hands');\n        await this.bp.appendScript('https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils');\n        await this.bp.appendScript('https://cdnjs.cloudflare.com/ajax/libs/tone/15.2.6/Tone.js');\n        await this.bp.appendCSS('/v5/apps/based/bubblepop/bubble-pop.css');\n        this.synth = new Tone.Synth({\n            oscillator: { type: 'sine' },\n            envelope: { attack: 0.001, decay: 0.1, sustain: 0, release: 0.1 }\n        }).toDestination();\n        try {\n            Tone.start(); // don't wait for user interaction, Tone.js will handle it\n        } catch (err) {\n            console.log(err);\n        }\n        return 'loaded BubblePop';\n    }\n\n    async open() {\n        this.win = this.bp.window(this.window());\n        this.startBubblePop();\n        this.win.maximize();\n        return this.win;\n    }\n\n    window() {\n        const content = `\n        <video class=\"bubble-pop-video\" id=\"video\" width=\"640\" height=\"480\" autoplay style=\"display:none;\"></video>\n        <canvas id=\"canvas\" width=\"640\" height=\"480\" style=\"background:black; cursor:none;\"></canvas>\n        <div style=\"position:absolute; top:10px; left:10px; color:white; font-size:14px;\" id=\"status\">\n            ðŸŽˆ BubblePop | Score: 0 | C: Clear, R: Reset\n        </div>\n        `;\n        return {\n            id: 'bubblepop',\n            title: 'BubblePop',\n            icon: 'desktop/assets/images/icons/icon_game_64.png',\n            x: 300,\n            y: 100,\n            width: 700,\n            height: 520,\n            content,\n            parent: $('#desktop')[0],\n            resizable: true,\n            maximizable: true,\n            closable: true,\n        };\n    }\n\n    smoothPosition(newPos) {\n        this.positionHistory.push(newPos);\n        if (this.positionHistory.length > this.maxHistory) {\n            this.positionHistory.shift();\n        }\n        const avgPos = { x: 0, y: 0 };\n        this.positionHistory.forEach(pos => {\n            avgPos.x += pos.x;\n            avgPos.y += pos.y;\n        });\n        avgPos.x /= this.positionHistory.length;\n        avgPos.y /= this.positionHistory.length;\n        return avgPos;\n    }\n\n    spawnBubble() {\n        const radius = 20 + Math.random() * 20; // Random radius between 20 and 40\n        const x = Math.random() * (640 - 2 * radius) + radius; // Random x within canvas\n        const speedY = -(1 + Math.random() * 2); // Upward speed (1-3 pixels/frame)\n        const speedX = (Math.random() - 0.5) * 2; // Slight horizontal drift\n        if (this.bubbles.length >= this.maxBubbles) {\n            // Remove the oldest bubble if max limit reached\n            //this.bubbles.shift();\n            return;\n        }\n        this.bubbles.push({ x, y: 480 + radius, radius, speedY, speedX });\n    }\n\n    async startBubblePop() {\n        const video = document.getElementById('video');\n        const canvas = document.getElementById('canvas');\n        const ctx = canvas.getContext('2d');\n        const status = document.getElementById('status');\n\n        // Keyboard controls (unchanged)\n        document.addEventListener('keydown', (e) => {\n            switch (e.key.toLowerCase()) {\n                case 'c':\n                    this.bubbles = [];\n                    ctx.clearRect(0, 0, canvas.width, canvas.height);\n                    status.innerText = `ðŸŽˆ BubblePop | Score: ${this.score} | C: Clear, R: Reset`;\n                    break;\n                case 'r':\n                    this.bubbles = [];\n                    this.score = 0;\n                    this.spawnRate = 1000;\n                    ctx.clearRect(0, 0, canvas.width, canvas.height);\n                    status.innerText = `ðŸŽˆ BubblePop | Score: ${this.score} | C: Clear, R: Reset`;\n                    break;\n            }\n        });\n\n        // Start bubble spawning (unchanged)\n        const spawnInterval = setInterval(() => {\n            this.spawnBubble();\n            this.spawnRate = Math.max(300, this.spawnRate * 0.95);\n        }, this.spawnRate);\n\n        const stream = await navigator.mediaDevices.getUserMedia({ video: true });\n        video.srcObject = stream;\n        await new Promise(resolve => (video.onloadeddata = resolve));\n        video.play();\n\n        const hands = new Hands({\n            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`\n        });\n\n        hands.setOptions({\n            maxNumHands: 1,\n            modelComplexity: 1,\n            minDetectionConfidence: 0.7,\n            minTrackingConfidence: 0.7,\n            selfieMode: true\n        });\n\n        const camera = new Camera(video, {\n            onFrame: async () => await hands.send({ image: video }),\n            width: 640,\n            height: 480,\n        });\n        camera.start();\n\n        const animate = () => {\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n            // Draw bubbles (unchanged)\n            this.bubbles.forEach(bubble => {\n                ctx.beginPath();\n                ctx.arc(bubble.x, bubble.y, bubble.radius, 0, 2 * Math.PI);\n                ctx.fillStyle = 'rgba(100, 150, 255, 0.5)';\n                ctx.fill();\n                ctx.strokeStyle = 'rgba(255, 255, 255, 0{atan2(0, 0)})';\n                ctx.stroke();\n                bubble.y += bubble.speedY;\n                bubble.x += bubble.speedX;\n            });\n\n            // Draw burst animations (unchanged)\n            this.burstAnimations = this.burstAnimations.filter(anim => anim.radius < 60);\n            this.burstAnimations.forEach(anim => {\n                ctx.beginPath();\n                ctx.arc(anim.x, anim.y, anim.radius, 0, 2 * Math.PI);\n                ctx.strokeStyle = `rgba(255, 255, 255, ${1 - anim.radius / 60})`;\n                ctx.lineWidth = 2;\n                ctx.stroke();\n                anim.radius += 2;\n            });\n\n            // Remove off-screen bubbles (unchanged)\n            this.bubbles = this.bubbles.filter(bubble => bubble.y > -bubble.radius);\n\n            // Update spawn interval (unchanged)\n            clearInterval(spawnInterval);\n            setInterval(() => this.spawnBubble(), this.spawnRate);\n\n            requestAnimationFrame(animate);\n        };\n        requestAnimationFrame(animate);\n\n        hands.onResults((results) => {\n            if (!results.multiHandLandmarks || results.multiHandLandmarks.length === 0) {\n                this.lastPos = null;\n                this.positionHistory = [];\n                status.innerText = `ðŸŽˆ BubblePop | Score: ${this.score} | C: Clear, R: Reset`;\n                return;\n            }\n\n            const hand = results.multiHandLandmarks[0];\n            const tip = hand[8]; // Index finger tip\n            let x = tip.x * canvas.width;\n            let y = tip.y * canvas.height;\n\n            // Smooth position\n            const smoothedPos = this.smoothPosition({ x, y });\n            x = smoothedPos.x;\n            y = smoothedPos.y;\n\n            // Draw cursor\n            ctx.beginPath();\n            ctx.arc(x, y, 6, 0, 2 * Math.PI);\n            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n            ctx.fill();\n\n            // Check for bubble collisions\n            const now = Date.now();\n            this.bubbles = this.bubbles.filter(bubble => {\n                const distance = Math.hypot(x - bubble.x, y - bubble.y);\n                if (distance < bubble.radius && now - this.lastPopTime >= this.cooldown) {\n                    this.score++;\n                    this.synth.triggerAttackRelease('C5', '16n', Tone.now());\n                    this.lastPopTime = now;\n                    this.burstAnimations.push({ x: bubble.x, y: bubble.y, radius: bubble.radius });\n                    status.innerText = `ðŸŽˆ BubblePop | Score: ${this.score} | C: Clear, R: Reset`;\n                    return false; // Remove popped bubble\n                }\n                return true;\n            });\n\n            this.lastPos = { x, y };\n        });\n    }\n}"],"names":["BubblePop","constructor","bp","options","this","bubbles","score","maxBubbles","lastPos","positionHistory","maxHistory","spawnRate","burstAnimations","lastPopTime","cooldown","init","appendScript","appendCSS","synth","Tone","Synth","oscillator","type","envelope","attack","decay","sustain","release","toDestination","start","err","console","log","open","win","window","startBubblePop","maximize","id","title","icon","x","y","width","height","content","parent","$","resizable","maximizable","closable","smoothPosition","newPos","push","length","shift","avgPos","forEach","pos","spawnBubble","radius","Math","random","speedY","speedX","video","document","getElementById","canvas","ctx","getContext","status","addEventListener","e","key","toLowerCase","clearRect","innerText","spawnInterval","setInterval","max","stream","navigator","mediaDevices","getUserMedia","srcObject","Promise","resolve","onloadeddata","play","hands","Hands","locateFile","file","setOptions","maxNumHands","modelComplexity","minDetectionConfidence","minTrackingConfidence","selfieMode","Camera","onFrame","async","send","image","animate","bubble","beginPath","arc","PI","fillStyle","fill","strokeStyle","stroke","filter","anim","lineWidth","clearInterval","requestAnimationFrame","onResults","results","multiHandLandmarks","tip","smoothedPos","now","Date","hypot","triggerAttackRelease"],"mappings":"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"}