{"version":3,"file":"bubblepop.js","sources":["../../../apps/based/bubblepop/bubblepop.js","../../../apps/based/bubblepop/lib/startLoadingSequence.js"],"sourcesContent":["import startLoadingSequence from './lib/startLoadingSequence.js';\n\nexport default class BubblePop {\n    constructor(bp, options = {}) {\n        this.bp = bp;\n        this.options = options;\n        this.bubbles = []; // Array of bubble objects {x, y, radius, speedY, speedX}\n        this.score = 0;\n        this.maxBubbles = 50; // Maximum bubbles on screen\n        this.lastPos = null;\n        this.positionHistory = []; // For smoothing finger position\n        this.maxHistory = 3; // Number of points to average\n        this.spawnRate = 200; // Milliseconds between bubble spawns\n        this.burstAnimations = []; // Array for burst effect animations\n        this.lastPopTime = 0; // Track last pop sound time\n        this.cooldown = 50; // Cooldown in milliseconds\n\n        this.lastCursorTime = 0; // Track last hand detection time\n        this.cursorTimeout = 500; // 500ms timeout for cursor persistence\n\n        this.spawnInterval = null; // Initialize spawnInterval\n        this.animationFrameId = null; // Initialize animation frame ID\n\n        this.chainCount = 0; // Track number of chained pops\n        this.chainThreshold = 800; // 800ms threshold for pitch chain\n        this.pitchNotes = ['C5', 'C#5', 'D5', 'D#5', 'E5', 'F5']; // Pitch progression\n\n        this.isHandDetected = false; // Track hand detection state\n\n\n        return this;\n    }\n\n    async init() {\n        await this.bp.appendScript('https://cdn.jsdelivr.net/npm/@mediapipe/hands');\n        await this.bp.appendScript('https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils');\n        await this.bp.appendScript('https://cdnjs.cloudflare.com/ajax/libs/tone/15.2.6/Tone.js');\n        this.html = await this.bp.load('/v5/apps/based/bubblepop/bubblepop.html');\n        await this.bp.appendCSS('/v5/apps/based/bubblepop/bubblepop.css');\n        this.synth = new Tone.Synth({\n            oscillator: { type: 'sine' },\n            envelope: { attack: 0.001, decay: 0.1, sustain: 0, release: 0.1 }\n        }).toDestination();\n        try {\n            Tone.start(); // don't wait for user interaction, Tone.js will handle it\n        } catch (err) {\n            console.log(err);\n        }\n        return 'loaded BubblePop';\n    }\n\n    async open() {\n\n        if (this.win) {\n            console.warn('BubblePop window already open, returning existing window');\n            this.win.restore();\n            this.win.focus();\n            return this.win;\n        }\n\n        this.win = this.bp.window(this.window());\n        this.startLoadingSequence();\n        this.startBubblePop();\n        this.win.maximize();\n        return this.win;\n    }\n\n    window() {\n        const content = this.html;\n        return {\n            id: 'bubblepop',\n            title: 'BubblePop',\n            icon: 'desktop/assets/images/icons/icon_bubblepop_64.png',\n            x: 300,\n            y: 100,\n            width: 700,\n            height: 520,\n            content,\n            parent: $('#desktop')[0],\n            resizable: true,\n            maximizable: true,\n            closable: true,\n            onClose: () => {\n                // Clean up resources\n                if (this.spawnInterval) {\n                    clearInterval(this.spawnInterval);\n                    this.spawnInterval = null;\n                }\n                if (this.animationFrameId) {\n                    cancelAnimationFrame(this.animationFrameId);\n                    this.animationFrameId = null;\n                }\n                if (this.camera) {\n                    this.camera.stop();\n                    this.camera = null;\n                }\n                if (this.hands) {\n                    this.hands.close();\n                    this.hands = null;\n                }\n                if (this.video && this.video.srcObject) {\n                    this.video.srcObject.getTracks().forEach(track => track.stop());\n                    this.video.srcObject = null;\n                }\n\n                if (this.canvas && this.mouseMoveHandler) {\n                    this.canvas.removeEventListener('mousemove', this.mouseMoveHandler);\n                }\n                this.video = null;\n                this.bubbles = [];\n                this.positionHistory = [];\n                this.lastPos = null;\n                this.lastCursorTime = 0;\n                this.burstAnimations = [];\n                this.score = 0;\n                this.win = null;\n            }\n\n        };\n    }\n\n    smoothPosition(newPos) {\n        this.positionHistory.push(newPos);\n        if (this.positionHistory.length > this.maxHistory) {\n            this.positionHistory.shift();\n        }\n        const avgPos = { x: 0, y: 0 };\n        this.positionHistory.forEach(pos => {\n            avgPos.x += pos.x;\n            avgPos.y += pos.y;\n        });\n        avgPos.x /= this.positionHistory.length;\n        avgPos.y /= this.positionHistory.length;\n        return avgPos;\n    }\n\n    spawnBubble() {\n        const radius = 20 + Math.random() * 20;\n        const x = Math.random() * (640 - 2 * radius) + radius;\n        const speedY = -(1 + Math.random() * 1.5);\n        const speedX = (Math.random() - 0.5) * 1.5;\n        if (this.bubbles.length >= this.maxBubbles) {\n            return;\n        }\n        this.bubbles.push({ x, y: 480 + radius, radius, speedY, speedX });\n    }\n\n    async startBubblePop() {\n        this.video = document.getElementById('video');\n        this.canvas = document.getElementById('canvas');\n        const ctx = this.canvas.getContext('2d');\n        const status = document.getElementById('status');\n        const scoreDisplay = document.getElementById('score-display');\n\n        // Initialize score display\n        scoreDisplay.innerText = `Score: ${this.score}`;\n\n        // Mouse movement handler\n        this.mouseMoveHandler = (e) => {\n            if (this.isHandDetected) return; // Ignore mouse if hand is detected\n            const rect = this.canvas.getBoundingClientRect();\n            const x = e.clientX - rect.left;\n            const y = e.clientY - rect.top;\n            const smoothedPos = this.smoothPosition({ x, y });\n            this.lastPos = { x: smoothedPos.x, y: smoothedPos.y };\n            this.lastCursorTime = Date.now();\n        };\n        this.canvas.addEventListener('mousemove', this.mouseMoveHandler);\n\n        // Keyboard controls\n        document.addEventListener('keydown', (e) => {\n            switch (e.key.toLowerCase()) {\n                case 'c':\n                    this.bubbles = [];\n                    ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n                    status.innerText = `ðŸŽˆ BubblePop | C: Clear, R: Reset`;\n                    scoreDisplay.innerText = `Score: ${this.score}`;\n                    break;\n                case 'r':\n                    this.bubbles = [];\n                    this.score = 0;\n                    this.chainCount = 0;\n                    this.spawnRate = 1000;\n                    ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n                    status.innerText = `ðŸŽˆ BubblePop | C: Clear, R: Reset`;\n                    scoreDisplay.innerText = `Score: ${this.score}`;\n                    if (this.spawnInterval) {\n                        clearInterval(this.spawnInterval);\n                        this.spawnInterval = setInterval(() => this.spawnBubble(), this.spawnRate);\n                    }\n                    break;\n            }\n        });\n\n        // Start bubble spawning\n        this.spawnInterval = setInterval(() => {\n            this.spawnBubble();\n            const newSpawnRate = Math.max(300, this.spawnRate * 0.95);\n            if (Math.abs(newSpawnRate - this.spawnRate) > 1) {\n                this.spawnRate = newSpawnRate;\n                if (this.spawnInterval) {\n                    clearInterval(this.spawnInterval);\n                    this.spawnInterval = setInterval(() => this.spawnBubble(), this.spawnRate);\n                }\n            }\n        }, this.spawnRate);\n\n        // Attempt to start camera, but allow mouse-only fallback\n        let stream;\n        try {\n            stream = await navigator.mediaDevices.getUserMedia({ video: true });\n            this.video.srcObject = stream;\n            await new Promise(resolve => (this.video.onloadeddata = resolve));\n            this.video.play();\n        } catch (err) {\n            console.warn('Camera access denied, falling back to mouse input:', err);\n            status.innerText = `ðŸŽˆ BubblePop | Using mouse | C: Clear, R: Reset`;\n            this.canvas.classList.add('no-hand');\n            // hide the loading spinner\n            $('.bubblepop-loading', this.win.content).fadeOut(300);\n        }\n\n        this.hands = new Hands({\n            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`\n        });\n\n        this.hands.setOptions({\n            maxNumHands: 1,\n            modelComplexity: 1,\n            minDetectionConfidence: 0.7,\n            minTrackingConfidence: 0.7,\n            selfieMode: true\n        });\n\n        if (stream) {\n            this.camera = new Camera(this.video, {\n                onFrame: async () => await this.hands.send({ image: this.video }),\n                width: 640,\n                height: 480,\n            });\n            this.camera.start();\n        }\n\n        const animate = () => {\n            ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n            // Draw bubbles\n            this.bubbles.forEach(bubble => {\n                ctx.beginPath();\n                ctx.arc(bubble.x, bubble.y, bubble.radius, 0, 2 * Math.PI);\n                ctx.fillStyle = 'rgba(100, 150, 255, 0.5)';\n                ctx.fill();\n                ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';\n                ctx.lineWidth = 1;\n                ctx.stroke();\n                bubble.y += bubble.speedY;\n                bubble.x += bubble.speedX;\n            });\n\n            // Draw burst animations\n            this.burstAnimations = this.burstAnimations.filter(anim => anim.radius < 60);\n            this.burstAnimations.forEach(anim => {\n                ctx.beginPath();\n                ctx.arc(anim.x, anim.y, anim.radius, 0, 2 * Math.PI);\n                ctx.strokeStyle = `rgba(255, 255, 255, ${1 - anim.radius / 60})`;\n                ctx.lineWidth = 2;\n                ctx.stroke();\n                anim.radius += 2;\n            });\n\n            // Draw cursor if within timeout\n            if (this.lastPos && Date.now() - this.lastCursorTime < this.cursorTimeout) {\n                ctx.beginPath();\n                ctx.arc(this.lastPos.x, this.lastPos.y, 6, 0, 2 * Math.PI);\n                ctx.fillStyle = `rgba(255, 255, 255, ${1 - (Date.now() - this.lastCursorTime) / this.cursorTimeout})`;\n                ctx.fill();\n            }\n\n            // Check for bubble collisions with mouse or hand\n            const now = Date.now();\n            if (this.lastPos && Date.now() - this.lastCursorTime < this.cursorTimeout) {\n                this.bubbles = this.bubbles.filter(bubble => {\n                    const distance = Math.hypot(this.lastPos.x - bubble.x, this.lastPos.y - bubble.y);\n                    if (distance < bubble.radius && now - this.lastPopTime >= this.cooldown) {\n                        this.score++;\n                        if (now - this.lastPopTime <= this.chainThreshold) {\n                            this.chainCount = Math.min(this.chainCount + 1, this.pitchNotes.length - 1);\n                        } else {\n                            this.chainCount = 0;\n                        }\n                        const note = this.pitchNotes[this.chainCount];\n                        /*\n                        This error only happens in mouse mode, not hand mode, when camera is not available.\n                        Debug.ts:12 Uncaught Error: Start time must be strictly greater than previous start time\n                            at Bn (Debug.ts:12:9)\n                            at Xa.start (Source.ts:208:4)\n                            at Ha._triggerEnvelopeAttack (Synth.ts:133:19)\n                            at Ha.triggerAttack (Monophonic.ts:87:8)\n                            at Ha.triggerAttackRelease (Instrument.ts:168:8)\n                            at bubblepop.js?v=6.5.6:293:36\n                            at Array.filter (<anonymous>)\n                            at animate (bubblepop.js?v=6.5.6:283:45)\n                            */                       \n                           // TODO: get sound to work in mouse-only mode\n                           // issue with too rapid calls to triggerAttackRelease, probably need to debounce\n                           try {\n                            this.synth.triggerAttackRelease(note, '16n', Tone.now());\n                           } catch (err) {\n\n                           }\n                        this.lastPopTime = now;\n                        this.burstAnimations.push({ x: bubble.x, y: bubble.y, radius: bubble.radius });\n                        scoreDisplay.innerText = `Score: ${this.score}`;\n                        status.innerText = this.isHandDetected\n                            ? `ðŸŽˆ BubblePop | C: Clear, R: Reset`\n                            : `ðŸŽˆ BubblePop | Using mouse | C: Clear, R: Reset`;\n                        return false;\n                    }\n                    return true;\n                });\n            }\n\n            // Remove off-screen bubbles\n            this.bubbles = this.bubbles.filter(bubble => bubble.y > -bubble.radius);\n\n            this.animationFrameId = requestAnimationFrame(animate);\n        };\n        this.animationFrameId = requestAnimationFrame(animate);\n\n        let firstResults = false;\n\n        this.hands.onResults((results) => {\n            if (!firstResults) {\n                firstResults = true;\n                $('.bubblepop-loading', this.win.content).fadeOut(300);\n            }\n\n            this.isHandDetected = !!(results.multiHandLandmarks && results.multiHandLandmarks.length > 0);\n            if (this.isHandDetected) {\n                this.canvas.classList.remove('no-hand');\n                status.innerText = `ðŸŽˆ BubblePop | C: Clear, R: Reset`;\n            } else {\n                this.canvas.classList.add('no-hand');\n                status.innerText = `ðŸŽˆ BubblePop | Using mouse | C: Clear, R: Reset`;\n            }\n\n            if (!this.isHandDetected) {\n                return;\n            }\n\n            const hand = results.multiHandLandmarks[0];\n            const tip = hand[8]; // Index finger tip\n            let x = tip.x * this.canvas.width;\n            let y = tip.y * this.canvas.height;\n\n            // Smooth position\n            const smoothedPos = this.smoothPosition({ x, y });\n            x = smoothedPos.x;\n            y = smoothedPos.y;\n\n            // Update cursor position and timestamp\n            this.lastPos = { x, y };\n            this.lastCursorTime = Date.now();\n        });\n    }\n\n}\n\n\nBubblePop.prototype.startLoadingSequence = startLoadingSequence;","export default function startLoadingSequence(win) {\n    const steps = [\n        \"Initializing camera...\",\n        \"Loading vision model...\",\n        \"Warming up tensors...\",\n        \"Calibrating hand gestures...\",\n        \"Initializing Synth...\",\n        \"Finalizing setup...\"\n    ];\n\n    let stepIndex = 0;\n    const $loadingText = $('#loading-text', this.win.content);\n\n    const interval = setInterval(() => {\n        $loadingText.text(steps[stepIndex]);\n        stepIndex++;\n\n        // End of steps â€” stop interval\n        if (stepIndex >= steps.length) {\n            clearInterval(interval);\n        }\n    }, 1200); // Change step every 1.2s\n}\n"],"names":["BubblePop","constructor","bp","options","this","bubbles","score","maxBubbles","lastPos","positionHistory","maxHistory","spawnRate","burstAnimations","lastPopTime","cooldown","lastCursorTime","cursorTimeout","spawnInterval","animationFrameId","chainCount","chainThreshold","pitchNotes","isHandDetected","init","appendScript","html","load","appendCSS","synth","Tone","Synth","oscillator","type","envelope","attack","decay","sustain","release","toDestination","start","err","console","log","open","win","warn","restore","focus","window","startLoadingSequence","startBubblePop","maximize","id","title","icon","x","y","width","height","content","parent","$","resizable","maximizable","closable","onClose","clearInterval","cancelAnimationFrame","camera","stop","hands","close","video","srcObject","getTracks","forEach","track","canvas","mouseMoveHandler","removeEventListener","smoothPosition","newPos","push","length","shift","avgPos","pos","spawnBubble","radius","Math","random","speedY","speedX","document","getElementById","ctx","getContext","status","scoreDisplay","stream","innerText","e","rect","getBoundingClientRect","clientX","left","clientY","top","smoothedPos","Date","now","addEventListener","key","toLowerCase","clearRect","setInterval","newSpawnRate","max","abs","navigator","mediaDevices","getUserMedia","Promise","resolve","onloadeddata","play","classList","add","fadeOut","Hands","locateFile","file","setOptions","maxNumHands","modelComplexity","minDetectionConfidence","minTrackingConfidence","selfieMode","Camera","onFrame","async","send","image","animate","bubble","beginPath","arc","PI","fillStyle","fill","strokeStyle","lineWidth","stroke","filter","anim","hypot","min","note","triggerAttackRelease","requestAnimationFrame","firstResults","onResults","results","multiHandLandmarks","remove","tip","prototype","steps","stepIndex","$loadingText","interval","text"],"mappings":"AAEe,MAAMA,EACjB,WAAAC,CAAYC,EAAIC,EAAU,IA2BtB,OA1BAC,KAAKF,GAAKA,EACVE,KAAKD,QAAUA,EACfC,KAAKC,QAAU,GACfD,KAAKE,MAAQ,EACbF,KAAKG,WAAa,GAClBH,KAAKI,QAAU,KACfJ,KAAKK,gBAAkB,GACvBL,KAAKM,WAAa,EAClBN,KAAKO,UAAY,IACjBP,KAAKQ,gBAAkB,GACvBR,KAAKS,YAAc,EACnBT,KAAKU,SAAW,GAEhBV,KAAKW,eAAiB,EACtBX,KAAKY,cAAgB,IAErBZ,KAAKa,cAAgB,KACrBb,KAAKc,iBAAmB,KAExBd,KAAKe,WAAa,EAClBf,KAAKgB,eAAiB,IACtBhB,KAAKiB,WAAa,CAAC,KAAM,MAAO,KAAM,MAAO,KAAM,MAEnDjB,KAAKkB,gBAAiB,EAGflB,IACf,CAEI,UAAMmB,SACInB,KAAKF,GAAGsB,aAAa,uDACrBpB,KAAKF,GAAGsB,aAAa,8DACrBpB,KAAKF,GAAGsB,aAAa,8DAC3BpB,KAAKqB,WAAarB,KAAKF,GAAGwB,KAAK,iDACzBtB,KAAKF,GAAGyB,UAAU,0CACxBvB,KAAKwB,MAAQ,IAAIC,KAAKC,MAAM,CACxBC,WAAY,CAAEC,KAAM,QACpBC,SAAU,CAAEC,OAAQ,KAAOC,MAAO,GAAKC,QAAS,EAAGC,QAAS,MAC7DC,gBACH,IACIT,KAAKU,OACR,CAAC,MAAOC,GACLC,QAAQC,IAAIF,EACxB,CACQ,MAAO,kBACf,CAEI,UAAMG,GAEF,OAAIvC,KAAKwC,KACLH,QAAQI,KAAK,4DACbzC,KAAKwC,IAAIE,UACT1C,KAAKwC,IAAIG,QACF3C,KAAKwC,MAGhBxC,KAAKwC,IAAMxC,KAAKF,GAAG8C,OAAO5C,KAAK4C,UAC/B5C,KAAK6C,uBACL7C,KAAK8C,iBACL9C,KAAKwC,IAAIO,WACF/C,KAAKwC,IACpB,CAEI,MAAAI,GAEI,MAAO,CACHI,GAAI,YACJC,MAAO,YACPC,KAAM,oDACNC,EAAG,IACHC,EAAG,IACHC,MAAO,IACPC,OAAQ,IACRC,QATYvD,KAAKqB,KAUjBmC,OAAQC,EAAE,YAAY,GACtBC,WAAW,EACXC,aAAa,EACbC,UAAU,EACVC,QAAS,KAED7D,KAAKa,gBACLiD,cAAc9D,KAAKa,eACnBb,KAAKa,cAAgB,MAErBb,KAAKc,mBACLiD,qBAAqB/D,KAAKc,kBAC1Bd,KAAKc,iBAAmB,MAExBd,KAAKgE,SACLhE,KAAKgE,OAAOC,OACZjE,KAAKgE,OAAS,MAEdhE,KAAKkE,QACLlE,KAAKkE,MAAMC,QACXnE,KAAKkE,MAAQ,MAEblE,KAAKoE,OAASpE,KAAKoE,MAAMC,YACzBrE,KAAKoE,MAAMC,UAAUC,YAAYC,SAAQC,GAASA,EAAMP,SACxDjE,KAAKoE,MAAMC,UAAY,MAGvBrE,KAAKyE,QAAUzE,KAAK0E,kBACpB1E,KAAKyE,OAAOE,oBAAoB,YAAa3E,KAAK0E,kBAEtD1E,KAAKoE,MAAQ,KACbpE,KAAKC,QAAU,GACfD,KAAKK,gBAAkB,GACvBL,KAAKI,QAAU,KACfJ,KAAKW,eAAiB,EACtBX,KAAKQ,gBAAkB,GACvBR,KAAKE,MAAQ,EACbF,KAAKwC,IAAM,MAI3B,CAEI,cAAAoC,CAAeC,GACX7E,KAAKK,gBAAgByE,KAAKD,GACtB7E,KAAKK,gBAAgB0E,OAAS/E,KAAKM,YACnCN,KAAKK,gBAAgB2E,QAEzB,MAAMC,EAAS,CAAE9B,EAAG,EAAGC,EAAG,GAO1B,OANApD,KAAKK,gBAAgBkE,SAAQW,IACzBD,EAAO9B,GAAK+B,EAAI/B,EAChB8B,EAAO7B,GAAK8B,EAAI9B,KAEpB6B,EAAO9B,GAAKnD,KAAKK,gBAAgB0E,OACjCE,EAAO7B,GAAKpD,KAAKK,gBAAgB0E,OAC1BE,CACf,CAEI,WAAAE,GACI,MAAMC,EAAS,GAAqB,GAAhBC,KAAKC,SACnBnC,EAAIkC,KAAKC,UAAY,IAAM,EAAIF,GAAUA,EACzCG,IAAW,EAAoB,IAAhBF,KAAKC,UACpBE,EAAiC,KAAvBH,KAAKC,SAAW,IAC5BtF,KAAKC,QAAQ8E,QAAU/E,KAAKG,YAGhCH,KAAKC,QAAQ6E,KAAK,CAAE3B,IAAGC,EAAG,IAAMgC,EAAQA,SAAQG,SAAQC,UAChE,CAEI,oBAAM1C,GACF9C,KAAKoE,MAAQqB,SAASC,eAAe,SACrC1F,KAAKyE,OAASgB,SAASC,eAAe,UACtC,MAAMC,EAAM3F,KAAKyE,OAAOmB,WAAW,MAC7BC,EAASJ,SAASC,eAAe,UACjCI,EAAeL,SAASC,eAAe,iBAwD7C,IAAIK,EArDJD,EAAaE,UAAY,UAAUhG,KAAKE,QAGxCF,KAAK0E,iBAAoBuB,IACrB,GAAIjG,KAAKkB,eAAgB,OACzB,MAAMgF,EAAOlG,KAAKyE,OAAO0B,wBACnBhD,EAAI8C,EAAEG,QAAUF,EAAKG,KACrBjD,EAAI6C,EAAEK,QAAUJ,EAAKK,IACrBC,EAAcxG,KAAK4E,eAAe,CAAEzB,IAAGC,MAC7CpD,KAAKI,QAAU,CAAE+C,EAAGqD,EAAYrD,EAAGC,EAAGoD,EAAYpD,GAClDpD,KAAKW,eAAiB8F,KAAKC,OAE/B1G,KAAKyE,OAAOkC,iBAAiB,YAAa3G,KAAK0E,kBAG/Ce,SAASkB,iBAAiB,WAAYV,IAClC,OAAQA,EAAEW,IAAIC,eACV,IAAK,IACD7G,KAAKC,QAAU,GACf0F,EAAImB,UAAU,EAAG,EAAG9G,KAAKyE,OAAOpB,MAAOrD,KAAKyE,OAAOnB,QACnDuC,EAAOG,UAAY,oCACnBF,EAAaE,UAAY,UAAUhG,KAAKE,QACxC,MACJ,IAAK,IACDF,KAAKC,QAAU,GACfD,KAAKE,MAAQ,EACbF,KAAKe,WAAa,EAClBf,KAAKO,UAAY,IACjBoF,EAAImB,UAAU,EAAG,EAAG9G,KAAKyE,OAAOpB,MAAOrD,KAAKyE,OAAOnB,QACnDuC,EAAOG,UAAY,oCACnBF,EAAaE,UAAY,UAAUhG,KAAKE,QACpCF,KAAKa,gBACLiD,cAAc9D,KAAKa,eACnBb,KAAKa,cAAgBkG,aAAY,IAAM/G,KAAKmF,eAAenF,KAAKO,gBAOhFP,KAAKa,cAAgBkG,aAAY,KAC7B/G,KAAKmF,cACL,MAAM6B,EAAe3B,KAAK4B,IAAI,IAAsB,IAAjBjH,KAAKO,WACpC8E,KAAK6B,IAAIF,EAAehH,KAAKO,WAAa,IAC1CP,KAAKO,UAAYyG,EACbhH,KAAKa,gBACLiD,cAAc9D,KAAKa,eACnBb,KAAKa,cAAgBkG,aAAY,IAAM/G,KAAKmF,eAAenF,KAAKO,eAGzEP,KAAKO,WAIR,IACIwF,QAAeoB,UAAUC,aAAaC,aAAa,CAAEjD,OAAO,IAC5DpE,KAAKoE,MAAMC,UAAY0B,QACjB,IAAIuB,SAAQC,GAAYvH,KAAKoE,MAAMoD,aAAeD,IACxDvH,KAAKoE,MAAMqD,MACd,CAAC,MAAOrF,GACLC,QAAQI,KAAK,qDAAsDL,GACnEyD,EAAOG,UAAY,kDACnBhG,KAAKyE,OAAOiD,UAAUC,IAAI,WAE1BlE,EAAE,qBAAsBzD,KAAKwC,IAAIe,SAASqE,QAAQ,IAC9D,CAEQ5H,KAAKkE,MAAQ,IAAI2D,MAAM,CACnBC,WAAaC,GAAS,iDAAiDA,MAG3E/H,KAAKkE,MAAM8D,WAAW,CAClBC,YAAa,EACbC,gBAAiB,EACjBC,uBAAwB,GACxBC,sBAAuB,GACvBC,YAAY,IAGZtC,IACA/F,KAAKgE,OAAS,IAAIsE,OAAOtI,KAAKoE,MAAO,CACjCmE,QAASC,eAAkBxI,KAAKkE,MAAMuE,KAAK,CAAEC,MAAO1I,KAAKoE,QACzDf,MAAO,IACPC,OAAQ,MAEZtD,KAAKgE,OAAO7B,SAGhB,MAAMwG,EAAU,KACZhD,EAAImB,UAAU,EAAG,EAAG9G,KAAKyE,OAAOpB,MAAOrD,KAAKyE,OAAOnB,QAGnDtD,KAAKC,QAAQsE,SAAQqE,IACjBjD,EAAIkD,YACJlD,EAAImD,IAAIF,EAAOzF,EAAGyF,EAAOxF,EAAGwF,EAAOxD,OAAQ,EAAG,EAAIC,KAAK0D,IACvDpD,EAAIqD,UAAY,2BAChBrD,EAAIsD,OACJtD,EAAIuD,YAAc,2BAClBvD,EAAIwD,UAAY,EAChBxD,EAAIyD,SACJR,EAAOxF,GAAKwF,EAAOrD,OACnBqD,EAAOzF,GAAKyF,EAAOpD,UAIvBxF,KAAKQ,gBAAkBR,KAAKQ,gBAAgB6I,QAAOC,GAAQA,EAAKlE,OAAS,KACzEpF,KAAKQ,gBAAgB+D,SAAQ+E,IACzB3D,EAAIkD,YACJlD,EAAImD,IAAIQ,EAAKnG,EAAGmG,EAAKlG,EAAGkG,EAAKlE,OAAQ,EAAG,EAAIC,KAAK0D,IACjDpD,EAAIuD,YAAc,uBAAuB,EAAII,EAAKlE,OAAS,MAC3DO,EAAIwD,UAAY,EAChBxD,EAAIyD,SACJE,EAAKlE,QAAU,KAIfpF,KAAKI,SAAWqG,KAAKC,MAAQ1G,KAAKW,eAAiBX,KAAKY,gBACxD+E,EAAIkD,YACJlD,EAAImD,IAAI9I,KAAKI,QAAQ+C,EAAGnD,KAAKI,QAAQgD,EAAG,EAAG,EAAG,EAAIiC,KAAK0D,IACvDpD,EAAIqD,UAAY,uBAAuB,GAAKvC,KAAKC,MAAQ1G,KAAKW,gBAAkBX,KAAKY,iBACrF+E,EAAIsD,QAIR,MAAMvC,EAAMD,KAAKC,MACb1G,KAAKI,SAAWqG,KAAKC,MAAQ1G,KAAKW,eAAiBX,KAAKY,gBACxDZ,KAAKC,QAAUD,KAAKC,QAAQoJ,QAAOT,IAE/B,GADiBvD,KAAKkE,MAAMvJ,KAAKI,QAAQ+C,EAAIyF,EAAOzF,EAAGnD,KAAKI,QAAQgD,EAAIwF,EAAOxF,GAChEwF,EAAOxD,QAAUsB,EAAM1G,KAAKS,aAAeT,KAAKU,SAAU,CACrEV,KAAKE,QACDwG,EAAM1G,KAAKS,aAAeT,KAAKgB,eAC/BhB,KAAKe,WAAasE,KAAKmE,IAAIxJ,KAAKe,WAAa,EAAGf,KAAKiB,WAAW8D,OAAS,GAEzE/E,KAAKe,WAAa,EAEtB,MAAM0I,EAAOzJ,KAAKiB,WAAWjB,KAAKe,YAe/B,IACCf,KAAKwB,MAAMkI,qBAAqBD,EAAM,MAAOhI,KAAKiF,MAClD,CAAC,MAAOtE,GAEpC,CAOwB,OANApC,KAAKS,YAAciG,EACnB1G,KAAKQ,gBAAgBsE,KAAK,CAAE3B,EAAGyF,EAAOzF,EAAGC,EAAGwF,EAAOxF,EAAGgC,OAAQwD,EAAOxD,SACrEU,EAAaE,UAAY,UAAUhG,KAAKE,QACxC2F,EAAOG,UAAYhG,KAAKkB,eAClB,oCACA,mDACC,CAC/B,CACoB,OAAO,MAKflB,KAAKC,QAAUD,KAAKC,QAAQoJ,QAAOT,GAAUA,EAAOxF,GAAKwF,EAAOxD,SAEhEpF,KAAKc,iBAAmB6I,sBAAsBhB,IAElD3I,KAAKc,iBAAmB6I,sBAAsBhB,GAE9C,IAAIiB,GAAe,EAEnB5J,KAAKkE,MAAM2F,WAAWC,IAelB,GAdKF,IACDA,GAAe,EACfnG,EAAE,qBAAsBzD,KAAKwC,IAAIe,SAASqE,QAAQ,MAGtD5H,KAAKkB,kBAAoB4I,EAAQC,oBAAsBD,EAAQC,mBAAmBhF,OAAS,GACvF/E,KAAKkB,gBACLlB,KAAKyE,OAAOiD,UAAUsC,OAAO,WAC7BnE,EAAOG,UAAY,sCAEnBhG,KAAKyE,OAAOiD,UAAUC,IAAI,WAC1B9B,EAAOG,UAAY,oDAGlBhG,KAAKkB,eACN,OAGJ,MACM+I,EADOH,EAAQC,mBAAmB,GACvB,GACjB,IAAI5G,EAAI8G,EAAI9G,EAAInD,KAAKyE,OAAOpB,MACxBD,EAAI6G,EAAI7G,EAAIpD,KAAKyE,OAAOnB,OAG5B,MAAMkD,EAAcxG,KAAK4E,eAAe,CAAEzB,IAAGC,MAC7CD,EAAIqD,EAAYrD,EAChBC,EAAIoD,EAAYpD,EAGhBpD,KAAKI,QAAU,CAAE+C,IAAGC,KACpBpD,KAAKW,eAAiB8F,KAAKC,QAEvC,EAKA9G,EAAUsK,UAAUrH,qBCjXL,SAA8BL,GACzC,MAAM2H,EAAQ,CACV,yBACA,0BACA,wBACA,+BACA,wBACA,uBAGJ,IAAIC,EAAY,EAChB,MAAMC,EAAe5G,EAAE,gBAAiBzD,KAAKwC,IAAIe,SAE3C+G,EAAWvD,aAAY,KACzBsD,EAAaE,KAAKJ,EAAMC,IACxBA,IAGIA,GAAaD,EAAMpF,QACnBjB,cAAcwG,KAEnB,KACP"}