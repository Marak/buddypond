{"version":3,"file":"desktop.js","sources":["../../../apps/based/desktop/lib/Folder.js","../../../apps/based/desktop/lib/File.js","../../../apps/based/desktop/lib/shortcuts/createShortCut.js","../../../apps/based/desktop/lib/appList.js","../../../apps/based/desktop/lib/defaultDesktopShortcuts.js","../../../apps/based/desktop/desktop.js","../../../apps/based/desktop/lib/shortcuts/addShortCut.js","../../../apps/based/desktop/lib/addFolder.js","../../../apps/based/desktop/lib/shortcuts/removeShortCut.js","../../../apps/based/desktop/lib/shortcuts/arrangeShortCuts.js","../../../apps/based/desktop/lib/contextmenu/setupContextMenu.js","../../../apps/based/desktop/lib/contextmenu/showContextMenu.js","../../../apps/based/desktop/lib/viewSource.js","../../../apps/based/desktop/lib/shortcuts/renameShortCut.js","../../../apps/based/desktop/lib/apps/addApp.js","../../../apps/based/desktop/lib/apps/removeApp.js"],"sourcesContent":["export default class Folder {\n    constructor(data, options = {}) {\n        this.data = data;\n        this.parentElement = options.parentElement;\n        this.desktop = options.desktop;\n        this.depth = options.depth;\n        this.options = options;\n    }\n\n    render(app = {}) {\n    \n        app = this.data;\n        // Create the shortcut element\n        const folderDiv = document.createElement('div');\n        folderDiv.className = `folder ${app.class || ''}`;\n\n        if (this.depth > 1) {\n            folderDiv.classList.add(`hidden`);\n        }\n        folderDiv.classList.add('icon', 'shortcut');   \n        const anchor = document.createElement('a');\n        // anchor.href = app.href || `#icon_dock_${app.name}`;\n\n        const image = document.createElement('img');\n        image.className = 'bp-desktop-icon';\n        image.loading = 'lazy';\n        image.src = 'desktop/assets/images/icons/icon_folder_64.png';\n\n        const title = document.createElement('span');\n        title.className = 'title';\n        title.textContent = app.label || app.name || app.id;\n\n        anchor.appendChild(image);\n        anchor.appendChild(title);\n        folderDiv.appendChild(anchor);\n\n        // folderDiv.onclick = () => this.openFolder(); // Placeholder for folder opening logic\n\n        $(folderDiv).draggable({\n            containment: 'parent' // Confine dragging within the parent container\n        });\n\n        // folderDiv click handler\n        folderDiv.addEventListener('mousedown', (e) => {\n           this.options.onOpen();\n        });\n\n        this.parentElement.appendChild(folderDiv);\n\n        // Recursively render each child in this folder\n        // this.data.children.forEach(child => this.desktop.renderNode(child, folderDiv, this.depth + 1));\n    }\n\n    open () {\n        // Logic to open the folder\n           this.options.onOpen();\n    }\n}\n","\n\nexport default class File {\n    constructor(data, parentElement, desktop, depth) {\n        this.data = data;\n        console.log(\"FIKLE DATA\", data);\n        this.parentElement = parentElement;\n        this.desktop = desktop;\n        this.options = {};\n        this.depth = depth;\n    }\n\n    render(app = {}) {\n\n        app = this.data;\n\n        // Create the shortcut element\n        const el = document.createElement('div');\n        el.className = `icon shortcut ${app.class || ''}`;\n\n        if (this.depth > 1) {\n            el.classList.add(`hidden`);\n        }\n\n        el.classList.add('icon', 'shortcut');   \n\n\n        const anchor = document.createElement('a');\n        // anchor.href = app.href || `#icon_dock_${app.name}`;\n\n        const image = document.createElement('img');\n        image.className = 'bp-desktop-icon';\n        image.loading = 'lazy';\n        image.src = app.icon;\n\n        const title = document.createElement('span');\n        title.className = 'title';\n        title.textContent = app.label || app.name || app.id;\n\n        anchor.appendChild(image);\n        anchor.appendChild(title);\n        el.appendChild(anchor);\n\n        // Adding onClick event to the .icon container\n        el.addEventListener('click', this.options.onClick);\n\n\n\n\n        // Apply jQuery UI draggable if enabled\n        if (this.enableShortcutDragging) {\n            $(el).draggable({\n                containment: 'parent' // Confine dragging within the parent container\n            });\n        }\n\n\n        this.parentElement.appendChild(el);\n\n\n        // Recursively render each child in this folder\n    }\n}\n","export default function createShortcut() {\n    if (!this.createShortCutWindow) {\n        let shortCutHtml = `\n        <div class=\"bp-create-shortcut-container\">\n            <h2>Create Shortcut</h2>\n            <form id=\"create-shortcut-form\" action=\"#\" method=\"post\">\n                <div class=\"bp-form-group\">\n                    <label>Shortcut Type:</label>\n                    <div class=\"bp-shortcut-type\">\n                        <label><input type=\"radio\" name=\"shortcut-type\" value=\"url\" checked> URL</label>\n                        <label><input type=\"radio\" name=\"shortcut-type\" value=\"app\"> App</label>\n                        <label><input type=\"radio\" name=\"shortcut-type\" value=\"buddyscript\"> Buddyscript</label>\n                    </div>\n                </div>\n                <div class=\"bp-form-group\">\n                    <label for=\"shortcut-name\">Shortcut Name:</label>\n                    <input type=\"text\" id=\"shortcut-name\" name=\"shortcut-name\" required>\n                </div>\n                <div class=\"bp-form-group bp-app-select-group\" style=\"display: none;\">\n                    <label for=\"shortcut-apps\">Select App:</label>\n                    <select id=\"shortcut-apps\" name=\"shortcut-apps\">\n                        <option value=\"\">Select App</option>\n                        ${Object.keys(this.bp.apps.desktop.appList).map(appName => `<option value=\"${appName}\">${this.bp.apps.desktop.appList[appName].label || appName}</option>`).join('')}\n                    </select>\n                </div>\n                <div class=\"bp-form-group bp-command-group\">\n                    <label for=\"shortcut-command\">Command:</label>\n                    <input type=\"text\" id=\"shortcut-command\" name=\"shortcut-command\" required>\n                </div>\n                <div class=\"bp-form-group\">\n                    <label for=\"shortcut-icon\">Icon URL:</label>\n                    <input type=\"text\" id=\"shortcut-icon\" name=\"shortcut-icon\" placeholder=\"Optional\">\n                </div>\n                <div class=\"bp-form-group\">\n                    <label for=\"shortcut-description\">Description:</label>\n                    <textarea id=\"shortcut-description\" name=\"shortcut-description\" placeholder=\"Optional\"></textarea>\n                </div>\n                <div class=\"bp-form-group bp-form-actions\">\n                    <button type=\"submit\" class=\"bp-btn bp-btn-primary bp-create-shortcut-btn\">Create Shortcut</button>\n                    <button type=\"button\" class=\"bp-btn bp-btn-secondary\" id=\"cancel-shortcut\">Cancel</button>\n                </div>\n            </form>\n        </div>`;\n\n        this.createShortCutWindow = this.bp.apps.ui.windowManager.createWindow({\n            id: 'create-shortcut',\n            title: 'Create Shortcut',\n            icon: 'desktop/assets/images/icons/icon_console_64.png',\n            x: 250,\n            y: 75,\n            width: 600,\n            height: 400,\n            minWidth: 400,\n            minHeight: 300,\n            parent: $('#desktop')[0],\n            content: shortCutHtml,\n            resizable: true,\n            minimizable: true,\n            maximizable: true,\n            closable: true,\n            focusable: true,\n            maximized: false,\n            minimized: false,\n            onclose: () => {\n                // Clean up if needed\n            }\n        });\n\n        // Toggle app dropdown visibility based on shortcut type\n        $('#create-shortcut-form input[name=\"shortcut-type\"]').on('change', (e) => {\n            const shortcutType = e.target.value;\n            const appSelectGroup = $('.bp-app-select-group');\n            const commandGroup = $('.bp-command-group');\n            if (shortcutType === 'app') {\n                appSelectGroup.show();\n                commandGroup.hide();\n                $('#shortcut-command').prop('required', false);\n                $('#shortcut-apps').prop('required', true);\n            } else {\n                appSelectGroup.hide();\n                commandGroup.show();\n                $('#shortcut-command').prop('required', true);\n                $('#shortcut-apps').prop('required', false);\n            }\n        });\n\n        $('#create-shortcut-form').on('submit', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        $('.bp-create-shortcut-btn').on('click', (e) => {\n            e.preventDefault();\n            const shortcutType = $('input[name=\"shortcut-type\"]:checked').val();\n            const name = $('#shortcut-name').val().trim();\n            const appName = $('#shortcut-apps').val();\n            const command = $('#shortcut-command').val().trim();\n            const icon = $('#shortcut-icon').val().trim();\n            const description = $('#shortcut-description').val().trim();\n\n            // Validation\n            if (!name) {\n                alert('Shortcut Name is required.');\n                return;\n            }\n            if (shortcutType === 'app' && !appName) {\n                alert('Please select an app.');\n                return;\n            }\n            if ((shortcutType === 'url' || shortcutType === 'buddyscript') && !command) {\n                alert('Command is required for URL or Buddyscript shortcuts.');\n                return;\n            }\n\n            // Create the shortcut object\n            const shortcut = {\n                name: name,\n                label: name,\n                shortcutType: shortcutType,\n                icon: icon || 'desktop/assets/images/icons/icon_default_64.png', // Default icon if none provided\n                description: description || '',\n                target: shortcutType === 'app' ? this.bp.apps.desktop.appList[appName]?.onClick || `bp.open('${appName}')` : command,\n                parameters: {\n                    icon: icon || '',\n                    description: description || ''\n                }\n            };\n\n            try {\n                saveShortCut.call(this, shortcut);\n            } catch (error) {\n                console.error('Error creating shortcut:', error);\n                alert('Failed to create shortcut. Please check the console for details.');\n            }\n            return false;\n        });\n\n        $('#cancel-shortcut').on('click', () => {\n            this.createShortCutWindow.close();\n        });\n    } else {\n        this.createShortCutWindow.focus();\n        this.createShortCutWindow.restore();\n    }\n}\n\nfunction saveShortCut(shortcut) {\n    console.log('Saving shortcut:', shortcut);\n    // Save to localStorage\n    const shortcuts = JSON.parse(localStorage.getItem('bp-shortcuts') || '{}');\n    shortcuts[shortcut.name] = {\n        label: shortcut.label,\n        shortcutType: shortcut.shortcutType,\n        target: shortcut.target,\n        icon: shortcut.icon,\n        description: shortcut.parameters.description\n    };\n    // TODO: use app API instead\n    // localStorage.setItem('bp-short', JSON.stringify(shortcuts));\n\n    // Call addShortCut to create the shortcut on the desktop\n    this.bp.apps.desktop.addShortCut({\n        name: shortcut.name,\n        label: shortcut.label,\n        icon: shortcut.icon,\n        description: shortcut.description,\n        onClick: shortcut.shortcutType === 'url' ? () => window.open(shortcut.target, '_blank') :\n                 shortcut.shortcutType === 'app' ? shortcut.target :\n                 () => {\n                    // opens the apps, executes the shortcut command\n                    // TODO: add a runShortcut function to the desktop app\n                 },\n        textIcon: !shortcut.icon ? shortcut.label.charAt(0).toUpperCase() : null\n    });\n\n    // Close the window\n    this.createShortCutWindow.close();\n}","export default {\n  \"admin\": {\n    name: 'admin',\n    icon: `desktop/assets/images/icons/icon_profile_64.png`,\n    label: 'Admin',\n    \"onClick\": \"bp.open('admin')\",\n    adminOnly: true,\n  },\n  \"profile\": {\n    \"icon\": \"desktop/assets/images/icons/icon_profile_64.png\",\n    \"label\": \"My Profile\",\n    \"description\": \"Manage your profile and settings\",\n    \"onClick\": \"bp.open('profile')\",\n    \"categories\": [\"social\", \"productivity\"]\n  },\n  \"buddylist\": {\n    \"icon\": \"desktop/assets/images/icons/icon_profile_64.png\",\n    \"label\": \"BuddyList\",\n    \"description\": \"View and manage your contacts\",\n    \"onClick\": \"bp.open('buddylist')\",\n    \"categories\": [\"social\", \"community\"]\n  },\n  \"pad\": {\n    \"icon\": \"desktop/assets/images/icons/icon_pad_64.png\",\n    \"label\": \"Buddy Apps\",\n    \"description\": \"Create hosted Apps for Buddy Pond\",\n    \"onClick\": \"bp.open('pad')\",\n    \"categories\": [\"productivity\", \"creative\", \"community\"]\n  },\n  \"pond\": {\n    \"icon\": \"desktop/assets/images/icons/icon_pond_64.png\",\n    \"label\": \"Ponds\",\n    \"description\": \"Explore shared content or communities\",\n    \"onClick\": \"bp.open('pond')\",\n    \"categories\": [\"community\", \"social\"]\n  },\n  \"file-explorer\": {\n    \"icon\": \"desktop/assets/images/icons/icon_file-explorer_64.png\",\n    \"label\": \"Buddy Files\",\n    \"description\": \"Browse and manage your files\",\n    \"onClick\": \"bp.open('file-explorer')\",\n    \"desktopOnly\": true,\n    \"categories\": [\"files\", \"productivity\"]\n  },\n  \"file-viewer\": {\n    \"icon\": \"desktop/assets/images/icons/icon_file-viewer_64.png\",\n    \"label\": \"File Viewer\",\n    \"description\": \"View files in various formats\",\n    \"onClick\": \"bp.open('file-viewer')\",\n    \"categories\": [\"files\", \"productivity\"]\n  },\n  \"paint\": {\n    \"icon\": \"desktop/assets/images/icons/icon_paint_64.png\",\n    \"label\": \"Paint\",\n    \"description\": \"Create and edit digital artwork\",\n    \"onClick\": \"bp.open('paint')\",\n    \"categories\": [\"art\", \"creative\"]\n  },\n  \"soundrecorder\": {\n    \"icon\": \"desktop/assets/images/icons/icon_soundrecorder_64.png\",\n    \"label\": \"Sound Recorder\",\n    \"description\": \"Record and save audio clips\",\n    \"onClick\": \"bp.open('soundrecorder')\",\n    \"desktopOnly\": true,\n    \"categories\": [\"audio\", \"creative\"]\n  },\n  \"youtube\": {\n    \"icon\": \"desktop/assets/images/icons/icon_interdimensionalcable_64.png\",\n    \"label\": \"Inter Dimensional Cable\",\n    \"description\": \"Watch and browse YouTube videos\",\n    \"onClick\": \"bp.open('youtube')\",\n    \"categories\": [\"entertainment\", \"media\"]\n  },\n  \"camera\": {\n    \"icon\": \"desktop/assets/images/icons/icon_camera_64.png\",\n    \"label\": \"Camera\",\n    \"description\": \"Capture photos or videos\",\n    \"onClick\": \"bp.open('camera')\",\n    \"categories\": [\"media\", \"creative\"]\n  },\n  \"piano\": {\n    \"icon\": \"desktop/assets/images/icons/icon_piano_64.png\",\n    \"label\": \"Piano\",\n    \"description\": \"Play a virtual piano keyboard\",\n    \"onClick\": \"bp.open('piano')\",\n    \"desktopOnly\": true,\n    \"categories\": [\"music\", \"creative\"]\n  },\n  \"fluid-simulation\": {\n    \"icon\": \"desktop/assets/images/icons/icon_fluidsimulation_64.png\",\n    \"label\": \"Fluid Simulation\",\n    \"description\": \"Interact with a fluid dynamics simulation\",\n    \"onClick\": \"bp.open('fluid-simulation')\",\n    \"categories\": [\"creative\", \"entertainment\"]\n  },\n  \"sampler\": {\n    \"icon\": \"desktop/assets/images/icons/icon_midifighter_64.png\",\n    \"label\": \"Sampler\",\n    \"description\": \"Create and mix audio samples\",\n    \"onClick\": \"bp.open('sampler')\",\n    \"categories\": [\"audio\", \"music\", \"creative\"]\n  },\n  \"audio-visual\": {\n    \"icon\": \"desktop/assets/images/icons/icon_visuals_64.png\",\n    \"label\": \"Audio Visuals\",\n    \"description\": \"Experience audio-responsive visuals\",\n    \"onClick\": \"bp.open('audio-visual')\",\n    \"categories\": [\"creative\", \"entertainment\", \"audio\"]\n  },\n  \"coin\": {\n    \"icon\": \"desktop/assets/images/icons/icon_coin_64.png\",\n    \"label\": \"Buddy Coins\",\n    \"description\": \"Manage your virtual currency\",\n    \"onClick\": \"bp.open('coin')\",\n    \"categories\": [\"finance\"]\n  },\n  \"portfolio\": {\n    \"icon\": \"desktop/assets/images/icons/icon_portfolio_64.png\",\n    \"label\": \"Portfolio\",\n    \"description\": \"Track your investments and assets\",\n    \"onClick\": \"bp.open('portfolio')\",\n    \"categories\": [\"finance\"]\n  },\n  \"audio-player\": {\n    \"icon\": \"desktop/assets/images/icons/icon_audio-player_64.png\",\n    \"label\": \"Audio Player\",\n    \"description\": \"Play and manage audio files\",\n    \"onClick\": \"bp.open('audio-player')\",\n    \"categories\": [\"media\", \"audio\"]\n  },\n  \"mantra\": {\n    \"icon\": \"desktop/assets/images/icons/icon_mantra_64.png\",\n    \"label\": \"Mantra\",\n    \"description\": \"Play the Mantra game\",\n    \"categories\": [\"games\"]\n  },\n  \"minesweeper\": {\n    \"icon\": \"desktop/assets/images/icons/icon_minesweeper_64.png\",\n    \"label\": \"Minesweeper\",\n    \"description\": \"Classic Minesweeper puzzle game\",\n    \"categories\": [\"games\"]\n  },\n  \"emulator-nes\": {\n    \"icon\": \"desktop/assets/images/icons/icon_nes_64.png\",\n    \"app\": \"emulator\",\n    \"context\": 'nes',\n    \"label\": \"NES\",\n    \"description\": \"Play Nintendo Entertainment System games\",\n    \"options\": { \"context\": \"nes\" },\n    \"categories\": [\"games\", \"emulators\"]\n  },\n  \"emulator-sega\": {\n    \"icon\": \"desktop/assets/images/icons/icon_sega_64.png\",\n    \"app\": \"emulator\",\n    \"context\": 'sega',\n    \"label\": \"Sega\",\n    \"description\": \"Play Sega console games\",\n    \"options\": { \"context\": \"sega\" },\n    \"categories\": [\"games\", \"emulators\"]\n  },\n  \"emulator-snes\": {\n    \"icon\": \"desktop/assets/images/icons/icon_snes_64.png\",\n    \"app\": \"emulator\",\n    \"context\": 'snes',\n    \"label\": \"SNES\",\n    \"description\": \"Play Super Nintendo games\",\n    \"options\": { \"context\": \"snes\" },\n    \"categories\": [\"games\", \"emulators\"]\n  },\n  \"emulator-atari2600\": {\n    \"icon\": \"desktop/assets/images/icons/icon_atari2600_64.png\",\n    \"app\": \"emulator\",\n    \"context\": 'atari2600',\n    \"label\": \"Atari 2600\",\n    \"description\": \"Play Atari 2600 games\",\n    \"options\": { \"context\": \"atari2600\" },\n    \"categories\": [\"games\", \"emulators\"]\n  },\n  \"emulator-n64\": {\n    \"icon\": \"desktop/assets/images/icons/icon_n64_64.png\",\n    \"app\": \"emulator\",\n    \"context\": 'n64',\n    \"label\": \"n64\",\n    \"description\": \"Play Nintendo 64 games\",\n    \"options\": { \"context\": \"n64\" },\n    \"categories\": [\"games\", \"emulators\"]\n  },\n  \"solitaire\": {\n    \"icon\": \"desktop/assets/images/icons/icon_solitaire_64.png\",\n    \"label\": \"Solitaire\",\n    \"description\": \"Classic Solitaire card game\",\n    \"categories\": [\"games\"]\n  },\n  \"globe\": {\n    \"icon\": \"desktop/assets/images/icons/icon_globe_64.png\",\n    \"label\": \"Globe\",\n    \"description\": \"Visualize global network data\",\n    \"categories\": [\"tools\"]\n  },\n  \"hacker-typer\": {\n    \"icon\": \"desktop/assets/images/icons/icon_hacker-typer_64.png\",\n    \"label\": \"Hack Typer\",\n    \"description\": \"Simulate hacking with a typing game\",\n    \"categories\": [\"tools\", \"games\"]\n  },\n  \"hex-editor\": {\n    \"icon\": \"desktop/assets/images/icons/icon_hex-editor_64.png\",\n    \"label\": \"Hex Editor\",\n    \"description\": \"Edit files in hexadecimal format\",\n    \"categories\": [\"tools\", \"productivity\"]\n  },\n  \"maps\": {\n    \"icon\": \"desktop/assets/images/icons/icon_maps_64.png\",\n    \"label\": \"Maps\",\n    \"description\": \"Access mapping and navigation tools\",\n    \"categories\": [\"tools\"]\n  },\n  \"spellbook\": {\n    \"icon\": \"desktop/assets/images/icons/icon_spellbook_64.png\",\n    \"label\": \"Spellbook\",\n    \"description\": \"Manage scripts or commands\",\n    \"categories\": [\"tools\", \"productivity\"]\n  }\n}","export default function defaultDesktopShortcuts() {\n\n    // check if we have default apps, if not initialize them\n    let installeApps = this.bp.settings.apps_installed || {};\n    if (Object.keys(installeApps).length === 0) {\n        let defaultAppList = [\n            'profile',\n            'buddylist',\n            'pad',\n            'pond',\n            'file-explorer',\n            'youtube',\n            'fluid-simulation',\n            'coin',\n            'portfolio',\n        ];\n\n        defaultAppList.forEach(appName => {\n            let app = this.bp.apps.desktop.appList[appName];\n            if (app) {\n                console.log(`Adding default app shortcut: ${appName}`);\n                console.log(app);\n                installeApps[appName] = app;\n\n                // this.bp.apps.desktop.addShortCut(app);\n            } else {\n                console.warn(`App ${appName} not found in desktop app list.`);\n            }\n        });\n\n        this.bp.set('apps_installed', installeApps);\n\n    }\n\n    let installedApps = bp.settings.apps_installed || {};\n    if (Object.keys(installedApps).length > 0) {\n        Object.keys(installedApps).forEach(appName => {\n            let app = installedApps[appName];\n            if (app) {\n                bp.apps.desktop.addShortCut({\n                    name: appName,\n                    icon: app.icon || `desktop/assets/images/icons/icon_app_64.png`,\n                    label: app.label || appName,\n                    description: app.description || 'No description available'\n                }, {\n                    onClick: () => {\n                        bp.open(appName);\n                    }\n                });\n            }\n        });\n\n    }\n\n}","/* Desktop.js - Buddy Pond - Marak Squires - 2023 */\n\n// import Folder from '../file-explorer/Folder/Folder.js';\nimport Folder from \"./lib/Folder.js\";\nimport File from \"./lib/File.js\";\n\n// shortcuts\nimport addShortCut from \"./lib/shortcuts/addShortCut.js\";\nimport addFolder from \"./lib/addFolder.js\";\nimport removeShortCut from \"./lib/shortcuts/removeShortCut.js\";\nimport createShortCut from \"./lib/shortcuts/createShortCut.js\";\nimport renameShortCut from \"./lib/shortcuts/renameShortCut.js\";\nimport arrangeShortcuts from \"./lib/shortcuts/arrangeShortCuts.js\";\n\n// apps\nimport appList from \"./lib/appList.js\";\nimport addApp from \"./lib/apps/addApp.js\";\nimport removeApp from \"./lib/apps/removeApp.js\";\n\n\n// context menu(s)\nimport setupContextMenu from \"./lib/contextmenu/setupContextMenu.js\";\nimport showContextMenu from \"./lib/contextmenu/showContextMenu.js\";\n\n// utils\nimport buildJsTreeData from \"../file-explorer/lib/buildJsTreeData.js\";\nimport viewSource from \"./lib/viewSource.js\";\n\n\n// default data\nimport defaultDesktopShortcuts from \"./lib/defaultDesktopShortcuts.js\";\n\nexport default class Desktop {\n    constructor(bp, options = {}) {\n        this.bp = bp;\n        this.options = options;\n\n        this.apps = {}; // registered apps\n\n        this.folders = [];\n\n        // Setup containers for the desktop and shortcuts\n        this.container = document.createElement('div');\n        this.container.id = 'desktop-container';\n        this.container.className = 'desktop-container';\n\n        this.shortCutsContainer = document.createElement('div');\n        this.shortCutsContainer.id = 'desktop-shortcuts-container';\n        this.shortCutsContainer.className = 'desktop-shortcuts-container';\n        this.container.appendChild(this.shortCutsContainer);\n\n        // Set parent container\n        this.parent = options.parent || document.body;\n        this.parent.appendChild(this.container);\n\n        this.enableShortcutDragging = true;\n\n        if (typeof options.enableShortcutDragging === 'boolean') {\n            this.enableShortcutDragging = options.enableShortcutDragging;\n        }\n\n        // Context menu for desktop\n        this.setupContextMenu();\n    }\n\n    async init() {\n        await this.bp.load('/v5/apps/based/desktop/desktop.css');\n\n        // Used for parsing shortcuts, not needed ( for now )\n        //let yaml = await this.bp.importModule('/v5/apps/based/ui/vendor/js-yaml.min.js', {}, false);\n        //this.yaml = yaml.jsYamlDefault;\n\n        // Render the default shortcuts\n        defaultDesktopShortcuts.call(this);\n\n        /*\n        if (this.bp.settings.wallpaper_url) {\n            // won't work unless desktop is already loaded\n            this.bp.apps.desktop.setWallpaper(this.bp.settings.wallpaper_url);\n        } else {\n            this.bp.apps.wallpaper.wallpaperManager.active = this.bp.settings.wallpaper_name || 'solid';\n            this.bp.apps.wallpaper.wallpaperManager.start();\n        }\n        */\n\n        // check if there is a wallpaper_url\n        /*\n        if (this.bp.settings.wallpaper_url) {\n            this.setWallpaper(this.bp.settings.wallpaper_url);\n        }\n        */\n\n        // console.log('this.bp.settings.active_theme', this.bp.settings.active_theme)\n        /*\n        if (this.bp.settings.active_theme) {\n            // alert(this.bp.settings.active_theme);\n            this.bp.apps.themes.applyTheme(this.bp.settings.active_theme);\n        }\n        */\n\n\n\n        // if (this.bp.settings.wallpaper) {\n\n        // TODO: after launch, port legacy wallpaper app\n        // this.setupWallpaper(); // Set initial wallpaper\n        return 'loaded desktop';\n    }\n\n    async load() {\n        return;\n        // get file list from cdn\n        // returns cloudFiles.files ( a flat array of relative file and directory paths )\n        let cloudFiles = await this.bp.apps.client.api.listFiles('desktop', 6);\n\n        // converts the flat array of files and directories into a nested jsTree data structure\n        // this conforms to the jsTree data format\n        /*\n\n        // Expected format of the node (there are no required fields)\n            {\n            id          : \"string\" // will be autogenerated if omitted\n            text        : \"string\" // node text\n            icon        : \"string\" // string for custom\n            state       : {\n                opened    : boolean  // is the node open\n                disabled  : boolean  // is the node disabled\n                selected  : boolean  // is the node selected\n            },\n            children    : []  // array of strings or objects\n            li_attr     : {}  // attributes for the generated LI node\n            a_attr      : {}  // attributes for the generated A node\n            }\n        */\n\n        // TODO: which will be easier to write a renderer for? flat array or tree data?\n        // We believe tree data will be easier to write a renderer for\n        let treeData = buildJsTreeData(this.bp.me, cloudFiles.files);\n        console.log('treeData', treeData);\n\n        // example shortcut format\n        let yamlStr = `\n                type: Shortcut\n                target: /path/to/application.exe\n                parameters:\n                startIn: /path/to/\n                args: \"--example-arg\"\n                icon: /path/to/icon.png\n                hotkey: Ctrl+Alt+A\n                description: \"A shortcut to an application\"\n        `;\n        // load the yaml as json\n        let doc = this.yaml.load(yamlStr);\n        console.log(doc);\n\n        // we now have treeData which is the form of a jsTree data structure\n        let userRoot = treeData[0]; // the top node is the buddyname / user root / foldername on CDN\n        console.log('userRoot', userRoot) // the desktop folder itself ( since we query for it )\n        let desktopRoot = userRoot.children[0]; // the desktop folder itself ( since we query for it )\n\n        // the problem is now we intended to render the \"Desktop\" folder contents at the top-level\n        // ( such that all its children are visible on the desktop )\n        // however; with the current structure we see a \"desktop\" folder on the desktop\n        // TODO: we need a way to render the co ntents of a folder at a top-level\n        // or change the way folders are rendered\n        // render the userRoot\n        this.renderNode(desktopRoot, this.shortCutsContainer, 0, true);\n       // arrangeDesktop(); // global ( for now remove later )\n\n        return;\n\n\n\n    }\n\n    renderNode(node, parentElement, depth = 0, skipFolderUI = false) {\n        console.log('renderNode', node, parentElement, depth, skipFolderUI);\n        if (node.children && node.children.length > 0) {\n            // Check if we should skip rendering the folder UI (used for top-level folder)\n            if (skipFolderUI) {\n                // Directly render the children in the parent element\n                node.children.forEach(child => this.renderNode(child, parentElement, depth + 1));\n            } else {\n                // It's a folder and should be rendered as such\n                const folder = new Folder(node, parentElement, this, depth);\n                folder.render();\n            }\n        } else {\n            // It's a file or shortcut\n            if (node.text.endsWith('.yml')) {\n                const shortcut = new Shortcut(node, parentElement);\n                shortcut.render();\n            } else {\n                const file = new File(node, parentElement, this, depth);\n                file.render();\n            }\n        }\n    }\n\n    toggleMute () {\n        if (this.bp.settings.audio_enabled === false) {\n          this.bp.set('audio_enabled', true);\n          $('.volumeFull').show();\n          $('.volumeMuted').hide();\n          this.bp.play('desktop/assets/audio/VOLUME-ON.mp3', { tryHard: Infinity });\n        } else {\n          this.bp.set('audio_enabled', false);\n          $('.volumeFull').hide();\n          $('.volumeMuted').show();\n        }\n    }\n\n    openFolder(folderId) {\n        console.log('openFolder', folderId);\n        // Find the folder by ID\n        const folder = this.folders.find(f => f.data.name === folderId);\n        if (folder) {\n            // Open the folder (this could be a method in the Folder class)\n            folder.open();\n        } else {\n            console.error(`Folder with ID ${folderId} not found.`);\n        }\n    }\n\n}\n\nDesktop.prototype.Folder = Folder;\nDesktop.prototype.File = File;\nDesktop.prototype.addShortCut = addShortCut;\nDesktop.prototype.addFolder = addFolder;\nDesktop.prototype.removeShortCut = removeShortCut;\nDesktop.prototype.arrangeShortcuts = arrangeShortcuts;\nDesktop.prototype.setupContextMenu = setupContextMenu;\nDesktop.prototype.showContextMenu = showContextMenu;\n// Desktop.prototype.buildJsTreeData = buildJsTreeData;\nDesktop.prototype.viewSource = viewSource;\n\nDesktop.prototype.showDesktopIcons = function showDesktopIcons() {\n    this.shortCutsContainer.style.display = 'flex';\n    if (this.bp.isMobile()) {\n        this.shortCutsContainer.style.position = 'absolute';\n        this.shortCutsContainer.style.left = '0px';\n        this.shortCutsContainer.style.bottom = '0px';\n    }\n}\n\nclass Shortcut {\n    constructor(data, parentElement) {\n        this.data = data;\n        this.parentElement = parentElement;\n    }\n\n    render() {\n        const shortcutElement = document.createElement('div');\n        shortcutElement.textContent = this.data.text || this.data.id;\n        shortcutElement.className = 'shortcut';\n\n        shortcutElement.classList.add('icon', 'shortcut', 'bp-desktop-iconp');   \n\n        this.parentElement.appendChild(shortcutElement);\n    }\n}\n\nDesktop.prototype.appList = appList;\nDesktop.prototype.createShortCut = createShortCut;\nDesktop.prototype.renameShortCut = renameShortCut;\nDesktop.prototype.addApp = addApp;\nDesktop.prototype.removeApp = removeApp;\n","export default function addShortCut(app, options = {}, parent) {\n    // Default onClick behavior if not provided\n    if (typeof options.onClick !== 'function') {\n        options.onClick = () => console.log('desktop app - Missing options.onClick function', app.name);\n    }\n\n    // Create the shortcut element\n    const el = document.createElement('div');\n    el.className = `icon shortcut ${app.class || ''} bp-desktop-shortcut`;\n    el.setAttribute('data-app', app.name);\n    const anchor = document.createElement('a');\n    // anchor.href = app.href || `#${app.name}`;\n\n    if (!app.textIcon) {\n        const image = document.createElement('img');\n        image.className = 'bp-desktop-icon';\n        image.loading = 'lazy';\n        image.src = app.icon;\n        if (options.imageStyle) {\n            Object.keys(options.imageStyle).forEach(key => {\n                image.style[key] = options.imageStyle[key];\n            });\n        }\n        anchor.appendChild(image);\n    } else {\n        const image = document.createElement('div');\n        image.textContent = app.textIcon;\n        image.style.fontSize = '32px';\n        image.style.position = 'relative';\n        image.style.bottom = '10px';\n        if (options.imageStyle) {\n            Object.keys(options.imageStyle).forEach(key => {\n                image.style[key] = options.imageStyle[key];\n            });\n        }\n        anchor.appendChild(image);\n    }\n\n    const title = document.createElement('span');\n    title.className = 'title';\n    title.textContent = app.label || app.name;\n    anchor.appendChild(title);\n    el.appendChild(anchor);\n\n    // Adding onClick event to the .icon container\n    // TODO: make this event only happen on touchend\n    // the idea here is that if the element was dragged, we don't want to trigger the click event\n    // but if it was tapped, we do want to trigger the click event \n    /*\n    el.addEventListener('click', (e) => {\n        alert()\n        e.preventDefault();\n        options.onClick(e, app);\n        return false;\n    });\n    */\n\n    let pointerDownPos = null;\n    let wasDragging = false;\n\n    el.addEventListener('pointerdown', (e) => {\n        pointerDownPos = { x: e.clientX, y: e.clientY };\n        wasDragging = false;\n    });\n\n    el.addEventListener('pointermove', (e) => {\n        if (!pointerDownPos) return;\n\n        const dx = e.clientX - pointerDownPos.x;\n        const dy = e.clientY - pointerDownPos.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n\n        // If moved more than a threshold, consider it a drag\n        if (distance > 5) {\n            wasDragging = true;\n        }\n    });\n\n    el.addEventListener('pointerup', (e) => {\n        if (!wasDragging) {\n            e.preventDefault(); // Prevent default anchor behavior\n            options.onClick(e, app);\n        }\n\n        pointerDownPos = null;\n        wasDragging = false;\n\n        // update the x/y position of the app shortcut inside this.bp.settings.installed_apps\n        let appsInstalled = this.bp.settings.apps_installed || {};\n        appsInstalled[app.name] = appsInstalled[app.name] || app;\n\n        appsInstalled[app.name].position = {\n            x: el.offsetLeft,\n            y: el.offsetTop\n        }\n\n        console.log('saving appsInstalled', appsInstalled)\n        this.bp.set('apps_installed', appsInstalled);\n\n        console.log('apppp', app);\n        return false;\n\n    });\n\n    // remove all existing context menus to avoid duplicates\n    /*\n    const existingMenus = document.querySelectorAll('.desktop-context-menu');\n    existingMenus.forEach(menu => {\n        menu.remove();\n    });\n    */\n\n    // Context menu setup\n    const contextMenu = document.createElement('div');\n    contextMenu.className = 'desktop-context-menu';\n    contextMenu.innerHTML = `\n        <div class=\"bp-context-menu-item\" data-action=\"delete\">Delete Shortcut</div>\n        <div class=\"bp-context-menu-item\" data-action=\"rename\">Rename Shortcut</div>\n    `;\n    document.body.appendChild(contextMenu); // Append to body for positioning\n\n    // Hide context menu on click elsewhere\n    document.addEventListener('click', () => {\n        contextMenu.style.display = 'none';\n    });\n\n    // Prevent default context menu and show custom menu\n    el.addEventListener('contextmenu', (e) => {\n\n        const existingMenu = $('.desktop-context-menu');\n        // existingMenu.hide();\n\n\n        console.log('Context menu triggered for app:', app.name);\n        e.preventDefault();\n        // Position menu near cursor, ensuring it stays within viewport\n        const menuWidth = 150; // Approximate width of context menu\n        const menuHeight = 80; // Approximate height of context menu\n        const posX = e.clientX;\n        const posY = e.clientY;\n        const maxX = window.innerWidth - menuWidth;\n        const maxY = window.innerHeight - menuHeight;\n        contextMenu.style.left = `${Math.min(posX, maxX)}px`;\n        contextMenu.style.top = `${Math.min(posY, maxY)}px`;\n        contextMenu.style.display = 'block';\n    });\n\n    // Handle context menu actions\n    contextMenu.addEventListener('click', (e) => {\n        const action = e.target.getAttribute('data-action');\n        if (action === 'delete') {\n            this.deleteShortcut(app.name, app, options.context);\n        } else if (action === 'rename') {\n            this.renameShortCut(app.name, title, options.context);\n        }\n        contextMenu.style.display = 'none';\n    });\n\n    // Append the new shortcut to the container\n    let p = parent || this.shortCutsContainer;\n    p.appendChild(el);\n\n    // Apply jQuery UI draggable if enabled\n    if (this.enableShortcutDragging) {\n        $(el).draggable({\n            containment: 'parent' // Confine dragging within the parent container\n        });\n    }\n\n    // Register the app with desktop.apps\n    app.options = options;\n    const appKey = options && options.context ? `${app.name}-${options.context}` : app.name;\n    this.apps[appKey] = app;\n\n    // Stubbed functions for context menu actions\n    this.deleteShortcut = function (appName, app, context) {\n        console.log(`Stub: Deleting shortcut for ${appName}${context ? `-${context}` : ''}`);\n        // Call removeApp to align with App Store logic\n        this.removeApp(appName, app);\n    };\n\n}","import Folder from './Folder.js';\nimport arrangeShortcuts from '../lib/shortcuts/arrangeShortCuts.js';\nexport default function addFolder(metadata) {\n\n    let that = this;\n\n    function renderItem(_item, parent) {\n\n        let item = {};\n        if (typeof _item === 'string') {\n            item.id = _item;\n            item.name = _item;\n            item.label = _item;\n        } else {\n            item = _item;\n        }\n\n        if (!item.icon) {\n            item.icon = `/desktop/assets/images/icons/icon_${item.id}_64.png`;\n        }\n\n        item.options = item.options || {};\n        that.addShortCut({\n            name: item.id,\n            icon: item.icon,\n            label: item.label,\n        }, {\n            onClick: () => {\n                bp.open(item.id, item.options);\n            },\n            ...item.options\n        }, parent);\n\n    }\n\n    let folderHolder = document.createElement('div');\n    folderHolder.className = 'folder-holder';\n\n    metadata.items.forEach(item => {\n        renderItem(item, folderHolder);\n    });\n\n\n    const folder = new Folder(metadata, {\n        desktop: this,\n        parentElement: this.shortCutsContainer,\n        depth: 0,\n        onOpen: () => {\n\n            this.arrangeShortcuts(4, {\n                parent: folderHolder,\n                x: 0,\n                y: 20\n            })\n\n            console.log('Folder opened:', metadata.name);\n            this.bp.apps.ui.windowManager.createWindow({\n                id: metadata.name,\n                title: metadata.name,\n                icon: '/desktop/assets/images/icons/icon_folder.png',\n                width: metadata.width || 400,\n                height: metadata.height || 150,\n                parent: $('#desktop').get(0),\n                content: folderHolder\n            });\n\n        }\n    });\n    this.folders.push(folder);\n\n    folder.render()\n    //this.addShortCut(folder);\n    // this.shortCutsContainer.appendChild(folder.render());\n}","export default function removeShortCut(appName) {\n    console.log(`Removing shortcut for app: ${appName}`);\n    // Find and remove a shortcut based on the app name\n    const shortcuts = Array.from(this.shortCutsContainer.children);\n    const shortcut = shortcuts.find(el => $(el).data('app') === appName);\n    if (shortcut) {\n        this.shortCutsContainer.removeChild(shortcut);\n    }\n}","export default function arrangeShortcuts(cols = 4, options = {\n    rowWidth: 80,\n    rowHeight: 100,\n    x: 0, // TODO: we should start from the x and y position in our calculations\n    y: 0,\n    ignoreSavedPosition: true\n}) {\n    let parent;\n    if (typeof options.parent !== 'undefined') {\n        parent = options.parent;\n    } else {\n        parent = this.shortCutsContainer;\n    }\n\n    if (typeof options.rowWidth !== 'number') {\n        options.rowWidth = 74;\n        if (this.bp.isMobile()) {\n            options.rowWidth = 256;\n        }\n    }\n\n    if (typeof options.rowHeight !== 'number') {\n        options.rowHeight = 100;\n        if (this.bp.isMobile()) {\n            options.rowHeight = 256;\n        }\n    }\n\n    if (typeof options.x !== 'number') {\n        options.x = 0;\n    }\n\n    if (typeof options.y !== 'number') {\n        options.y = 0;\n    }\n\n    const containerWidth = parent.offsetWidth || 800; // Get the container's width\n    const maxCols = Math.floor(containerWidth / options.rowWidth); // Calculate the maximum number of columns\n    const actualCols = cols < maxCols ? cols : maxCols; // Choose the lesser to avoid overflow\n\n    let appsInstalled = this.bp.settings.apps_installed || {};\n\n    Array.from(parent.children).forEach((icon, index) => {\n        let appName = icon.getAttribute('data-app');\n        let app = appsInstalled[appName] || {};\n        let x = (index % actualCols) * options.rowWidth; // Calculate x position\n        let y = Math.floor(index / actualCols) * options.rowHeight; // Calculate y position\n\n        let offSetY = 100;\n        if (this.bp.isMobile()) { // TODO: remove\n            y += offSetY; // Add an offset to the y position\n\n        }\n        let offsetX = 15;\n        x += offsetX; // Add an offset to the x position\n\n        x += options.x;\n        y += options.y;\n\n        if (app && app.position && !options.ignoreSavedPosition) {\n            // If the app has a specific position, use that instead\n            x = app.position.x || x;\n            y = app.position.y || y;\n        }\n\n        // update the x/y position of the app shortcut inside this.bp.settings.installed_apps\n        appsInstalled[appName] = appsInstalled[appName] || app;\n        appsInstalled[appName].position = {\n            x: x,\n            y: y\n        }\n\n        // console.log('x:', x, 'y:', y);\n        icon.style.position = 'absolute'; // Corrected typo here\n        icon.style.left = `${x}px`; // Set left position\n        icon.style.top = `${y}px`; // Set top position\n    });\n    this.bp.set('apps_installed', appsInstalled);\n\n}","// TODO: implement context menu options for desktop itself\nexport default function setupContextMenu() {\n    this.container.oncontextmenu = (event) => {\n        // check if target has class \"bp-desktop-icon\"\n        if (event.target.classList.contains('bp-desktop-icon')) {\n            // If it does, prevent the default context menu\n            return;\n        }\n\n        // find any existing context menu and remove it\n        const existingMenu = $('.desktop-context-menu');\n        existingMenu.hide();\n\n        event.preventDefault();\n        this.showContextMenu(event.clientX, event.clientY);\n    };\n}","export default function  showContextMenu(x, y) {\n\n    const menu = document.createElement('div');\n    menu.className = 'desktop-context-menu';\n    menu.style.top = `${y}px`;\n    menu.style.left = `${x}px`;\n    menu.style.display = 'block';\n    // z-index is needed to display the menu on top of other elements\n    menu.style.zIndex = '9999';\n    menu.innerHTML = `\n        <ul>\n            <!-- <li onclick=\"bp.apps.desktop.createShortCut()\">New Shortcut...</li> -->\n            <li onclick=\"bp.apps.desktop.arrangeShortcuts(3, {\n    rowWidth: 80,\n    rowHeight: 100,\n    x: 0,\n    y: 0,\n    ignoreSavedPosition: true\n            })\">Arrange Icons</li>\n            <li onclick=\"bp.open('profile', { context: 'themes' })\">Desktop Settings</li>\n            <li onclick=\"bp.apps.wallpaper.removeWallpaper()\">Remove Wallpaper</li>\n            <li onclick=\"bp.apps.desktop.viewSource()\">View Source</li>\n        </ul>\n    `;\n    // clear the body before appending the menu\n    document.body.appendChild(menu);\n    // Hide menu on click anywhere\n    document.addEventListener('click', () => menu.remove(), { once: true });\n}","export default async function viewSource (url = 'https://raw.githubusercontent.com/Marak/buddypond/refs/heads/master/index.html') {\n    // fetch the content as text\n    const response = await fetch(url);\n    const content = await response.text();\n    await this.bp.load('editor-monaco', {\n        content: content\n    });\n    this.bp.apps['editor-monaco'].open();\n}","export default function renameShortCut(appName, titleElement) {\n    \n    const newName = prompt('Enter new shortcut name:', titleElement.textContent);\n\n    // TODO: forbidden Note check goes here ( no bad names in shortcuts )\n    let shortcut = $(`.bp-desktop-shortcut[data-app=\"${appName}\"]`);\n    console.log(`Renaming shortcut ${shortcut} to ${newName}`);\n    console.log(`Shortcut element:`, shortcut);\n\n    /*\n    // Update the shortcut name\n    shortcut.name = newName;\n    \n    // Update the label if it exists\n    if (shortcut.label) {\n        shortcut.label = newName;\n    }\n        */\n    \n    //let titleElement = shortcut.find('.title');\n    // Update the title element's text content\n    titleElement.textContent = newName;\n\n    let installed_apps = this.bp.get('apps_installed') || {};\n    // Update the app label in the installed apps\n    if (installed_apps[appName]) {\n        installed_apps[appName].label = newName;\n        this.bp.set('apps_installed', installed_apps);\n    } else {\n        console.warn(`App ${appName} not found in installed apps.`);\n    }\n\n    // Update the icon's title text\n    /*\n    const iconElement = document.querySelector(`.bp-desktop-shortcut[data-app=\"${shortcut.name}\"] .title`);\n    if (iconElement) {\n        iconElement.textContent = newName;\n    } else {\n        console.warn(`Shortcut element for ${shortcut.name} not found.`);\n    }\n    */\n    \n    // Optionally, you can also update the app settings or any other related data\n    //this.bp.set(`apps_installed.${shortcut.name}`, shortcut);\n    \n    // Play a sound effect for renaming\n    //this.bp.play('desktop/assets/audio/APP-RENAME.wav');\n    \n    // Optionally, you can rearrange shortcuts if needed\n    // this.bp.apps.desktop.arrangeShortcuts();\n    \n    console.log(`Shortcut renamed to ${newName}`);\n};","let sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));\n\nexport default async function addApp(appName, app) {\n\n    if (!appName) {\n        console.error('No app name provided');\n        return;\n    }\n\n    if (!app) {\n        console.log('this.bp.apps.desktop', this.bp.apps.desktop)\n        // if no app is provided, look up the app in the appstore\n        app = this.bp.apps.desktop.appList[appName];\n    }\n\n    if (!app) {\n        console.error(`App ${appName} not found in appstore`);\n        return;\n    }\n    console.log(`Stub: Adding app ${app} to desktop`);\n    this.bp.play('desktop/assets/audio/APP-ADD.wav');\n    let installedApps = this.bp.settings.apps_installed || {};\n    // TODO: lookup actual app object from appstore.apps\n    installedApps[appName] = app;\n    this.bp.set('apps_installed', installedApps);\n    this.bp.apps.desktop.addShortCut({\n        name: appName,\n        icon: `desktop/assets/images/icons/icon_${appName}_64.png`,\n        label: app.label || appName,\n    }, {\n        onClick: () => {\n            this.bp.open(appName);\n        }\n    });\n    // this.bp.apps.desktop.hideLoadingProgressIndicator();\n    this.bp.apps.desktop.arrangeShortcuts();\n    await sleep(777); // Simulate delay for UI update\n}\n","let sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));\n\nexport default async function removeApp(appName, app) {\n    console.log(`Stub: Adding app ${app} to desktop`);\n\n    this.bp.play('desktop/assets/audio/APP-REMOVE.wav');\n\n    let installedApps = this.bp.settings.apps_installed || {};\n    delete installedApps[appName];\n    this.bp.set('apps_installed', installedApps);\n    //desktop.ui.renderDesktopShortCuts();\n\n    // alert('removing ' + appName);\n    this.bp.apps.desktop.removeShortCut(appName);\n\n    // desktop.ui.hideLoadingProgressIndicator();\n    this.bp.apps.desktop.arrangeShortcuts();\n    await sleep(777); // Simulate delay for UI update\n\n}\n"],"names":["Folder","constructor","data","options","this","parentElement","desktop","depth","render","app","folderDiv","document","createElement","className","class","classList","add","anchor","image","loading","src","title","textContent","label","name","id","appendChild","$","draggable","containment","addEventListener","e","onOpen","open","File","console","log","el","icon","onClick","enableShortcutDragging","saveShortCut","shortcut","JSON","parse","localStorage","getItem","shortcutType","target","description","parameters","bp","apps","addShortCut","window","textIcon","charAt","toUpperCase","createShortCutWindow","close","appList","admin","adminOnly","profile","categories","buddylist","pad","pond","desktopOnly","paint","soundrecorder","youtube","camera","piano","sampler","coin","portfolio","mantra","minesweeper","context","solitaire","globe","maps","spellbook","defaultDesktopShortcuts","installeApps","settings","apps_installed","Object","keys","length","forEach","appName","warn","set","installedApps","Desktop","folders","container","shortCutsContainer","parent","body","setupContextMenu","init","load","call","renderNode","node","skipFolderUI","children","child","text","endsWith","Shortcut","toggleMute","audio_enabled","show","hide","play","tryHard","Infinity","openFolder","folderId","folder","find","f","error","prototype","setAttribute","style","fontSize","position","bottom","imageStyle","key","pointerDownPos","wasDragging","x","clientX","y","clientY","dx","dy","Math","sqrt","preventDefault","appsInstalled","offsetLeft","offsetTop","contextMenu","innerHTML","display","posX","posY","maxX","innerWidth","maxY","innerHeight","left","min","top","action","getAttribute","deleteShortcut","renameShortCut","appKey","removeApp","addFolder","metadata","that","folderHolder","items","item","_item","renderItem","arrangeShortcuts","ui","windowManager","createWindow","width","height","get","content","push","removeShortCut","Array","from","removeChild","cols","rowWidth","rowHeight","ignoreSavedPosition","isMobile","containerWidth","offsetWidth","maxCols","floor","actualCols","index","oncontextmenu","event","contains","showContextMenu","menu","zIndex","remove","once","viewSource","async","url","response","fetch","showDesktopIcons","shortcutElement","createShortCut","focus","restore","shortCutHtml","map","join","minWidth","minHeight","resizable","minimizable","maximizable","closable","focusable","maximized","minimized","onclose","on","value","appSelectGroup","commandGroup","prop","val","trim","command","alert","titleElement","newName","prompt","installed_apps","addApp","ms","Promise","resolve","setTimeout"],"mappings":"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"}