{"version":3,"file":"youtube.js","sources":["../../../apps/based/youtube/youtube.js"],"sourcesContent":["export default class Youtube {\n    constructor(bp, options = {}) {\n        this.bp = bp;\n        this.youtubeWindow = null;\n        this.player = null;\n        // default video static to start rZhbnty03U4\n        return this;\n    }\n\n    async init() {\n        this.html = await this.bp.load('/v5/apps/based/youtube/youtube.html');\n        // is importModule not using the correct host path here?\n        let playlistModule = await this.bp.importModule('/v5/apps/based/youtube/data/playlist.js', {}, false);\n        this.playlist = playlistModule.default;\n\n        if (!window.YT) {\n            await this.bp.appendScript('https://www.youtube.com/iframe_api');\n            window.onYouTubeIframeAPIReady = () => {\n                this.apiReady = true;\n            };\n        } else {\n            this.apiReady = true;\n        }\n    }\n\n    async close() {\n        if (this.player) {\n            this.player.destroy();\n            this.player = null;\n        }\n        if (this.youtubeWindow) {\n            this.youtubeWindow = null;\n        }\n    }\n\n    async open(options = {}) {\n        if (this.youtubeWindow) {\n            if (this.player && options.context) {\n                this.player.loadVideoById(options.context);\n            }\n            return this.youtubeWindow;\n        }\n\n        this.youtubeWindow = this.bp.apps.ui.windowManager.createWindow({\n            id: 'youtube',\n            title: 'Interdimensional Cable',\n            x: 50,\n            y: 100,\n            width: 600,\n            height: 480,\n            minWidth: 200,\n            minHeight: 200,\n            parent: $('#desktop')[0],\n            icon: '/desktop/assets/images/icons/icon_interdimensionalcable_64.png',\n            content: this.html,\n            resizable: true,\n            minimizable: true,\n            maximizable: true,\n            closable: true,\n            focusable: true,\n            maximized: false,\n            minimized: false,\n            onClose: () => this.close()\n        });\n\n        // Wait for YouTube API to be ready\n        while (!this.apiReady) {\n            await new Promise((resolve) => setTimeout(resolve, 100));\n        }\n\n        $('.orb-holder', this.youtubeWindow.content).on('click', () => {\n            this.playRandomVideo();\n        });\n\n        let startingVideo = options.context || this.playlist[Math.floor(Math.random() * this.playlist.length)];\n\n        this.player = new YT.Player('youtube-player', {\n            height: '390',\n            width: '640',\n            videoId: startingVideo,\n            playerVars: { autoplay: 1, controls: 1 },\n            events: {\n                'onReady': this.onPlayerReady,\n                'onStateChange': (event) => this.onPlayerStateChange(event),\n                'onError': (event) => this.onPlayerError(event)\n            },\n            origin: window.location.origin\n        });\n        return this.youtubeWindow;\n    }\n\n    onPlayerReady(event) {\n        console.log('YouTube Player Ready', event);\n    }\n\n    onPlayerStateChange(event) {\n        if (event.data === YT.PlayerState.ENDED) {\n            this.playRandomVideo();\n        }\n    }\n\n    onPlayerError(event) {\n        console.warn('YouTube Player Error:', event);\n\n        // Handle different error types\n        const errorCodes = [100, 101, 150]; // Common unavailable video errors\n        if (errorCodes.includes(event.data) || event.data === 2) {\n            console.warn('Video unavailable, selecting a new one...');\n            this.playRandomVideo();\n        }\n    }\n\n    playRandomVideo() {\n        if (!this.player || !this.playlist) return;\n        let randomVideo = this.playlist[Math.floor(Math.random() * this.playlist.length)];\n        this.player.loadVideoById(randomVideo);\n    }\n}"],"names":["Youtube","constructor","bp","options","this","youtubeWindow","player","init","html","load","playlistModule","importModule","playlist","default","window","YT","apiReady","appendScript","onYouTubeIframeAPIReady","close","destroy","open","context","loadVideoById","apps","ui","windowManager","createWindow","id","title","x","y","width","height","minWidth","minHeight","parent","$","icon","content","resizable","minimizable","maximizable","closable","focusable","maximized","minimized","onClose","Promise","resolve","setTimeout","on","playRandomVideo","startingVideo","Math","floor","random","length","Player","videoId","playerVars","autoplay","controls","events","onReady","onPlayerReady","onStateChange","event","onPlayerStateChange","onError","onPlayerError","origin","location","console","log","data","PlayerState","ENDED","warn","includes","randomVideo"],"mappings":"AAAe,MAAMA,EACjB,WAAAC,CAAYC,EAAIC,EAAU,IAKtB,OAJAC,KAAKF,GAAKA,EACVE,KAAKC,cAAgB,KACrBD,KAAKE,OAAS,KAEPF,IACf,CAEI,UAAMG,GACFH,KAAKI,WAAaJ,KAAKF,GAAGO,KAAK,uCAE/B,IAAIC,QAAuBN,KAAKF,GAAGS,aAAa,0CAA2C,CAAE,GAAE,GAC/FP,KAAKQ,SAAWF,EAAeG,QAE1BC,OAAOC,GAMRX,KAAKY,UAAW,SALVZ,KAAKF,GAAGe,aAAa,sCAC3BH,OAAOI,wBAA0B,KAC7Bd,KAAKY,UAAW,GAKhC,CAEI,WAAMG,GACEf,KAAKE,SACLF,KAAKE,OAAOc,UACZhB,KAAKE,OAAS,MAEdF,KAAKC,gBACLD,KAAKC,cAAgB,KAEjC,CAEI,UAAMgB,CAAKlB,EAAU,IACjB,GAAIC,KAAKC,cAIL,OAHID,KAAKE,QAAUH,EAAQmB,SACvBlB,KAAKE,OAAOiB,cAAcpB,EAAQmB,SAE/BlB,KAAKC,cA0BhB,IAvBAD,KAAKC,cAAgBD,KAAKF,GAAGsB,KAAKC,GAAGC,cAAcC,aAAa,CAC5DC,GAAI,UACJC,MAAO,yBACPC,EAAG,GACHC,EAAG,IACHC,MAAO,IACPC,OAAQ,IACRC,SAAU,IACVC,UAAW,IACXC,OAAQC,EAAE,YAAY,GACtBC,KAAM,iEACNC,QAASnC,KAAKI,KACdgC,WAAW,EACXC,aAAa,EACbC,aAAa,EACbC,UAAU,EACVC,WAAW,EACXC,WAAW,EACXC,WAAW,EACXC,QAAS,IAAM3C,KAAKe,WAIhBf,KAAKY,gBACH,IAAIgC,SAASC,GAAYC,WAAWD,EAAS,OAGvDZ,EAAE,cAAejC,KAAKC,cAAckC,SAASY,GAAG,SAAS,KACrD/C,KAAKgD,qBAGT,IAAIC,EAAgBlD,EAAQmB,SAAWlB,KAAKQ,SAAS0C,KAAKC,MAAMD,KAAKE,SAAWpD,KAAKQ,SAAS6C,SAc9F,OAZArD,KAAKE,OAAS,IAAIS,GAAG2C,OAAO,iBAAkB,CAC1CzB,OAAQ,MACRD,MAAO,MACP2B,QAASN,EACTO,WAAY,CAAEC,SAAU,EAAGC,SAAU,GACrCC,OAAQ,CACJC,QAAW5D,KAAK6D,cAChBC,cAAkBC,GAAU/D,KAAKgE,oBAAoBD,GACrDE,QAAYF,GAAU/D,KAAKkE,cAAcH,IAE7CI,OAAQzD,OAAO0D,SAASD,SAErBnE,KAAKC,aACpB,CAEI,aAAA4D,CAAcE,GACVM,QAAQC,IAAI,uBAAwBP,EAC5C,CAEI,mBAAAC,CAAoBD,GACZA,EAAMQ,OAAS5D,GAAG6D,YAAYC,OAC9BzE,KAAKgD,iBAEjB,CAEI,aAAAkB,CAAcH,GACVM,QAAQK,KAAK,wBAAyBX,IAGnB,CAAC,IAAK,IAAK,KACfY,SAASZ,EAAMQ,OAAwB,IAAfR,EAAMQ,QACzCF,QAAQK,KAAK,6CACb1E,KAAKgD,kBAEjB,CAEI,eAAAA,GACI,IAAKhD,KAAKE,SAAWF,KAAKQ,SAAU,OACpC,IAAIoE,EAAc5E,KAAKQ,SAAS0C,KAAKC,MAAMD,KAAKE,SAAWpD,KAAKQ,SAAS6C,SACzErD,KAAKE,OAAOiB,cAAcyD,EAClC"}