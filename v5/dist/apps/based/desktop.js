class t{constructor(t,e={}){this.data=t,this.parentElement=e.parentElement,this.desktop=e.desktop,this.depth=e.depth,this.options=e}render(t={}){t=this.data;const e=document.createElement("div");e.className=`folder ${t.class||""}`,this.depth>1&&e.classList.add("hidden"),e.classList.add("icon","shortcut");const o=document.createElement("a"),n=document.createElement("img");n.className="bp-desktop-icon",n.loading="lazy",n.src="desktop/assets/images/icons/icon_folder_64.png";const s=document.createElement("span");s.className="title",s.textContent=t.label||t.name||t.id,o.appendChild(n),o.appendChild(s),e.appendChild(o),$(e).draggable({containment:"parent"}),e.addEventListener("mousedown",(t=>{this.options.onOpen()})),this.parentElement.appendChild(e)}open(){this.options.onOpen()}}function e(t){console.log("Saving shortcut:",t);JSON.parse(localStorage.getItem("bp-shortcuts")||"{}")[t.name]={label:t.label,shortcutType:t.shortcutType,target:t.target,icon:t.icon,description:t.parameters.description},this.bp.apps.desktop.addShortCut({name:t.name,label:t.label,icon:t.icon,description:t.description,textIcon:t.icon?null:t.label.charAt(0).toUpperCase()},{onClick:t.onClick}),this.arrangeShortcuts(2,{rowWidth:80,rowHeight:100,x:0,y:0,ignoreSavedPosition:!1}),this.createShortCutWindow.close()}var o={admin:{name:"admin",icon:"desktop/assets/images/icons/icon_profile_64.png",label:"Admin",onClick:"bp.open('admin')",adminOnly:!0},profile:{icon:"desktop/assets/images/icons/icon_myprofile_64.png",label:"My Profile",description:"Manage your profile and settings",onClick:"bp.open('profile')",categories:["social","productivity"]},buddylist:{icon:"desktop/assets/images/icons/icon_profile_64.png",label:"BuddyList",description:"View and manage your contacts",onClick:"bp.open('buddylist')",categories:["social","community"]},pad:{icon:"desktop/assets/images/icons/icon_pad_64.png",label:"Buddy Apps",description:"Create hosted Apps for Buddy Pond",onClick:"bp.open('pad')",categories:["productivity","creative","community"],alias:["buddy-apps"]},pond:{icon:"desktop/assets/images/icons/icon_pond_64.png",label:"Ponds",description:"Explore shared content or communities",onClick:"bp.open('pond')",categories:["community","social"]},"file-explorer":{icon:"desktop/assets/images/icons/icon_file-explorer_64.png",label:"Buddy Files",description:"Browse and manage your files",onClick:"bp.open('file-explorer')",desktopOnly:!0,categories:["files","productivity"],alias:["buddy-files","files"]},"plays-doodle-jump-extra":{icon:"desktop/assets/images/icons/icon_doodle-jump-extra_64.png",label:"Doodle Jump Extra",description:"Play Doodle Jump Extra game",onClick:"bp.open('doodle-jump-extra')",categories:["games","entertainment"],author:"Plays.org",alias:["doodle-jump"]},"plays-malpek":{icon:"desktop/assets/images/icons/icon_plays-malpek_64.png",label:"Malpek",description:"Play Malpek game",onClick:"bp.open('plays-malpek')",categories:["games","entertainment"],author:"Plays.org",alias:["malpek"]},"frvr-kittenforce":{icon:"desktop/assets/images/icons/icon_kittenforce-frvr_64.png",label:"Kitten Force",description:"Play Kitten Force FRVR game",onClick:"bp.open('frvr-kittenforce')",categories:["games","entertainment"],author:"FRVR Games",alias:["kittenforce"]},minipaint:{icon:"desktop/assets/images/icons/icon_minipaint_64.png",label:"miniPaint",author:"ViliusL",description:"Advanced image editor to create and edit images",onClick:"bp.open('minipaint')",categories:["art","creative"]},"frvr-greed":{icon:"desktop/assets/images/icons/icon_frvr-greed_64.png",label:"Greed",description:"Play Greedy FRVR game",onClick:"bp.open('frvr-greed')",categories:["games","entertainment"],author:"FRVR Games",alias:["greed"]},patatap:{icon:"desktop/assets/images/icons/icon_patatap_64.png",label:"Patatap",description:"Create music and animations with touch and keyboard input",onClick:"bp.open('patatap')",categories:["audio","music","creative"],author:"Jono Brandel"},soundrecorder:{icon:"desktop/assets/images/icons/icon_soundrecorder_64.png",label:"Sound Recorder",author:"Isaiah Odhner",description:"Record and save audio clips",onClick:"bp.open('soundrecorder')",desktopOnly:!0,categories:["audio","creative"],alias:["recorder"]},youtube:{icon:"desktop/assets/images/icons/icon_interdimensionalcable_64.png",label:"IDC Cable",description:"Watch and browse YouTube videos",onClick:"bp.open('youtube')",categories:["entertainment","media"],alias:["idc"]},camera:{icon:"desktop/assets/images/icons/icon_camera_64.png",label:"Camera",description:"Capture photos or videos",onClick:"bp.open('camera')",categories:["media","creative"]},coin:{icon:"desktop/assets/images/icons/icon_coin_64.png",label:"Buddy Coins",description:"Manage your virtual currency",onClick:"bp.open('coin')",categories:["finance"]},"fluid-simulation":{icon:"desktop/assets/images/icons/icon_fluidsimulation_64.png",author:"Pavel Dobryakov",label:"Fluid Simulation",description:"Interact with a fluid dynamics simulation",onClick:"bp.open('fluid-simulation')",categories:["creative","entertainment"],alias:["fluids"]},sampler:{icon:"desktop/assets/images/icons/icon_midifighter_64.png",label:"Sampler",description:"Create and mix audio samples",onClick:"bp.open('sampler')",categories:["audio","music","creative"]},"audio-visual":{icon:"desktop/assets/images/icons/icon_visuals_64.png",author:"lachlanmaclean",label:"Audio Visuals",description:"Experience audio-responsive visuals",onClick:"bp.open('audio-visual')",categories:["creative","entertainment","audio"],alias:["av"]},chalkboard:{icon:"desktop/assets/images/icons/icon_chalkboard_64.png",label:"Chalkboard",description:"Draw and write on a virtual chalkboard",onClick:"bp.open('chalkboard')",categories:["art","creative"],chatWindowButton:["buddy","pond"],chatButton:{text:"Chalkboard",image:"desktop/assets/images/icons/icon_chalkboard_64.png",onclick:async t=>{let e=t.target.dataset.context,o=t.target.dataset.type;return bp.open("chalkboard",{output:o||"buddy",context:e}),!1}}},piano:{icon:"desktop/assets/images/icons/icon_piano_64.png",label:"Piano",description:"Play a virtual piano keyboard",onClick:"bp.open('piano')",desktopOnly:!0,categories:["music","creative"]},portfolio:{icon:"desktop/assets/images/icons/icon_portfolio_64.png",label:"Portfolio",description:"Track your investments and assets",onClick:"bp.open('portfolio')",categories:["finance"]},"audio-player":{icon:"desktop/assets/images/icons/icon_audio-player_64.png",label:"Audio Player",description:"Play and manage audio files",onClick:"bp.open('audio-player')",categories:["media","audio"]},paint:{icon:"desktop/assets/images/icons/icon_paint_64.png",label:"Paint",author:"Isaiah Odhner",description:"A Classic Retro Style Image Editor",onClick:"bp.open('paint')",categories:["art","creative"],chatWindowButton:["buddy","pond"]},painterro:{icon:"desktop/assets/images/icons/icon_painterro_64.png",label:"Painterro",author:"Ivan Borshchov",description:"Easy to use image editing tool",onClick:"bp.open('painterro')",categories:["art","creative"]},"frvr-basketball":{icon:"desktop/assets/images/icons/icon_basketball-frvr_64.png",label:"BasketBall",description:"Play Basketball game",onClick:"bp.open('frvr-basketball')",categories:["games","entertainment"],author:"FRVR Games",alias:["basketball"]},"frvr-bowlingo":{icon:"desktop/assets/images/icons/icon_frvr-bowlingo_64.png",label:"Bowlingo",description:"Play Bowlingo game",onClick:"bp.open('frvr-bowlingo')",categories:["games","entertainment"],author:"FRVR Games",alias:["bowling"]},mantra:{icon:"desktop/assets/images/icons/icon_mantra_64.png",label:"Mantra",description:"Play the Mantra game",categories:["games"]},minesweeper:{icon:"desktop/assets/images/icons/icon_minesweeper_64.png",label:"Minesweeper",description:"Classic Minesweeper puzzle game",categories:["games"]},"emulator-nes":{icon:"desktop/assets/images/icons/icon_nes_64.png",app:"emulator",context:"nes",label:"NES",description:"Play Nintendo Entertainment System games",options:{context:"nes"},categories:["games","emulators"]},"emulator-sega":{icon:"desktop/assets/images/icons/icon_sega_64.png",app:"emulator",context:"sega",label:"Sega",description:"Play Sega console games",options:{context:"sega"},categories:["games","emulators"]},"emulator-snes":{icon:"desktop/assets/images/icons/icon_snes_64.png",app:"emulator",context:"snes",label:"SNES",description:"Play Super Nintendo games",options:{context:"snes"},categories:["games","emulators"]},"emulator-atari2600":{icon:"desktop/assets/images/icons/icon_atari2600_64.png",app:"emulator",context:"atari2600",label:"Atari 2600",description:"Play Atari 2600 games",options:{context:"atari2600"},categories:["games","emulators"]},"emulator-n64":{icon:"desktop/assets/images/icons/icon_n64_64.png",app:"emulator",context:"n64",label:"n64",description:"Play Nintendo 64 games",options:{context:"n64"},categories:["games","emulators"]},solitaire:{icon:"desktop/assets/images/icons/icon_solitaire_64.png",label:"Solitaire",description:"Classic Solitaire card game",categories:["games"]},spellbook:{icon:"desktop/assets/images/icons/icon_spellbook_64.png",label:"Spellbook",description:"Manage scripts or commands",categories:["tools","productivity"]},globe:{icon:"desktop/assets/images/icons/icon_globe_64.png",label:"Globe",description:"Visualize global network data",categories:["tools"]},"file-viewer":{icon:"desktop/assets/images/icons/icon_file-viewer_64.png",label:"File Viewer",description:"View files in various formats",onClick:"bp.open('file-viewer')",categories:["files","productivity"]},"hacker-typer":{icon:"desktop/assets/images/icons/icon_hacker-typer_64.png",label:"Hack Typer",description:"Simulate hacking with a typing game",categories:["tools","games"]},"hex-editor":{icon:"desktop/assets/images/icons/icon_hex-editor_64.png",label:"Hex Editor",description:"Edit files in hexadecimal format",categories:["tools","productivity"]},maps:{icon:"desktop/assets/images/icons/icon_maps_64.png",label:"Maps",description:"Access mapping and navigation tools",categories:["tools"]},motd:{icon:"desktop/assets/images/icons/icon_console_64.png",label:"MOTD",description:"Message of the Day",onClick:"bp.open('motd')",categories:["social","community"],chatWindowButton:["buddy","pond"]}};const n={};function s(){let t=this.bp.settings.apps_installed||{},e=this.bp.settings.taskbar_apps||{},o=!1;if(Object.keys(t).length>0&&(o=Object.values(t).every((t=>!t.icon))),o&&(t={}),0===Object.keys(e).length){["file-explorer","pad","buddylist","portfolio"].forEach((t=>{let o=this.bp.apps.desktop.appList[t];o?e[t]={app:o.app||t,context:o.context||"default",label:o.label||t,icon:o.icon||""}:console.warn(`App ${t} not found in desktop app list.`)}))}if(Object.keys(e).forEach((t=>{let o=e[t],n=this.bp.apps.desktop.appList[o.id||t];if(!n)return void console.warn(`App ${t} not found in desktop app list.`);n.id=t,n.app=n.app||t;let s={...n};s?this.bp.apps.ui.windowManager.taskBar.addItem(s):console.warn(`App ${t} not found in desktop app list.`)})),0===Object.keys(t).length){["profile","buddylist","pad","pond","file-explorer","youtube","fluid-simulation","coin","portfolio"].forEach((e=>{let o=this.bp.apps.desktop.appList[e];o?(console.log(`Adding default app shortcut: ${e}`),t[e]=o):console.warn(`App ${e} not found in desktop app list.`)})),this.bp.set("apps_installed",t),this.client.incrementAppInstallCount(Object.keys(t))}Object.keys(t).length>0&&Object.keys(t).forEach((e=>{let o=t[e];o&&bp.apps.desktop.addShortCut({name:e,...o},{onClick:()=>{bp.open(o.app||e,{context:o.context})}})}))}n.incrementAppInstallCount=async function(t){if(t){Array.isArray(t)||(t=[t]);try{await fetch(`${buddypond.appsEndpoint}/apps/install`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appIds:t})})}catch(e){console.error(`Failed to increment install count for app ${t}:`,e)}}else console.error("No app name provided for incrementing install count")},n.getAppsStats=async function(){try{const t=await fetch(`${buddypond.appsEndpoint}/apps/stats`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Failed to fetch app stats:",t),null}};class i{constructor(t,e={}){this.bp=t,this.options=e,this.apps={},this.folders=[],this.container=document.createElement("div"),this.container.id="desktop-container",this.container.className="desktop-container",this.shortCutsContainer=document.createElement("div"),this.shortCutsContainer.id="desktop-shortcuts-container",this.shortCutsContainer.className="desktop-shortcuts-container",this.container.appendChild(this.shortCutsContainer),this.parent=e.parent||document.body,this.parent.appendChild(this.container),this.enableShortcutDragging=!0,this.enabledChatWindowButtons=[],"boolean"==typeof e.enableShortcutDragging&&(this.enableShortcutDragging=e.enableShortcutDragging),this.setupContextMenu()}async init(){return await this.bp.load("/v5/apps/based/desktop/desktop.css"),s.call(this),"loaded desktop"}async load(){}renderNode(e,o,n=0,s=!1){if(console.log("renderNode",e,o,n,s),e.children&&e.children.length>0)if(s)e.children.forEach((t=>this.renderNode(t,o,n+1)));else{new t(e,o,this,n).render()}else if(e.text.endsWith(".yml")){new a(e,o).render()}else{new File(e,o,this,n).render()}}toggleMute(){!1===this.bp.settings.audio_enabled?(this.bp.set("audio_enabled",!0),$(".volumeFull").show(),$(".volumeMuted").hide(),this.bp.play("desktop/assets/audio/VOLUME-ON.mp3",{tryHard:1/0})):(this.bp.set("audio_enabled",!1),$(".volumeFull").hide(),$(".volumeMuted").show())}openFolder(t){console.log("openFolder",t);const e=this.folders.find((e=>e.data.name===t));e?e.open():console.error(`Folder with ID ${t} not found.`)}}i.prototype.Folder=t,i.prototype.File=class{constructor(t,e,o,n){this.data=t,console.log("FIKLE DATA",t),this.parentElement=e,this.desktop=o,this.options={},this.depth=n}render(t={}){t=this.data;const e=document.createElement("div");e.className=`icon shortcut ${t.class||""}`,this.depth>1&&e.classList.add("hidden"),e.classList.add("icon","shortcut");const o=document.createElement("a"),n=document.createElement("img");n.className="bp-desktop-icon",n.loading="lazy",n.src=t.icon;const s=document.createElement("span");s.className="title",s.textContent=t.label||t.name||t.id,o.appendChild(n),o.appendChild(s),e.appendChild(o),e.addEventListener("click",this.options.onClick),this.enableShortcutDragging&&$(e).draggable({containment:"parent"}),this.parentElement.appendChild(e)}},i.prototype.addShortCut=function(t,e={},o){"function"!=typeof e.onClick&&(e.onClick=()=>console.log("desktop app - Missing options.onClick function",t.name));const n=document.createElement("div");n.className=`icon shortcut ${t.class||""} bp-desktop-shortcut`,n.setAttribute("data-app",t.name);const s=document.createElement("a");if(t.textIcon){const o=document.createElement("div");o.textContent=t.textIcon,o.style.fontSize="32px",o.style.position="relative",o.style.bottom="10px",e.imageStyle&&Object.keys(e.imageStyle).forEach((t=>{o.style[t]=e.imageStyle[t]})),s.appendChild(o)}else{const o=document.createElement("img");o.className="bp-desktop-icon",o.loading="lazy",o.src=t.icon,e.imageStyle&&Object.keys(e.imageStyle).forEach((t=>{o.style[t]=e.imageStyle[t]})),s.appendChild(o)}const i=document.createElement("span");i.className="title",i.textContent=t.label||t.name,s.appendChild(i),n.appendChild(s);let a=null,p=!1;n.addEventListener("pointerdown",(t=>{a={x:t.clientX,y:t.clientY},p=!1})),n.addEventListener("pointermove",(t=>{if(!a)return;const e=t.clientX-a.x,o=t.clientY-a.y;Math.sqrt(e*e+o*o)>5&&(p=!0)})),n.addEventListener("pointerup",(o=>{p||(o.preventDefault(),e.onClick(o,t)),a=null,p=!1;let s=this.bp.settings.apps_installed||{};return s[t.name]=s[t.name]||t,s[t.name].position={x:n.offsetLeft,y:n.offsetTop},this.bp.set("apps_installed",s),!1}));const r=document.createElement("div");r.className="desktop-context-menu";let l="";if("pad"!==t.name&&(l+='<div class="bp-context-menu-item" data-action="delete">Delete Shortcut</div>'),l+='\n        <div class="bp-context-menu-item" data-action="rename">Rename Shortcut</div>\n        <div class="bp-context-menu-item" data-action="add-taskbar">Add to Taskbar</div>\n    ',r.innerHTML=l,document.body.appendChild(r),document.addEventListener("click",(()=>{r.style.display="none"})),n.addEventListener("contextmenu",(t=>{$(".desktop-context-menu"),t.preventDefault();const e=t.clientX,o=t.clientY,n=window.innerWidth-150,s=window.innerHeight-80;r.style.left=`${Math.min(e,n)}px`,r.style.top=`${Math.min(o,s)}px`,r.style.display="block"})),r.addEventListener("click",(o=>{const n=o.target.getAttribute("data-action");"delete"===n?this.deleteShortcut(t.name,t,e.context):"rename"===n?this.renameShortCut(t.name,i,e.context):"add-taskbar"===n&&(t.id=t.name,this.bp.apps.ui.windowManager.taskBar.addItem(t)),r.style.display="none"})),(o||this.shortCutsContainer).appendChild(n),this.enableShortcutDragging&&$(n).draggable({containment:"parent"}),t.chatWindowButton){let e=this.bp.apps.ui.windowManager.findWindows({app:"buddylist",type:t.chatWindowButton}),o=t.chatButton;if(!o)return void console.warn("No chatButton defined for app:",t.name);o.name=t.name,this.bp.apps.desktop.enabledChatWindowButtons&&this.bp.apps.desktop.enabledChatWindowButtons.push(o),this.bp.apps.buddylist&&this.bp.apps.buddylist.options.chatWindowButtons&&this.bp.apps.buddylist.options.chatWindowButtons.push(o),e.forEach((t=>{t.buttonBar?t.buttonBar.addButton(o):console.warn("No buttonBar found for pond chat window",t)}))}t.options=e;const c=e&&e.context?`${t.name}-${e.context}`:t.name;this.apps[c]=t,this.deleteShortcut=function(t,e,o){console.log(`Stub: Deleting shortcut for ${t}${o?`-${o}`:""}`),this.removeApp(t,e)}},i.prototype.addFolder=function(e){let o=this,n=document.createElement("div");n.className="folder-holder",e.items.forEach((t=>{!function(t,e){let n={};"string"==typeof t?(n.id=t,n.name=t,n.label=t):n=t,n.icon||(n.icon=`/desktop/assets/images/icons/icon_${n.id}_64.png`),n.options=n.options||{},o.addShortCut({name:n.id,icon:n.icon,label:n.label},{onClick:()=>{bp.open(n.id,n.options)},...n.options},e)}(t,n)}));const s=new t(e,{desktop:this,parentElement:this.shortCutsContainer,depth:0,onOpen:()=>{this.arrangeShortcuts(4,{parent:n,x:0,y:20}),console.log("Folder opened:",e.name),this.bp.apps.ui.windowManager.createWindow({id:e.name,title:e.name,icon:"/desktop/assets/images/icons/icon_folder.png",width:e.width||400,height:e.height||150,parent:$("#desktop").get(0),content:n})}});this.folders.push(s),s.render()},i.prototype.removeShortCut=function(t,e){console.log(`Removing shortcut for app: ${t}`,e);const o=Array.from(this.shortCutsContainer.children).find((e=>$(e).data("app")===t));if(o&&this.shortCutsContainer.removeChild(o),e.chatWindowButton){this.bp.apps.desktop.enabledChatWindowButtons&&(this.bp.apps.desktop.enabledChatWindowButtons=this.bp.apps.desktop.enabledChatWindowButtons.filter((t=>t.text!==e.label))),this.bp.apps.buddylist.options.chatWindowButtons&&(this.bp.apps.buddylist.options.chatWindowButtons=this.bp.apps.buddylist.options.chatWindowButtons.filter((t=>t.text!==e.label))),this.bp.apps.ui.windowManager.findWindows({app:"buddylist",type:e.chatWindowButton}).forEach((t=>{t.buttonBar?t.buttonBar.removeButton(e.label):console.warn("No buttonBar found for pond chat window",t)}))}},i.prototype.arrangeShortcuts=function(t=2,e={rowWidth:80,rowHeight:100,x:0,y:0,ignoreSavedPosition:!0}){let o=e.parent||this.shortCutsContainer;"number"!=typeof e.rowWidth&&(e.rowWidth=this.bp.isMobile()?256:74),"number"!=typeof e.rowHeight&&(e.rowHeight=this.bp.isMobile()?256:100),"number"!=typeof e.x&&(e.x=0),"number"!=typeof e.y&&(e.y=0);const n=o.offsetHeight||600;Math.floor(n/e.rowHeight);let s=this.bp.settings.apps_installed||{},i=0,a=0;Array.from(o.children).forEach(((t,o)=>{const p=t.getAttribute("data-app");s[p];let r=e.x+i*e.rowWidth+15,l=e.y+a*e.rowHeight+(this.bp.isMobile()?100:0);l+e.rowHeight>n&&(i++,a=0,r=e.x+i*e.rowWidth+15,l=e.y+a*e.rowHeight+(this.bp.isMobile()?100:0)),s[p]=s[p]||{},s[p].position={x:r,y:l},t.style.position="absolute",t.style.left=`${r}px`,t.style.top=`${l}px`,a++})),this.bp.set("apps_installed",s)},i.prototype.setupContextMenu=function(){this.container.oncontextmenu=t=>{if(t.target.classList.contains("bp-desktop-icon"))return;$(".desktop-context-menu").hide(),t.preventDefault(),this.showContextMenu(t.clientX,t.clientY)}},i.prototype.showContextMenu=function(t,e){const o=document.createElement("div");o.className="desktop-context-menu",o.style.top=`${e}px`,o.style.left=`${t}px`,o.style.display="block",o.style.zIndex="9999",o.innerHTML='\n        <ul>\n            \x3c!-- <li onclick="bp.apps.desktop.createShortCut()">New Shortcut...</li> --\x3e\n            <li onclick="bp.apps.desktop.arrangeShortcuts(2, {\n    rowWidth: 80,\n    rowHeight: 100,\n    x: 0,\n    y: 0,\n    ignoreSavedPosition: true\n            })">Arrange Icons</li>\n            <li onclick="bp.open(\'profile\', { context: \'themes\' })">Desktop Settings</li>\n            <li onclick="bp.apps.wallpaper.removeWallpaper()">Remove Wallpaper</li>\n            <li onclick="bp.apps.desktop.viewSource()">View Source</li>\n        </ul>\n    ',document.body.appendChild(o),document.addEventListener("click",(()=>o.remove()),{once:!0})},i.prototype.viewSource=async function(t="https://raw.githubusercontent.com/Marak/buddypond/refs/heads/master/index.html"){const e=await fetch(t),o=await e.text();await this.bp.load("editor-monaco",{content:o}),this.bp.apps["editor-monaco"].open()},i.prototype.showDesktopIcons=function(){this.shortCutsContainer.style.display="flex",this.bp.isMobile()&&(this.shortCutsContainer.style.position="absolute",this.shortCutsContainer.style.left="0px",this.shortCutsContainer.style.bottom="0px")};class a{constructor(t,e){this.data=t,this.parentElement=e}render(){const t=document.createElement("div");t.textContent=this.data.text||this.data.id,t.className="shortcut",t.classList.add("icon","shortcut","bp-desktop-iconp"),this.parentElement.appendChild(t)}}i.prototype.appList=o,i.prototype.createShortCut=function(){if(this.createShortCutWindow)this.createShortCutWindow.focus(),this.createShortCutWindow.restore();else{let t=`\n        <div class="bp-create-shortcut-container">\n            <form id="create-shortcut-form" action="#" method="post">\n                <div class="bp-form-group">\n                    <label>Shortcut Type:</label>\n                    <div class="bp-shortcut-type">\n                        <label><input type="radio" name="shortcut-type" value="url" checked> URL</label>\n                        <label><input type="radio" name="shortcut-type" value="app"> App</label>\n                        <label><input type="radio" name="shortcut-type" value="buddyscript"> Buddyscript</label>\n                    </div>\n                </div>\n                <div class="bp-form-group bp-shortcut-examples">\n                    \x3c!-- radio group of examples --\x3e\n                    <label>Examples:</label>\n                    <div class="bp-shortcut-examples-list">\n                        <label><input type="radio" name="shortcut-example" value="url" checked>Open a Website</label>\n                        <label><input type="radio" name="shortcut-example" value="app">Open your own Pond</label>\n                        <label><input type="radio" name="shortcut-example" value="buddyscript">Run a Buddyscript</label>\n                    </div>\n                </div>\n                <div class="bp-form-group">\n                    <label for="shortcut-name">Shortcut Name:</label>\n                    <input type="text" id="shortcut-name" name="shortcut-name" required>\n                </div>\n                <div class="bp-form-group bp-app-select-group" style="display: none;">\n                    <label for="shortcut-apps">Select App:</label>\n                    <select id="shortcut-apps" name="shortcut-apps">\n                        <option value="">Select App</option>\n                        ${Object.keys(this.bp.apps.desktop.appList).map((t=>`<option value="${t}">${this.bp.apps.desktop.appList[t].label||t}</option>`)).join("")}\n                    </select>\n                </div>\n                <div class="bp-form-group bp-app-select-group">\n                    \x3c!-- context input, type input, output input --\x3e\n                    <label for="shortcut-context">Context:</label>\n                    <input type="text" id="shortcut-context" name="shortcut-context" placeholder="Optional, e.g. 'chatWindow'" value="">\n                    <label for="shortcut-type">Type:</label>\n                    <input type="text" id="shortcut-type" name="shortcut-type" placeholder="Optional, e.g. 'pond'" value="pond">\n                    <label for="shortcut-output">Output:</label>\n                    <input type="text" id="shortcut-output" name="shortcut-output" placeholder="Optional, e.g. 'chat'" value="chat">\n                </div>\n\n                <div class="bp-form-group bp-url-group">\n                    <label for="shortcut-url">URL:</label>\n                    <input type="text" id="shortcut-url" name="shortcut-url" required>\n                </div>\n\n                <div class="bp-form-group bp-command-group">\n                    <label for="shortcut-command">Command:</label>\n                    <input type="text" id="shortcut-command" name="shortcut-command" required>\n                </div>\n                <div class="bp-form-group">\n                    <label for="shortcut-icon">Icon URL:</label>\n                    <input type="text" id="shortcut-icon" name="shortcut-icon" placeholder="Optional">\n                </div>\n                <div class="bp-form-group">\n                    <label for="shortcut-description">Description:</label>\n                    <textarea id="shortcut-description" name="shortcut-description" placeholder="Optional"></textarea>\n                </div>\n                <div class="bp-form-group bp-form-actions">\n                    <button type="submit" class="bp-btn bp-btn-primary bp-create-shortcut-btn">Create Shortcut</button>\n                    <button type="button" class="bp-btn bp-btn-secondary" id="cancel-shortcut">Cancel</button>\n                </div>\n            </form>\n        </div>`;this.createShortCutWindow=this.bp.apps.ui.windowManager.createWindow({id:"create-shortcut",title:"Create Shortcut",icon:"desktop/assets/images/icons/icon_console_64.png",x:250,y:75,width:600,height:600,minWidth:400,minHeight:300,parent:$("#desktop")[0],content:t,resizable:!0,minimizable:!0,maximizable:!0,closable:!0,focusable:!0,maximized:!1,minimized:!1,onClose:()=>{this.createShortCutWindow=null}}),$('#create-shortcut-form input[name="shortcut-type"]').on("change",(t=>{const e=t.target.value,o=$(".bp-app-select-group"),n=$(".bp-command-group"),s=$(".bp-url-group");"app"===e&&(o.show(),n.hide(),s.hide(),$("#shortcut-command").prop("required",!1),$("#shortcut-apps").prop("required",!0)),"buddyscript"===e&&(o.hide(),n.show(),s.hide(),$("#shortcut-command").prop("required",!0),$("#shortcut-apps").prop("required",!1)),"url"===e&&(s.show(),o.hide(),n.hide(),$("#shortcut-command").prop("required",!1),$("#shortcut-apps").prop("required",!1))})),$("#create-shortcut-form").on("submit",(t=>(t.preventDefault(),!1))),$(".bp-create-shortcut-btn").on("click",(async t=>{t.preventDefault();const o=$('input[name="shortcut-type"]:checked').val(),n=$("#shortcut-name").val().trim(),s=$("#shortcut-apps").val(),i=$("#shortcut-command").val().trim();let a=$("#shortcut-icon").val().trim();const p=$("#shortcut-description").val().trim();if(!n)return void alert("Shortcut Name is required.");if("app"===o&&!s)return void alert("Please select an app.");if("buddyscript"===o&&!i)return void alert("Command is required for URL or Buddyscript shortcuts.");if("url"===o&&!$("#shortcut-url").val().trim())return void alert("URL is required for URL shortcuts.");let r=null;if("app"===o){let t=$("#shortcut-context").val().trim()||"";console.log("appNameappName",s),a||(a=this.bp.apps.desktop.appList[s]?.icon||"desktop/assets/images/icons/icon_default_64.png"),r=()=>{bp.open(s,{context:t})}}if("buddyscript"===o&&(r=()=>{if(i){let t=this.bp.apps.buddyscript.parseCommand(i);console.log("got back buddyscript command",t),t.pipe&&t.pipe()}else alert("Please enter a valid Buddyscript command.")}),"url"===o){const t=$("#shortcut-url").val().trim();r=()=>{t?window.open(t,"_blank"):alert("Please enter a valid URL.")}}const l={name:n,label:n,shortcutType:o,icon:a||"desktop/assets/images/icons/icon_default_64.png",description:p||"",target:"app"===o?this.bp.apps.desktop.appList[s]?.onClick||`bp.open('${s}')`:i,onClick:r,parameters:{icon:a||"",description:p||""}};try{e.call(this,l)}catch(t){console.error("Error creating shortcut:",t),alert("Failed to create shortcut. Please check the console for details.")}return!1})),$("#cancel-shortcut").on("click",(()=>{this.createShortCutWindow.close()}))}},i.prototype.renameShortCut=function(t,e){const o=prompt("Enter new shortcut name:",e.textContent);if(!o||""===o.trim())return;let n=$(`.bp-desktop-shortcut[data-app="${t}"]`);console.log(`Renaming shortcut ${n} to ${o}`),console.log("Shortcut element:",n),e.textContent=o;let s=this.bp.get("apps_installed")||{};s[t]?(s[t].label=o,this.bp.set("apps_installed",s)):console.warn(`App ${t} not found in installed apps.`),console.log(`Shortcut renamed to ${o}`)},i.prototype.addApp=async function(t,e){if(!t)return void console.error("No app name provided");if(e||(console.log("this.bp.apps.desktop",this.bp.apps.desktop),e=this.bp.apps.desktop.appList[t]),!e)return void console.error(`App ${t} not found in appstore`);this.client.incrementAppInstallCount(t),this.bp.apps.pad.data.appStats[t]=this.bp.apps.pad.data.appStats[t]||{},this.bp.apps.pad.data.appStats[t].installCount=(this.bp.apps.pad.data.appStats[t]?.installCount||0)+1,this.bp.play("desktop/assets/audio/APP-ADD.wav",{tryHard:1});let o=this.bp.settings.apps_installed||{};var n;o[t]=e,this.bp.set("apps_installed",o),this.bp.apps.desktop.addShortCut({name:t,...e},{onClick:()=>{this.bp.open(e.app||t,{context:e.context})}}),this.bp.apps.desktop.arrangeShortcuts(),await(n=777,new Promise((t=>setTimeout(t,n))))},i.prototype.removeApp=async function(t,e){this.bp.play("desktop/assets/audio/APP-REMOVE.wav");let o=this.bp.settings.apps_installed||{};var n;delete o[t],this.bp.set("apps_installed",o),this.bp.apps.desktop.removeShortCut(t,e),this.bp.apps.desktop.arrangeShortcuts(),await(n=777,new Promise((t=>setTimeout(t,n))))},i.prototype.client=n,i.prototype.bindKeyboardShortcuts=function(){document.addEventListener("keydown",(t=>{if(192===t.which)return t.preventDefault(),this.bp.open("console"),!1}))};const p=(()=>{let t=null,e=null;return{push:function(o,n,s,i=250){e={stateObj:o,title:n,url:s},t&&clearTimeout(t),t=setTimeout((()=>{const{stateObj:o,title:n,url:s}=e;history.pushState(o,n,s),t=null}),i)}}})();window.DelayedPushState=p;export{i as default};
//# sourceMappingURL=desktop.js.map
