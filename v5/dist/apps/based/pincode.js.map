{"version":3,"file":"pincode.js","sources":["../../../apps/based/pincode/pincode.js"],"sourcesContent":["export default class PasswordDialog {\n  constructor(bp, options = {}) {\n    this.bp = bp;\n    this.options = options;\n  }\n\n  async init() {\n    this.html = await this.bp.load('/v5/apps/based/pincode/pincode.html');\n    await this.bp.load('/v5/apps/based/pincode/pincode.css');\n    return 'loaded password dialog';\n  }\n\n  async open() {\n    if (!this.opened) {\n      this.opened = true;\n      $(document.body).append(this.html);\n\n      const $form = $('.password-form');\n      const $email = $('.email-input');\n      const $password = $('.password-main');\n      const $confirm = $('.password-confirm');\n      const $status = $('.form-status');\n\n      if (bp.apps.buddylist && bp.apps.buddylist.data.profileState && bp.apps.buddylist.data.profileState.email) {\n        $email.val(bp.apps.buddylist.data.profileState.email);\n      }\n\n\n      const $errors = {\n        email: $('.email-error'),\n        password: $('.password-error'),\n        confirm: $('.confirm-error')\n      };\n\n      $('.save-btn').on('click', async () => {\n        $errors.email.text('');\n        $errors.password.text('');\n        $errors.confirm.text('');\n        $status.text('');\n        $password.removeClass('error');\n        $confirm.removeClass('error');\n\n        const email = $email.val().trim();\n        const pass = $password.val().trim();\n        const confirm = $confirm.val().trim();\n\n        if (!pass) {\n          $errors.password.text('Password is required.');\n          $password.addClass('error');\n          return;\n        }\n\n        if (confirm !== pass) {\n          $errors.confirm.text('Passwords do not match.');\n          $confirm.addClass('error');\n          return;\n        }\n\n        try {\n          const result = await buddypond.updateAccount({\n            buddyname: this.bp.me,\n            password: pass,\n            email: email || undefined\n          });\n\n          console.log('Password set successfully', result);\n          $('.password-overlay').hide();\n\n          if (bp.apps.buddylist && bp.apps.buddylist.data.profileState && bp.apps.buddylist.data.profileState.email) {\n            // Update the email in buddylist if it exists\n            bp.apps.buddylist.data.profileState.email = email;\n            // bp.apps.buddylist.updateProfileState();\n          }\n\n        } catch (err) {\n          console.error('Failed to save password:', err);\n          $status.text('Failed to update account. Please try again.');\n        }\n      });\n\n      $('.cancel-btn').on('click', () => {\n        $('.password-overlay').hide();\n      });\n\n      window.showPasswordDialog = () => $('.password-overlay').show();\n      // focus the email input\n      // if email is set, focus on .password-input\n      showPasswordDialog();\n      if ($email.val().trim()) {\n        $password.focus();\n      } else {\n        $email.focus();\n      }\n\n    }\n  }\n}\n"],"names":["PasswordDialog","constructor","bp","options","this","init","html","load","open","opened","$","document","body","append","$email","$password","$confirm","$status","apps","buddylist","data","profileState","email","val","$errors","password","confirm","on","async","text","removeClass","trim","pass","addClass","result","buddypond","updateAccount","buddyname","me","undefined","console","log","hide","err","error","window","showPasswordDialog","show","focus"],"mappings":"AAAe,MAAMA,EACnB,WAAAC,CAAYC,EAAIC,EAAU,IACxBC,KAAKF,GAAKA,EACVE,KAAKD,QAAUA,CACnB,CAEE,UAAME,GAGJ,OAFAD,KAAKE,WAAaF,KAAKF,GAAGK,KAAK,6CACzBH,KAAKF,GAAGK,KAAK,sCACZ,wBACX,CAEE,UAAMC,GACJ,IAAKJ,KAAKK,OAAQ,CAChBL,KAAKK,QAAS,EACdC,EAAEC,SAASC,MAAMC,OAAOT,KAAKE,MAEfI,EAAE,kBAChB,MAAMI,EAASJ,EAAE,gBACXK,EAAYL,EAAE,kBACdM,EAAWN,EAAE,qBACbO,EAAUP,EAAE,gBAEdR,GAAGgB,KAAKC,WAAajB,GAAGgB,KAAKC,UAAUC,KAAKC,cAAgBnB,GAAGgB,KAAKC,UAAUC,KAAKC,aAAaC,OAClGR,EAAOS,IAAIrB,GAAGgB,KAAKC,UAAUC,KAAKC,aAAaC,OAIjD,MAAME,EAAU,CACdF,MAAOZ,EAAE,gBACTe,SAAUf,EAAE,mBACZgB,QAAShB,EAAE,mBAGbA,EAAE,aAAaiB,GAAG,SAASC,UACzBJ,EAAQF,MAAMO,KAAK,IACnBL,EAAQC,SAASI,KAAK,IACtBL,EAAQE,QAAQG,KAAK,IACrBZ,EAAQY,KAAK,IACbd,EAAUe,YAAY,SACtBd,EAASc,YAAY,SAErB,MAAMR,EAAQR,EAAOS,MAAMQ,OACrBC,EAAOjB,EAAUQ,MAAMQ,OACvBL,EAAUV,EAASO,MAAMQ,OAE/B,IAAKC,EAGH,OAFAR,EAAQC,SAASI,KAAK,8BACtBd,EAAUkB,SAAS,SAIrB,GAAIP,IAAYM,EAGd,OAFAR,EAAQE,QAAQG,KAAK,gCACrBb,EAASiB,SAAS,SAIpB,IACE,MAAMC,QAAeC,UAAUC,cAAc,CAC3CC,UAAWjC,KAAKF,GAAGoC,GACnBb,SAAUO,EACVV,MAAOA,QAASiB,IAGlBC,QAAQC,IAAI,4BAA6BP,GACzCxB,EAAE,qBAAqBgC,OAEnBxC,GAAGgB,KAAKC,WAAajB,GAAGgB,KAAKC,UAAUC,KAAKC,cAAgBnB,GAAGgB,KAAKC,UAAUC,KAAKC,aAAaC,QAElGpB,GAAGgB,KAAKC,UAAUC,KAAKC,aAAaC,MAAQA,EAI/C,CAAC,MAAOqB,GACPH,QAAQI,MAAM,2BAA4BD,GAC1C1B,EAAQY,KAAK,8CACvB,KAGMnB,EAAE,eAAeiB,GAAG,SAAS,KAC3BjB,EAAE,qBAAqBgC,UAGzBG,OAAOC,mBAAqB,IAAMpC,EAAE,qBAAqBqC,OAGzDD,qBACIhC,EAAOS,MAAMQ,OACfhB,EAAUiC,QAEVlC,EAAOkC,OAGf,CACA"}