{"version":3,"file":"pincode.js","sources":["../../../apps/based/pincode/pincode.js"],"sourcesContent":["export default class PasswordDialog {\n  constructor(bp, options = {}) {\n    this.bp = bp;\n    this.options = options;\n  }\n\n  async init() {\n    this.html = await this.bp.load('/v5/apps/based/pincode/pincode.html');\n    await this.bp.load('/v5/apps/based/pincode/pincode.css');\n    return 'loaded password dialog';\n  }\n\n  async open() {\n    if (this.opened) return;\n\n    this.opened = true;\n    this.$container = $('<div>').html(this.html);\n    $(document.body).append(this.$container);\n\n    const $form = $('.password-form', this.$container);\n    const $email = $('.email-input', this.$container);\n    const $password = $('.password-main', this.$container);\n    const $confirm = $('.password-confirm', this.$container);\n    const $status = $('.form-status', this.$container);\n    const $overlay = $('.password-overlay', this.$container);\n\n    const $errors = {\n      email: $('.email-error', this.$container),\n      password: $('.password-error', this.$container),\n      confirm: $('.confirm-error', this.$container)\n    };\n\n    // Pre-fill email if available\n    const emailFromProfile = this.bp.apps?.buddylist?.data?.profileState?.email;\n    if (emailFromProfile) {\n      $email.val(emailFromProfile);\n    }\n\n    // Save button handler\n    $('.save-btn', this.$container).on('click', async () => {\n      $errors.email.text('');\n      $errors.password.text('');\n      $errors.confirm.text('');\n      $status.text('');\n      $password.removeClass('error');\n      $confirm.removeClass('error');\n\n      const email = $email.val().trim();\n      const pass = $password.val().trim();\n      const confirm = $confirm.val().trim();\n\n      if (!pass) {\n        $errors.password.text('Password is required.');\n        $password.addClass('error');\n        return;\n      }\n\n      if (confirm !== pass) {\n        $errors.confirm.text('Passwords do not match.');\n        $confirm.addClass('error');\n        return;\n      }\n\n      try {\n        const result = await buddypond.updateAccount({\n          buddyname: this.bp.me,\n          password: pass,\n          email: email || undefined\n        });\n\n        console.log('Password set successfully', result);\n        $overlay.hide();\n\n        if (emailFromProfile) {\n          this.bp.apps.buddylist.data.profileState.email = email;\n        }\n\n      } catch (err) {\n        console.error('Failed to save password:', err);\n        $status.text('Failed to update account. Please try again.');\n      }\n    });\n\n    // Cancel button handler\n    $('.cancel-btn', this.$container).on('click', () => {\n      $overlay.hide();\n    });\n\n    // Public show method\n    window.showPasswordDialog = () => {\n      $overlay.show();\n      if ($email.val().trim()) {\n        $password.focus();\n      } else {\n        $email.focus();\n      }\n    };\n\n    // Auto-show\n    showPasswordDialog();\n  }\n}\n"],"names":["PasswordDialog","constructor","bp","options","this","init","html","load","open","opened","$container","$","document","body","append","$email","$password","$confirm","$status","$overlay","$errors","email","password","confirm","emailFromProfile","apps","buddylist","data","profileState","val","on","async","text","removeClass","trim","pass","addClass","result","buddypond","updateAccount","buddyname","me","undefined","console","log","hide","err","error","window","showPasswordDialog","show","focus"],"mappings":"AAAe,MAAMA,EACnB,WAAAC,CAAYC,EAAIC,EAAU,IACxBC,KAAKF,GAAKA,EACVE,KAAKD,QAAUA,CACnB,CAEE,UAAME,GAGJ,OAFAD,KAAKE,WAAaF,KAAKF,GAAGK,KAAK,6CACzBH,KAAKF,GAAGK,KAAK,sCACZ,wBACX,CAEE,UAAMC,GACJ,GAAIJ,KAAKK,OAAQ,OAEjBL,KAAKK,QAAS,EACdL,KAAKM,WAAaC,EAAE,SAASL,KAAKF,KAAKE,MACvCK,EAAEC,SAASC,MAAMC,OAAOV,KAAKM,YAEfC,EAAE,iBAAkBP,KAAKM,YACvC,MAAMK,EAASJ,EAAE,eAAgBP,KAAKM,YAChCM,EAAYL,EAAE,iBAAkBP,KAAKM,YACrCO,EAAWN,EAAE,oBAAqBP,KAAKM,YACvCQ,EAAUP,EAAE,eAAgBP,KAAKM,YACjCS,EAAWR,EAAE,oBAAqBP,KAAKM,YAEvCU,EAAU,CACdC,MAAOV,EAAE,eAAgBP,KAAKM,YAC9BY,SAAUX,EAAE,kBAAmBP,KAAKM,YACpCa,QAASZ,EAAE,iBAAkBP,KAAKM,aAI9Bc,EAAmBpB,KAAKF,GAAGuB,MAAMC,WAAWC,MAAMC,cAAcP,MAClEG,GACFT,EAAOc,IAAIL,GAIbb,EAAE,YAAaP,KAAKM,YAAYoB,GAAG,SAASC,UAC1CX,EAAQC,MAAMW,KAAK,IACnBZ,EAAQE,SAASU,KAAK,IACtBZ,EAAQG,QAAQS,KAAK,IACrBd,EAAQc,KAAK,IACbhB,EAAUiB,YAAY,SACtBhB,EAASgB,YAAY,SAErB,MAAMZ,EAAQN,EAAOc,MAAMK,OACrBC,EAAOnB,EAAUa,MAAMK,OACvBX,EAAUN,EAASY,MAAMK,OAE/B,IAAKC,EAGH,OAFAf,EAAQE,SAASU,KAAK,8BACtBhB,EAAUoB,SAAS,SAIrB,GAAIb,IAAYY,EAGd,OAFAf,EAAQG,QAAQS,KAAK,gCACrBf,EAASmB,SAAS,SAIpB,IACE,MAAMC,QAAeC,UAAUC,cAAc,CAC3CC,UAAWpC,KAAKF,GAAGuC,GACnBnB,SAAUa,EACVd,MAAOA,QAASqB,IAGlBC,QAAQC,IAAI,4BAA6BP,GACzClB,EAAS0B,OAELrB,IACFpB,KAAKF,GAAGuB,KAAKC,UAAUC,KAAKC,aAAaP,MAAQA,EAGpD,CAAC,MAAOyB,GACPH,QAAQI,MAAM,2BAA4BD,GAC1C5B,EAAQc,KAAK,8CACrB,KAIIrB,EAAE,cAAeP,KAAKM,YAAYoB,GAAG,SAAS,KAC5CX,EAAS0B,UAIXG,OAAOC,mBAAqB,KAC1B9B,EAAS+B,OACLnC,EAAOc,MAAMK,OACflB,EAAUmC,QAEVpC,EAAOoC,SAKXF,oBACJ"}