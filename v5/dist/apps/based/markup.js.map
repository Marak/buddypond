{"version":3,"file":"markup.js","sources":["../../../apps/based/markup/markup.js"],"sourcesContent":["/* Markup.js - Marak Squires 2023 - Buddypond */\n// This Plugin will parse the DOM HTML and open buddypond apps based on the markup\n// Uses the custom elements API to define custom elements\n/*\n    When the parser finds markup like this:\n        \n        <bp-audio-player  context=\"coolsong.mp3\" type=\"basic\"/>\n\n    It will result in bp.open('audio-player', { context: 'coolsong.mp3', type: 'basic' }) being called\n*/\n\nexport default class Markup {\n    constructor(bp, options = {}) {\n        this.bp = bp;\n    }\n\n    init() {\n        this.bp.parseHTML = this.parseHTML.bind(this);\n        // Initialization logic if needed\n        //this.parseHTML();\n    }\n\n    defineCustomElements() {\n        // Define all custom elements prefixed with 'bp-'\n        const customTags = Array.from(document.querySelectorAll('*')).filter(el => el.tagName.toLowerCase().startsWith('bp-'));\n\n        customTags.forEach(tag => {\n            const tagName = tag.tagName.toLowerCase();\n            if (!customElements.get(tagName)) {\n                class CustomElement extends HTMLElement {\n                    constructor() {\n                        super();\n                    }\n                }\n                customElements.define(tagName, CustomElement);\n            }\n        });\n    }\n\n    parseCustomDomElements() {\n        console.log('Parsing custom Buddypond DOM elements...');\n        const elements = Array.from(document.querySelectorAll('*')).filter(el => el.tagName.toLowerCase().startsWith('bp-'));\n\n        elements.forEach(async (element)  => {\n            const tagName = element.tagName.toLowerCase();\n            const app = tagName.replace('bp-', '');\n            const context = element.getAttribute('context');\n            const type = element.getAttribute('type');\n            // determine if an attribute exists named \"opem\" ( has no value )\n            const open = element.hasAttribute('open');\n            // TODO: needs a way to instead replace the element with the app,\n            // instead of opening the window\n            // this indicates at least two types of behaviors for custom elements\n            // the default behavior should be to replace the element with the app\n            // the custom behavior with a flag should be to open the app in a window\n            // TODO: how to get content from bp.open() without side-effects of opening a window...\n\n\n            if (app) {\n                await bp.load(app);\n                if (bp.apps[app] && bp.apps[app].render) {\n                    //let html = await bp.apps[app].render();\n                    //console.log('html:', html);\n                }\n                if (bp.apps[app] && open && bp.apps[app].open) {\n                    bp.open(app, { context, type });\n                }\n\n            }\n        });\n\n        console.log('All Buddypond apps initialized.');\n    }\n\n    displayOriginalHTML() {\n        const pre = document.createElement('pre');\n        pre.textContent = document.body.innerHTML;\n        document.body.appendChild(pre);\n    }\n\n    parseHTML(parent = document) { // TODO: use parent to limit scope of parsing\n        this.defineCustomElements();\n        this.parseCustomDomElements();\n\n        if (this.displayOriginalHTML) {\n            this.displayOriginalHTML();\n        }\n    }\n}"],"names":["Markup","constructor","bp","options","this","init","parseHTML","bind","defineCustomElements","Array","from","document","querySelectorAll","filter","el","tagName","toLowerCase","startsWith","forEach","tag","customElements","get","CustomElement","HTMLElement","super","define","parseCustomDomElements","console","log","async","element","app","replace","context","getAttribute","type","open","hasAttribute","load","apps","render","displayOriginalHTML","pre","createElement","textContent","body","innerHTML","appendChild","parent"],"mappings":"AAWe,MAAMA,EACjB,WAAAC,CAAYC,EAAIC,EAAU,IACtBC,KAAKF,GAAKA,CAClB,CAEI,IAAAG,GACID,KAAKF,GAAGI,UAAYF,KAAKE,UAAUC,KAAKH,KAGhD,CAEI,oBAAAI,GAEuBC,MAAMC,KAAKC,SAASC,iBAAiB,MAAMC,QAAOC,GAAMA,EAAGC,QAAQC,cAAcC,WAAW,SAEpGC,SAAQC,IACf,MAAMJ,EAAUI,EAAIJ,QAAQC,cAC5B,IAAKI,eAAeC,IAAIN,GAAU,CAC9B,MAAMO,UAAsBC,YACxB,WAAAtB,GACIuB,OACxB,EAEgBJ,eAAeK,OAAOV,EAASO,EAC/C,IAEA,CAEI,sBAAAI,GACIC,QAAQC,IAAI,4CACKnB,MAAMC,KAAKC,SAASC,iBAAiB,MAAMC,QAAOC,GAAMA,EAAGC,QAAQC,cAAcC,WAAW,SAEpGC,SAAQW,MAAOC,IACpB,MACMC,EADUD,EAAQf,QAAQC,cACZgB,QAAQ,MAAO,IAC7BC,EAAUH,EAAQI,aAAa,WAC/BC,EAAOL,EAAQI,aAAa,QAE5BE,EAAON,EAAQO,aAAa,QAS9BN,UACM7B,GAAGoC,KAAKP,GACV7B,GAAGqC,KAAKR,IAAQ7B,GAAGqC,KAAKR,GAAKS,OAI7BtC,GAAGqC,KAAKR,IAAQK,GAAQlC,GAAGqC,KAAKR,GAAKK,MACrClC,GAAGkC,KAAKL,EAAK,CAAEE,UAASE,aAMpCR,QAAQC,IAAI,kCACpB,CAEI,mBAAAa,GACI,MAAMC,EAAM/B,SAASgC,cAAc,OACnCD,EAAIE,YAAcjC,SAASkC,KAAKC,UAChCnC,SAASkC,KAAKE,YAAYL,EAClC,CAEI,SAAApC,CAAU0C,EAASrC,UACfP,KAAKI,uBACLJ,KAAKsB,yBAEDtB,KAAKqC,qBACLrC,KAAKqC,qBAEjB"}