{"version":3,"file":"spellbook.js","sources":["../../../apps/based/spellbook/lib/client.js","../../../apps/based/spellbook/lib/spellData.js","../../../apps/based/spellbook/spellbook.js","../../../apps/based/spellbook/lib/calculateCost.js","../../../apps/based/spellbook/lib/castSpell.js","../../../apps/based/spellbook/lib/submitFormHandler.js","../../../apps/based/spellbook/lib/updateConfigForm.js"],"sourcesContent":["const client = {};\n\n// admin client endpoint\nclient.endpoint = buddypond.adminEndpoint;\n\nclient.apiRequest = async (uri, method = 'GET', data = null) => {\n\n  const options = {\n    method: method\n  };\n\n  let headers = {\n    \"Accept\": \"application/json\",\n    \"Content-Type\": \"application/json; charset=utf-8\"\n  };\n  if (buddypond.qtokenid) {\n    headers[\"Authorization\"] = `Bearer ${buddypond.qtokenid}`; // âœ… Use Authorization header\n    headers[\"X-Me\"] = buddypond.me; // âœ… Use X-Me header\n  }\n\n\n  if (data) {\n    options.body = JSON.stringify(data);\n  }\n\n  options.headers = headers;\n\n  let url = `${client.endpoint}${uri}`;\n  console.log('admin client making api request', url, options);\n\n\n  try {\n    const response = await fetch(url, options);\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n    return await response.json();\n  } catch (error) {\n    console.error('Error in API request:', error);\n    throw error;\n  }\n\n};\n\nexport default client;","export default {\n  spells: [\n    {\n      name: 'zalgo',\n      label: 'Zalgo',\n      icon: 'ðŸ‘¹',\n      description: 'Corrupts text with chaotic glyphs.',\n      cost: 10,\n      costText: 'ðŸª™3',\n      costSymbol: 'B.webp,B.webp',\n      config: {\n        targets: ['self', 'buddy'],\n        intensity: { type: 'number', label: 'Intensity', value: 10, min: 1, max: 50 },\n      },\n    },\n    /*\n    {\n      name: 'ebublio',\n      description: 'Traps target in a bubble.',\n      cost: 60,\n      costText: 'ðŸª™2',\n      config: { duration: { type: 'number', label: 'Duration (seconds)', value: 30, min: 10, max: 300 } },\n    },\n    */\n    {\n      name: 'cure',\n      label: 'Cure',\n      icon: 'ðŸ’Š',\n      description: 'Removes a curse from the target.',\n      cost: 20,\n      costText: 'ðŸª™4',\n      costSymbol: 'W.webp',\n      config: { targets: ['self'] },\n    },\n    {\n      name: 'rickroll',\n      label: 'Rickroll',\n      icon: 'ðŸŽµ',\n      description: 'Plays a classic prank video.',\n      cost: 10,\n      costText: 'ðŸª™1',\n      costSymbol: 'U.webp',\n      config: {\n        targets: ['self'],\n        url: { type: 'text', label: 'Video URL', value: 'https://youtu.be/dQw4w9WgXcQ' },\n      },\n    },\n    {\n      name: 'forbiddenRickRoll',\n      label: 'Forbidden Rickroll',\n      icon: 'ðŸ”’',\n      description: 'An inescapable prank video.',\n      cost: 30,\n      costText: 'ðŸª™2',\n      costSymbol: 'B.webp,U.webp,G.webp',\n      config: { targets: ['self'] },\n    },\n    {\n      name: 'lightning',\n      label: 'Lightning',\n      icon: 'âš¡ï¸',\n      description: 'Strikes with a dazzling bolt.',\n      cost: 80,\n      costText: 'ðŸª™3',\n      costSymbol: 'R.webp',\n      config: {\n        targets: ['self', 'buddy', 'pond'],\n        intensity: { type: 'number', label: 'Intensity', value: 5, min: 1, max: 10 },\n      },\n    },\n    {\n      name: 'fireball',\n      label: 'Fireball',\n      icon: 'ðŸ”¥',\n      description: 'Hurls a fiery projectile.',\n      cost: 80,\n      costText: 'ðŸª™3',\n      costSymbol: 'R.webp',\n      config: {\n        targets: ['self', 'buddy', 'pond'],\n        power: { type: 'number', label: 'Power', value: 5, min: 1, max: 10 },\n      },\n    },\n    {\n      name: 'earthquake',\n      label: 'Earthquake',\n      icon: 'ðŸŒ',\n      description: 'Shakes the ground beneath.',\n      cost: 80,\n      costText: 'ðŸª™3',\n      costSymbol: 'R.webp,G.webp',\n      config: {\n        targets: ['self', 'buddy', 'pond'],\n        magnitude: { type: 'number', label: 'Magnitude', value: 5, min: 1, max: 10 },\n      },\n    },\n    {\n      name: 'flood',\n      label: 'Flood',\n      icon: 'ðŸŒŠ',\n      description: 'Covers the area in water.',\n      cost: 80,\n      costText: 'ðŸª™3',\n      costSymbol: 'U.webp',\n      config: {\n        targets: ['self', 'buddy', 'pond'],\n        depth: { type: 'number', label: 'Depth', value: 5, min: 1, max: 10 },\n      },\n    },\n    {\n      name: 'vortex',\n      label: 'Vortex',\n      icon: 'ðŸŒªï¸',\n      description: 'Creates a swirling wind.',\n      cost: 80,\n      costText: 'ðŸª™3',\n      costSymbol: 'U.webp,R.webp',\n      config: {\n        targets: ['self', 'buddy', 'pond'],\n        strength: { type: 'number', label: 'Strength', value: 5, min: 1, max: 10 },\n      },\n    },\n    {\n      name: 'barrelRoll',\n      label: 'Barrel Roll',\n      icon: 'ðŸŽ¢',\n      description: 'Performs a barrel roll.',\n      cost: 10,\n      costText: 'ðŸª™1',\n      costSymbol: 'U.webp, R.webp',\n      config: { targets: ['self', 'buddy', 'pond'] },\n    },\n    {\n      name: 'alert',\n      label: 'Alert',\n      icon: 'ðŸ“¢',\n      description: 'Displays a custom message.',\n      cost: 10,\n      costText: 'ðŸª™1',\n      costSymbol: 'W.webp',\n      config: {\n        targets: ['self', 'buddy'],\n        text: { type: 'text', label: 'Message', value: 'You have been cursed!' },\n      },\n    },\n    {\n      name: 'logout',\n      label: 'Logout',\n      icon: 'ðŸšª',\n      description: 'Forces the target to log out.',\n      cost: 250,\n      costText: 'ðŸª™5',\n      costSymbol: 'B.webp',\n      config: { },\n    },\n  ],\n\n  curses: [\n    {\n      name: 'babel',\n      label: 'Babel.js',\n      icon: 'ðŸ—£ï¸',\n      description: 'Scrambles communication.',\n      cost: 120,\n      costText: 'ðŸª™3',\n      costSymbol: 'U.webp, B.webp',\n      config: {\n        targets: ['self'],\n        duration: { type: 'number', label: 'Curse Duration', value: 1, min: 1, max: 5 },\n      },\n    },\n    {\n      name: 'riddikulus',\n      label: 'Riddikulus',\n      icon: 'ðŸ˜‚',\n      description: 'Turns fears into something funny.',\n      cost: 60,\n      costText: 'ðŸª™2',\n      costSymbol: 'U.webp, B.webp',\n      config: {\n        targets: ['self'],\n        duration: { type: 'number', label: 'Duration (seconds)', value: 1, min: 1, max: 5 },\n      },\n    },\n    {\n      name: 'no-uploads',\n      label: 'No Uploads',\n      icon: 'ðŸš«',\n      description: 'Prevents uploads for a duration.',\n      cost: 150,\n      costText: 'ðŸª™5',\n      costSymbol: 'B.webp, W.webp',\n      config: {\n        duration: { type: 'number', label: 'Curse Duration', value: 1, min: 1, max: 5 },\n      },\n    },\n    {\n      name: 'banhammer',\n      label: 'Banhammer',\n      icon: 'ðŸ”¨',\n      description: 'Temporarily bans the target.',\n      cost: 1000,\n      costText: 'ðŸª™10',\n      costSymbol: 'W.webp,B.webp',\n      config: {\n        duration: { type: 'number', label: 'Ban Duration (seconds)', value: 600, min: 300, max: 86400 },\n      },\n    },\n  ],\n\n  memes: [\n    {\n      name: 'chicken-jockey',\n      label: 'Chicken Jockey',\n      icon: 'ðŸ”',\n      description: 'Summons a chicken jockey.',\n      cost: 10,\n      costText: 'ðŸª™1',\n      costSymbol: 'G.webp',\n      config: {\n        targets: ['self', 'buddy', 'pond'],\n        duration: { type: 'number', label: 'Duration (seconds)', value: 5, min: 1, max: 10 },\n      },\n    },\n    {\n      name: 'hamster-dance',\n      label: 'Hamster Dance',\n      icon: 'ðŸ¹',\n      description: 'Plays a funny hamster dance sound.',\n      cost: 10,\n      costText: 'ðŸª™1',\n      costSymbol: 'G.webp',\n      config: {\n        targets: ['self', 'buddy', 'pond'],\n        volume: { type: 'number', label: 'Volume', value: 5, min: 1, max: 10 },\n      },\n    },\n    {\n      name: 'cappuccino-assassino',\n      label: 'Cappuccino Assassino',\n      icon: 'â˜•',\n      description: 'Summons a cappuccino assassin.',\n      cost: 10,\n      costText: 'ðŸª™1',\n      costSymbol: 'B.webp, R.webp',\n      config: {\n        targets: ['self', 'buddy', 'pond'],\n        duration: { type: 'number', label: 'Duration (seconds)', value: 5, min: 1, max: 10 },\n      },\n    },\n    {\n      name: 'peanut-butter-jelly-time',\n      label: 'Peanut Butter Jelly Time',\n      icon: 'ðŸž',\n      description: 'Plays a funny peanut butter jelly time sound.',\n      cost: 10,\n      costText: 'ðŸª™1',\n      costSymbol: 'R.webp, G.webp',\n      config: {\n        targets: ['self', 'buddy', 'pond'],\n        volume: { type: 'number', label: 'Volume', value: 5, min: 1, max: 10 },\n      },\n    },\n  ],\n};\n","import client from './lib/client.js';\nimport castSpell from './lib/castSpell.js';\nimport spellData from './lib/spellData.js';\nimport calculateCost from './lib/calculateCost.js';\nimport submitFormHandler from './lib/submitFormHandler.js';\nimport updateConfigForm from './lib/updateConfigForm.js';\n\nfunction updateSpellButtons(spellType, container) {\n  const currentTargetType = $('#spellTargetType').val() || 'buddy'; // fallback\n  const spells = spellData[spellType];\n  // console.log('updateSpellButtons', spellType, currentTargetType, spells);\n\n  const buttons = Array.from(container.querySelectorAll('.spellbook-spell-button'));\n\n  buttons.forEach(button => {\n    const spellName = button.dataset.name;\n    const spell = spells.find(s => s.name === spellName);\n\n    if (!spell || !spell.config || !spell.config.targets && this.bp.me !== 'Marak') { // TODO: admin rbac check\n      button.disabled = true;\n      button.classList.remove('valid-target');\n      button.classList.add('invalid-target');\n      button.title = `Spell ${spellName} has no allowed targets for you.`;\n      return;\n    }\n\n    if (spell.config?.targets?.includes(currentTargetType) || this.bp.me === 'Marak') { // TODO: admin rbac check\n      button.disabled = false;\n      button.classList.add('valid-target');\n      button.classList.remove('invalid-target');\n      button.title = ''; // optional: add a helpful hint here\n    } else {\n      button.disabled = true;\n      button.classList.remove('valid-target');\n      button.classList.add('invalid-target');\n      button.title = `Valid targets: ${spell.config.targets.join(', ')}`;\n    }\n  });\n\n  // Now sort buttons: enabled first, then alphabetically\n  buttons.sort((a, b) => {\n    const aDisabled = a.disabled ? 1 : 0;\n    const bDisabled = b.disabled ? 1 : 0;\n\n    if (aDisabled !== bDisabled) {\n      return aDisabled - bDisabled;\n    }\n\n    const aLabel = a.querySelector('.spell-label').textContent.toLowerCase();\n    const bLabel = b.querySelector('.spell-label').textContent.toLowerCase();\n    return aLabel.localeCompare(bLabel);\n  });\n\n  // Re-append sorted buttons\n  buttons.forEach(button => container.appendChild(button));\n}\n\n\nfunction renderSpellButtons(spellType, container, onSelect) {\n  container.innerHTML = '';\n  const spells = spellData[spellType];\n  spells.forEach(spell => {\n\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.className = 'spellbook-spell-button';\n    btn.dataset.name = spell.name;\n\n    const icon = document.createElement('div');\n    icon.className = 'spell-icon';\n    icon.textContent = spell.icon || 'âœ¨'; // fallback icon\n\n    const label = document.createElement('div');\n    label.className = 'spell-label';\n    label.textContent = `${spell.label || spell.name}`;\n\n    btn.appendChild(icon);\n    btn.appendChild(label);\n\n    if (!spell.config || !spell.config.targets && this.bp.me !== 'Marak') { // TODO: admin rbac check\n      btn.disabled = true;\n    }\n    btn.addEventListener('click', () => {\n      onSelect(spell);\n      this.applyCooldown(btn, spell.cooldown || 10000); // default cooldown of 1 second\n    });\n    container.appendChild(btn);\n\n\n  });\n\n  // ['self', 'buddy', 'pond'], etc\n  // may contain any combination of 'self', 'buddy', 'pond'\n  let currentTargetType = $('#spellTargetType').val() || 'buddy'; // default to buddy if not set\n  // console.log('currentTargetType', currentTargetType);\n  // TODO: we need to disable the button if currentTargetType is not in spell.config.targets\n  updateSpellButtons.call(this, spellType, container);\n\n}\n\nfunction initSpellbookUI($content, context) {\n  const spellButtonsContainer = $content.querySelector('.spellbook-spells');\n  const tabButtons = $content.querySelectorAll('.spellbook-tab');\n\n  function handleSpellSelection(spell) {\n    const $spellTargetType = $content.querySelector('#spellTargetType');\n    //const $spellCost = $content.querySelector('#spellCost');\n    //$spellCost.textContent = `Cost: ${spell.cost}`;\n    // console.log('Selected spell:', spell);\n    if (spell.config?.targets) {\n      const availableTargets = spell.config.targets;\n      [...$spellTargetType.options].forEach(opt => {\n        opt.disabled = !availableTargets.includes(opt.value);\n      });\n      if (!availableTargets.includes($spellTargetType.value)) {\n        $spellTargetType.value = availableTargets[0];\n      }\n    }\n    let e = new Event('change');\n    this.submitFormHandler(e, $content, spell);\n  }\n\n  tabButtons.forEach(btn => {\n    btn.addEventListener('click', () => {\n      const type = btn.dataset.type;\n      $('#spellType', $content).val(type);\n      renderSpellButtons.call(this, type, spellButtonsContainer, handleSpellSelection.bind(this));\n    });\n  });\n\n  // Default to first type\n  tabButtons[0].click();\n}\n\nexport default class Spellbook {\n  constructor(bp, options = {}) {\n    this.bp = bp;\n    this.data = spellData;\n    return this;\n  }\n\n  async init() {\n    this.html = await this.bp.load('/v5/apps/based/spellbook/spellbook.html');\n    await this.bp.load('/v5/apps/based/spellbook/spellbook.css');\n\n    this.isUsingInput = false;\n\n    return 'loaded Spellbook';\n  }\n\n  async open(options = {}) {\n\n    let context = null;\n    let output = null;\n\n    if (options.output) { // could be a buddy or a pond or self\n      output = options.output;\n    }\n\n    if (options.context) { // could be a buddyname or pond name\n      context = options.context;\n    }\n\n    if (!this.spellbookWindow) {\n      this.spellbookWindow = this.bp.apps.ui.windowManager.createWindow({\n        id: 'spellbook',\n        title: 'Spellbook',\n        icon: 'desktop/assets/images/icons/icon_spellbook_64.png',\n        x: 250,\n        y: 75,\n        width: 360,\n        height: 440,\n        minWidth: 200,\n        minHeight: 200,\n        parent: $('#desktop')[0],\n        content: this.html,\n        resizable: false, // no works?\n        minimizable: true,\n        maximizable: true,\n        closable: true,\n        focusable: true,\n        maximized: false,\n        minimized: false,\n        onClose: () => {\n          this.spellbookWindow = null;\n        },\n      });\n\n      //\n      // Spellbook eventBind listeners\n      //\n      const $content = this.spellbookWindow.content;\n      initSpellbookUI.call(this, $content, context);\n      // Initialize dropdowns and events\n      $('#spellType', $content).on('change', (e) => {\n        updateSpellsDropdown.call(this, $content);\n      });\n      $('#spellName', $content).on('change', (e) => {\n        updateValidTargets.call(this, $content);\n      });\n      // $('#spellName', $content).on('change', updateConfigForm);\n      $('#spellTargetType', $content).on('change', (e) => {\n        updateTargetVisibility.call(this, $content);\n        updateSpellButtons.call(this, $('#spellType', $content).val(), $content.querySelector('.spellbook-spells'));\n      });\n      // spellDuration is a slider, needs to update on slide\n      $('#spellDuration', $content).on('input', (e) => {\n        const duration = parseInt($(e.target).val(), 10);\n        const spellType = $('#spellType', $content).val();\n        const spellName = $('#spellName', $content).val();\n        const _spellData = this.data[spellType].find((s) => s.name === spellName);\n        const spellCost = calculateCost(_spellData, { duration });\n        $('#spellCost', $content).text(`Total cost: ${spellCost} buddy points`);\n      });\n\n      $('#toggleTargetInput', $content).on('click', () => {\n        this.isUsingInput = !this.isUsingInput;\n        $('#spellTargetName', $content).toggle(!this.isUsingInput);\n        $('#spellTargetInput', $content).toggle(this.isUsingInput);\n        $('#toggleTargetInput', $content).text(this.isUsingInput ? 'Choose from list' : 'Choose name not on list');\n      });\n\n      // Populate active users\n      if (this.bp.apps.buddylist?.data?.activeUsers) {\n        this.bp.apps.buddylist.data.activeUsers.forEach((buddy) => {\n          $('#spellTargetName', $content).append(`<option value=\"${buddy}\">${buddy}</option>`);\n        });\n      }\n\n      // Populate active ponds\n      if (this.bp.apps.buddylist?.data?.activePonds) {\n        this.bp.apps.buddylist.data.activePonds.forEach((pond) => {\n          $('#spellTargetPond', $content).append(`<option value=\"${pond}\">${pond}</option>`);\n        });\n      }\n\n      // Autocomplete for target input\n      $('#spellTargetInput', $content).autocomplete({\n        source: this.bp.apps.buddylist?.data?.activeUsers || [],\n      });\n\n      // Form submission\n      $('#castSpellForm', $content).on('submit', async (e) => {\n        this.submitFormHandler(e, $content);\n      });\n\n      // Orb click (alternative cast trigger)\n      $('.ponderSpellbook', $content).on('click', (e) => {\n        e.preventDefault();\n        $('#castSpellForm', $content).trigger('submit');\n      });\n\n      // Event listeners for dynamic updates\n      this.bp.on('buddy::activeUserAdded', 'update-spellbook-targets', (buddy) => {\n        if (!$(`#spellTargetName option[value=\"${buddy}\"]`, $content).length) {\n          $('#spellTargetName', $content).append(`<option value=\"${buddy}\">${buddy}</option>`);\n        }\n      });\n\n      this.bp.on('pond::activePondAdded', 'update-spellbook-pond-targets', (pond) => {\n        if (!$(`#spellTargetPond option[value=\"${pond}\"]`, $content).length) {\n          $('#spellTargetPond', $content).append(`<option value=\"${pond}\">${pond} Pond</option>`);\n        }\n      });\n\n    }\n\n    if (output) {\n      // select the targetType using the output value\n      $('#spellTargetType', this.spellbookWindow.content).val(output);\n      // trigger change event to update target visibility\n      $('#spellTargetType', this.spellbookWindow.content).trigger('change');\n    }\n    if (context) {\n      if (output === 'buddy') {\n        // select the targetName using the context value\n        $('#spellTargetName', this.spellbookWindow.content).val(context);\n        // trigger change event to update target visibility\n        // $('#spellTargetName', this.spellbookWindow.content).trigger('change');\n      }\n      if (output === 'pond') {\n        // select the targetPond using the context value\n        $('#spellTargetPond', this.spellbookWindow.content).show().val(context);\n        // trigger change event to update target visibility\n        // $('#spellTargetPond', this.spellbookWindow.content).trigger('change');\n        setTimeout(() => {\n          // Remark: For some reason there is race condition with the pond dropdown\n          // only when first opening the spellbook, TODO: resolve this\n          $('#spellTargetPond', this.spellbookWindow.content).show();\n        }, 400);\n      }\n\n    }\n\n    let $content = $(this.spellbookWindow.content);\n    updateTargetVisibility.call(this, $content);\n    updateSpellsDropdown.call(this, $content);\n\n\n    return this.spellbookWindow;\n  }\n}\n\n//\n// Spellbook functions\n//\n\n// Update target visibility based on target type\nfunction updateTargetVisibility($content) {\n  // TODO: just use spellTargetName for both pond and buddy\n  const targetType = $('#spellTargetType', $content).val();\n  if (targetType === 'pond') {\n    $('#spellTargetPond', $content).show();\n    $('#spellTargetName', $content).hide();\n    $('.spellTargetSelf', $content).hide();\n    $('#toggleTargetInput', $content).show();\n  }\n\n  if (targetType === 'buddy') {\n    // show the buddy dropdown\n    $('#spellTargetName', $content).show();\n    $('#spellTargetPond', $content).hide();\n    $('.spellTargetSelf', $content).hide();\n    $('#toggleTargetInput', $content).show();\n  }\n\n  if (targetType === 'self') {\n    // hide the buddy and pond dropdowns\n    $('#spellTargetName', $content).hide();\n    $('#spellTargetPond', $content).hide();\n    $('.spellTargetSelf', $content).html(this.bp.me).show();\n    $('#toggleTargetInput', $content).hide();\n    $('.spellTargetNameLabel').show();\n  }\n};\n\n// Populate spells dropdown based on spellType\nfunction updateSpellsDropdown($content) {\n  const spellType = $('#spellType', $content).val();\n  const spellsList = this.data[spellType];\n  const $spellName = $('#spellName', $content);\n\n\n  // console.log('updateSpellsDropdown', spellType, spellsList);\n  $spellName.empty();\n  spellsList.forEach((spell) => {\n\n    let disabled = '';\n\n    // check spell.config.targets\n    if (!spell.config || !spell.config.targets) {\n      disabled = 'disabled';\n    }\n    // TODO: uncomment / add role check from session\n    // Remark: This is validated server-side\n    /*\n    // Ensures that admins can cast any spell\n    */\n    if (this.bp.me === 'Marak') {\n      disabled = '';\n    }\n\n    $spellName.append(`<option ${disabled} value=\"${spell.name}\">(${spell.cost}) - ${spell.label || spell.name}</option>`);\n  });\n\n  // Sort spells\n  // Step 1: Group by disabled status (enabled first, disabled last)\n  let options = $spellName.find('option').get().sort((a, b) => {\n    const aDisabled = $(a).prop('disabled') ? 1 : 0;\n    const bDisabled = $(b).prop('disabled') ? 1 : 0;\n    return aDisabled - bDisabled;\n  });\n\n  // Step 2: Sort alphabetically while preserving groups\n  options = options.sort((a, b) => {\n    const aDisabled = $(a).prop('disabled') ? 1 : 0;\n    const bDisabled = $(b).prop('disabled') ? 1 : 0;\n\n    // Preserve group order: enabled (0) before disabled (1)\n    if (aDisabled !== bDisabled) {\n      return aDisabled - bDisabled;\n    }\n\n    // Sort alphabetically within groups\n    return $(a).val().localeCompare($(b).val(), 'en', { sensitivity: 'base' });\n  });\n\n  // Append sorted options back to the select\n  $spellName.empty().append(options);\n  // prepend as first option\n  $spellName.prepend('<option value=\"\" selected>Choose your spell wisely...</option>');\n\n  // this.updateConfigForm.call($content);\n};\n\nfunction updateValidTargets($content) {\n  const spellName = $('#spellName', $content).val();\n  // get the spellData ref\n  const spellType = $('#spellType', $content).val();\n  const spellsList = this.data[spellType];\n  const spell = spellsList.find((s) => s.name === spellName);\n  const spellConfig = spell.config;\n  const previousTargetType = $('#spellTargetType', $content).val();\n  const previousTargetName = $('#spellTargetName', $content).val();\n\n  // check the spellConfig.targets and then update the targetType dropdown with disabled options such that any values\n  // not found in the spellConfig.targets are disabled\n  // console.log('updateValidTargets', spellName, spellType, spell);\n  const $targetType = $('#spellTargetType', $content);\n  $targetType.empty().append('<option value=\"\">Choose your target wisely...</option>');\n  if (spellConfig && spellConfig.targets) {\n    let allTargets = ['self', 'buddy', 'pond'];\n    allTargets.forEach((value) => {\n      let disabled = 'disabled';\n      if (spellConfig.targets.includes(value)) {\n        disabled = '';\n      }\n      // TODO: uncomment / add role check from session\n      // Remark: This is validated server-side\n      // Ensures that admins can choose any target\n      /*\n      */\n      if (this.bp.me === 'Marak') {\n        disabled = '';\n      }\n      // upperCast first letter\n      const targetLabel = value.charAt(0).toUpperCase() + value.slice(1);\n      $targetType.append(`<option ${disabled} value=\"${value}\">${targetLabel}</option>`);\n    });\n    // if only one targetType, select it\n    if (Object.keys(spellConfig.targets).length === 1) {\n      const targetType = spellConfig.targets[0];\n      // console.log('updateValidTargets - only one targetType', targetType);\n      $targetType.val(targetType);\n      if (targetType === 'self') {\n        // hide the spellTargetName\n        $('#spellTargetName', $content).hide();\n        // show the spellTargetSelf with value as this.bp.me\n        $('.spellTargetSelf', $content).html(this.bp.me).show();\n        $('#toggleTargetInput', $content).hide();\n      } else {\n        // show the spellTargetName\n        $('#spellTargetName', $content).show();\n        // hide the spellTargetSelf\n        $('.spellTargetSelf', $content).hide();\n        $('#toggleTargetInput', $content).show();\n      }\n    } else {\n      // show the spellTargetName\n      $('#spellTargetName', $content).show();\n      // hide the spellTargetSelf\n      $('.spellTargetSelf', $content).hide();\n      $('#toggleTargetInput', $content).show();\n    }\n  } else {\n    $targetType.append('<option disabled value=\"self\">Self</option>');\n  }\n\n  // if the previousTargetType is available in the spellConfig.targets, select it\n  if (spellConfig && spellConfig.targets && spellConfig.targets.includes(previousTargetType)) {\n    $targetType.val(previousTargetType);\n  } else {\n    $targetType.val('');\n  }\n\n}\nfunction applyCooldown(button, durationMs) {\n  button.classList.add('cooldown', 'cooldown-active'); // cooldown-active blocks pointer events\n  button.style.setProperty('--cooldown-time', `${durationMs}ms`);\n\n  const cooldownOverlay = document.createElement('div');\n  cooldownOverlay.className = 'cooldown-overlay';\n  cooldownOverlay.style.animationDuration = `${durationMs}ms`;\n\n  button.appendChild(cooldownOverlay);\n\n  setTimeout(() => {\n    button.classList.remove('cooldown', 'cooldown-active');\n    if (cooldownOverlay.parentElement) {\n      cooldownOverlay.remove();\n    }\n  }, durationMs);\n}\n\n\nSpellbook.prototype.applyCooldown = applyCooldown;\n\nSpellbook.prototype.castSpell = castSpell;\nSpellbook.prototype.client = client;\nSpellbook.prototype.submitFormHandler = submitFormHandler;\nSpellbook.prototype.updateConfigForm = updateConfigForm;","export default function calculateCost(spellData, config) {\n    console.log('calculateCost', spellData, config);\n    const cost = spellData.cost;\n    const duration = config.duration;\n\n    let totalCost = cost * duration;\n\n    return totalCost;\n\n}","export default async function castSpell(targetType, targetName, spellName, spellData) {\n  console.log(spellName, castSpell);\n  if (spellName.length > 0 && castSpell.length > 0) {\n    // if Buddy fails role check, reflect the spell back onto them\n    let result;\n    try {\n      result = await this.client.apiRequest(`/spellbook/cast-spell/${targetType}/${targetName}/${spellName}`, 'POST', spellData)\n    } catch (err) {\n      console.error('Error casting spell:', err);\n      result = {\n        error: err.message\n      };\n    }\n    console.log('castSpell result', result);\n    return result;\n  }\n}","export default async function submitFormHandler(e, content, spell) {\n  let $content = $(content);\n    e.preventDefault();\n    // console.log('Submitting spell form...', content, spell);\n    const spellType = $('#spellType', $content).val();\n    //const spellName = $('#spellName', $content).val();\n    let spellName = spell.name;\n    let targetType = $('#spellTargetType', $content).val();\n    // console.log(`Submitting spell form for type: ${spellType}, name: ${spellName} and target type: ${targetType}`);\n    const spellDuration = $('#spellDuration', $content).val();\n    const _spellData = this.data[spellType].find((s) => s.name === spellName);\n    let target = null;\n    const config = {};\n\n    if (targetType === 'buddy') {\n      target = this.isUsingInput ? $('#spellTargetInput', $content).val() : $('#spellTargetName', $content).val();\n    }\n\n    if (targetType === 'pond') {\n      target = $('#spellTargetPond', $content).val();\n    }\n\n    if (targetType === 'self') {\n      target = this.bp.me; // Use current user\n    }\n\n    /*\n    if (targetType === 'buddy') {\n      target = isUsingInput ? $('#spellTargetInput', $content).val() : $('#spellTargetName', $content).val();\n    } else if (targetType === 'pond' && spellType === 'spell') {\n      target = $('#spellTargetPond', $content).val();\n    } else if (targetType === 'self') {\n      target = this.bp.me; // Use current user\n    }\n    */\n\n    // Collect config values\n    $('#spellConfig input', $content).each(function () {\n      const name = $(this).attr('name').match(/spellConfig\\[(.*)\\]/)[1];\n      config[name] = $(this).val();\n    });\n\n    config.duration = spellDuration;\n\n    // let totalCost = calculateCost(_spellData, config);\n    // console.log(`Casting ${spellName} on ${target} with a total cost of ${totalCost} buddy points.`);\n\n    if (spellName && target) {\n      try {\n        if (targetType === 'self') {\n          targetType = 'buddy'; // self is a special case, but we want to treat it as a buddy for casting\n        }\n        let result = await this.castSpell(targetType, target, spellName, { type: spellType, config });\n        if (result && result.error) {\n          // display error message\n          $('.spell-message', $content).addClass('error');\n          $('.spell-message', $content).text(result.error).show();\n        } else {\n          // display success message\n          $('.spell-message', $content).removeClass('error');\n          $('.spell-message', $content).text('Spell cast successfully!').show();\n        }\n        // this.applyCooldown(spellType, spellName, targetType, target);\n        console.log('Spell cast result:', result);\n      } catch (error) {\n        throw new Error(`Error casting spell: ${error.message}`);\n      }\n\n    } else {\n      alert('Please select a spell and a valid target.');\n    }\n}"," // Populate config form based on selected spell\n export default function updateConfigForm ($content) {\n   const spellName = $('#spellName', $content).val();\n   const spellType = $('#spellType', $content).val();\n   const spellsList = this.data[spellType];\n   const spell = spellsList.find((s) => s.name === spellName);\n   const $config = $('#spellConfig', $content);\n   $config.empty();\n   if (spell && spell.config) {\n     Object.entries(spell.config).forEach(([key, config]) => {\n       if (key === 'targets') {\n         return;\n       }\n       const inputId = `spellConfig-${key}`;\n       const $label = $(`<label for=\"${inputId}\">${config.label}</label>`);\n       let $input;\n       if (config.type === 'number') {\n         $input = $(`<input type=\"number\" id=\"${inputId}\" name=\"spellConfig[${key}]\" value=\"${config.value}\" min=\"${config.min}\" max=\"${config.max}\">`);\n       } else {\n         $input = $(`<input type=\"text\" id=\"${inputId}\" name=\"spellConfig[${key}]\" value=\"${config.value}\">`);\n       }\n       $config.append($label, $input);\n     });\n   }\n}"],"names":["client","endpoint","buddypond","adminEndpoint","apiRequest","async","uri","method","data","options","headers","Accept","qtokenid","me","body","JSON","stringify","url","console","log","response","fetch","ok","Error","status","json","error","spellData","spells","name","label","icon","description","cost","costText","costSymbol","config","targets","intensity","type","value","min","max","power","magnitude","depth","strength","text","curses","duration","memes","volume","updateSpellButtons","spellType","container","currentTargetType","$","val","buttons","Array","from","querySelectorAll","forEach","button","spellName","dataset","spell","find","s","this","bp","disabled","classList","remove","add","title","includes","join","sort","a","b","aDisabled","bDisabled","aLabel","querySelector","textContent","toLowerCase","bLabel","localeCompare","appendChild","renderSpellButtons","onSelect","innerHTML","btn","document","createElement","className","addEventListener","applyCooldown","cooldown","call","initSpellbookUI","$content","context","spellButtonsContainer","tabButtons","handleSpellSelection","$spellTargetType","availableTargets","opt","e","Event","submitFormHandler","bind","click","Spellbook","constructor","init","html","load","isUsingInput","open","output","spellbookWindow","apps","ui","windowManager","createWindow","id","x","y","width","height","minWidth","minHeight","parent","content","resizable","minimizable","maximizable","closable","focusable","maximized","minimized","onClose","on","updateSpellsDropdown","updateValidTargets","updateTargetVisibility","parseInt","target","spellCost","calculateCost","toggle","buddylist","activeUsers","buddy","append","activePonds","pond","autocomplete","source","preventDefault","trigger","length","show","setTimeout","targetType","hide","spellsList","$spellName","empty","get","prop","sensitivity","prepend","spellConfig","previousTargetType","$targetType","targetLabel","charAt","toUpperCase","slice","Object","keys","prototype","durationMs","style","setProperty","cooldownOverlay","animationDuration","parentElement","castSpell","targetName","result","err","message","spellDuration","each","attr","match","addClass","removeClass","alert","updateConfigForm","$config","entries","key","inputId","$label","$input"],"mappings":"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"}