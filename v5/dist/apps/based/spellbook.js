const e={};e.endpoint=buddypond.adminEndpoint,e.apiRequest=async(t,l="GET",o=null)=>{const s={method:l};let a={Accept:"application/json","Content-Type":"application/json; charset=utf-8"};buddypond.qtokenid&&(a.Authorization=`Bearer ${buddypond.qtokenid}`,a["X-Me"]=buddypond.me),o&&(s.body=JSON.stringify(o)),s.headers=a;let n=`${e.endpoint}${t}`;console.log("admin client making api request",n,s);try{const e=await fetch(n,s);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){throw console.error("Error in API request:",e),e}};var t={spells:[{name:"zalgo",label:"Zalgo",icon:"👹",description:"Corrupts text with chaotic glyphs.",cost:10,costText:"🪙3",costSymbol:"B.webp,B.webp",config:{targets:["self","buddy"],intensity:{type:"number",label:"Intensity",value:10,min:1,max:50}}},{name:"cure",label:"Cure",icon:"💊",description:"Removes a curse from the target.",cost:20,costText:"🪙4",costSymbol:"W.webp",config:{targets:["self"]}},{name:"rickroll",label:"Rickroll",icon:"🎵",description:"Plays a classic prank video.",cost:10,costText:"🪙1",costSymbol:"U.webp",config:{targets:["self"],url:{type:"text",label:"Video URL",value:"https://youtu.be/dQw4w9WgXcQ"}}},{name:"forbiddenRickRoll",label:"Forbidden Rickroll",icon:"🔒",description:"An inescapable prank video.",cost:30,costText:"🪙2",costSymbol:"B.webp,U.webp,G.webp",config:{targets:["self"]}},{name:"lightning",label:"Lightning",icon:"⚡️",description:"Strikes with a dazzling bolt.",cost:80,costText:"🪙3",costSymbol:"R.webp",config:{targets:["self","buddy","pond"],intensity:{type:"number",label:"Intensity",value:5,min:1,max:10}}},{name:"fireball",label:"Fireball",icon:"🔥",description:"Hurls a fiery projectile.",cost:80,costText:"🪙3",costSymbol:"R.webp",config:{targets:["self","buddy","pond"],power:{type:"number",label:"Power",value:5,min:1,max:10}}},{name:"earthquake",label:"Earthquake",icon:"🌍",description:"Shakes the ground beneath.",cost:80,costText:"🪙3",costSymbol:"R.webp,G.webp",config:{targets:["self","buddy","pond"],magnitude:{type:"number",label:"Magnitude",value:5,min:1,max:10}}},{name:"flood",label:"Flood",icon:"🌊",description:"Covers the area in water.",cost:80,costText:"🪙3",costSymbol:"U.webp",config:{targets:["self","buddy","pond"],depth:{type:"number",label:"Depth",value:5,min:1,max:10}}},{name:"vortex",label:"Vortex",icon:"🌪️",description:"Creates a swirling wind.",cost:80,costText:"🪙3",costSymbol:"U.webp,R.webp",config:{targets:["self","buddy","pond"],strength:{type:"number",label:"Strength",value:5,min:1,max:10}}},{name:"barrelRoll",label:"Barrel Roll",icon:"🎢",description:"Performs a barrel roll.",cost:10,costText:"🪙1",costSymbol:"U.webp, R.webp",config:{targets:["self","buddy","pond"]}},{name:"death",label:"Death",icon:"💀",description:"Causes the target to die.",cost:100,costText:"🪙5",costSymbol:"B.webp,R.webp",config:{targets:["self","buddy"]}},{name:"confetti",label:"Confetti",icon:"🎉",description:"Covers the area in confetti.",cost:20,costText:"🪙2",costSymbol:"R.webp, W.webp",config:{targets:["self","buddy","pond"],particleCount:{type:"number",label:"Particle Count",value:100,min:10,max:500},duration:{type:"number",label:"Duration (seconds)",value:5,min:1,max:10}}},{name:"rainbow",label:"Rainbow",icon:"🌈",description:"Creates a beautiful rainbow.",cost:30,costText:"🪙2",costSymbol:"U.webp,G.webp, W.webp, R.webp",config:{targets:["self","buddy","pond"],duration:{type:"number",label:"Duration (seconds)",value:5,min:1,max:10}}},{name:"alert",label:"Alert",icon:"📢",description:"Displays a custom message.",cost:10,costText:"🪙1",costSymbol:"W.webp",config:{targets:["self","buddy"],text:{type:"text",label:"Message",value:"You have been cursed!"}}},{name:"logout",label:"Logout",icon:"🚪",description:"Forces the target to log out.",cost:250,costText:"🪙5",costSymbol:"B.webp",config:{}}],curses:[{name:"babel",label:"Babel.js",icon:"🗣️",description:"Scrambles communication.",cost:120,costText:"🪙3",costSymbol:"U.webp, B.webp",config:{targets:["self"],duration:{type:"number",label:"Curse Duration",value:1,min:1,max:5}}},{name:"riddikulus",label:"Riddikulus",icon:"😂",description:"Turns fears into something funny.",cost:60,costText:"🪙2",costSymbol:"U.webp, B.webp",config:{targets:["self"],duration:{type:"number",label:"Duration (seconds)",value:1,min:1,max:5}}},{name:"no-uploads",label:"No Uploads",icon:"🚫",description:"Prevents uploads for a duration.",cost:150,costText:"🪙5",costSymbol:"B.webp, W.webp",config:{duration:{type:"number",label:"Curse Duration",value:1,min:1,max:5}}},{name:"banhammer",label:"Banhammer",icon:"🔨",description:"Temporarily bans the target.",cost:1e3,costText:"🪙10",costSymbol:"W.webp,B.webp",config:{duration:{type:"number",label:"Ban Duration (seconds)",value:600,min:300,max:86400}}}],memes:[{name:"chicken-jockey",label:"Chicken Jockey",icon:"🐔",description:"Summons a chicken jockey.",cost:10,costText:"🪙1",costSymbol:"G.webp",config:{targets:["self","buddy","pond"],duration:{type:"number",label:"Duration (seconds)",value:5,min:1,max:10}}},{name:"hamster-dance",label:"Hamster Dance",icon:"🐹",description:"Plays a funny hamster dance sound.",cost:10,costText:"🪙1",costSymbol:"G.webp",config:{targets:["self","buddy","pond"],volume:{type:"number",label:"Volume",value:5,min:1,max:10}}},{name:"cappuccino-assassino",label:"Cappuccino Assassino",icon:"☕",description:"Summons a cappuccino assassin.",cost:10,costText:"🪙1",costSymbol:"B.webp, R.webp",config:{targets:["self","buddy","pond"],duration:{type:"number",label:"Duration (seconds)",value:5,min:1,max:10}}},{name:"peanut-butter-jelly-time",label:"Peanut Butter Jelly Time",icon:"🍞",description:"Plays a funny peanut butter jelly time sound.",cost:10,costText:"🪙1",costSymbol:"R.webp, G.webp",config:{targets:["self","buddy","pond"],volume:{type:"number",label:"Volume",value:5,min:1,max:10}}}]};function l(e,l){const o=$("#spellTargetType").val()||"buddy",s=t[e],a=Array.from(l.querySelectorAll(".spellbook-spell-button"));a.forEach((e=>{const t=e.dataset.name,l=s.find((e=>e.name===t));if(!l||!l.config||!l.config.targets&&"Marak"!==this.bp.me)return e.disabled=!0,e.classList.remove("valid-target"),e.classList.add("invalid-target"),void(e.title=`Spell ${t} has no allowed targets for you.`);l.config?.targets?.includes(o)||"Marak"===this.bp.me?(e.disabled=!1,e.classList.add("valid-target"),e.classList.remove("invalid-target"),e.title=""):(e.disabled=!0,e.classList.remove("valid-target"),e.classList.add("invalid-target"),e.title=`Valid targets: ${l.config.targets.join(", ")}`)})),a.sort(((e,t)=>{const l=e.disabled?1:0,o=t.disabled?1:0;if(l!==o)return l-o;const s=e.querySelector(".spell-label").textContent.toLowerCase(),a=t.querySelector(".spell-label").textContent.toLowerCase();return s.localeCompare(a)})),a.forEach((e=>l.appendChild(e)))}function o(e,o,s){o.innerHTML="";t[e].forEach((e=>{const t=document.createElement("button");t.type="button",t.className="spellbook-spell-button",t.dataset.name=e.name;const l=document.createElement("div");l.className="spell-icon",l.textContent=e.icon||"✨";const a=document.createElement("div");a.className="spell-label",a.textContent=`${e.label||e.name}`,t.appendChild(l),t.appendChild(a),e.config&&(e.config.targets||"Marak"===this.bp.me)||(t.disabled=!0),t.addEventListener("click",(()=>{s(e),this.applyCooldown(t,e.cooldown||1e4)})),o.appendChild(t)})),$("#spellTargetType").val(),l.call(this,e,o)}function s(e,t){const l=e.querySelector(".spellbook-spells"),s=e.querySelectorAll(".spellbook-tab");function a(t){const l=e.querySelector("#spellTargetType");if(t.config?.targets){const e=t.config.targets;[...l.options].forEach((t=>{t.disabled=!e.includes(t.value)})),e.includes(l.value)||(l.value=e[0])}let o=new Event("change");this.submitFormHandler(o,e,t)}s.forEach((t=>{t.addEventListener("click",(()=>{const s=t.dataset.type;$("#spellType",e).val(s),o.call(this,s,l,a.bind(this))}))})),s[0].click()}class a{constructor(e,l={}){return this.bp=e,this.data=t,this}async init(){return this.html=await this.bp.load("/v5/apps/based/spellbook/spellbook.html"),await this.bp.load("/v5/apps/based/spellbook/spellbook.css"),this.isUsingInput=!1,"loaded Spellbook"}async open(e={}){let t=null,o=null;if(e.output&&(o=e.output),e.context&&(t=e.context),!this.spellbookWindow){this.spellbookWindow=this.bp.apps.ui.windowManager.createWindow({id:"spellbook",title:"Spellbook",icon:"desktop/assets/images/icons/icon_spellbook_64.png",x:250,y:75,width:360,height:500,minWidth:200,minHeight:200,parent:$("#desktop")[0],content:this.html,resizable:!1,minimizable:!0,maximizable:!0,closable:!0,focusable:!0,maximized:!1,minimized:!1,onClose:()=>{this.spellbookWindow=null}});const e=this.spellbookWindow.content;s.call(this,e,t),$("#spellType",e).on("change",(t=>{i.call(this,e)})),$("#spellName",e).on("change",(t=>{p.call(this,e)})),$("#spellTargetType",e).on("change",(t=>{n.call(this,e),l.call(this,$("#spellType",e).val(),e.querySelector(".spellbook-spells"))})),$("#spellDuration",e).on("input",(t=>{const l=parseInt($(t.target).val(),10),o=$("#spellType",e).val(),s=$("#spellName",e).val(),a=function(e,t){return console.log("calculateCost",e,t),e.cost*t.duration}(this.data[o].find((e=>e.name===s)),{duration:l});$("#spellCost",e).text(`Total cost: ${a} buddy points`)})),$("#toggleTargetInput",e).on("click",(()=>{this.isUsingInput=!this.isUsingInput,$("#spellTargetName",e).toggle(!this.isUsingInput),$("#spellTargetInput",e).toggle(this.isUsingInput),$("#toggleTargetInput",e).text(this.isUsingInput?"Choose from list":"Choose name not on list")})),this.bp.apps.buddylist?.data?.activeUsers&&this.bp.apps.buddylist.data.activeUsers.forEach((t=>{$("#spellTargetName",e).append(`<option value="${t}">${t}</option>`)})),this.bp.apps.buddylist?.data?.activePonds&&this.bp.apps.buddylist.data.activePonds.forEach((t=>{$("#spellTargetPond",e).append(`<option value="${t}">${t}</option>`)})),$("#spellTargetInput",e).autocomplete({source:this.bp.apps.buddylist?.data?.activeUsers||[]}),$("#castSpellForm",e).on("submit",(async t=>{this.submitFormHandler(t,e)})),$(".ponderSpellbook",e).on("click",(t=>{t.preventDefault(),$("#castSpellForm",e).trigger("submit")})),this.bp.on("buddy::activeUserAdded","update-spellbook-targets",(t=>{$(`#spellTargetName option[value="${t}"]`,e).length||$("#spellTargetName",e).append(`<option value="${t}">${t}</option>`)})),this.bp.on("pond::activePondAdded","update-spellbook-pond-targets",(t=>{$(`#spellTargetPond option[value="${t}"]`,e).length||$("#spellTargetPond",e).append(`<option value="${t}">${t} Pond</option>`)}))}o&&($("#spellTargetType",this.spellbookWindow.content).val(o),$("#spellTargetType",this.spellbookWindow.content).trigger("change")),t&&("buddy"===o&&($(`#spellTargetName option[value="${t}"]`,this.spellbookWindow.content).length||$("#spellTargetName",this.spellbookWindow.content).append(`<option value="${t}">${t}</option>`),$("#spellTargetName",this.spellbookWindow.content).val(t)),"pond"===o&&($("#spellTargetPond",this.spellbookWindow.content).show().val(t),setTimeout((()=>{$("#spellTargetPond",this.spellbookWindow.content).show()}),400)));let a=$(this.spellbookWindow.content);return n.call(this,a),i.call(this,a),this.spellbookWindow}}function n(e){const t=$("#spellTargetType",e).val();"pond"===t&&($("#spellTargetPond",e).show(),$("#spellTargetName",e).hide(),$(".spellTargetSelf",e).hide(),$("#toggleTargetInput",e).show()),"buddy"===t&&($("#spellTargetName",e).show(),$("#spellTargetPond",e).hide(),$(".spellTargetSelf",e).hide(),$("#toggleTargetInput",e).show()),"self"===t&&($("#spellTargetName",e).hide(),$("#spellTargetPond",e).hide(),$(".spellTargetSelf",e).html(this.bp.me).show(),$("#toggleTargetInput",e).hide(),$(".spellTargetNameLabel").show())}function i(e){const t=$("#spellType",e).val(),l=this.data[t],o=$("#spellName",e);o.empty(),l.forEach((e=>{let t="";e.config&&e.config.targets||(t="disabled"),"Marak"===this.bp.me&&(t=""),o.append(`<option ${t} value="${e.name}">(${e.cost}) - ${e.label||e.name}</option>`)}));let s=o.find("option").get().sort(((e,t)=>($(e).prop("disabled")?1:0)-($(t).prop("disabled")?1:0)));s=s.sort(((e,t)=>{const l=$(e).prop("disabled")?1:0,o=$(t).prop("disabled")?1:0;return l!==o?l-o:$(e).val().localeCompare($(t).val(),"en",{sensitivity:"base"})})),o.empty().append(s),o.prepend('<option value="" selected>Choose your spell wisely...</option>')}function p(e){const t=$("#spellName",e).val(),l=$("#spellType",e).val(),o=this.data[l].find((e=>e.name===t)).config,s=$("#spellTargetType",e).val();$("#spellTargetName",e).val();const a=$("#spellTargetType",e);if(a.empty().append('<option value="">Choose your target wisely...</option>'),o&&o.targets){if(["self","buddy","pond"].forEach((e=>{let t="disabled";o.targets.includes(e)&&(t=""),"Marak"===this.bp.me&&(t="");const l=e.charAt(0).toUpperCase()+e.slice(1);a.append(`<option ${t} value="${e}">${l}</option>`)})),1===Object.keys(o.targets).length){const t=o.targets[0];a.val(t),"self"===t?($("#spellTargetName",e).hide(),$(".spellTargetSelf",e).html(this.bp.me).show(),$("#toggleTargetInput",e).hide()):($("#spellTargetName",e).show(),$(".spellTargetSelf",e).hide(),$("#toggleTargetInput",e).show())}else $("#spellTargetName",e).show(),$(".spellTargetSelf",e).hide(),$("#toggleTargetInput",e).show()}else a.append('<option disabled value="self">Self</option>');o&&o.targets&&o.targets.includes(s)?a.val(s):a.val("")}a.prototype.applyCooldown=function(e,t){e.classList.add("cooldown","cooldown-active"),e.style.setProperty("--cooldown-time",`${t}ms`);const l=document.createElement("div");l.className="cooldown-overlay",l.style.animationDuration=`${t}ms`,e.appendChild(l),setTimeout((()=>{e.classList.remove("cooldown","cooldown-active"),l.parentElement&&l.remove()}),t)},a.prototype.castSpell=async function e(t,l,o,s){if(console.log(o,e),o.length>0&&e.length>0){let e;try{e=await this.client.apiRequest(`/spellbook/cast-spell/${t}/${l}/${o}`,"POST",s)}catch(t){console.error("Error casting spell:",t),e={error:t.message},"HTTP error! status: 401"===t.message&&(e.error="Please log in to cast spells.")}return console.log("castSpell result",e),e}},a.prototype.client=e,a.prototype.submitFormHandler=async function(e,t,l){let o=$(t);e.preventDefault();const s=$("#spellType",o).val();let a=l.name,n=$("#spellTargetType",o).val();const i=$("#spellDuration",o).val();this.data[s].find((e=>e.name===a));let p=null;const r={};if("buddy"===n&&(p=this.isUsingInput?$("#spellTargetInput",o).val():$("#spellTargetName",o).val()),"pond"===n&&(p=$("#spellTargetPond",o).val()),"self"===n&&(p=this.bp.me),$("#spellConfig input",o).each((function(){const e=$(this).attr("name").match(/spellConfig\[(.*)\]/)[1];r[e]=$(this).val()})),r.duration=i,a&&p)try{"self"===n&&(n="buddy");let e=await this.castSpell(n,p,a,{type:s,config:r});e&&e.error?($(".spell-message",o).addClass("error"),$(".spell-message",o).text(e.error).show()):($(".spell-message",o).removeClass("error"),$(".spell-message",o).text("Spell cast successfully!").show()),console.log("Spell cast result:",e)}catch(e){throw new Error(`Error casting spell: ${e.message}`)}else alert("Please select a spell and a valid target.")},a.prototype.updateConfigForm=function(e){const t=$("#spellName",e).val(),l=$("#spellType",e).val(),o=this.data[l].find((e=>e.name===t)),s=$("#spellConfig",e);s.empty(),o&&o.config&&Object.entries(o.config).forEach((([e,t])=>{if("targets"===e)return;const l=`spellConfig-${e}`,o=$(`<label for="${l}">${t.label}</label>`);let a;a="number"===t.type?$(`<input type="number" id="${l}" name="spellConfig[${e}]" value="${t.value}" min="${t.min}" max="${t.max}">`):$(`<input type="text" id="${l}" name="spellConfig[${e}]" value="${t.value}">`),s.append(o,a)}))};export{a as default};
//# sourceMappingURL=spellbook.js.map
