function e(e,t){const d=(e,t)=>{e.find(".card-website-loading").hide();const r=e.find(".card-website-content");r.find(".card-website-link").attr("href",n),r.find(".card-website-title").text(t.title||new URL(n).hostname),r.find(".card-website-description").text(t.description||"");const d=r.find(".card-website-image");t.image?d.attr("src",t.image).show():d.hide(),r.removeClass("card-website-hidden")};buddypond.websiteCardCache=buddypond.websiteCardCache||{};const i=$(e),{url:n}=t||{};if(!n||!/^https?:\/\//i.test(n))return void s(i,"Invalid URL");if(buddypond.websiteCardCache[n])return void d(i,buddypond.websiteCardCache[n]);i.find(".card-website-loading").show(),i.find(".card-website-content, .card-website-error").addClass("card-website-hidden");const o=n.startsWith(window.location.origin),a=e=>{const t=(new DOMParser).parseFromString(e,"text/html"),r=e=>t.querySelector(`meta[property="${e}"]`)?.content||"",d=e=>t.querySelector(`meta[name="${e}"]`)?.content||"";return{title:r("og:title")||t.title||"",description:r("og:description")||d("description")||"",image:r("og:image")||d("twitter:image")||d("image")||""}},s=(e,t)=>{e.find(".card-website-loading").hide();const r=e.find(".card-website-error");r.find(".card-website-error-message").text(t),r.removeClass("card-website-hidden")};o?fetch(n,{method:"GET"}).then((e=>{if(!e.ok)throw new Error("Network error");return e.text()})).then((e=>{const t=a(e);buddypond.websiteCardCache[n]=t,d(i,t)})).catch((()=>{r(i,n,a,d)})):r(i,n,a,d)}const t=(e,t)=>{e.find(".card-website-loading").hide();const r=e.find(".card-website-fallback");r.find(".card-website-fallback-link").attr("href",t).text(new URL(t)),r.removeClass("card-website-hidden")};function r(e,r,d,i,n){let o=`${buddypond.buddyProxy}/api/fetch-metadata?url=${encodeURIComponent(r)}`;const a=new AbortController,s=setTimeout((()=>a.abort()),6e3);fetch(o,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${buddypond.qtokenid}`,"x-me":buddypond.me},signal:a.signal}).then((e=>{if(clearTimeout(s),!e.ok)throw new Error("Proxy error");return e.json()})).then((t=>{buddypond.websiteCardCache[r]=t,i(e,t)})).catch((d=>{"AbortError"===d.name?console.warn("Fetch aborted due to timeout"):console.error("Fetch error:",d),t(e,r)}))}export{e as default};
//# sourceMappingURL=website-card.js.map
