{"version":3,"file":"github-card.js","sources":["../../../../../../apps/based/card/cards/github/github-card.js"],"sourcesContent":["\n\nexport default async function applyData(el, data, cardClass, parent) {\n    const $el = $(el);\n\n    $el.find('.card-url-url').text(data.url);\n    $el.find('.card-url-url').attr('href', data.url);\n    $el.find('.card-url-url').attr('target', '_blank');\n    $el.find('.card-github-file').text(data.filename);\n    $el.find('.card-github-repo').text(`${data.owner}/${data.repo}`);\n\n    // Append Prism.js for syntax highlighting\n    // TODO: vendor these deps\n    await cardClass.bp.appendScript(\"https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js\");\n    await cardClass.bp.appendCSS(\"https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-coy.css\");\n\n    $el.find('.card-github-header').click(() => {\n        // opens a new link to the github file\n        window.open(data.url, '_blank');\n    });\n\n    // Fetch and display GitHub snippet with expand/collapse functionality\n    fetchGitHubSnippet(data.url, $el, cardClass, parent);\n}\n\nasync function fetchGitHubSnippet(url, $el, cardClass, parent) {\n    try {\n        const apiUrl = url.replace(\"github.com\", \"raw.githubusercontent.com\").replace(\"/blob/\", \"/\");\n        const response = await fetch(apiUrl);\n        if (!response.ok) throw new Error(\"Failed to fetch\");\n\n        let code = await response.text();\n        const lines = code.split(\"\\n\");\n\n        // Initial snippet (first 10 lines)\n        let shortSnippet = lines.join(\"\\n\");\n        let fullSnippet = code;\n\n        const language = apiUrl.split('.').pop(); // Infer language from extension\n        const $codeBlock = $el.find(\"code\");\n\n        // Set initial short snippet\n        $codeBlock.text(shortSnippet);\n        $codeBlock.addClass(`language-${language}`);\n        Prism.highlightElement($codeBlock[0]);\n\n        triggerScroll.call(this);\n\n        // ensure we scroll to bottom of chat after rendering github card\n        function triggerScroll() {\n            if (parent && parent.content) {\n                // console.log('Scrolling to bottom of parent content');\n                // Scroll to bottom of parent content\n                if (cardClass.bp && cardClass.bp.apps && cardClass.bp.apps.buddylist) {\n                    cardClass.bp.apps.buddylist.scrollToBottom(parent.content);\n                }\n            }\n        }\n\n\n    } catch (error) {\n        console.log(\"Error fetching GitHub snippet:\", error);\n        $el.find(\"code\").text(\"Error loading preview.\");\n    }\n}\n\n\n"],"names":["async","applyData","el","data","cardClass","parent","$el","$","find","text","url","attr","filename","owner","repo","bp","appendScript","appendCSS","click","window","open","apiUrl","replace","response","fetch","ok","Error","code","shortSnippet","split","join","language","pop","$codeBlock","triggerScroll","content","apps","buddylist","scrollToBottom","addClass","Prism","highlightElement","call","this","error","console","log","fetchGitHubSnippet"],"mappings":"AAEeA,eAAeC,EAAUC,EAAIC,EAAMC,EAAWC,GACzD,MAAMC,EAAMC,EAAEL,GAEdI,EAAIE,KAAK,iBAAiBC,KAAKN,EAAKO,KACpCJ,EAAIE,KAAK,iBAAiBG,KAAK,OAAQR,EAAKO,KAC5CJ,EAAIE,KAAK,iBAAiBG,KAAK,SAAU,UACzCL,EAAIE,KAAK,qBAAqBC,KAAKN,EAAKS,UACxCN,EAAIE,KAAK,qBAAqBC,KAAK,GAAGN,EAAKU,SAASV,EAAKW,cAInDV,EAAUW,GAAGC,aAAa,kEAC1BZ,EAAUW,GAAGE,UAAU,oEAE7BX,EAAIE,KAAK,uBAAuBU,OAAM,KAElCC,OAAOC,KAAKjB,EAAKO,IAAK,aAO9BV,eAAkCU,EAAKJ,EAAKF,EAAWC,GACnD,IACI,MAAMgB,EAASX,EAAIY,QAAQ,aAAc,6BAA6BA,QAAQ,SAAU,KAClFC,QAAiBC,MAAMH,GAC7B,IAAKE,EAASE,GAAI,MAAM,IAAIC,MAAM,mBAElC,IAAIC,QAAaJ,EAASd,OAI1B,IAAImB,EAHUD,EAAKE,MAAM,MAGAC,KAAK,MAG9B,MAAMC,EAAWV,EAAOQ,MAAM,KAAKG,MAC7BC,EAAa3B,EAAIE,KAAK,QAU5B,SAAS0B,IACD7B,GAAUA,EAAO8B,SAGb/B,EAAUW,IAAMX,EAAUW,GAAGqB,MAAQhC,EAAUW,GAAGqB,KAAKC,WACvDjC,EAAUW,GAAGqB,KAAKC,UAAUC,eAAejC,EAAO8B,QAGtE,CAfQF,EAAWxB,KAAKmB,GAChBK,EAAWM,SAAS,YAAYR,KAChCS,MAAMC,iBAAiBR,EAAW,IAElCC,EAAcQ,KAAKC,KActB,CAAC,MAAOC,GACLC,QAAQC,IAAI,iCAAkCF,GAC9CtC,EAAIE,KAAK,QAAQC,KAAK,yBAC9B,CACA,CA1CIsC,CAAmB5C,EAAKO,IAAKJ,EAAKF,EAAWC,EACjD"}