{"version":3,"file":"file-explorer.js","sources":["../../../apps/based/file-explorer/FileTree/FileTree.js","../../../apps/based/file-explorer/FileUploadOverlay.js","../../../apps/based/file-explorer/FileExplorer.js","../../../apps/based/file-explorer/lib/handleDrop.js","../../../apps/based/file-explorer/lib/handleUpload.js","../../../apps/based/file-explorer/lib/open.js","../../../apps/based/file-explorer/lib/create.js","../../../apps/based/file-explorer/lib/onClick.js","../../../apps/based/file-explorer/lib/renderFolderContents.js","../../../apps/based/file-explorer/lib/renderPathContents.js","../../../apps/based/file-explorer/lib/getUsage.js","../../../apps/based/file-explorer/lib/showFile.js","../../../apps/based/browser/BrowserWindow.js","../../../apps/based/pad/PadEditor.js","../../../apps/based/file-explorer/lib/buildJsTreeData.js","../../../apps/based/file-explorer/file-explorer.js","../../../apps/based/file-explorer/lib/getCloudFiles.js"],"sourcesContent":["// FileTree.js\n// Remark: 1/6/2025 - Deciding to use jsTree instead of FileTree.js\n//                    jsTree is very mature and has all APIs we need for file-explorer v1\n// This file is currently not being used\nexport default class FileTree {\n    constructor(bp, options = {}) {\n        this.bp = bp;\n    }\n\n    async init() {\n        await this.bp.appendCSS('/v5/apps/based/file-explorer/FileTree/FileTree.css', false, true);\n\n    }\n\n    create(container, options) {\n\n        this.options = {\n            onFileSelect: options.onFileSelect || ((file) => console.log('File selected:', file)),\n            onFolderToggle: options.onFolderToggle || ((folder, isExpanded) => console.log('Folder toggled:', folder, isExpanded)),\n            indent: options.indent || 20,\n        };\n\n\n        this.container = typeof container === 'string' ? document.querySelector(container) : container;\n\n\n        // Initialize root container\n        this.treeRoot = document.createElement('div');\n        this.treeRoot.className = 'bp-filetree-container';\n        this.container.appendChild(this.treeRoot);\n\n        // Bind methods\n        this.handleClick = this.handleClick.bind(this);\n        this.renderItem = this.renderItem.bind(this);\n\n        // Add event listener\n        this.treeRoot.addEventListener('click', this.handleClick);\n        return this;\n\n    }\n\n    handleClick(event) {\n        const target = event.target.closest('.bp-filetree-item');\n        if (!target) return;\n\n        const isFolder = target.dataset.type === 'folder';\n        const path = target.dataset.path;\n\n        if (isFolder) {\n            const isExpanded = target.classList.toggle('bp-filetree-expanded');\n            const childContainer = target.nextElementSibling;\n            childContainer.style.display = isExpanded ? 'block' : 'none';\n            this.options.onFolderToggle(path, isExpanded);\n        } else {\n            this.options.onFileSelect(path, target);\n        }\n    }\n\n    getFileIcon(filename) {\n        // Basic file type detection based on extension\n        const ext = filename.split('.').pop().toLowerCase();\n        const iconMap = {\n            js: 'üìÑ',\n            json: 'üìã',\n            html: 'üåê',\n            css: 'üé®',\n            png: 'üñºÔ∏è',\n            jpg: 'üñºÔ∏è',\n            pdf: 'üìë',\n            default: 'üìÑ'\n        };\n        return iconMap[ext] || iconMap.default;\n    }\n\n    renderItem(item, level = 0) {\n        const itemContainer = document.createElement('div');\n        itemContainer.className = 'bp-filetree-item-container';\n\n        const itemElement = document.createElement('div');\n        itemElement.className = 'bp-filetree-item';\n        itemElement.dataset.path = item.path;\n        itemElement.dataset.type = item.type;\n        itemElement.style.paddingLeft = `${level * this.options.indent}px`;\n\n        // Create icon element\n        const icon = document.createElement('span');\n        icon.className = 'bp-filetree-icon';\n        icon.textContent = item.type === 'folder' ? 'üìÅ' : this.getFileIcon(item.name);\n\n        // Create name element\n        const name = document.createElement('span');\n        name.className = 'bp-filetree-name';\n        name.textContent = item.name;\n\n        itemElement.appendChild(icon);\n        itemElement.appendChild(name);\n        itemContainer.appendChild(itemElement);\n\n        if (item.type === 'folder' && Array.isArray(item.children)) {\n            const childContainer = document.createElement('div');\n            childContainer.className = 'bp-filetree-children';\n            childContainer.style.display = 'none';\n\n            item.children.forEach(child => {\n                childContainer.appendChild(this.renderItem(child, level + 1));\n            });\n\n            itemContainer.appendChild(childContainer);\n        }\n\n        return itemContainer;\n    }\n\n    toggleFolder(path) {\n        const folder = this.treeRoot.querySelector(`.bp-filetree-item[data-path=\"${path}\"]`);\n        if (!folder) return;\n\n        const isExpanded = folder.classList.toggle('bp-filetree-expanded');\n        const childContainer = folder.nextElementSibling;\n        childContainer.style.display = isExpanded ? 'block' : 'none';\n        this.options.onFolderToggle(path, isExpanded);\n    }\n\n    render(files) {\n        // Clear existing content\n        this.treeRoot.innerHTML = '';\n        this.files = files;\n        // Render each root item\n        files.forEach(file => {\n            this.treeRoot.appendChild(this.renderItem(file));\n        });\n    }\n\n    destroy() {\n        this.treeRoot.removeEventListener('click', this.handleClick);\n        this.container.removeChild(this.treeRoot);\n    }\n\n\n    buildFileTree(paths) {\n        const root = { type: 'folder', name: 'root', path: '', children: [] };\n\n        paths.forEach(path => {\n            if (!path) return;\n            const parts = path.split('/').filter(part => part.length);\n            let current = root;\n\n            for (let i = 0; i < parts.length; i++) {\n                const part = parts[i];\n                const isFile = i === parts.length - 1 && part.includes('.');\n                const newPath = '/' + parts.slice(0, i + 1).join('/');\n\n                let node = current.children.find(child => child.name === part);\n                if (!node) {\n                    node = {\n                        type: isFile ? 'file' : 'folder',\n                        name: part,\n                        path: newPath,\n                        children: []\n                    };\n                    current.children.push(node);\n                }\n\n                if (!isFile) {\n                    current = node;\n                }\n            }\n        });\n\n        return root.children; // Remove root if you don't want the top-level folder\n    }\n\n\n    // Helper function to find a node based on a path\n    findNodeByPath(root, path) {\n        const parts = path.split('/').filter(part => part.length);\n        let current = root;\n        for (let part of parts) {\n            let next = current.find(child => child.name === part);\n            if (!next) {\n                return null; // Node not found\n            }\n            current = next;\n        }\n        return current;\n    }\n\n    // Function to merge new tree into the target node\n    mergeTrees(targetNode, newChildren) {\n        const existingNames = targetNode.children.map(child => child.name);\n        newChildren.forEach(newChild => {\n            if (!existingNames.includes(newChild.name)) {\n                targetNode.children.push(newChild); // Add new child if it doesn't exist\n            } else {\n                // If the child exists and is a folder, merge recursively\n                let existingChild = targetNode.children.find(child => child.name === newChild.name);\n                if (existingChild.type === 'folder' && newChild.type === 'folder') {\n                    mergeTrees(existingChild, newChild.children);\n                }\n            }\n        });\n    }\n\n\n}","export default class FileUploadOverlay {\n    constructor({\n        parent,\n        fileExplorer,\n        onUploadComplete = () => {}\n    }, uploadFn) {\n        this.parent = parent;\n        this.fileExplorer = fileExplorer;\n        this.files = [];\n        this.initializeElements();\n        this.bindEvents();\n        this.onUploadComplete = onUploadComplete;\n        this.uploadFn = uploadFn;\n        this.bp = fileExplorer.bp;\n    }\n\n    initializeElements() {\n        this.overlay = this.parent.querySelector('.bp-file-explorer-upload-overlay');\n        this.filesList = this.parent.querySelector('.bp-file-explorer-upload-files-list');\n        this.totalSize = this.parent.querySelector('.bp-file-explorer-total-size');\n        this.uploadButton = this.parent.querySelector('.bp-file-explorer-upload-start');\n        this.cancelButton = this.parent.querySelector('.bp-file-explorer-upload-cancel');\n        this.progressContainer = this.parent.querySelector('.bp-file-explorer-upload-progress-container');\n        this.progressBar = this.parent.querySelector('.bp-file-explorer-upload-progress-bar');\n        this.progressPercentage = this.parent.querySelector('.bp-file-explorer-upload-progress-percentage');\n        this.currentFile = this.parent.querySelector('.bp-file-explorer-current-file');\n        this.fileCount = this.parent.querySelector('.bp-file-explorer-file-count');\n    }\n\n    bindEvents() {\n        this.uploadButton.addEventListener('click', () => this.startUpload(this.onUploadComplete));\n        this.cancelButton.addEventListener('click', () => this.hide());\n    }\n\n    show(files) {\n        this.files = Array.from(files);\n        this.overlay.style.display = 'flex';\n        this.renderFiles();\n        this.updateTotalSize();\n        if (this.bp.me === \"Guest\") {\n            $('.bp-file-explorer-upload-controls').html('<h2>Guest account may not upload files.</hr><br/>Please  <button class=\"open-app action-button\" data-app=\"buddylist\">log in</button> to BuddyPond.');\n        }\n\n    }\n\n    hide() {\n        this.overlay.style.display = 'none';\n        this.progressContainer.style.display = 'none';\n        this.files = [];\n        this.filesList.innerHTML = '';\n    }\n\n    formatSize(bytes) {\n        const sizes = ['B', 'KB', 'MB', 'GB'];\n        if (bytes === 0) return '0 B';\n        const i = Math.floor(Math.log(bytes) / Math.log(1024));\n        return `${(bytes / Math.pow(1024, i)).toFixed(2)} ${sizes[i]}`;\n    }\n\n    renderFiles() {\n        // TODO: clone this from HTML template instead of duplicating string\n        this.filesList.innerHTML = this.files.map((file, index) => `\n        <div class=\"bp-file-explorer-upload-file-item\" data-file-id=\"${index}\">\n          <div class=\"bp-file-explorer-upload-column-name\">${file.path}</div>\n          <div class=\"bp-file-explorer-upload-column-size\">${this.formatSize(file.file.size)}</div>\n          <div class=\"bp-file-explorer-upload-column-status\">Pending</div>\n        </div>\n      `).join('');\n    }\n\n    updateTotalSize() {\n        const totalBytes = this.files.reduce((acc, file) => acc + file.file.size, 0);\n        this.totalSize.textContent = this.formatSize(totalBytes);\n\n        // TODO: better scope, us localstorage or another class\n        if (typeof this.fileExplorer.currentStorageRemaining === 'number') {\n            // console.log(\"comparing\", totalBytes, this.fileExplorer.currentStorageRemaining);\n            if (totalBytes > this.fileExplorer.currentStorageRemaining) {\n                // this.totalSize.textContent = `${this.totalSize.textContent} (Not enough space)`;\n                $('.bp-file-explorer-storage-warning').show();\n                this.uploadButton.disabled = true;\n                this.uploadButton.classList.add('disabled');\n            }\n        }\n\n    }\n\n    async startUpload(onUploadComplete = () => {}) {\n        this.uploadButton.disabled = true;\n        this.progressContainer.style.display = 'block';\n\n        let uploadedFiles = 0;\n        let uploadedAllFiles = true;\n        let errors = [];\n        for (const file of this.files) {\n            uploadedFiles++;\n            this.currentFile.textContent = file.name;\n            this.fileCount.textContent = `(File ${uploadedFiles} of ${this.files.length})`;\n            $(`.bp-file-explorer-upload-file-item[data-file-id=\"${uploadedFiles - 1}\"] .bp-file-explorer-upload-column-status`).text('Uploading...');\n\n            try {\n                await this.uploadFn(file, (progress) => {\n                    const totalProgress = progress * 100;\n                    this.updateProgress(totalProgress);\n                });\n                $(`.bp-file-explorer-upload-file-item[data-file-id=\"${uploadedFiles - 1}\"] .bp-file-explorer-upload-column-status`).text('Completed');\n                this.uploadButton.disabled = false;\n\n            } catch (error) {\n                uploadedAllFiles = false;\n                errors.push(error);\n                console.error('Upload failed:', error);\n                // console.log(\"trying to find element\", `.bp-file-explorer-upload-file-item[data-file-id=\"${uploadedFiles - 1}\"] .bp-file-explorer-upload-column-error`);\n                //$(`.bp-file-explorer-upload-file-item[data-file-id=\"${uploadedFiles - 1}\"] .bp-file-explorer-upload-column-error`).text(error.message).show();\n                $('.bp-file-explorer-upload-errors').append(`<div class=\"bp-file-explorer-upload-error\">${error.message}</div>`).show();\n                $(`.bp-file-explorer-upload-file-item[data-file-id=\"${uploadedFiles - 1}\"] .bp-file-explorer-upload-column-status`).text('Failed').addClass('error');\n            }\n        }\n\n        if (uploadedAllFiles) {\n            setTimeout(() => {\n                // should show final status\n                $('.bp-file-explorer-upload-status').text('Upload completed');\n                this.hide();\n                onUploadComplete();\n            }, 2200);\n\n            // wait just a moment until attempting to get files\n            this.fileExplorer.refreshFileTree();\n\n\n\n            setTimeout(() => {\n                // takes a moment for durable objects to update\n                // probably want to poll this?\n                this.fileExplorer.getUsage();\n            }, 1000)\n\n\n\n        } else {\n            // throw new Error(`Failed to upload ${errors.length} files`);\n            console.error(`Failed to upload ${errors.length} files`, errors);\n        }\n    }\n\n    // TODO: is this no longer being called/\n    // Remark: Remove this FN?  \n    async uploadFile(file, onProgress) {\n        // This is a placeholder for your actual upload implementation\n        // Replace this with your actual upload logic\n\n        try {\n            await this.uploadFn(file, onProgress);\n        } catch (error) {\n            // show the error in the UI, could be out of space, etc\n            alert(error.message)\n            //$('.bp-file-explorer-upload-column-status').textContent = 'Failed'; // should be more specific\n        }\n\n        /*\n        return new Promise((resolve) => {\n          let progress = 0;\n          const interval = setInterval(() => {\n            progress += 0.1;\n            onProgress(progress);\n            if (progress >= 1) {\n              clearInterval(interval);\n              resolve();\n            }\n          }, 100);\n        });\n        */\n    }\n\n    updateProgress(percentage) {\n        const roundedPercentage = Math.min(100, Math.round(percentage));\n        this.progressBar.style.width = `${roundedPercentage}%`;\n        this.progressPercentage.textContent = `${roundedPercentage}%`;\n    }\n}\n","import handleDrop from \"./lib/handleDrop.js\";\nimport handleUpload from \"./lib/handleUpload.js\";\nimport FileTree from \"./FileTree/FileTree.js\";\nimport renderFolderContents from \"./lib/renderFolderContents.js\";\nimport renderPathContents from \"./lib/renderPathContents.js\";\nimport open from \"./lib/open.js\";\nimport create from \"./lib/create.js\";\nimport getUsage from \"./lib/getUsage.js\";\nimport onClick from \"./lib/onClick.js\";\nimport showFile from \"./lib/showFile.js\";\n\nexport default class FileExplorer {\n    constructor(bp, options = {}) {\n        this.bp = bp;\n\n        if (!options.fileTree) {\n            options.fileTree = {};\n        }\n\n        this.options = options;\n\n        // root path\n        this.currentSelectedNode = {\n            id: \"\"\n        };\n    }\n\n\n    async init() {\n\n        this.html = await this.bp.load('/v5/apps/based/file-explorer/file-explorer.html');\n\n        await this.bp.load('/v5/apps/based/file-explorer/file-explorer.css');\n\n        let bytes = await this.bp.importModule('/v5/apps/based/file-explorer/lib/bytes.js', {}, false);\n        this.bytes = bytes.default;\n\n\n        this.fileTreeInstance = new FileTree(this.bp, this.options.fileTree);\n\n        await this.fileTreeInstance.init();\n\n        this.fileTree = this.fileTreeInstance;\n\n        // async import import mime from 'mime';\n        // is most likely already loaded and cached at this point\n        let mime = await this.bp.importModule('/v5/apps/based/file-explorer/lib/mime.js', {}, false);\n        this.mime = mime.default;\n\n        this.onClick();\n\n        return 'loaded file explorer';\n    }\n\n\n    setPreviewAddressBar(path) {\n        $('.bp-file-explorer-address-input').val(path);\n        let host = this.bp.config.host;\n        // this.bp.emit('browser::setAddressBar', host + path);\n        this.bp.emit('browser::setAddressBar', host + '/' + this.bp.me + path);\n\n    }\n\n}\n\nFileExplorer.prototype.handleDrop = handleDrop;\nFileExplorer.prototype.handleUpload = handleUpload;\nFileExplorer.prototype.open = open;\nFileExplorer.prototype.create = create;\nFileExplorer.prototype.onClick = onClick;\nFileExplorer.prototype.renderFolderContents = renderFolderContents;\nFileExplorer.prototype.renderPathContents = renderPathContents;\nFileExplorer.prototype.getUsage = getUsage;\nFileExplorer.prototype.showFile = showFile;","export default function dropareaEvent(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    console.log(\"file-explorer handling drop event\", e);\n    let items = e.dataTransfer.items;\n\n    let ignoredFiles = ['.DS_Store', '.git', '.gitignore', '.gitattributes', '.gitmodules', '.gitkeep', '.npmignore', '.npmrc', '.yarnignore', '.yarnrc', '.editorconfig', '.eslint'];\n    let ignoredDirs = ['.git', 'node_modules'];\n\n    // Function to check if the file or directory should be ignored\n    const shouldIgnore = (fileName, fullPath) => {\n        return ignoredFiles.includes(fileName) || ignoredDirs.some(dir => fullPath.includes(`/${dir}/`));\n    };\n\n\n\n    const processEntry = (entry, path = '') => {\n        return new Promise((resolve, reject) => {\n            console.log('processing item:', entry, 'currentNode', this.currentSelectedNode);\n    \n            // Scope the path to the current selected folder if applicable\n            if (this.currentSelectedNode) {\n                // path += this.currentSelectedNode.id + '/';\n                console.log('Updated path to scope to the selected folder:', path);\n            }\n    \n            if (entry.isFile) {\n                entry.file(file => {\n                    const filePath = path + file.name;\n                    if (shouldIgnore(file.name, filePath)) {\n                        console.log('Ignoring file:', filePath);\n                        resolve([]);\n                    } else {\n                        file.filePath = filePath;\n                        console.log(filePath); // Optionally log the file path\n                        resolve({path: filePath, file: file});\n                    }\n                }, reject);\n            } else if (entry.isDirectory) {\n                let reader = entry.createReader();\n                reader.readEntries(entries => {\n                    Promise.all(entries.map(entryItem => processEntry(entryItem, path + entry.name + '/')))\n                        .then(files => resolve(files.flat()))\n                        .catch(reject);\n                }, reject);\n            }\n        });\n    };\n    \n\n    const promises = [];\n    // Process each dragged item\n    for (let i = 0; i < items.length; i++) {\n        const item = items[i].webkitGetAsEntry ? items[i].webkitGetAsEntry() : items[i].getAsEntry();\n        if (item) {\n            if (!shouldIgnore(item.name, item.fullPath)) {\n                // check if this is the root node\n                // we could also check bp.me === node.id, checking for jsTree parent indicator seems safer\n                if (this.currentSelectedNode.parent !== '#') {\n                    promises.push(processEntry(item, this.currentSelectedNode.id + '/'));\n                } else {\n                    promises.push(processEntry(item));\n                }\n            }\n        }\n    }\n\n    Promise.all(promises)\n        .then(files => {\n            console.log('All files:', files.flat());\n            // Here, you would typically update your UI to show the files and await user confirmation before upload\n            this.uploadOverlay.show(files.flat());\n        })\n        .catch(error => console.error('Error processing files:', error));\n}\n","export default async function handleUploadEvent(e, options = { includeRootDirectory: true, path: '' }) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    console.log(\"Handling file input event\", e);\n    const items = e.target.files; // This is a FileList object, not a DataTransferItem\n\n    let ignoredFiles = ['.DS_Store', '.git', '.gitignore', '.gitattributes', '.gitmodules', '.gitkeep', '.npmignore', '.npmrc', '.yarnignore', '.yarnrc', '.editorconfig', '.eslint'];\n    let ignoredDirs = ['.git', 'node_modules'];\n\n    // Function to check if the file or directory should be ignored\n    const shouldIgnoreLegacy = (fileName, fullPath) => {\n        return ignoredFiles.includes(fileName) || ignoredDirs.some(dir => fullPath.includes(`/${dir}/`));\n    };\n\n    const shouldIgnore2 = (fileName, fullPath) => {\n        // Check ignored filenames (dotfiles, etc.)\n        if (ignoredFiles.includes(fileName)) return true;\n\n        // Normalize path segments\n        const pathSegments = fullPath.split('/');\n\n        // Check if any directory in the path is ignored\n        return pathSegments.some(segment => ignoredDirs.includes(segment));\n    };\n\n     const shouldIgnore = (fileName, fullPath) => {\n        if (ignoredFiles.includes(fileName)) return true;\n        const pathSegments = fullPath.split('/');\n        return pathSegments.some(segment => ignoredDirs.includes(segment));\n    };\n\n\n    const processFileLegacy = (file, path = '') => {\n        return new Promise((resolve) => {\n            // Assume path includes directory structure if supported\n            const fullPath = path + file.webkitRelativePath || file.name; // Use webkitRelativePath if available\n            if (shouldIgnore(file.name, fullPath)) {\n                console.log('Ignoring file:', fullPath);\n                resolve([]);\n            } else {\n                if (this.currentSelectedNode.parent !== '#') {\n                    file.filePath = this.currentSelectedNode.id + '/' + fullPath;\n                } else {\n                    file.filePath = fullPath;\n                }\n                console.log('assigning filePath:', file.filePath);\n                resolve({ path: file.filePath, file: file });\n            }\n        });\n    };\n\n    const processFile2 = (file, path = '') => {\n        return new Promise((resolve) => {\n            // Get the relative path like \"folderA/sub/file.txt\"\n            let relPath = path + file.webkitRelativePath || file.name;\n\n            // Strip the top-level folder from webkitRelativePath\n            const pathParts = relPath.split('/');\n            if (pathParts.length > 1) {\n                pathParts.shift(); // remove the root folder name\n                relPath = pathParts.join('/');\n            }\n            console.log('Processing file:', file.name, relPath);\n            if (shouldIgnore(file.name, relPath)) {\n                console.log('Ignoring file:', relPath);\n                resolve([]);\n            } else {\n                if (this.currentSelectedNode.parent !== '#') {\n                    file.filePath = this.currentSelectedNode.id + '/' + relPath;\n                } else {\n                    file.filePath = relPath;\n                }\n                console.log('assigning filePath:', file.filePath);\n                resolve({ path: file.filePath, file: file });\n            }\n        });\n    };\n\n     const processFile = (file, path = '') => {\n        return new Promise((resolve) => {\n            let relPath = path + file.webkitRelativePath || file.name;\n\n            // ‚öôÔ∏è Handle includeRootDirectory option\n            if (!options.includeRootDirectory) {\n                const pathParts = relPath.split('/');\n                if (pathParts.length > 1) {\n                    pathParts.shift(); // remove top-level folder\n                    relPath = path + pathParts.join('/');\n                }\n            }\n\n            console.log('Processing file:', file.name, relPath);\n\n            if (shouldIgnore(file.name, relPath)) {\n                console.log('Ignoring file:', relPath);\n                resolve([]);\n            } else {\n                if (this.currentSelectedNode.parent !== '#') {\n                    file.filePath = this.currentSelectedNode.id + '/' + relPath;\n                } else {\n                    file.filePath = relPath;\n                }\n                console.log('assigning filePath:', file.filePath);\n                resolve({ path: file.filePath, file });\n            }\n        });\n    };\n\n\n    // Initialize path if directory input is supported\n    const promises = Array.from(items).map(file => processFile(file, options.path));\n\n    await Promise.all(promises)\n        .then(files => {\n            console.log('All processed files:', files.flat());\n            // Update your UI to show these files or handle them further\n            this.uploadOverlay.show(files.flat());\n        })\n        .catch(error => console.error('Error processing files:', error));\n\n}\n","export default async function open({ context }) {\n        // console.log(`Opening file explorer with context ${context}`);\n        this.options.context = context;\n        if (!this.fileExplorer) {\n            this.fileExplorer = this.fileExplorerInstance.create();\n            this.fileExplorer.getCloudFiles = this.getCloudFiles.bind(this);\n            this.fileExplorer.refreshFileTree = this.refreshFileTree.bind(this);\n            this.handleDrop = this.fileExplorer.handleDrop.bind(this.fileExplorer);\n            this.handleUpload = this.fileExplorer.handleUpload.bind(this.fileExplorer);\n        }\n\n        // console.log('created explorer', this.fileExplorer);\n\n\n        if (!this.fileExplorerWindow) {\n            this.fileExplorerWindow = this.bp.apps.ui.windowManager.createWindow({\n                id: 'file-explorer',\n                title: 'Buddy Files',\n                app: 'file-explorer',\n                icon: 'desktop/assets/images/icons/icon_file-explorer_64.png',\n                x: 100,\n                y: 30,\n                width: 1000,\n                height: 600,\n                minWidth: 200,\n                minHeight: 200,\n                parent: $('#desktop')[0],\n                content: this.fileExplorer.container,\n                resizable: true,\n                minimizable: true,\n                maximizable: true,\n                closable: true,\n                focusable: true,\n                maximized: false,\n                minimized: false,\n                onClose: async () => {\n                    // delete the local reference to the file explorer\n\n                    await this.remove();\n\n                    this.fileExplorerWindow = null;\n                }\n            });\n\n            this.fileExplorerWindow.container.classList.add('has-droparea');\n\n            // this window should have no selectable text\n            this.fileExplorerWindow.container.style.userSelect = 'none';\n            this.create();\n\n        } else {\n            // jsTree should be ready at this point ( as file-explorer was already created )\n            // this could have race condition if spammed opened on first load\n            if (this.options.context) {\n                this.fileExplorer.renderPathContents(this.options.context);\n\n            } else {\n                this.fileExplorer.renderPathContents('/');\n\n            }\n\n        }\n\n    }\n","import FileUploadOverlay from \"../FileUploadOverlay.js\";\n\n\nexport default function create(options = {}) {\n\n    if (!options.onUploadComplete) {\n        options.onUploadComplete = () => {\n            // console.log(\"File Explorer created\");\n        };\n    }\n    let container = document.createElement('div');\n    container.innerHTML = this.html;\n    container.classList.add('bp-file-explorer');\n    /*\n    let fileTreeHolder = $('.bp-file-explorer-tree', container);\n    fileTreeHolder.html('');\n    this.fileTree = this.fileTreeInstance.create(fileTreeHolder[0], this.options.fileTree);\n\n    this.fileTree.render([\n        {\n            name: 'index.html',\n            type: 'file',\n        },\n        {\n            name: 'style.css',\n            type: 'file',\n        },\n        {\n            name: 'script.js',\n            type: 'file',\n        },\n        {\n            name: 'images',\n            type: 'folder',\n            children: [\n                {\n                    name: 'logo.png',\n                    type: 'file',\n                },\n                {\n                    name: 'background.jpg',\n                    type: 'file',\n                },\n            ]\n        }\n    ]);\n    */\n    this.uploadOverlay = new FileUploadOverlay({ parent: container, fileExplorer: this, onUploadComplete: this.onUploadComplete }, async (file, onProgress) => {\n        // upload file here\n        // console.log(\"uploading file\", file);\n        await this.bp.apps.client.api.uploadFile(file.file, onProgress);\n    });\n    this.uploadOverlay.hide();\n    this.container = container;\n\n    $('.bp-file-explorer-sidebar', this.container).resizable({\n        handles: 'e,w',// 'e' stands for east, i.e., the right side\n        start: (event, ui) => {\n            $('.bp-file-explorer-file-viewer-iframe', this.container).css('pointer-events', 'none');\n        },\n        stop: (event, ui) => {\n            $('.bp-file-explorer-file-viewer-iframe', this.container).css('pointer-events', 'auto');\n        }\n    });\n\n    $('.bp-file-explorer-address-input', this.container).on('keyup', (e) => {\n        // check to see if we matched a node in the jstree\n        // if so, load the contents of that node\n        // check on each keyup\n        let path = $('.bp-file-explorer-address-input').val();\n        this.renderPathContents(path);\n\n    });\n\n\n    return this;\n\n\n}\n","export default function onClick() {\n    $(document).on('click', (e) => {\n        // check to see if target was '.bp-file-explorer-item'\n        let target = $(e.target);\n        if (target.hasClass('bp-file-explorer-column')) {\n\n            let parent = target.parent();\n\n            let type = parent.data('type');\n            let name = parent.data('name');\n            let size = parent.data('size');\n            let date = parent.data('date');\n            let path = parent.data('path');\n            // console.log('clicked', type, path);\n\n\n            // update the .bp-file-explorer-address-input with the folder path\n            this.setPreviewAddressBar('/' + path);\n            // $('.bp-file-explorer-address-input').val('/' + path);\n\n            if (type === 'folder') {\n                // open folder\n                // console.log('open folder', type, path);\n                // TODO: path is the node.js from the jsTree\n                // we need to get that node reference and get its children\n                //let node = this.fileTree.getNode(path);\n                let instance = $('#jtree').jstree(true);\n                let node = instance.get_node(path);\n\n\n                let contents = node.children;\n                // console.log('111 showing contents of folder', node.id, contents);\n\n                // go through each child and get their node data from jstree\n                contents = contents.map(child => {\n                    let childNode = instance.get_node(child);\n                    return {\n                        name: childNode.text,\n                        type: childNode.children.length > 0 ? 'folder' : 'file',\n                        path: childNode.id\n                    };\n                });\n                // console.log('222 showing contents of folder', node.id, contents);\n                // update the .bp-file-explorer-address-input with the folder path\n                // $('.bp-file-explorer-address-input').val('/' + node.id);\n                this.setPreviewAddressBar('/' + node.id);\n\n                this.renderFolderContents(contents);\n\n                $('.bp-file-explorer-file-viewer').hide();\n                $('.bp-file-explorer-files').show();\n                $('.bp-file-explorer-header').flexShow();\n\n                $('.bp-file-explorer-drag-upload').flexShow();\n\n\n            } else {\n                // open file\n                // console.log('open file', type);\n                this.showFile(this.bp.me, path);\n                $('.bp-file-explorer-drag-upload').hide();\n\n                //this.showFile('/v5/apps/based/file-explorer/files', name);\n            }\n        }\n    });\n}\n","export default function renderFolderContents(files) {\n\n        $('.bp-file-explorer-header').flexShow();\n\n        // clear the bp-file-explorer-files div\n        let filesContainer = $('.bp-file-explorer-files', this.container);\n        filesContainer.html('');\n\n        // iterate over the files and add them to the bp-file-explorer-files div\n        for (let file of files) {\n            // create using JS DOM API not string\n            let item = document.createElement('div');\n            item.classList.add('bp-file-explorer-item');\n            item.dataset.type = file.type;\n            item.dataset.name = file.name;\n            item.dataset.size = file.size;\n            item.dataset.date = file.date;\n            item.dataset.path = file.path;\n            // console.log('file', file);\n            let columns = ['name', 'size', 'type', 'date'];\n            for (let column of columns) {\n                let columnDiv = document.createElement('div');\n                columnDiv.classList.add('bp-file-explorer-column');\n                let val = file[column];\n                if (column === 'size') {\n                    val = this.bytes(file[column]);\n                }\n                if (column === 'date') {\n                    val = new Date(file[column]).toLocaleString();\n                    // check if val is valid date, if not revert to original value\n                    if (val === 'Invalid Date') {\n                        val = file[column];\n                    }\n                }\n\n                columnDiv.textContent = val;\n                item.appendChild(columnDiv);\n            }\n\n\n\n\n            filesContainer.append(item);\n        }\n\n        $('.bp-file-explorer-file-viewer-iframe', this.content).hide();\n        $('.bp-file-explorer-file-viewer-editor', this.content).hide();\n        $('.bp-file-explorer-files', this.content).show();\n\n    }\n","export default function renderPathContents(path) {\n\n    // $('.bp-file-explorer-address-input').val(path); // maybe no slash?\n\n    let previewPath = path.replace(this.bp.me + '/', ''); // remove the /me/ part from the path\n\n    this.setPreviewAddressBar(previewPath);\n\n    path = path.replace('/', '');\n    let instance = $('#jtree').jstree(true);\n\n    if (path === '') {\n        path = this.bp.me;\n    }\n\n    // console.log('going to merge metadata from ', this.cloudFiles)\n    let node = instance.get_node(path);\n\n    if (node) {\n\n        $('#jtree').jstree('select_node', node.id);\n        let type = node.children.length > 0 ? 'folder' : 'file';\n\n        if (type === 'file') {\n            this.showFile(this.bp.me, path);\n            return;\n        }\n\n        this.currentSelectedNode = node;\n\n        let contents = node.children;\n\n        // check this.cloudFiles.metadata[node.id] for the contents of the folder\n        // it *should* always exist, if not show error\n\n        if (!this.cloudFiles) {\n            alert('cloudFiles not loaded cannot show contents');\n            return;\n        }\n\n\n        // go through each child and get their node data from jstree\n        contents = contents.map(child => {\n            let childNode = instance.get_node(child);\n\n            let metadata = {};\n            let childPath = childNode.id.replace(this.bp.me + '/', ''); // remove the /me/ part from the path\n            childPath = childNode.id;\n\n            if (!this.cloudFiles.metadata[childPath]) {\n                // Remark: Folders are not returning metadata?\n                // TODO: should server return folder metadata?\n                //console.error(`No metadata found for ${childNode.id} cannot show metadata`);\n                //console.error(`This should *not* happen and indicates that the metadata and Object Store are out of sync`);\n                // console.warn(`No metadata found for ${childPath}, assuming empty folder`);\n            } else {\n                // we found the metadata ( as expected )\n                // console.log('found metadata for', childPath, this.cloudFiles.metadata[childPath]);\n                metadata = this.cloudFiles.metadata[childPath];\n            }\n\n            return {\n                name: childNode.text,\n                type: childNode.children.length > 0 ? 'folder' : 'file',\n                path: childNode.id,\n                size: metadata.size,\n                date: metadata.lastModified\n            };\n        });\n        // console.log('5555 showing contents of folder', node.id, contents);\n        // update the .bp-file-explorer-address-input with the folder path\n        //$('.bp-file-explorer-address-input').val('/' + this.bp.me + '/' + node.id);\n\n        this.renderFolderContents(contents);\n\n    }\n\n}","    export default async function getUsage() {\n\n        // get initial file usage\n        let currentUsage = await this.bp.apps.client.api.getFileUsage();\n        // console.log('currentUsage', currentUsage);\n        this.currentStorageUsage = currentUsage.usage;\n        console.log('got back currentUsage', currentUsage);\n        let storageLimit = currentUsage.storageLimit || 10000000; // 10mb\n        let storageRemaining = storageLimit - currentUsage.usage;\n        this.currentStorageRemaining = storageRemaining;\n\n        $('.storageUsed', this.content).text(this.bytes(currentUsage.usage));\n        $('.storageRemaining', this.content).text(this.bytes(storageRemaining));\n    }\n","export default async function showFile(root, file, showEditor = false) {\n\n    if (!file) {\n        console.error('no file specified');\n        return;\n    }\n\n    $('.bp-file-explorer-file-viewer').show();\n    $('.bp-file-explorer-files').hide();\n    $('.bp-file-explorer-header').flexHide();\n\n    // if file does not start with a slash, prepend the slash\n    if (!file.startsWith('/')) {\n        // file = '/' + file;\n    }\n\n    let supportedEditorTypes = ['js', 'json', 'html', 'css', 'txt', 'yml', 'md'];\n\n    // check to see if the file is a supported editor type\n    let ext = file.split('.').pop();\n    if (supportedEditorTypes.includes(ext)) {\n        showEditor = true;\n    }\n\n    // show the file in the iframe\n\n    if (!showEditor) {\n\n        let fileViewerIframe = $('.bp-file-explorer-file-viewer-iframe', this.container);\n        // set height and width of iframe\n        //fileViewerIframe.css('height', '100%');\n        //fileViewerIframe.css('width', '500px');\n        // let src = root + '/' + file;\n        let src = '/' + file;\n        fileViewerIframe.attr('src', src);\n\n        $('.bp-file-explorer-file-viewer-iframe').show();\n        $('.bp-file-explorer-file-viewer-editor').hide();\n\n    }\n\n    if (showEditor) {\n        // instead of loading the file in iframe, we will display its contents in the code editor\n\n        // first we fetch the file contents using fetch\n        // let filePath = '/' + root + '/' + file;\n        let filePath = '/' + file; // root is not needed here, as file is already a full path\n        let fileCDN = 'https://files.buddypond.com';\n        filePath = fileCDN + filePath;\n        // filePath = filePath.replace(this.bp.me + '/', ''); // remove the /me/ part from the path\n        // console.log(\"fetching filePath\", filePath);\n        let fileContents = await fetch(filePath);\n\n        // now we will write the contents to the editor\n        // for now just JSON.stringify the contents to .bp-file-explorer-file-viewer\n        let fileText = await fileContents.text();\n        // let fileExt = file.split('.').pop();\n        let fileMimeType = this.mime.getType(filePath);\n        if (this.editor) {\n            if (fileMimeType) {\n                this.editor.changeEditorLanguage(fileMimeType);\n            }\n            this.editor.editor.setValue(fileText);\n            this.editor.filePath = filePath;\n        } else {\n            let fileViewerEditor = $('.bp-file-explorer-file-viewer-editor', this.container);\n            // console.log(\"setting text content\", fileText);\n\n        }\n\n        //fileViewerEditor.html('');\n        //let pre = document.createElement('pre');\n        //pre.textContent = await fileContents.text();\n        //fileViewerEditor.append(pre);\n\n        // show the iframe, hide the editor\n        $('.bp-file-explorer-file-viewer-iframe').hide();\n        $('.bp-file-explorer-file-viewer-editor').show();\n        $('.bp-file-explorer-drag-upload').hide();\n        // for now, ensure that editor state resets to editor showing code ( not preview or upload )\n        // this is in case the user has previous entered preview mode and then clicked new file on file tree\n        if (ext === 'html') {\n          // show html preview by default\n          $('.pad-editor-button-preview').click();\n        } else {\n          $('.pad-editor-button-edit').click();\n        }\n    }\n\n}","export default class BrowserWindow {\n    constructor(bp, container, initialUrl = 'https://example.com') {\n        this.bp = bp;\n        this.container = container;\n        this.currentUrl = initialUrl;\n        this.iframe = null; // Reference to the iframe\n        this.history = [initialUrl]; // Store visited URLs\n        this.currentIndex = 0; // Current position in history\n        this.baseUrl = ''; // Base URL for relative links\n        this.init();\n        return this;\n    }\n\n    init() {\n        // Create and inject HTML\n        let html = `\n            <div class=\"bp-browserwindow-container\">\n                <div class=\"bp-browserwindow-toolbar\">\n                    <div class=\"bp-browserwindow-navigation\">\n                        <button class=\"bp-browserwindow-nav-btn back\" disabled>‚Üê</button>\n                        <button class=\"bp-browserwindow-nav-btn forward\" disabled>‚Üí</button>\n                        <button class=\"bp-browserwindow-nav-btn reload\">‚Üª</button>\n                    </div>\n                    <div class=\"bp-browserwindow-addressbar\">\n                        <span class=\"ssl-indicator\">üîí</span>\n                        <input type=\"text\" class=\"bp-browserwindow-url\" value=\"${this.currentUrl}\">\n                    </div>\n                </div>\n                <div class=\"bp-browserwindow-content\">\n                    <iframe src=\"about:blank\" style=\"width:100%; height:100%; border:none;\"></iframe>\n                </div>\n            </div>\n        `\n        let el = document.createElement('div');\n        el.className = 'bp-browserwindow';\n        el.innerHTML = html;\n        this.container.append(el);\n        \n        // Reference the iframe\n        this.iframe = this.container.querySelector('iframe');\n        // Set up event listeners\n        this.setupEventListeners();\n        \n        // Initialize with the first URL\n        this.navigate(this.currentUrl);\n\n        this.bp.on('browser::setAddressBar', 'update-address-bar-value', (url) => {\n            this.setAddressBar(url);\n        })\n\n    }\n\n    setBaseUrl(url) {\n        this.baseUrl = url;\n    }\n\n    setContent(htmlContent, attempts = 1) {\n        try {\n            const doc = this.iframe.contentDocument || this.iframe.contentWindow.document;\n            doc.open();\n            // Set the base URL before writing the content\n            const baseTag = `<base href=\"${this.baseUrl}\" target=\"_blank\">`;\n            // set the base of the current document\n            // doc.write(baseTag);\n            const contentWithBase = baseTag + htmlContent;\n            //console.log('writing', contentWithBase)\n            doc.write(contentWithBase);\n            doc.close();\n    \n        } catch (e) {\n            console.log('Error setting content:', e);\n            // clear out the iframe and reload it with about:blank\n            // this could be due to previous page being remote url / cross-domain\n            this.iframe.src = 'about:blank';\n            // console.error('Error setting content:', e);\n            if (attempts < 9001) {\n                setTimeout(() => {\n                    this.setContent(htmlContent, attempts + 1);\n                }, 100);\n            } else {\n                console.error('Failed to set content after 2 attempts');\n            }\n        }\n    }\n\n    setupEventListeners() {\n        const urlInput = this.container.querySelector('.bp-browserwindow-url');\n        const backBtn = this.container.querySelector('.bp-browserwindow-nav-btn.back');\n        const forwardBtn = this.container.querySelector('.bp-browserwindow-nav-btn.forward');\n        const reloadBtn = this.container.querySelector('.bp-browserwindow-nav-btn.reload');\n\n        urlInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') {\n                this.navigate(urlInput.value);\n            }\n        });\n\n        backBtn.addEventListener('click', () => this.goBack());\n        forwardBtn.addEventListener('click', () => this.goForward());\n        reloadBtn.addEventListener('click', () => this.reload());\n    }\n\n    navigate(url) {\n\n        // console.log('navigating to', url);\n\n        // lets' check url for http or https\n        // if either are missing, add https\n        if (!url.startsWith('http://') && !url.startsWith('https://')) {\n            url = 'https://' + url;\n        }\n\n        // If we're not at the end of the history, remove all entries after current position\n        if (this.currentIndex < this.history.length - 1) {\n            this.history = this.history.slice(0, this.currentIndex + 1);\n        }\n\n        // Add new URL to history and update current index\n        this.history.push(url);\n        this.currentIndex = this.history.length - 1;\n        \n        // Update current URL and UI\n        this.currentUrl = url;\n        this.updateAddressBar();\n        this.updateNavigationButtons();\n    }\n\n    goBack() {\n        if (this.currentIndex > 0) {\n            this.currentIndex--;\n            this.currentUrl = this.history[this.currentIndex];\n            this.updateAddressBar();\n            this.updateNavigationButtons();\n        }\n    }\n\n    goForward() {\n        if (this.currentIndex < this.history.length - 1) {\n            this.currentIndex++;\n            this.currentUrl = this.history[this.currentIndex];\n            this.updateAddressBar();\n            this.updateNavigationButtons();\n        }\n    }\n\n    reload() {\n        // Reload the current URL\n        this.iframe.src = this.currentUrl;\n    }\n\n    setAddressBar(url) {\n        const urlInput = this.container.querySelector('.bp-browserwindow-url');\n        urlInput.value = url;\n    }\n\n    updateAddressBar() {\n        // console.log('updating address bar', this.currentUrl);\n        const urlInput = this.container.querySelector('.bp-browserwindow-url');\n        urlInput.value = this.currentUrl;\n        // set the src of the iframe to the currentUrl\n        this.iframe.src = this.currentUrl;\n    }\n\n    updateNavigationButtons() {\n        const backBtn = this.container.querySelector('.bp-browserwindow-nav-btn.back');\n        const forwardBtn = this.container.querySelector('.bp-browserwindow-nav-btn.forward');\n\n        // Enable/disable back button\n        backBtn.disabled = this.currentIndex <= 0;\n\n        // Enable/disable forward button\n        forwardBtn.disabled = this.currentIndex >= this.history.length - 1;\n    }\n\n    // Helper method to get navigation history\n    getHistory() {\n        return {\n            history: this.history,\n            currentIndex: this.currentIndex,\n            currentUrl: this.currentUrl\n        };\n    }\n}","import BrowserWindow from '../browser/BrowserWindow.js';\n\nexport default class PadEditor {\n    constructor(parentElement, options = {}) {\n        if (!parentElement) {\n            throw new Error('PadEditor requires a parent element');\n        }\n\n        options.files = options.files || [];\n        this.bp = options.bp;\n        this.options = options;\n        this.files = options.files;\n        \n        this.parentElement = parentElement;\n        this.options = options;\n        this.editor = null;\n        this.currentContent = '';\n        this.previewMode = false;\n        \n        // Create main container\n        this.container = document.createElement('div');\n        this.container.className = 'pad-editor';\n        this.container.style.display = 'flex';\n        this.container.style.flexDirection = 'column';\n        this.parentElement.appendChild(this.container);\n        \n        // Create controls\n        this.controls = document.createElement('div');\n        this.controls.className = 'editor-controls';\n        \n        // Create main content area\n        this.contentArea = document.createElement('div');\n        this.contentArea.className = 'editor-content';\n        this.contentArea.style.display = 'flex';\n        this.contentArea.style.flex = '1';\n        \n        // Create editor container\n        this.editorContainer = document.createElement('div');\n        this.editorContainer.className = 'editor-container';\n        this.editorContainer.style.flex = '1';\n        \n        // Create preview iframe\n        /*\n        this.previewFrame = document.createElement('iframe');\n        this.previewFrame.className = 'preview-frame';\n        this.previewFrame.style.flex = '1';\n        this.previewFrame.style.display = 'none';\n        this.previewFrame.style.border = 'none';\n        this.previewFrame.src = 'about:blank';\n        */\n\n        let liveLink = this.bp.config.host + '/' + this.bp.me\n\n\n        // TODO: replace all this.previewFrame with this.browserPreview\n        // we now have the BrowserWindow ( which has its own iframe )\n        // console.log('this.previewFrame', this.previewFrame);\n        // Assemble the DOM structure\n        this.container.appendChild(this.controls);\n        this.container.appendChild(this.contentArea);\n        this.previewFrame = new BrowserWindow(this.bp, this.container, liveLink);\n        this.previewFrame.setContent('loading...');\n        // set the base url to this.bp.config.host + '/' + this.bp.me\n        this.previewFrame.setBaseUrl(this.bp.config.cdn + '/' + this.bp.me + '/');\n        this.contentArea.appendChild(this.editorContainer);\n        \n        this.setupControls();\n        \n        return this;\n    }\n\n    setupControls() {\n        const buttons = [\n            { text: 'Preview', action: () => this.onPreview() },\n            { text: 'Edit', action: () => this.onEdit() },\n            { text: 'Update', action: () => this.onUpdate() },\n            { text: 'Delete', action: () => this.onDelete() },\n\n            // { text: 'Cancel', action: () => this.onCancel() }\n        ];\n\n        buttons.forEach(({ text, action }) => {\n            const button = document.createElement('button');\n            button.className = 'desktopButton';\n             button.classList.add('pad-editor-button-' + text.toLowerCase());\n            button.textContent = text;\n            button.onclick = action;\n            this.controls.appendChild(button);\n        });\n    }\n\n    async init() {\n        await this.loadMonaco();\n        await this.initializeEditor();\n        await this.initializeFileTree(this.files);\n        await this.bp.load('browser');\n\n        // hide the update and cancel buttons\n        // this.controls.children[2].style.display = 'none';\n        // this.controls.children[3].style.display = 'none';\n\n        return this;\n    }\n\n    async loadMonaco() {\n        if (!window.require) {\n            await this.loadScript('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.2/min/vs/loader.js');\n        }\n\n        return new Promise((resolve) => {\n            require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.2/min/vs' } });\n            require(['vs/editor/editor.main'], resolve);\n        });\n    }\n\n    loadScript(url) {\n        return new Promise((resolve, reject) => {\n            const script = document.createElement('script');\n            script.src = url;\n            script.onload = resolve;\n            script.onerror = reject;\n            document.head.appendChild(script);\n        });\n    }\n\n    async initializeEditor() {\n        this.editor = monaco.editor.create(this.editorContainer, {\n            value: this.currentContent,\n            language: 'html',\n            theme: 'vs-dark',\n            automaticLayout: true,\n            minimap: { enabled: false }\n        });\n    }\n    \n    changeEditorLanguage(newLanguage) {\n        const model = this.editor.getModel();\n        monaco.editor.setModelLanguage(model, newLanguage);\n    }\n\n    async initializeFileTree(files = []) {\n        if (this.options.fileTree) {\n            this.fileTreeComponent = this.options.fileTree.create(this.fileTree, {\n                onFileSelect: (filePath, target) => {\n                    this.loadFile(filePath);\n                },\n                onFolderToggle: (folderPath, isExpanded) => {\n                    // console.log('Folder toggled:', folderPath, isExpanded);\n                }\n            });\n            \n            this.fileTreeComponent.render(files);\n        }\n    }\n\n    loadFile(filePath) {\n        const content = this.options.getFileContent?.(filePath) || '';\n        // this.filePath = filePath;\n        this.setContent(content);\n    }\n\n    getContent() {\n        return this.editor ? this.editor.getValue() : this.currentContent;\n    }\n\n    setContent(content) {\n        this.currentContent = content;\n        if (this.editor) {\n            this.editor.setValue(content);\n        }\n    }\n\n    togglePreview(show) {\n        this.previewMode = show;\n        this.editorContainer.style.display = show ? 'none' : 'block';\n        //this.previewFrame.style.display = show ? 'block' : 'none';\n        // hide tree\n        //this.fileTree.style.display = 'none';\n        \n    }\n\n    updatePreview(content) {\n\n        // we need to get all three files content (index.html, style.css, script.js)\n        // and write all of them to the iframe\n\n        if (!content) {\n            content = this.getContent();\n        }\n        // console.log('setting preview content', content);\n        this.previewFrame.setContent(content);\n    }\n\n    onEdit() {\n        this.togglePreview(false);\n        if (this.options.onEdit) {\n            this.options.onEdit(this.getContent());\n        }\n    }\n\n    onUpdate() {\n        if (this.options.onUpdate) {\n            this.options.onUpdate(this.filePath, this.getContent());\n        }\n        if (this.previewMode) {\n            this.updatePreview();\n        }\n    }\n\n    onDelete() {\n        if (this.options.onDelete) {\n            this.options.onDelete(this.filePath);\n        }\n    }\n\n    onPreview() {\n        this.togglePreview(true);\n        if (this.options.onPreview) {\n            this.options.onPreview(this.getContent());\n        }\n\n        // TODO: reload the preview from this.currentContent\n        // Needs to reset the iframe between about:blank type and iframe.src remote type    \n        this.updatePreview();\n\n    }\n\n    onCancel() {\n        this.togglePreview(false);\n        if (this.options.onCancel) {\n            this.options.onCancel();\n        }\n    }\n\n    dispose() {\n        if (this.editor) {\n            this.editor.dispose();\n        }\n        this.container.remove();\n    }\n}","export default function buildJsTreeData(id, paths) {\n\n    const root = { id, text: id, state: { opened: true }, children: [] };\n\n    paths.forEach(path => {\n        // console.log('Processing path:', path);\n        const parts = path.split('/').filter(part => part.length);\n        if (parts.length === 0) return; // Skip empty paths\n\n        let current = root;\n\n        for (let i = 0; i < parts.length; i++) {\n            const part = parts[i];\n            const isFile = i === parts.length - 1 && part.includes('.');\n            const newPath = id + '/' + parts.slice(0, i + 1).join('/');\n            // console.log('newPath', newPath, 'isFile', isFile);\n            // Use id (full path) to find existing node, not text\n            let node = current.children.find(child => child.id === newPath);\n            if (!node) {\n                node = {\n                    id: newPath, // Unique identifier based on the full path\n                    text: part, // Sanitized display text\n                    icon: isFile ? 'jstree-file' : 'jstree-folder',\n                    children: isFile ? [] : [],\n                    state: {\n                        opened: false,\n                        selected: false\n                    }\n                };\n                current.children.push(node);\n            }\n\n            // Only navigate into non-file nodes\n            if (!isFile) {\n                current = node;\n            }\n        }\n    });\n\n    // Optional: Validate tree for circular references\n    function validateTree(nodes, seenIds = new Set()) {\n        for (const node of nodes) {\n            if (seenIds.has(node.id)) {\n                console.error(`Duplicate node ID detected: ${node.id}`);\n                throw new Error(`Duplicate node ID: ${node.id}`);\n            }\n            seenIds.add(node.id);\n            if (node.children.length > 0) {\n                validateTree(node.children, seenIds);\n            }\n        }\n    }\n    // console.log(\"Built jsTree data:\", JSON.stringify(root, null, 2));\n    try {\n        validateTree([root]);\n    } catch (e) {\n        console.error(\"Tree validation failed:\", e.message);\n        return []; // Return empty tree to prevent jsTree crash\n    }\n\n    return [root];\n}","import FileExplorerClass from \"./FileExplorer.js\";\nimport getCloudFiles from \"./lib/getCloudFiles.js\";\nimport PadEditor from \"../pad/PadEditor.js\";\nimport buildJsTreeData from \"./lib/buildJsTreeData.js\";\n\nexport default class FileExplorer {\n    constructor(bp, options = {}) {\n        this.bp = bp;\n        this.options = options;\n        this.isPolling = false;\n        return this;\n    }\n\n    async init() {\n\n        let mime = await this.bp.importModule('/v5/apps/based/file-explorer/lib/mime.js', {}, false);\n        this.mime = mime.default;\n\n        // load jstree from CDN ( for now )\n        // TODO: vendor\n        //await this.bp.appendScript('https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js');\n        await this.bp.appendScript('/v5/apps/based/file-explorer/vendor/jstree.min.js');\n\n        this.bp.log('Hello from File Explorer');\n        //await this.bp.load('/v5/apps/based/file-explorer/FileTree/jsTree.css');\n        //await this.bp.load('https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css');\n        await this.bp.appendCSS('/v5/apps/based/file-explorer/vendor/style.min.css', false, true);\n\n        this.fileExplorerInstance = new FileExplorerClass(this.bp, {\n            fileTree: {\n                onFileSelect: (filePath, target) => {\n                    $('.bp-file-explorer-drag-upload').hide();\n                },\n                onFolderToggle: async (folderPath, isExpanded) => {\n                    $('.bp-file-explorer-drag-upload').hide();\n                    // display the contents of the folder in the main window\n                    return;\n                },\n                onFolderSelect: async (folderPath, target) => {\n                    $('.bp-file-explorer-drag-upload').hide();\n                }\n            }\n        });\n        await this.fileExplorerInstance.init();\n\n\n        return 'loaded File Explorer';\n    }\n\n    async create() {\n\n        if (!this.fileExplorer) {\n            this.fileExplorer = this.fileExplorerInstance.create({\n                onUploadComplete: this.options.onUploadComplete\n            });\n            this.fileExplorer.getCloudFiles = this.getCloudFiles.bind(this);\n            this.fileExplorer.refreshFileTree = this.refreshFileTree.bind(this);\n            this.handleDrop = this.fileExplorer.handleDrop.bind(this.fileExplorer);\n            this.handleUpload = this.fileExplorer.handleUpload.bind(this.fileExplorer);\n        }\n        // TODO: move all this code to inside FileExplorer class\n        // keep file-explorer app very minimal and just wrapper to FileExplorer class + optional windowing\n\n        let defaultFileContent = {};\n\n        let padEditorHolder = document.createElement('div');\n        padEditorHolder.className = 'pad-editor-holder';\n        $('.bp-file-explorer-file-viewer-editor', this.fileExplorer.content).append(padEditorHolder);\n        this.fileExplorer.getUsage();\n        const editor = new PadEditor(padEditorHolder, {\n            bp: this.bp,\n            // fileTree: fileTreeComponent, // Your file tree implementation\n            files: [],\n            getFileContent: (filePath) => {\n                // Your logic to get file content\n                return defaultFileContent[filePath];\n            },\n            onEdit: (content) => {\n                // hide the preview and show the code editor\n                $('.editor-content').flexShow();\n                //$('.myProfile').flexHide();\n\n                // show the Update and Cancel buttons\n                $('.pad-editor-button-update').show();\n                $('.pad-editor-button-cancel').show();\n\n            },\n\n            onDelete: async (filePath) => {\n                let relativePath = filePath.replace('https://files.buddypond.com/' + this.bp.me + '/', '');\n                // console.log('relativePath', relativePath);\n                try {\n                    await this.bp.apps.client.api.removeFile(relativePath);\n                    // at this point we have confirmd with server that file is being deleted\n                    // we should immediately remove the file from the file tree\n                    let tree = $('#jtree').jstree(true);\n                    // let localPath = filePath.replace('https://files.buddypond.com/', '');\n                    // console.log('looking for node with path', relativePath);\n                    let node = tree.get_node(relativePath);\n                    // console.log('found node', node);\n                    tree.delete_node(node);\n\n                } catch (err) {\n                    console.error('Error deleting file:', err);\n                }\n            },\n\n            onUpdate: async (filePath, content) => {\n\n                // show \"updating\" overlay\n                $('.bp-file-explorer-update-overlay').flexShow();\n\n                let relativePath = filePath.replace('https://files.buddypond.com/' + this.bp.me + '/', '');\n\n                let mimeType = this.mime.getType(relativePath);\n\n                // Assuming 'content' is a string, we need to convert it to a Blob, then to a File\n                const blob = new Blob([content], { type: mimeType });  // Adjust the MIME type as necessary\n\n                // Creating a File object from the Blob\n                const file = new File([blob], relativePath.split('/').pop(), {\n                    type: blob.type,\n                    lastModified: new Date()  // You might need to adjust this if you have specific requirements\n                });\n                file.filePath = relativePath;\n\n                // Assuming uploadFile() expects a standard File type object\n                try {\n                    let files = await this.bp.apps.client.api.uploadFile(file);\n                    // TODO: take all files add them to jsTree... is there easier better way?\n                    //        we could re-render and wait...might be best as they are 404 until they are ready\n                } catch (err) {\n                    alert('Error uploading file: ' + err.message);\n                }\n\n                this.fileExplorer.getUsage();\n\n                this.bp.emit('file-explorer::update', {\n                    path: relativePath,\n                });\n\n                $('.bp-file-explorer-update-overlay').flexHide();\n\n            },\n\n            onPreview: (content) => {\n                // hide the code editor and show the preview .myProfile\n                // what is handling this now? directly calling into browser app?\n                // check and ensure that we don't need to move that logic here\n                // console.log(\"onPreview\", content);\n            },\n            onCancel: () => {\n                // console.log('Cancel clicked');\n                // hide the Update and Cancel buttons\n                $('.pad-editor-button-update').hide();\n                $('.pad-editor-button-cancel').hide();\n                // hide the code editor and show the preview\n                $('.pad-editor-button-preview').click();\n\n            }\n        });\n\n        this.editor = editor;\n\n        await editor.init();\n\n        // set the editor in the file explorer\n        this.fileExplorer.editor = editor;\n\n        // load the content of the first file\n        //editor.loadFile('/myprofile/index.html');\n\n        // set the height of the editor\n        editor.editorContainer.style.height = '600px';\n        // this.editor.previewFrame.setContent(buddyProfilePad.content);\n\n\n        // get the latest cloud files to populate the file explorer\n        let cloudFiles = await this.getCloudFiles('', 6); // hard-coded to 6 ( for now )\n        const treeData = buildJsTreeData(this.bp.me, cloudFiles.files);\n        // console.log(JSON.stringify(treeData, true, 2));\n        this.fileExplorer.cloudFiles = cloudFiles;\n\n        // TODO: connect tree to AJAX backend for granular loading ( not just loading the whole tree at once )\n        $('#jtree').jstree({\n            'core': {\n                'data': treeData,\n                // This option ensures that when a node is selected by clicking it won't be opened/closed\n                'multiple': true,  // This allows single selection of nodes\n                'check_callback': true  // This allows certain operations in the tree\n            },\n            'plugins': ['contextmenu'],  // Add 'contextmenu' to the list of plugins\n            'contextmenu': {\n                'items': function (node) {\n                    // console.log(node)\n                    var tree = $('#jtree').jstree(true);\n\n                    return {\n                        /* TODO: create and delete\n                        \"Create\": {\n                            \"separator_before\": false,\n                            \"separator_after\": false,\n                            \"label\": \"Create\",\n                            \"action\": function (obj) {\n                                tree.create_node(node);\n                            }\n                        },\n                        \"Rename\": {\n                            \"separator_before\": false,\n                            \"separator_after\": false,\n                            \"label\": \"Rename\",\n                            \"action\": function (obj) {\n                                tree.edit(node);\n                            }\n                        },\n                        */\n                        \"Delete\": {\n                            \"separator_before\": false,\n                            \"separator_after\": true,\n                            \"label\": \"Delete\",\n                            \"action\": function (obj) {\n                                tree.delete_node(node);\n                            }\n                        }\n                    }\n                }\n            }\n        }).on('ready.jstree', (e, data) => {\n            // console.log('Tree is now ready');\n            // render the root folder contents\n            //let jsTree = $('#jtree').jstree(true);\n            if (this.options.context) {\n                if (this.options.context === 'default') { // TODO: why is default value here?\n                    this.fileExplorer.renderPathContents('/');\n\n                } else {\n                    this.fileExplorer.renderPathContents(this.options.context);\n                }\n\n            } else {\n                if (this.bp.me !== 'Guest') {\n                }\n                this.fileExplorer.renderPathContents('/');\n            }\n\n        }).on(\"select_node.jstree\", (e, data) => {\n            // Get the reference to the jsTree instance\n            var instance = data.instance;\n            var node = data.node;\n            console.log('select_node.jstree', data);\n\n            if (node.children.length > 0) {  // Check if the node has children, indicating it's a folder\n                // Prevent the default select action to toggle on first click\n                e.preventDefault();\n                // Toggle open/close on single click\n                console.log('Selected node:', node.id);\n                this.fileExplorer.currentSelectedNode = node;\n                instance.toggle_node(node);\n            }\n            $('.bp-file-explorer-drag-upload').hide();\n\n        });\n\n        $('.bp-file-explorer-drag-upload').flexShow();\n\n        this.fileExplorer.setPreviewAddressBar('/');\n        // $('.bp-file-explorer-address-input').val('/');\n\n        // TODO: move as much of this logic to the FileExplorer class as possible\n\n        $('#jtree').on(\"delete_node.jstree\", (e, data) => {\n            // delete the file or directory from CDN\n            // console.log(\"delete_node.jstree\", e, data);\n            let node = data.node;\n            // let path = node.id.replace(this.bp.me + '/', ''); // remove the /me/ part from the path\n            let path = node.id;\n            // console.log('jstree request to delete', path);\n\n            // delete the file from the CDN\n            // not needed?\n            //let relativePath = path.replace('https://files.buddypond.com/' + this.bp.me + '/', '');\n            let relativePath = path;\n            // console.log('relativePath', relativePath);\n\n            this.bp.apps.client.api.removeFile(relativePath).then(() => {\n                // console.log('file removed from CDN', relativePath);\n                // console.log('this.fileExplorer.cloudFiles.files', this.fileExplorer.cloudFiles.files);\n\n                this.fileExplorer.cloudFiles.files = this.fileExplorer.cloudFiles.files.filter(file => file !== relativePath);\n                // console.log('this.fileExplorer.cloudFiles.files', this.fileExplorer.cloudFiles.files);\n\n            });\n\n        });\n\n        $('#jtree').on(\"changed.jstree\", (e, data) => {\n            // console.log('changed.jstree', e, data.selected);\n            \n            // determine if the selected node is a file or folder\n            let node = data.instance.get_node(data.selected[0]);\n            // console.log('attempted to get node with id', data.selected[0]);\n            // renderNodeContents(data, node);\n            if (node) {\n                this.fileExplorer.renderPathContents('/' + node.id);\n            } else {\n                console.log('node not found', data.selected[0]);\n            }\n\n        });\n\n        // when click .upload-files, dynamically create input with directory support and click it\n        // take the results and send them to handleDrop\n        $('.upload-files').on('click', async (e) => {\n            // console.log('upload files clicked');\n            let input = document.createElement('input');\n            input.type = 'file';\n            input.multiple = true;\n            input.webkitdirectory = false;\n            input.directory = false;\n            input.click();\n\n            input.onchange = async (e) => {\n                // console.log('files selected', e.target.files);\n                let items = e.target.files;\n                await this.handleUpload(e);\n            };\n        });\n\n        $('.upload-directory').on('click', async (e) => {\n            // console.log('upload directory clicked');\n            let input = document.createElement('input');\n            input.type = 'file';\n            input.multiple = true;\n            input.webkitdirectory = true;\n            input.directory = true;\n            input.click();\n\n            input.onchange = async (e) => {\n                // console.log('files selected', e.target.files);\n                let items = e.target.files;\n                await this.handleUpload(e);\n            };\n        });\n\n        $('.refresh-files').on('click', async (e) => {\n\n            await this.refreshFileTree();\n\n\n        });\n\n        // console.log('got the cloud files', cloudFiles.files);\n        return this;\n\n    }\n\n    async refreshFileTree() {\n\n        if (this.isPolling) {\n            console.log('Already polling for changes, please wait...');\n            return;\n        }\n\n        this.isPolling = true;\n\n        // console.log('previous cloud files', this.fileExplorer.cloudFiles.files);\n        let attempts = 0;\n        const maxAttempts = 10; // You can adjust the maximum number of polling attempts\n    \n        const pollForChanges = async () => {\n            let cloudFiles = await this.getCloudFiles('', 6); // hard-coded to 6 (for now)\n    \n            // Compare current cloud files with previous ones\n            if (!this.areFilesSame(this.fileExplorer.cloudFiles.files, cloudFiles.files)) {\n                // console.log('Cloud files have changed, updating tree...');\n                const treeData = buildJsTreeData(this.bp.me, cloudFiles.files);\n                this.fileExplorer.cloudFiles = cloudFiles;\n    \n                // get the jsTree instance\n                let jsTree = $('#jtree').jstree(true);\n                // re-render the tree contents, we don't wish to destroy our previous configuration\n                jsTree.settings.core.data = treeData;\n                jsTree.refresh();\n                this.isPolling = false;\n                this.fileExplorer.getUsage();\n            } else if (attempts < maxAttempts) {\n                // console.log('No changes detected, trying again...');\n                attempts++;\n                setTimeout(pollForChanges, 1000); // Try again each second\n            }\n\n            if (attempts >= maxAttempts) {\n                // console.log('Max attempts reached, stopping polling...');\n                this.isPolling = false;\n            }\n\n        };\n    \n        pollForChanges();\n    }\n    \n    // Helper function to compare two arrays of files\n    areFilesSame(oldFiles, newFiles) {\n\n        const oldSet = new Set(oldFiles.map(file => file)); // Assuming each file has a unique 'id'\n        const newSet = new Set(newFiles.map(file => file));\n    \n        if (oldSet.size !== newSet.size) {\n            return false;\n        }\n    \n        for (let id of newSet) {\n            if (!oldSet.has(id)) {\n                return false;\n            }\n        }\n    \n        return true;\n    }\n    \n    async remove() {\n        // Clean up the file explorer instance and its event handlers\n        if (this.fileExplorer) {\n            // Remove the drag/drop handler\n            if (this.handleDrop) {\n                // Assuming handleDrop was bound to some element, remove it\n                $('.bp-file-explorer-drag-upload').off('drop', this.handleDrop);\n            }\n\n            // Clean up the jstree events and instance\n            $('#jtree').off('ready.jstree changed.jstree delete_node.jstree');\n            $('#jtree').jstree('destroy');\n\n            // Clean up the editor if it exists\n            if (this.editor) {\n                // Remove the editor instance\n                this.editor.destroy?.();\n                this.editor = null;\n            }\n\n            // Remove DOM elements created by the component\n            $('.bp-file-explorer-file-viewer-editor .pad-editor-holder').remove();\n            $('.bp-file-explorer-drag-upload').remove();\n            $('.bp-file-explorer-address-input').remove();\n\n            // Clear the file explorer instance\n            this.fileExplorer.destroy?.();\n            this.fileExplorer = null;\n            this.handleDrop = null;\n            this.handleUpload = null;\n        }\n    }\n\n    async open({ context } = {}) {\n        // console.log(`Opening file explorer with context ${context}`);\n        this.options.context = context;\n                //alert('context is set to ' + this.options.context);\n\n        this.onUploadComplete = this.options.onUploadComplete || (() => {});\n\n        if (!this.fileExplorer) {\n            this.fileExplorer = this.fileExplorerInstance.create();\n            this.fileExplorer.onUploadComplete = this.onUploadComplete;\n            this.fileExplorer.getCloudFiles = this.getCloudFiles.bind(this);\n            this.fileExplorer.refreshFileTree = this.refreshFileTree.bind(this);\n            this.handleDrop = this.fileExplorer.handleDrop.bind(this.fileExplorer);\n            this.handleUpload = this.fileExplorer.handleUpload.bind(this.fileExplorer);\n        }\n\n        // console.log('created explorer', this.fileExplorer);\n\n\n        if (!this.fileExplorerWindow) {\n            this.fileExplorerWindow = this.bp.apps.ui.windowManager.createWindow({\n                id: 'file-explorer',\n                title: 'Buddy Files',\n                app: 'file-explorer',\n                icon: 'desktop/assets/images/icons/icon_file-explorer_64.png',\n                x: 100,\n                y: 30,\n                width: 1000,\n                height: 600,\n                minWidth: 200,\n                minHeight: 200,\n                parent: $('#desktop')[0],\n                content: this.fileExplorer.container,\n                resizable: true,\n                minimizable: true,\n                maximizable: true,\n                closable: true,\n                focusable: true,\n                maximized: false,\n                minimized: false,\n                onClose: async () => {\n                    // delete the local reference to the file explorer\n\n                    await this.remove();\n\n                    this.fileExplorerWindow = null;\n                }\n            });\n\n            this.fileExplorerWindow.container.classList.add('has-droparea');\n\n            // this window should have no selectable text\n            this.fileExplorerWindow.container.style.userSelect = 'none';\n            this.create();\n\n             this.bp.on('auth::qtoken', 'reload-file-explorer', async (data) => {\n                // console.log('auth::qtoken event received, reloading file explorer');\n                // reload the file explorer\n                // just close and re-open the file explorer window ( for now )\n                // TODO: make it easier to refresh the file explorer session without closing it\n                if (this.fileExplorerWindow) {\n                    await this.remove();\n                    this.fileExplorerWindow.close();\n                }\n                this.fileExplorerWindow = null;\n                this.fileExplorer = null;\n                this.open();\n                \n             });\n\n        } else {\n            // jsTree should be ready at this point ( as file-explorer was already created )\n            // this could have race condition if spammed opened on first load\n            if (this.options.context) {\n                this.fileExplorer.renderPathContents(this.options.context);\n\n            } else {\n                this.fileExplorer.renderPathContents('/');\n\n            }\n\n        }\n        this.fileExplorerWindow.maximize();\n\n        if (this.bp.me === \"Guest\") {\n            $('.upload-message', '.bp-file-explorer-drag-upload').html('Guest account files are read-only.<br/>Please  <button class=\"open-app action-button\" data-app=\"buddylist\">log in</button> to BuddyPond.');\n            $('.storage-used', '.bp-file-explorer-drag-upload').remove();\n\n        }\n        \n\n        return this.fileExplorerWindow;\n    }\n\n    async close() {\n        if (this.fileExplorerWindow) {\n            await this.remove();\n            this.fileExplorerWindow.close();\n            this.fileExplorerWindow = null;\n        }\n    }\n\n}\n\nFileExplorer.prototype.getCloudFiles = getCloudFiles;\nFileExplorer.prototype.buildJsTreeData = buildJsTreeData;","export default async function getCloudFiles(prefix, depth) {\n\n    // users can query their cloud files by glob\n    // users can only modify files in their home directory ( /buddyname )\n\n    // console.log('this.bp getting cloud files', this.bp);\n    // console.log(\"using prefix\", prefix, 'at depth', depth);\n\n    let userFiles = await this.bp.apps.client.api.listFiles(prefix, depth);\n    // console.log('userFiles', userFiles);\n    return userFiles;\n\n}"],"names":["FileTree","constructor","bp","options","this","init","appendCSS","create","container","onFileSelect","file","console","log","onFolderToggle","folder","isExpanded","indent","document","querySelector","treeRoot","createElement","className","appendChild","handleClick","bind","renderItem","addEventListener","event","target","closest","isFolder","dataset","type","path","classList","toggle","nextElementSibling","style","display","getFileIcon","filename","iconMap","js","json","html","css","png","jpg","pdf","default","split","pop","toLowerCase","item","level","itemContainer","itemElement","paddingLeft","icon","textContent","name","Array","isArray","children","childContainer","forEach","child","toggleFolder","render","files","innerHTML","destroy","removeEventListener","removeChild","buildFileTree","paths","root","parts","filter","part","length","current","i","isFile","includes","newPath","slice","join","node","find","push","findNodeByPath","next","mergeTrees","targetNode","newChildren","existingNames","map","newChild","existingChild","FileUploadOverlay","parent","fileExplorer","onUploadComplete","uploadFn","initializeElements","bindEvents","overlay","filesList","totalSize","uploadButton","cancelButton","progressContainer","progressBar","progressPercentage","currentFile","fileCount","startUpload","hide","show","from","renderFiles","updateTotalSize","me","$","formatSize","bytes","Math","floor","pow","toFixed","index","size","totalBytes","reduce","acc","currentStorageRemaining","disabled","add","uploadedFiles","uploadedAllFiles","errors","text","progress","totalProgress","updateProgress","error","append","message","addClass","setTimeout","refreshFileTree","getUsage","uploadFile","onProgress","alert","percentage","roundedPercentage","min","round","width","FileExplorer$1","fileTree","currentSelectedNode","id","load","importModule","fileTreeInstance","mime","onClick","setPreviewAddressBar","val","host","config","emit","FileExplorer","prototype","handleDrop","e","preventDefault","stopPropagation","items","dataTransfer","ignoredFiles","ignoredDirs","shouldIgnore","fileName","fullPath","some","dir","processEntry","entry","Promise","resolve","reject","filePath","isDirectory","createReader","readEntries","entries","all","entryItem","then","flat","catch","promises","webkitGetAsEntry","getAsEntry","uploadOverlay","handleUpload","async","includeRootDirectory","processFile","relPath","webkitRelativePath","pathParts","shift","segment","open","context","fileExplorerInstance","getCloudFiles","fileExplorerWindow","renderPathContents","apps","ui","windowManager","createWindow","title","app","x","y","height","minWidth","minHeight","content","resizable","minimizable","maximizable","closable","focusable","maximized","minimized","onClose","remove","userSelect","client","api","handles","start","stop","on","hasClass","data","instance","jstree","get_node","contents","childNode","renderFolderContents","flexShow","showFile","filesContainer","date","columns","column","columnDiv","Date","toLocaleString","previewPath","replace","cloudFiles","metadata","childPath","lastModified","currentUsage","getFileUsage","currentStorageUsage","usage","storageRemaining","storageLimit","showEditor","flexHide","startsWith","ext","src","attr","fileContents","fetch","fileText","fileMimeType","getType","editor","changeEditorLanguage","setValue","click","BrowserWindow","initialUrl","currentUrl","iframe","history","currentIndex","baseUrl","el","setupEventListeners","navigate","url","setAddressBar","setBaseUrl","setContent","htmlContent","attempts","doc","contentDocument","contentWindow","contentWithBase","write","close","urlInput","backBtn","forwardBtn","reloadBtn","key","value","goBack","goForward","reload","updateAddressBar","updateNavigationButtons","getHistory","PadEditor","parentElement","Error","currentContent","previewMode","flexDirection","controls","contentArea","flex","editorContainer","liveLink","previewFrame","cdn","setupControls","action","onPreview","onEdit","onUpdate","onDelete","button","onclick","loadMonaco","initializeEditor","initializeFileTree","window","require","loadScript","vs","script","onload","onerror","head","monaco","language","theme","automaticLayout","minimap","enabled","newLanguage","model","getModel","setModelLanguage","fileTreeComponent","loadFile","folderPath","getFileContent","getContent","getValue","togglePreview","updatePreview","onCancel","dispose","buildJsTreeData","state","opened","selected","validateTree","nodes","seenIds","Set","has","isPolling","appendScript","FileExplorerClass","onFolderSelect","defaultFileContent","padEditorHolder","relativePath","removeFile","tree","delete_node","err","mimeType","blob","Blob","File","treeData","core","multiple","check_callback","plugins","contextmenu","Delete","separator_before","separator_after","label","obj","toggle_node","input","webkitdirectory","directory","onchange","pollForChanges","areFilesSame","jsTree","settings","refresh","oldFiles","newFiles","oldSet","newSet","off","maximize","prefix","depth","listFiles"],"mappings":"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"}