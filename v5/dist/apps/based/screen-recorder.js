class e{constructor(e,t={}){this.bp=e,this.options=t,this.recorder=null,this.recordedChunks=[],this.stream=null,this.videoBlob=null,this.videoURL=null,this.timerInterval=null,this.secondsElapsed=0}async init(){return this.html=await this.bp.load("/v5/apps/based/screen-recorder/screen-recorder.html"),await this.bp.load("/v5/apps/based/screen-recorder/screen-recorder.css"),"loaded ScreenRecorder"}async open(){return this.win=this.bp.apps.ui.windowManager.createWindow({id:"screen-recorder",title:"Screen Recorder",icon:"desktop/assets/images/icons/icon_console_64.png",x:100,y:75,width:600,height:550,minWidth:400,minHeight:300,parent:$("#desktop")[0],content:this.html,resizable:!0,minimizable:!0,maximizable:!0,closable:!0,focusable:!0,maximized:!1,minimized:!1,onclose:()=>this.cleanup()}),this.bindUI(),this.win}bindUI(){$("#screen-recorder-start",this.win.content).on("click",(()=>this.startRecording())),document.getElementById("screen-recorder-preview").onclick=()=>this.startPreview(),document.getElementById("screen-recorder-stop").onclick=()=>this.stopRecording(),document.getElementById("screen-recorder-download").onclick=()=>this.downloadRecording(),document.getElementById("screen-recorder-screenshot").onclick=()=>this.takeScreenshot(),document.getElementById("screen-recorder-preview-stop").onclick=()=>this.stopPreview()}async startPreview(){try{if(!this.stream){this.stream=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});const e=document.getElementById("screen-recorder-live-video");e.srcObject=this.stream,e.play(),this.togglePreviewUI(!0)}}catch(e){console.error("Error starting screen preview:",e)}}stopPreview(){const e=document.getElementById("screen-recorder-live-video");e.pause(),e.srcObject=null,this.stream&&(this.stream.getTracks().forEach((e=>e.stop())),this.stream=null),this.togglePreviewUI(!1)}startRecording(){this.stream?(this.recordedChunks=[],this.videoBlob=null,this.videoURL=null,this.recorder=new MediaRecorder(this.stream),this.recorder.ondataavailable=e=>{e.data.size>0&&this.recordedChunks.push(e.data)},this.recorder.onstop=()=>{this.generatePreview(),this.stopTimer()},this.recorder.start(),this.startTimer(),this.toggleRecordingUI(!0),console.log("Recording started")):console.warn("Stream not initialized. Please start preview first.")}stopRecording(){this.recorder&&"inactive"!==this.recorder.state&&(this.recorder.stop(),console.log("Recording stopped"),this.toggleRecordingUI(!1))}generatePreview(){this.videoBlob=new Blob(this.recordedChunks,{type:"video/webm"}),this.videoURL=URL.createObjectURL(this.videoBlob);const e=document.getElementById("screen-recorder-preview-video");e.innerHTML="";const t=document.createElement("video");t.src=this.videoURL,t.controls=!0,t.style.width="100%",e.appendChild(t)}togglePreviewUI(e){document.getElementById("screen-recorder-preview").disabled=e,document.getElementById("screen-recorder-preview-stop").disabled=!e,document.getElementById("screen-recorder-screenshot").disabled=!e}downloadRecording(){if(!this.videoBlob)return;const e=document.createElement("a");e.href=this.videoURL,e.download=`buddypond-screen-${Date.now()}.webm`,document.body.appendChild(e),e.click(),document.body.removeChild(e)}async takeScreenshot(){try{this.stream||(this.stream=await navigator.mediaDevices.getDisplayMedia({video:!0}));const e=this.stream.getVideoTracks()[0],t=new ImageCapture(e),r=await t.grabFrame(),s=document.createElement("canvas");s.width=r.width,s.height=r.height,s.getContext("2d").drawImage(r,0,0),s.toBlob((e=>{const t=URL.createObjectURL(e),r=document.createElement("img");r.src=t,r.alt="Screenshot",r.className="screen-recorder-screenshot";document.getElementById("screen-recorder-preview-screenshots").appendChild(r)}),"image/png")}catch(e){console.error("Screenshot error:",e)}}startTimer(){alert("Starting timer");const e=document.getElementById("screen-recorder-indicator"),t=document.getElementById("screen-recorder-timer");this.secondsElapsed=0,this.timerInterval=setInterval((()=>{this.secondsElapsed++;const e=String(Math.floor(this.secondsElapsed/60)).padStart(2,"0"),r=String(this.secondsElapsed%60).padStart(2,"0");t.textContent=`${e}:${r}`}),1e3),e.classList.add("recording")}stopTimer(){clearInterval(this.timerInterval),document.getElementById("screen-recorder-indicator").classList.remove("recording"),document.getElementById("screen-recorder-timer").textContent="00:00"}toggleRecordingUI(e){}cleanup(){this.stopTimer(),this.stream&&this.stream.getTracks().forEach((e=>e.stop()))}}export{e as default};
//# sourceMappingURL=screen-recorder.js.map
