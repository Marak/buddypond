{"version":3,"file":"dictate.js","sources":["../../../apps/based/dictate/dictate.js"],"sourcesContent":["/* Dictate.js - Marak Squires 2025 - BuddyPond */\nexport default class Dictate {\n    constructor(bp, settings = {}) {\n        this.bp = bp;\n        this.settings = {\n            dictationEnabled: settings.dictationEnabled || true,\n            language: settings.language || 'en-US'\n        };\n        this.recognition = null;\n        // this.init(); // do not call init() in constructor, allow bp.init() to call it automatically on load\n    }\n\n    async init() {\n        if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {\n            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n            this.recognition = new SpeechRecognition();\n            this.recognition.continuous = false; // Stop after one sentence\n            this.recognition.interimResults = false; // Only final results\n            this.recognition.lang = this.settings.language;\n            this.available = true;\n\n            this.recognition.onresult = this.onResult.bind(this);\n            this.recognition.onerror = this.onError.bind(this);\n            this.recognition.onend = this.onEnd.bind(this);\n        } else {\n            this.available = false;\n            console.log('Speech Recognition not supported in this browser.');\n        }\n\n        this.bp.dictate = this.start.bind(this);\n\n        await this.bp.appendCSS('/v5/apps/based/dictate/dictate.css');\n    }\n\n\n    open({ targetEl }) {\n        console.log('Opening Dictate recorder...', targetEl);\n        this.targetEl = targetEl;\n        this.start();\n    }\n\n\n    start() {\n        if (!this.available || !this.settings.dictationEnabled) {\n            console.log('Warning: Speech recognition not available or disabled.');\n            return;\n        }\n\n        if (this.listening) {\n            // stop if already listening\n            console.log('Stopping speech recognition as it is already active.');\n            this.stop();\n            //console.log('Speech recognition is already active.');\n            return;\n        }\n\n        this.listening = true;\n        console.log('Starting speech recognition...');\n        this.recognition.start();\n        // add style to targetEl\n        this.targetEl.addClass('dictate-active');\n        // update placeholder text to indicate dictation is active\n        this.targetEl.attr('placeholder', 'Listening... Speak now!');\n        console.log('added class dictate-active to targetEl', this.targetEl);\n    }\n\n    stop() {\n        if (!this.available) return;\n        console.log('Stopping speech recognition...');\n        this.recognition.stop();\n        // remove style from targetEl\n\n    }\n\n    onResult(event) {\n        const transcript = event.results[0][0].transcript;\n        console.log('Recognized text:', transcript);\n        // targetEl is a jquery object\n        if (this.targetEl.val()) {\n            this.targetEl.val(this.targetEl.val() + ' ' + transcript);\n\n        } else {\n            this.targetEl.val(transcript);\n        }\n\n\n    }\n\n    onError(event) {\n        console.error('Speech recognition error:', event.error);\n        if (this.targetEl) {\n            this.targetEl.removeClass('dictate-active');\n            console.log('removed class dictate-active from targetEl', this.targetEl);\n        }\n    }\n\n    onEnd() {\n        console.log('Speech recognition ended.');\n\n        if (this.targetEl) {\n            this.targetEl.removeClass('dictate-active');\n            console.log('removed class dictate-active from targetEl', this.targetEl);\n        }\n        this.listening = false;\n        this.targetEl.attr('placeholder', 'Type your message...');\n\n    }\n\n    enableDictation(enable = true) {\n        this.settings.dictationEnabled = enable;\n    }\n\n    setLanguage(language) {\n        this.settings.language = language;\n        if (this.recognition) {\n            this.recognition.lang = language;\n        }\n    }\n}\n"],"names":["Dictate","constructor","bp","settings","this","dictationEnabled","language","recognition","init","window","SpeechRecognition","webkitSpeechRecognition","continuous","interimResults","lang","available","onresult","onResult","bind","onerror","onError","onend","onEnd","console","log","dictate","start","appendCSS","open","targetEl","listening","stop","addClass","attr","event","transcript","results","val","error","removeClass","enableDictation","enable","setLanguage"],"mappings":"AACe,MAAMA,EACjB,WAAAC,CAAYC,EAAIC,EAAW,IACvBC,KAAKF,GAAKA,EACVE,KAAKD,SAAW,CACZE,iBAAkBF,EAASE,mBAAoB,EAC/CC,SAAUH,EAASG,UAAY,SAEnCF,KAAKG,YAAc,IAE3B,CAEI,UAAMC,GACF,GAAI,sBAAuBC,QAAU,4BAA6BA,OAAQ,CACtE,MAAMC,EAAoBD,OAAOC,mBAAqBD,OAAOE,wBAC7DP,KAAKG,YAAc,IAAIG,EACvBN,KAAKG,YAAYK,YAAa,EAC9BR,KAAKG,YAAYM,gBAAiB,EAClCT,KAAKG,YAAYO,KAAOV,KAAKD,SAASG,SACtCF,KAAKW,WAAY,EAEjBX,KAAKG,YAAYS,SAAWZ,KAAKa,SAASC,KAAKd,MAC/CA,KAAKG,YAAYY,QAAUf,KAAKgB,QAAQF,KAAKd,MAC7CA,KAAKG,YAAYc,MAAQjB,KAAKkB,MAAMJ,KAAKd,KACrD,MACYA,KAAKW,WAAY,EACjBQ,QAAQC,IAAI,qDAGhBpB,KAAKF,GAAGuB,QAAUrB,KAAKsB,MAAMR,KAAKd,YAE5BA,KAAKF,GAAGyB,UAAU,qCAChC,CAGI,IAAAC,EAAKC,SAAEA,IACHN,QAAQC,IAAI,8BAA+BK,GAC3CzB,KAAKyB,SAAWA,EAChBzB,KAAKsB,OACb,CAGI,KAAAA,GACI,GAAKtB,KAAKW,WAAcX,KAAKD,SAASE,iBAAtC,CAKA,GAAID,KAAK0B,UAKL,OAHAP,QAAQC,IAAI,6DACZpB,KAAK2B,OAKT3B,KAAK0B,WAAY,EACjBP,QAAQC,IAAI,kCACZpB,KAAKG,YAAYmB,QAEjBtB,KAAKyB,SAASG,SAAS,kBAEvB5B,KAAKyB,SAASI,KAAK,cAAe,2BAClCV,QAAQC,IAAI,yCAA0CpB,KAAKyB,SAjBnE,MAFYN,QAAQC,IAAI,yDAoBxB,CAEI,IAAAO,GACS3B,KAAKW,YACVQ,QAAQC,IAAI,kCACZpB,KAAKG,YAAYwB,OAGzB,CAEI,QAAAd,CAASiB,GACL,MAAMC,EAAaD,EAAME,QAAQ,GAAG,GAAGD,WACvCZ,QAAQC,IAAI,mBAAoBW,GAE5B/B,KAAKyB,SAASQ,MACdjC,KAAKyB,SAASQ,IAAIjC,KAAKyB,SAASQ,MAAQ,IAAMF,GAG9C/B,KAAKyB,SAASQ,IAAIF,EAI9B,CAEI,OAAAf,CAAQc,GACJX,QAAQe,MAAM,4BAA6BJ,EAAMI,OAC7ClC,KAAKyB,WACLzB,KAAKyB,SAASU,YAAY,kBAC1BhB,QAAQC,IAAI,6CAA8CpB,KAAKyB,UAE3E,CAEI,KAAAP,GACIC,QAAQC,IAAI,6BAERpB,KAAKyB,WACLzB,KAAKyB,SAASU,YAAY,kBAC1BhB,QAAQC,IAAI,6CAA8CpB,KAAKyB,WAEnEzB,KAAK0B,WAAY,EACjB1B,KAAKyB,SAASI,KAAK,cAAe,uBAE1C,CAEI,eAAAO,CAAgBC,GAAS,GACrBrC,KAAKD,SAASE,iBAAmBoC,CACzC,CAEI,WAAAC,CAAYpC,GACRF,KAAKD,SAASG,SAAWA,EACrBF,KAAKG,cACLH,KAAKG,YAAYO,KAAOR,EAEpC"}