(function(e,a){typeof exports=="object"&&typeof module<"u"?module.exports=a():typeof define=="function"&&define.amd?define(a):(e=typeof globalThis<"u"?globalThis:e||self,e.BP=a())})(this,function(){"use strict";const e={};return typeof window<"u"&&(window.bp=e),e.version="6.5.2",e.log=console.log,e.log=function(){},e.error=console.error,e.reportError=function(){},e.mode="dev",(window.location.href.includes("buddypond")||window.location.href.includes("?prod=true"))&&(e.mode="prod"),e.config={host:""},e.apps={},e.data={},e.settings={},e._modules={},e.vendor={},e._cache={},e._cache.css={},e._cache.html={},e._cache.js={},e.setConfig=function(t,o=!1){o?e.config={...e.config,...t}:e.config=t},e.start=async function(t=[]){for(let o of t)await e.importModule(o)},e.open=async function(t,o={context:"default"}){let n=t;if(typeof t=="string"){if(this.apps.desktop&&this.apps.desktop.appList){let i=this.apps.desktop.appList;for(let s in i){let r=this.apps.desktop.appList[s];if(r&&r.alias&&Array.isArray(r.alias)&&r.alias.includes(n)){n=s;break}}}try{await e.importModule(n,{},!0)}catch(i){console.log("Failed to load app:",n,i)}}if(typeof t=="object"&&(n=t.name,o=t,await e.importModule(n,o,!0)),console.log("what is bp.apps[appName]",e.apps[n]),e.apps[n]&&typeof e.apps[n].open=="function"){let i=await e.apps[n].open(o);return i&&typeof i.focus=="function"&&i.focus(),i}},e.load=async function(t,o={}){if(typeof t=="string"){if(t.endsWith(".css"))return e.appendCSS(t);if(t.endsWith(".html"))return e.fetchHTMLFragment(t);if(t.endsWith(".js"))return e.appendScript(t);if(t.endsWith(".json"))return e.fetchJSON(t);if(!t.includes("."))return e.importModule(t,o)}console.log("Cannot load unknown resource type",t)},e.importModule=async function(t,o,n=!0,i){let s=e.config.host+`/v5/apps/based/${t}/${t}.js`,r=t;if(typeof t=="object"&&(o=t,r=t.name,t=r),e.mode==="prod"?s.includes("/card/cards")?(s=e.config.host+`/v5/dist/apps/based/${t}`,s=s.replace("apps/based//v5","")):s=e.config.host+`/v5/dist/apps/based/${t}.js`:s=e.config.host+`/v5/apps/based/${t}/${t}.js`,n||(s=t),s+="?v="+e.version,e._modules[s])return e._modules[s];n&&e.emit("bp::loading",r);try{let c=await import(s);return n&&(e.apps[r]=new c.default(e,o),typeof e.apps[r].init=="function"?(await e.apps[r].init(o),e.log("init complete",r)):e.log("no init function found",r),i&&(e.emit("bp::loaded",r,c),i(e.apps[r]))),e._modules[s]=c,c}catch(c){e.error("Failed to load module:",r,c),delete e.apps[r]}},e.fetchHTMLFragment=async function(t){let o=`${e.config.host}${t}`;return o+="?v="+e.version,e._cache.html[o]||(e._cache.html[o]=await fetch(o).then(n=>n.text())),e._cache.html[o]},e.fetchJSON=async function(t){return fetch(t).then(o=>o.json())},e.appendCSS=async function(t,o=!1,n=!1){let i=t;if(!t.startsWith("http")&&!t.startsWith("blob:"))if(e.mode==="prod"&&n!==!0){const r=t.replace(/^\.\//,"").replace(/\.css$/,"");let c=r;if(r.includes("/card/"))c=`${r}`;else{const l=r.lastIndexOf("/");l!==-1&&(c=r.substring(0,l))}c=c.replace("/v5",""),i=`${e.config.host}/v5/dist/${c}.css`}else i=`${e.config.host}${t}`;if(i+="?v="+e.version,e._cache.css[i]&&!o)return"cached";e._cache.css[i]=new Date().getTime();let s=document.createElement("link");return s.rel="stylesheet",s.href=i,new Promise((r,c)=>{s.onload=()=>{r("loaded")},s.onerror=()=>{c(new Error(`Failed to load CSS from ${i}`))},document.head.appendChild(s)})},e.appendScript=async function(t){let o=t;!t.includes("http")&&!t.includes("blob")&&(o=`${e.config.host}${t}`);let n=document.createElement("script");return n.src=o,document.head.appendChild(n),new Promise((i,s)=>{n.onload=i,n.onerror=s})},e.createWorker=async function(t,o={}){let n=`${e.config.host}/v5${t}`;e.log("createWorker",n);try{const s=await(await fetch(n)).blob(),r=URL.createObjectURL(s);let c=o||{};const l=new Worker(r,c);return e.log("Local Worker created from:",t),l}catch(i){return console.error("Failed to load worker script:",t,i),null}},e._emitters={},e.emit=function(t,...o){e.log("emit",t,...o),e._emitters[t]&&e._emitters[t].forEach(n=>{n.callback&&n.callback(...o)})},e.on=function(t,o,n){if(!t||!o||!n)throw new Error("Missing required parameters for on(). Try: bp.on(event, label, callback). All Event Emitter require a label");e._emitters[t]||(e._emitters[t]=[]),e._emitters[t].push({label:o,callback:n}),e.log("on",t,o)},e.off=function(t,o){e.log("off",t,o),e._emitters[t]&&(e._emitters[t]=e._emitters[t].filter(n=>n.label!==o))},e.set=function(t,o){const n=t.split(".");let i=e.settings,s="";n.slice(0,-1).forEach((c,l)=>{s+=(l>0?".":"")+c,i[c]||(i[c]={}),i=i[c],e.emit(`settings::${s}`,i)});const r=n[n.length-1];s+=(s?".":"")+r,i[r]=o,e.emit("settings",t,o),e.emit(`settings::${s}`,o)},e.get=function(t){const o=t.split(".");let n=e.settings;for(const i of o){if(n[i]===void 0)return;n=n[i]}return n},e.play=async function(){await e.importModule("play"),e.play.call(this,...arguments)},e.focus=function(){},e.isMobile=function(){return window.innerWidth<=767&&("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)},e.me="Guest",e});
