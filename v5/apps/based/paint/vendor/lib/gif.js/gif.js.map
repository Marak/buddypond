{"version":3,"sources":["/gif.coffee","/browser.coffee","events"],"names":["e","d","f","a","b","c","ImageData","CanvasRenderingContext2D","WebGLRenderingContext","Error","console","Math","Worker","Uint8Array","h","k","m","Blob","document","navigator","parseFloat","parseInt","EventEmitter","Array","isArray","Object","prototype","toString","call","setMaxListeners","_events","maxListeners","emit","error","length","arguments","slice","g","apply","addListener","warned","undefined","trace","push","on","once","removeListener","indexOf","splice","removeAllListeners","listeners"],"mappings":"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","sourceRoot":"../src","sourcesContent":["{EventEmitter} = require 'events'\nbrowser = require './browser.coffee'\n\nclass GIF extends EventEmitter\n\n  defaults =\n    workerScript: 'gif.worker.js'\n    workers: 2\n    repeat: 0 # repeat forever, -1 = repeat once\n    background: '#fff'\n    quality: 10 # pixel sample interval, lower is better\n    width: null # size derermined from first frame if possible\n    height: null\n\n  frameDefaults =\n    delay: 500 # ms\n    copy: false\n\n  constructor: (options) ->\n    @running = false\n\n    @options = {}\n    @frames = []\n\n    @freeWorkers = []\n    @activeWorkers = []\n\n    @setOptions options\n    for key, value of defaults\n      @options[key] ?= value\n\n  setOption: (key, value) ->\n    @options[key] = value\n    if @_canvas? and key in ['width', 'height']\n      @_canvas[key] = value\n\n  setOptions: (options) ->\n    @setOption key, value for own key, value of options\n\n  addFrame: (image, options={}) ->\n    frame = {}\n    for key of frameDefaults\n      frame[key] = options[key] or frameDefaults[key]\n\n    # use the images width and height for options unless already set\n    @setOption 'width', image.width unless @options.width?\n    @setOption 'height', image.height unless @options.height?\n\n    if ImageData? and image instanceof ImageData\n       frame.data = image.data\n    else if (CanvasRenderingContext2D? and image instanceof CanvasRenderingContext2D) or (WebGLRenderingContext? and image instanceof WebGLRenderingContext)\n      if options.copy\n        frame.data = @getContextData image\n      else\n        frame.context = image\n    else if image.childNodes?\n      if options.copy\n        frame.data = @getImageData image\n      else\n        frame.image = image\n    else\n      throw new Error 'Invalid image'\n\n    @frames.push frame\n\n  render: ->\n    throw new Error 'Already running' if @running\n\n    if not @options.width? or not @options.height?\n      throw new Error 'Width and height must be set prior to rendering'\n\n    @running = true\n    @nextFrame = 0\n    @finishedFrames = 0\n\n    @imageParts = (null for i in [0...@frames.length])\n    numWorkers = @spawnWorkers()\n    @renderNextFrame() for i in [0...numWorkers]\n\n    @emit 'start'\n    @emit 'progress', 0\n\n  abort: ->\n    loop\n      worker = @activeWorkers.shift()\n      break unless worker?\n      console.log \"killing active worker\"\n      worker.terminate()\n    @running = false\n    @emit 'abort'\n\n  # private\n\n  spawnWorkers: ->\n    numWorkers = Math.min(@options.workers, @frames.length)\n    [@freeWorkers.length...numWorkers].forEach (i) =>\n      console.log \"spawning worker #{ i }\"\n      worker = new Worker @options.workerScript\n      worker.onmessage = (event) =>\n        @activeWorkers.splice @activeWorkers.indexOf(worker), 1\n        @freeWorkers.push worker\n        @frameFinished event.data\n      @freeWorkers.push worker\n    return numWorkers\n\n  frameFinished: (frame) ->\n    console.log \"frame #{ frame.index } finished - #{ @activeWorkers.length } active\"\n    @finishedFrames++\n    @emit 'progress', @finishedFrames / @frames.length\n    @imageParts[frame.index] = frame\n    if null in @imageParts\n      @renderNextFrame()\n    else\n      @finishRendering()\n\n  finishRendering: ->\n    len = 0\n    for frame in @imageParts\n      len += (frame.data.length - 1) * frame.pageSize + frame.cursor\n    len += frame.pageSize - frame.cursor\n    console.log \"rendering finished - filesize #{ Math.round(len / 1000) }kb\"\n    data = new Uint8Array len\n    offset = 0\n    for frame in @imageParts\n      for page, i in frame.data\n        data.set page, offset\n        if i is frame.data.length - 1\n          offset += frame.cursor\n        else\n          offset += frame.pageSize\n\n    image = new Blob [data],\n      type: 'image/gif'\n\n    @emit 'finished', image, data\n\n  renderNextFrame: ->\n    throw new Error 'No free workers' if @freeWorkers.length is 0\n    return if @nextFrame >= @frames.length # no new frame to render\n\n    frame = @frames[@nextFrame++]\n    worker = @freeWorkers.shift()\n    task = @getTask frame\n\n    console.log \"starting frame #{ task.index + 1 } of #{ @frames.length }\"\n    @activeWorkers.push worker\n    worker.postMessage task#, [task.data.buffer]\n\n  getContextData: (ctx) ->\n    return ctx.getImageData(0, 0, @options.width, @options.height).data\n\n  getImageData: (image) ->\n    if not @_canvas?\n      @_canvas = document.createElement 'canvas'\n      @_canvas.width = @options.width\n      @_canvas.height = @options.height\n\n    ctx = @_canvas.getContext '2d'\n    ctx.setFill = @options.background\n    ctx.fillRect 0, 0, @options.width, @options.height\n    ctx.drawImage image, 0, 0\n\n    return @getContextData ctx\n\n  getTask: (frame) ->\n    index = @frames.indexOf frame\n    task =\n      index: index\n      last: index is (@frames.length - 1)\n      delay: frame.delay\n      width: @options.width\n      height: @options.height\n      quality: @options.quality\n      repeat: @options.repeat\n      canTransfer: (browser.name is 'chrome')\n\n    if frame.data?\n      task.data = frame.data\n    else if frame.context?\n      task.data = @getContextData frame.context\n    else if frame.image?\n      task.data = @getImageData frame.image\n    else\n      throw new Error 'Invalid frame'\n\n    return task\n\nmodule.exports = GIF\n","### CoffeeScript version of the browser detection from MooTools ###\n\nua = navigator.userAgent.toLowerCase()\nplatform = navigator.platform.toLowerCase()\nUA = ua.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/) or [null, 'unknown', 0]\nmode = UA[1] == 'ie' && document.documentMode\n\nbrowser =\n  name: if UA[1] is 'version' then UA[3] else UA[1]\n  version: mode or parseFloat(if UA[1] is 'opera' && UA[4] then UA[4] else UA[2])\n\n  platform:\n    name: if ua.match(/ip(?:ad|od|hone)/) then 'ios' else (ua.match(/(?:webos|android)/) or platform.match(/mac|win|linux/) or ['other'])[0]\n\nbrowser[browser.name] = true\nbrowser[browser.name + parseInt(browser.version, 10)] = true\nbrowser.platform[browser.platform.name] = true\n\nmodule.exports = browser\n","if (!process.EventEmitter) process.EventEmitter = function () {};\n\nvar EventEmitter = exports.EventEmitter = process.EventEmitter;\nvar isArray = typeof Array.isArray === 'function'\n    ? Array.isArray\n    : function (xs) {\n        return Object.prototype.toString.call(xs) === '[object Array]'\n    }\n;\n\n// By default EventEmitters will print a warning if more than\n// 10 listeners are added to it. This is a useful default which\n// helps finding memory leaks.\n//\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nvar defaultMaxListeners = 10;\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!this._events) this._events = {};\n  this._events.maxListeners = n;\n};\n\n\nEventEmitter.prototype.emit = function(type) {\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events || !this._events.error ||\n        (isArray(this._events.error) && !this._events.error.length))\n    {\n      if (arguments[1] instanceof Error) {\n        throw arguments[1]; // Unhandled 'error' event\n      } else {\n        throw new Error(\"Uncaught, unspecified 'error' event.\");\n      }\n      return false;\n    }\n  }\n\n  if (!this._events) return false;\n  var handler = this._events[type];\n  if (!handler) return false;\n\n  if (typeof handler == 'function') {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        var args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n    return true;\n\n  } else if (isArray(handler)) {\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    var listeners = handler.slice();\n    for (var i = 0, l = listeners.length; i < l; i++) {\n      listeners[i].apply(this, args);\n    }\n    return true;\n\n  } else {\n    return false;\n  }\n};\n\n// EventEmitter is defined in src/node_events.cc\n// EventEmitter.prototype.emit() is also defined there.\nEventEmitter.prototype.addListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('addListener only takes instances of Function');\n  }\n\n  if (!this._events) this._events = {};\n\n  // To avoid recursion in the case that type == \"newListeners\"! Before\n  // adding it to the listeners, first emit \"newListeners\".\n  this.emit('newListener', type, listener);\n\n  if (!this._events[type]) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  } else if (isArray(this._events[type])) {\n\n    // Check for listener leak\n    if (!this._events[type].warned) {\n      var m;\n      if (this._events.maxListeners !== undefined) {\n        m = this._events.maxListeners;\n      } else {\n        m = defaultMaxListeners;\n      }\n\n      if (m && m > 0 && this._events[type].length > m) {\n        this._events[type].warned = true;\n        console.error('(node) warning: possible EventEmitter memory ' +\n                      'leak detected. %d listeners added. ' +\n                      'Use emitter.setMaxListeners() to increase limit.',\n                      this._events[type].length);\n        console.trace();\n      }\n    }\n\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  } else {\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  var self = this;\n  self.on(type, function g() {\n    self.removeListener(type, g);\n    listener.apply(this, arguments);\n  });\n\n  return this;\n};\n\nEventEmitter.prototype.removeListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('removeListener only takes instances of Function');\n  }\n\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (!this._events || !this._events[type]) return this;\n\n  var list = this._events[type];\n\n  if (isArray(list)) {\n    var i = list.indexOf(listener);\n    if (i < 0) return this;\n    list.splice(i, 1);\n    if (list.length == 0)\n      delete this._events[type];\n  } else if (this._events[type] === listener) {\n    delete this._events[type];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (type && this._events && this._events[type]) this._events[type] = null;\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  if (!this._events) this._events = {};\n  if (!this._events[type]) this._events[type] = [];\n  if (!isArray(this._events[type])) {\n    this._events[type] = [this._events[type]];\n  }\n  return this._events[type];\n};\n"]}