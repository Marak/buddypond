<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge" />
<meta name="description" content="Buddy Pond - A place for buddies to chat." />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Buddy Pond</title>
<!--[if lt IE 7]>
<script>
window.top.location = 'ie.html';
</script>
<![endif]-->

<script type="text/javascript">
  let isMobile = false;
  // certain websites are currently not supported as referrer
  let notCurrentlySupportedSites = ['reddit.com', 'news.ycombinator.com'];
  notCurrentlySupportedSites.forEach(function(site){
    if (document.referrer.search(site) !== -1) {
      alert(site + ' is currently not supported by Buddy Pond. \n\n Please check out our Github or try again later.')
      document.location = 'https://duckduckgo.com/?q=happy+puppies&t=opera&iax=images&ia=images'
    }
  });

  // redirect to the mobile site for smaller screened devices
  if (window.location.search === '?desktop=enabled') {
    // if the desktop is enabled, load as normal
    isMobile = true;
  } else {
    // if desktop enabled flag is not set, check screen size for mobile device
    if (screen.width <= 699) {
      document.location = "mobile.html";
    }
  }
</script>

<link rel="stylesheet" href="desktop/assets/css/reset.css">
<link rel="stylesheet" href="desktop/assets/css/loader.css">

<!--[if lt IE 9]>
<link rel="stylesheet" href="desktop/assets/css/ie.css" />
<![endif]-->

</head>
<body>
<img id="wallpaper" class="abs" src="desktop/assets/images/misc/wallpaper.jpg" />
<div id="loaderHolder">
  <div id="loader"></div>
</div>

<div id="mainOverlay">
  <div class="abs" id="wrapper">
  <div class="abs" id="desktop">
    <canvas class="canvasBackground" id="c"></canvas>
    <a class="abs icon" style="left:20px;top:40px;" href="#icon_dock_buddylist">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_buddylist_64.png" />
      Buddy List
    </a>
    <a class="abs icon" style="left:20px;top:120px;" href="#icon_dock_pond">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_pond_64.png" />
      Buddy Pond
    </a>
    <a class="abs icon" style="left:110px;top:300px;" href="#icon_dock_memepool">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_memepool_64.png" />
      Meme Pool
    </a>
    <a class="abs icon" style="left:20px;top:200px;" href="#icon_dock_interdimensionalcable">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_interdimensionalcable_64.png" />
      Inter Dimensional Cable
    </a>
    <a class="abs icon" style="left:20px;top:380px;" href="#icon_dock_streamsquad">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_streamsquad_64.png" />
      Stream Squad
    </a>

    <a class="abs icon" style="left:110px;top:380px;" href="#icon_dock_paint">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_paint_64.png" />
      Paint
    </a>

    <a class="abs icon" style="left:110px;top:480px;" href="#icon_dock_gifstudio">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_gifstudio_64.png" />
      Gif Studio
    </a>
    <a class="abs icon" style="left:20px;top:480px;" href="#icon_dock_soundrecorder">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_soundrecorder_64.png" />
      Sound Recorder
    </a>
    <a class="abs icon" style="left:110px;top:200px;" href="#icon_dock_mtv">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_mtv_64.png" />
      Music Television
    </a>
    <!--
    <a class="abs icon" style="left:110px;top:500px;" href="#icon_dock_automaton">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_automaton_64.png" />
      Automaton
    </a>
    -->
    <a class="abs icon" style="left:20px;top:300px;" href="#icon_dock_soundcloud">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_soundcloud_64.png" />
      SoundCloud
    </a>
    <a class="abs icon" style="left:110px;top:120px;" href="#icon_dock_games">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_folder_64.png" />
      Games
    </a>
    <a id="login_desktop_icon" class="abs icon" style="left:110px;top:40px;" href="#icon_dock_login">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_login_64.png" />
      Login
    </a>
    <a id="profile_desktop_icon" class="abs icon" style="left:110px;top:40px;" href="#icon_dock_profile">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_profile_64.png" />
      Profile
    </a>
    <!--
      <a class="abs icon" style="right:40px;top:160px;" href="#icon_download_buddypond">
        <img class="emojiIcon" src="desktop/assets/images/icons/icon_32_drive.png" />
        Download Buddy Pond
      </a>
    -->
    <!--
    <a class="abs icon" style="right:20px;top:160px;width:120px;" href="#icon_dock_notifications">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_playpause.png" />
      <span class="label">Enable Notifications</span>
    </a>
    -->

    <a class="abs icon" style="left:20px;top:560px;" href="#icon_dock_mirror">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_mirror_64.png" />
      Mirror
    </a>
    <a class="abs icon" style="left:110px;top:560px;" href="#icon_dock_spellbook">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_spellbook_64.png" />
      Spellbook
    </a>
    <!--
      <a class="abs icon" style="left:110px;top:380px;" href="#icon_dock_gbp">
        <img class="emojiIcon" src="desktop/assets/images/icons/icon_gbp_64.png" />
        GBP
      </a>
    -->
    <a class="abs icon" style="right:20px;top:40px;" href="#icon_dock_settings">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_wallpaper_64.png" />
      Desktop Settings
    </a>

    <!--
    <a class="abs icon" style="right:20px;top:333px;" href="#icon_dock_themes">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_wallpaper_64.png" />
      Switch Themes
    </a>
    -->

    <a class="abs icon" style="right:20px;top:130px;" href="#icon_dock_console">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_console_64.png" />
      Console
    </a>
    <!--
    <a class="abs icon" style="right:20px;top:200px;" href="#icon_dock_settings">
      <img class="emojiIcon" src="desktop/assets/images/icons/icon_console_64.png" />
      Desktop Settings
    </a>
      -->
  </div>
  <div class="abs" id="bar_top">
    <ul>
      <li>
        <!-- Remark: Currently used to log window resize events <div class="debugWindow">DEBUG</div> -->
        <a class="menu_trigger" href="#"><span class="me_title" id="me_title">Welcome - You look nice today!</span></a>
        <ul class="menu">
          <!--
          <li>
            <a class="editProfileLink"  href="#">Set Status - Online</a>
          </li>
          <li>
            <a class="editProfileLink"  href="#">Set Status - Away</a>
          </li>
          <li>
            <a class="editProfileLink"  href="#">Set Status - Predisposed</a>
          </li>
          <li>
            <a class="setStatus"  href="#">Set Status - Custom</a>
          </li>
          <li class="emptyMenuCell">&nbsp;</li>
          <li class="emptyMenuCell">&nbsp;</li>
          -->
          <li>
            <span class="tiny"><em>We are stoked to be your buddy</em></span>
          </li>
          <li class="emptyMenuCell">&nbsp;</li>
          <li>
            <a class="editProfileLink" title="Login to Edit Profile"href="#">Login To Edit Profile</a>
          </li>
          <li>
            <a class="editDesktopSettingsLink"  href="#">Edit Desktop Settings</a>
          </li>
          <li class="emptyMenuCell">&nbsp;</li>
          <li>
            <a class="loginLink" href="#">Login</a>
          </li>
          <li>
            <a class="logoutLink"  href="#">Logout</a>
          </li>
        </ul>
      </li>
    </ul>
    <span class="float_right" id="clock"></span>
    <span class="float_right" id="volume">
      <span class="navbarControl volumeToggle volumeFull">ðŸ”‰</span>
      <span class="navbarControl volumeToggle volumeMuted">ðŸ”‡</span>
    </span>
    <ul class="float_right">
      <li>
        <a class="menu_trigger" href="#">Buddy Pond</a>
        <ul class="menu">
          <li>
            <a href="https://github.com/marak/buddypond">Source Code</a>
          </li>
          <li>
            <a href="https://buddypond.com/sdk/client">Client SDK</a>
          </li>
          <li>
            <a href="https://github.com/marak/buddypond">Home Page</a>
          </li>
        </ul>
      </li>
    </ul>
    <ul class="float_right">
      <li>
        <a class="menu_trigger" href="#">
          <!--
          <span class="desktopConnected float_right">Connection Established</span>
            -->
          <span class="totalConnected float_right"><span class="totalConnectedCount">0</span> Users Connected</span>
          <span class="desktopDisconnected float_right">Disconnected</span>
        </a>
        <ul class="menu connectionDetails">
          <li>
            Connection Started: <span class="connection_ctime"></span> <br/>
            Packets Sent <span class="connection_packets_sent"></span> <br/>
            Packets Recieved <span class="connection_packets_recieved"></span> <br/>
          </li>
          <li>
            Last Response Time: <span class="connection_last_response_time">33ms</span> <br/>
            Average Response Time: <span class="connection_average_response_time">33ms</span> <br/>
            <!-- Server Load <span class="">Low</span> <br/> -->
          </li>
        </ul>
      </li>
    </ul>
    <select name="selectPlaylist" class="desktopSelect selectPlaylist float_right">
      <option>Select music playlist...</option>
      <option value="942151069">Andrew Potthast: Bangas</option>
      <option value="938848927">Andrew Potthast: Burning Man Set</option>
      <option value="1397493787">Buddy House 1 ( 10 Tracks )</option>
      <option value="1397230333">Buddy House 0 ( 33 Tracks )</option>
      <option value="839091662">Featured Indie Producer: Andrew Potthast</option>
    </select>
  </div>
  <div class="abs" id="bar_bottom">
    <a class="float_left" href="#" id="show_desktop" title="Show Desktop">
      <img src="desktop/assets/images/icons/icon_22_desktop.png" />
    </a>
    <ul id="dock">
      <li id="icon_dock_buddy_message_0">
        <a href="#window_buddy_message_0">
          <img class="emojiIcon" src="desktop/assets/images/icons/icon_buddylist_64.png" />
          <span class="dock_title">
            Chat with X
          </span>
        </a>
      </li>
      <li id="icon_dock_pond_message_0">
        <a href="#window_pond_message_0">
          <img width="16" height="16" src="desktop/assets/images/icons/icon_pond_64.png" />
          <span class="dock_title">
            Chat with X
          </span>
        </a>
      </li>
    </ul>
  </div>
</div>
</div>

<link rel="stylesheet" href="desktop/assets/css/desktop.css" />
<link rel="stylesheet" href="desktop/assets/css/jquery.ui.css">

<script src="desktop/assets/js/jquery.js"></script>
<!-- ><script src="desktop/assets/js/jquery.ripples.js"></script> -->
<script src="desktop/assets/js/jquery.ui.js"></script>
<script src="desktop/assets/js/forbidden.notes.js"></script>

<script src="sdk/buddypond.js"></script>
<script src="desktop.js"></script>
<script src="desktop.load.js"></script>
<script src="desktop/assets/js/jquery.desktop.x.js"></script>

<script>
  // see: ReadMe.md for documentation on `desktop.use`
  $(document).ready(function(){
    let documentReadyTime = new Date();
    desktop.log('Buddy Pond Cloud Desktop Initialized');
    desktop.log('Now loading apps');
    desktop
      .use('console')
      .use('localstorage')
      .use('settings')
      .use('wallpaper')
      .use('audioplayer')
      .use('tts')
      .use('notifications')
      .use('buddylist')
      .use('pond')
      .use('streamsquad')
      .use('login', { defer: true })
      .use('mirror', { defer: true })
      .use('spellbook', { defer: true })
      .use('profile', { defer: true })
      .use('videochat', { defer: true })
      .use('automaton', { defer: true })
      .ready(function(err, apps){
        // desktop.log("Loaded", desktop.apps.loaded);
        try {
          desktop.ui.windowResizeEventHandler();
        } catch (err) {
          // alert(err.message)
        }
        desktop.log('Ready:', 'Buddy Pond', 'v4.20.69')
        // Desktop is ready, start refreshing it's state immediately
        desktop.refresh();
        let now = new Date();

        // For Buddy Experience we'll add some fades and delays
        let fadeInDelay = 555;

        // If the page has taken over 3.333 seconds to load...
        // ...reduce the fade in delay ( since the Buddy has waited long enough )
        if (now.getTime() - documentReadyTime.getTime() > 3333) {
          fadeInDelay = 111;
        }
        $('#loaderHolder').fadeOut({
          easing: 'linear',
          duration: fadeInDelay,
          complete: function(){
            $('#mainOverlay').fadeIn({
              easing: 'linear',
              duration: 333
            });
          }
        });

        // TODO: move this to somewhere? its a UI widget scoped to the desktop itself ( nav bar )
        // TODO: add a logic section for handling navbar widgets ( click, conneciton status etc)
        $('.selectPlaylist').on('change', function(){
          $('#soundcloudiframe').remove();
          $('#soundcloudplayer').html('');
          if (desktop.app.soundcloud) {
            desktop.app.soundcloud.embeded = false;
          }
          desktop.ui.openWindow('soundcloud', { playlistID: $(this).val() });
        });

        if (!desktop.settings.audio_enabled) {
          $('.volumeFull').hide();
          $('.volumeMuted').show();
        }

        $('.volumeToggle').on('click', function(){
          if (desktop.settings.audio_enabled) {
            desktop.set('audio_enabled', false);
          } else {
            desktop.set('audio_enabled', true);
          }
        });

        desktop.on('desktop.settings.audio_enabled', 'update-nav-volume', function(){
          if (!desktop.settings.audio_enabled) {
            $('.volumeFull').hide();
            $('.volumeMuted').show();
          } else {
            $('.volumeFull').show();
            $('.volumeMuted').hide();
            desktop.app.audioplayer.play('desktop/assets/audio/IM.wav');
          }
        });

      });
  });

</script>
  <div id="shadowRender">
  </div>
</body>
</html>